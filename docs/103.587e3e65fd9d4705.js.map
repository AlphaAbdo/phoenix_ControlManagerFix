{"version":3,"file":"103.587e3e65fd9d4705.js","mappings":"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","names":["TRatioPlotPainter","ObjectPainter","setGridsRange","xmin","xmax","ratio","this","getObject","x_handle","getPadPainter","findPainterFor","fLowerPad","clTPad","getFramePainter","full_min","full_max","fGridlines","forEach","line","fX1","fX2","redraw","_this","_asyncToGenerator","pp","top_p","fTopPad","disablePadDrawing","up_p","fUpperPad","up_main","getMainPainter","up_fp","low_p","low_main","low_fp","lbl_size","promise_up","Promise","resolve","_ratio_configured","options","Axis","getHisto","fYaxis","fLabelSize","Math","round","min","getPadWidth","getPadHeight","h","fXaxis","fTitle","fTitleSize","getRootPad","fTicky","redrawPad","then","o_zoom","zoom","_ratio_low_fp","_ratio_painter","ymin","ymax","zmin","zmax","res","scale_xmin","scale_xmax","o_sizeChanged","sizeChanged","fX1NDC","fX2NDC","forEachPainterInPad","objp","isFunc","testEditable","arr","currpad","fGridlinePositions","length","gridy","found","fY1","fY2","abs","create","clTLine","fLineStyle","push","undefined","selectCurrentPad","fName","TLinePainter","draw","getDom","all","_ratio_up_fp","dom","opt","painter","ensureTCanvas"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["../node_modules/jsroot/modules/draw/TRatioPlotPainter.mjs"],"sourcesContent":["import { create, clTPad, clTLine, isFunc } from '../core.mjs';\nimport { ObjectPainter } from '../base/ObjectPainter.mjs';\nimport { ensureTCanvas } from '../gpad/TCanvasPainter.mjs';\nimport { TLinePainter } from './TLinePainter.mjs';\n\n\n/**\n * @summary Painter class for TRatioPlot\n *\n * @private\n */\n\nclass TRatioPlotPainter extends ObjectPainter {\n\n   /** @summary Set grids range */\n   setGridsRange(xmin, xmax) {\n      const ratio = this.getObject();\n      if (xmin === xmax) {\n         const x_handle = this.getPadPainter()?.findPainterFor(ratio.fLowerPad, 'lower_pad', clTPad)?.getFramePainter()?.x_handle;\n         if (!x_handle) return;\n         xmin = x_handle.full_min;\n         xmax = x_handle.full_max;\n      }\n\n      ratio.fGridlines.forEach(line => {\n         line.fX1 = xmin;\n         line.fX2 = xmax;\n      });\n   }\n\n   /** @summary Redraw TRatioPlot */\n   async redraw() {\n      const ratio = this.getObject(),\n            pp = this.getPadPainter(),\n            top_p = pp.findPainterFor(ratio.fTopPad, 'top_pad', clTPad);\n      if (top_p) top_p.disablePadDrawing();\n\n      const up_p = pp.findPainterFor(ratio.fUpperPad, 'upper_pad', clTPad),\n            up_main = up_p?.getMainPainter(),\n            up_fp = up_p?.getFramePainter(),\n            low_p = pp.findPainterFor(ratio.fLowerPad, 'lower_pad', clTPad),\n            low_main = low_p?.getMainPainter(),\n            low_fp = low_p?.getFramePainter();\n      let lbl_size = 20, promise_up = Promise.resolve(true);\n\n      if (up_p && up_main && up_fp && low_fp && !up_p._ratio_configured) {\n         up_p._ratio_configured = true;\n         up_main.options.Axis = 0; // draw both axes\n\n         lbl_size = up_main.getHisto().fYaxis.fLabelSize;\n         if (lbl_size < 1) lbl_size = Math.round(lbl_size*Math.min(up_p.getPadWidth(), up_p.getPadHeight()));\n\n         const h = up_main.getHisto();\n         h.fXaxis.fLabelSize = 0; // do not draw X axis labels\n         h.fXaxis.fTitle = ''; // do not draw X axis title\n         h.fYaxis.fLabelSize = lbl_size;\n         h.fYaxis.fTitleSize = lbl_size;\n\n         up_p.getRootPad().fTicky = 1;\n\n         promise_up = up_p.redrawPad().then(() => {\n            up_fp.o_zoom = up_fp.zoom;\n            up_fp._ratio_low_fp = low_fp;\n            up_fp._ratio_painter = this;\n\n            up_fp.zoom = function(xmin, xmax, ymin, ymax, zmin, zmax) {\n               return this.o_zoom(xmin, xmax, ymin, ymax, zmin, zmax).then(res => {\n                  this._ratio_painter.setGridsRange(up_fp.scale_xmin, up_fp.scale_xmax);\n                  this._ratio_low_fp.o_zoom(up_fp.scale_xmin, up_fp.scale_xmax);\n                  return res;\n               });\n            };\n\n            up_fp.o_sizeChanged = up_fp.sizeChanged;\n            up_fp.sizeChanged = function() {\n               this.o_sizeChanged();\n               this._ratio_low_fp.fX1NDC = this.fX1NDC;\n               this._ratio_low_fp.fX2NDC = this.fX2NDC;\n               this._ratio_low_fp.o_sizeChanged();\n            };\n            return true;\n         });\n      }\n\n      return promise_up.then(() => {\n         if (!low_p || !low_main || !low_fp || !up_fp || low_p._ratio_configured)\n            return this;\n\n         low_p._ratio_configured = true;\n         low_main.options.Axis = 0; // draw both axes\n         const h = low_main.getHisto();\n         h.fXaxis.fTitle = 'x';\n         h.fXaxis.fLabelSize = lbl_size;\n         h.fXaxis.fTitleSize = lbl_size;\n         h.fYaxis.fLabelSize = lbl_size;\n         h.fYaxis.fTitleSize = lbl_size;\n         low_p.getRootPad().fTicky = 1;\n\n         low_p.forEachPainterInPad(objp => {\n            if (isFunc(objp?.testEditable))\n               objp.testEditable(false);\n         });\n\n         const arr = [];\n         let currpad;\n\n         if ((ratio.fGridlinePositions.length > 0) && (ratio.fGridlines.length < ratio.fGridlinePositions.length)) {\n            ratio.fGridlinePositions.forEach(gridy => {\n               let found = false;\n               ratio.fGridlines.forEach(line => {\n                  if ((line.fY1 === line.fY2) && (Math.abs(line.fY1 - gridy) < 1e-6)) found = true;\n               });\n               if (!found) {\n                  const line = create(clTLine);\n                  line.fX1 = up_fp.scale_xmin;\n                  line.fX2 = up_fp.scale_xmax;\n                  line.fY1 = line.fY2 = gridy;\n                  line.fLineStyle = 2;\n                  ratio.fGridlines.push(line);\n                  if (currpad === undefined)\n                     currpad = this.selectCurrentPad(ratio.fLowerPad.fName);\n                  arr.push(TLinePainter.draw(this.getDom(), line));\n               }\n            });\n         }\n\n         return Promise.all(arr).then(() => low_fp.zoom(up_fp.scale_xmin, up_fp.scale_xmax)).then(() => {\n            low_fp.o_zoom = low_fp.zoom;\n            low_fp._ratio_up_fp = up_fp;\n            low_fp._ratio_painter = this;\n\n            low_fp.zoom = function(xmin, xmax, ymin, ymax, zmin, zmax) {\n               this._ratio_painter.setGridsRange(xmin, xmax);\n               this._ratio_up_fp.o_zoom(xmin, xmax);\n               return this.o_zoom(xmin, xmax, ymin, ymax, zmin, zmax);\n            };\n\n            low_fp.o_sizeChanged = low_fp.sizeChanged;\n            low_fp.sizeChanged = function() {\n               this.o_sizeChanged();\n               this._ratio_up_fp.fX1NDC = this.fX1NDC;\n               this._ratio_up_fp.fX2NDC = this.fX2NDC;\n               this._ratio_up_fp.o_sizeChanged();\n            };\n            return this;\n         });\n      });\n   }\n\n   /** @summary Draw TRatioPlot */\n   static async draw(dom, ratio, opt) {\n      const painter = new TRatioPlotPainter(dom, ratio, opt);\n\n      return ensureTCanvas(painter, false).then(() => painter.redraw());\n   }\n\n} // class TRatioPlotPainter\n\nexport { TRatioPlotPainter };\n"],"x_google_ignoreList":[0]}