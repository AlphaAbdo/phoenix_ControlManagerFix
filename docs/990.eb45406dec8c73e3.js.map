{"version":3,"file":"990.eb45406dec8c73e3.js","mappings":"+JAOA,MAAMA,UAAuBC,KAE1BC,YAAYC,EAAKC,EAAKC,EAAKC,GACxBC,MAAMJ,EAAKC,EAAKC,GAChBG,KAAKF,QAAUA,CAClB,CAGAG,WAAWC,EAAMC,GACd,MAAMP,EAAMI,KAAKI,YACjB,IAAKR,EAAK,OAAOO,EACbH,KAAKK,YAAWH,EAAOF,KAAKK,UAAYH,GAE5C,MAAMI,EAAaC,IAChB,QAAaC,IAATL,EAAoB,OAAOI,EAC/B,MAAME,SAAcN,EAAMO,SAAcH,EACxC,OAAIE,IAASC,EAAaH,EACb,YAATE,EACY,WAATC,EAAmC,KAARH,GAAwB,MAARA,GAAyB,OAARA,GAA0B,QAARA,IACzEA,EAEE,WAATE,GAAgC,WAATC,EAClBC,WAAWJ,GACdA,GAGV,GAAIX,EAAIgB,OAAOC,EAAG,CACf,MAAMC,EAAQlB,EAAIgB,MAAMC,EAAEX,GAC1B,GAAIY,EAAO,OAAOR,EAAWQ,EAAMC,EACtC,CAEA,GAAIf,KAAKgB,QAAQC,QAAS,CACvB,MAAMC,EAAOlB,KAAKgB,OAAOC,QACzB,QAASE,EAAI,EAAGA,EAAID,EAAKE,SAAUD,EAAG,CACnC,MAAME,EAAQH,EAAKC,GAKnB,IAJenB,KAAKF,SAAYuB,EAAMC,WAAatB,KAAKF,SACzCF,EAAI2B,KAAQF,EAAMC,WAAc,IAAM1B,EAAI2B,KAC1C3B,EAAI4B,WAAcH,EAAMC,WAAc,IAAM1B,EAAI4B,YAElDH,EAAMI,KAAKZ,EAAG,CACxB,MAAMC,EAAQO,EAAMI,IAAIZ,EAAEX,EAAKwB,eAC/B,GAAIZ,EAAO,OAAOR,EAAWQ,EAAMC,EACtC,CACH,CACH,CAEA,OAAOZ,CACV,CAGAwB,UAAUzB,EAAMY,GACb,MAAMlB,EAAMI,KAAKI,YACbJ,KAAKK,YAAWH,EAAOF,KAAKK,UAAYH,GAExCN,GAAKgB,OAAOC,IACbjB,EAAIgB,MAAMC,EAAEX,GAAQ,CAAEa,EAAGD,GAC/B,CAGAc,aAAa1B,EAAM2B,EAAQ1B,GACpB0B,GAAU,IAAGA,EAAS,GAE1B,MAAMf,EAAQd,KAAKC,WAAWC,GAE9B,QAAcM,IAAVM,EACD,OAAOgB,KAAKC,MAAM5B,EAAK0B,GAE1B,GAAqB,iBAAVf,EACR,OAAOgB,KAAKC,MAAMjB,EAAMe,GAE3B,GAAc,OAAVf,EACD,OAAO,EAEV,IAAIkB,EAAO,EAAGC,EAAK,EAAGC,EAAMpB,EAAOqB,EAAU,EAAGC,EAAM,EAEtD,KAAOF,GAAK,CAET,KAAQE,EAAMF,EAAId,SAA0B,MAAbc,EAAIE,IAA+B,OAAbF,EAAIE,OACpDA,EAEL,GAAIA,GAAOF,EAAId,OACZ,MAEH,GAAkB,MAAbc,EAAIE,IAA+B,MAAbF,EAAIE,GAAe,CAC3C,GAAID,EACDE,eAAQC,IAAI,4BAA8BxB,GACnCX,EAEVgC,EAAwB,MAAbD,EAAIE,IAAgB,EAAK,EACpCA,IACA,QACH,CAIA,IAFIA,EAAM,IAAKF,EAAMA,EAAIK,MAAMH,GAAMA,EAAM,GAEnCA,EAAMF,EAAId,SAAcc,EAAIE,IAAQ,KAASF,EAAIE,IAAQ,KAAuB,MAAbF,EAAIE,KAAgBA,IAE/F,MAAMrB,EAAIJ,WAAWuB,EAAIK,MAAM,EAAGH,IAClC,IAAKI,OAAOC,SAAS1B,GAClBsB,eAAQC,IAAK,4BAA2BxB,KACjCgB,KAAKC,MAAM5B,EAAK0B,GAG1BK,EAAMA,EAAIK,MAAMH,GAChBA,EAAM,EACDD,IAASA,EAAU,GACpBD,GAAmB,MAAXA,EAAI,IACbA,EAAMA,EAAIK,MAAM,GAChBP,GAAQG,EAAQpB,EAAE,KACTmB,EAAId,OAAS,GAAkB,MAAXc,EAAI,IAA2B,MAAXA,EAAI,IACrDA,EAAMA,EAAIK,MAAM,GAChBN,GAAME,EAAQpB,GAEdiB,GAAQG,EAAQpB,EAEnBoB,EAAU,CACb,CAEA,OAAOL,KAAKC,MAAMC,EAAKH,EAASI,EACnC,CAGAS,YAAYxC,EAAMC,GACf,IAAI+B,EAAMlC,KAAKC,WAAWC,EAAM,IAChC,IAAKgC,KAAO,EAACS,SAAMT,GAAM,OAAO/B,EAEhC,GAAY,SAAR+B,EAAgB,CACjB,MAAMU,EAAK5C,KAAK6C,gBAChB,QAA4BrC,IAAxBoC,GAAIE,gBAA+B,CACpC,MAAMC,EAAMH,EAAGI,iBACTC,EAAML,EAAGE,kBACf,IAAII,EAAMN,EAAGO,gBAAkB,EAC3BD,EAAM,IAAGA,EAAM,GACnBhB,EAAMa,EAAMA,EAAIK,gBAAiBH,EAAMC,EAAOA,GAAO,OAChDlD,KAAKqD,eAAcrD,KAAKqD,aAAe,CAAC,GAC7CrD,KAAKqD,aAAanD,GAAQgC,CAC7B,MAAWlC,KAAKqD,cAAgBrD,KAAKqD,aAAanD,GAC/CgC,EAAMlC,KAAKqD,aAAanD,IAExBmC,QAAQiB,MAAO,aAAYpD,yCAC3BgC,EAAM,GAEZ,SAAsB,MAAXA,EAAI,GAAY,CACxB,MAAMqB,EAAU5C,WAAWuB,EAAIK,MAAM,EAAGL,EAAId,OAAO,IAEnD,GADAc,EAAM,QACFM,OAAOC,SAASc,GAAU,CAC1B,MAAMR,EAAM/C,KAAK6C,iBAAiBG,iBAC9BD,IAAKb,EAAMa,EAAIK,gBAAgBG,GACvC,CACH,CACA,OAAOrB,CACV,CAIAsB,WAAWtD,EAAMuD,EAAOC,GAChBD,EAEqB,iBAAVA,IACbA,EAAQ,CAAEE,KAAMF,IAFhBA,EAAQ,CAAC,EAIZ,MAAMb,EAAK5C,KAAK6C,gBACVe,EAAQhB,GAAIiB,YAAc,CAAEC,QAAS,QAASC,OAAQ,GAAIC,QAAS,IACnEC,EAAajE,KAAKC,WAAWC,EAAO,SAAU,GAC9CgE,EAAalE,KAAKC,WAAWC,EAAO,SAAUuD,EAAMU,OAAS,QAC7DC,EAAapE,KAAK0C,YAAYxC,EAAO,SAAUuD,EAAMY,OAAS,QAC9DC,EAActE,KAAKC,WAAWC,EAAO,eAAgB0D,EAAME,SAAW,SACtES,EAAavE,KAAKC,WAAWC,EAAO,cAAe0D,EAAMG,QAAU,IACnES,EAAcxE,KAAKC,WAAWC,EAAO,eAAgB0D,EAAMI,SAAW,IAC3E,IAAIS,EAAYzE,KAAKC,WAAWC,EAAO,QAASuD,EAAME,MAAQ,KAE9D,EAAIhB,SAAM8B,KAAYA,EAAY9D,WAAW8D,MACxCjC,OAAOC,SAASgC,IAAeA,GAAa,KAAIA,EAAY,IAC5Df,IAAWA,EAAYd,GAAI8B,gBAAkB,KAElD,MAAMC,EAAU,IAAIC,KAAY,KAAMH,EAAWf,GACjDiB,SAAQE,mBAAmBP,EAAaC,EAAYC,GAEhDP,GAAYU,EAAQG,SAAS,IAAMb,GACpB,SAAfC,GAAuBS,EAAQI,SAASb,GACzB,SAAfE,GAAuBO,EAAQK,SAASZ,GAErCO,CACV,CAGDM,gBAAgBC,KACRA,KAAU,EAACvC,SAAMuC,MAASA,EAAS,SAExC,MAAMb,EAAQrE,KAAK0C,YAAYwC,EAAS,QAAS,IAC3CC,EAAUnF,KAAKC,WAAWiF,EAAS,QAAS,GAElDlF,KAAKoF,cAAc,CAAED,UAASd,QAAOgB,cAAc,GACtD,CAGAC,gBAAgBJ,KACRA,KAAU,EAACvC,SAAMuC,MAASA,EAAS,SAExC,MAAMb,EAAQrE,KAAK0C,YAAYwC,EAAS,QAAS,SAC3CK,EAAQvF,KAAKC,WAAWiF,EAAS,QAAS,GAC1CM,EAAQxF,KAAKC,WAAWiF,EAAS,QAAS,GAC1CC,EAAUnF,KAAKC,WAAWiF,EAAS,WAEzClF,KAAKyF,cAAc,CAAEpB,QAAOkB,QAAOC,QAAOL,YAE3B,YAAXD,GACDlF,KAAK0F,QAAQC,UAAU3F,KAAKC,WAAWiF,EAAS,KAAM,GAAIlF,KAAKC,WAAWiF,EAAS,KAAM,GAC/F,CAGAU,kBAAkBV,KACVA,KAAU,EAACvC,SAAMuC,MAASA,EAAS,WAExC,MAAMb,EAAQrE,KAAK0C,YAAYwC,EAAS,QAAS,SAC3CvB,EAAO3D,KAAKC,WAAWiF,EAAS,OAAQ,KACxCM,EAAQxF,KAAKC,WAAWiF,EAAS,QAAS,GAC1CW,EAAWlC,GAAQ,EAAK,EAAK3D,KAAK6C,iBAAiB6B,gBAAkB,IAE3E1E,KAAK8F,gBAAgB,CAAEzB,QAAOV,OAAM6B,QAAOK,WAC9C,CAIAE,aAAaC,EAAK9F,EAAMY,EAAOmF,GAC5B,IAAKjG,KAAKkG,OACP,OAAO,EAELF,EAAIG,YACNH,EAAIG,UAAa,GAAEC,4BACnBJ,EAAIK,IAAM,GACVL,EAAIM,MAAQ,GACZN,EAAIO,OAAS,GACbP,EAAIQ,QAAS,GAGZxG,KAAKK,YAAWH,EAAOF,KAAKK,UAAYH,GAC5C8F,EAAIK,IAAII,KAAKzG,KAAKkG,QAClBF,EAAIM,MAAMG,KAAKvG,GACf,IAAIN,EAAM,KAOV,GALe,MAAVkB,IACEmF,IAAMA,EAAO,QACL,SAATA,GAAiB5D,QAAQiB,MAAO,iBAAgB2C,sBAGjDA,EACF,cAAenF,GACZ,IAAK,SAAUmF,EAAO,SAAU,MAChC,IAAK,UAAWA,EAAO,UAK7B,OADArG,EAAM,CAAEuG,UAAY,GAAEC,qBACdH,GACL,IAAK,OAAQrG,EAAIuG,WAAa,YAAa,MAC3C,IAAK,UAAWvG,EAAIuG,WAAa,cAAevG,EAAImB,IAAMD,EAAO,MACjE,IAAK,MAAOlB,EAAIuG,WAAa,aAAcvG,EAAImB,EAAI2F,SAAS5F,GAAQ,MACpE,IAAK,SAAUlB,EAAIuG,WAAa,gBAAiBvG,EAAImB,EAAIJ,WAAWG,GAAQ,MAC5E,QAASlB,EAAIuG,WAAa,gBAAiBvG,EAAImB,KAAI4B,SAAM7B,GAASA,EAAQ6F,KAAKC,UAAU9F,GAG5FkF,SAAIO,OAAOE,KAAK7G,IACT,CACV,CAGAiH,kBAAkBb,EAAKc,GACpB,MAAMC,EAAO/G,KAAKgH,iBACdD,GAAQf,GAAKG,iBACI3F,IAAdsG,IACDd,EAAIQ,SAAWM,GAClBC,EAAKE,gBAAgB,GAAIjB,GAE/B,CAMAiB,gBAAgBhB,EAAMD,EAAKkB,GACxB,MAAMH,EAAO/G,KAAKgH,iBAClB,SAAKG,UAAOJ,GAAMK,uBAIbpH,KAAKkG,OAKHa,EAAKK,sBAAsBnB,EAAMD,EAAKhG,KAAMkH,IAJhDlH,KAAKqH,iBAAmB,CAAEpB,OAAMD,MAAKkB,UAC9BlB,GANuC,IAUpD,CAIAsB,aAAaC,GAEV,GADAvH,KAAKkG,OAASqB,EACVvH,KAAKkG,QAAUlG,KAAKqH,iBAAkB,CACvC,MAAMG,EAAIxH,KAAKqH,iBACfrH,KAAKiH,gBAAgBO,EAAEvB,KAAMuB,EAAExB,IAAKwB,EAAEN,eAC/BlH,KAAKqH,gBACf,CACH,CAOAI,aACG,MAAMV,EAAO/G,KAAKgH,iBAClB,OAAKD,GAASA,EAAKK,uBAA0BL,EAAKW,WA1TxC,EAAsC,CA8TnD,CAEAC,eAAiB,OAhUJ,IAgUW3H,KAAKyH,YAA0B,CAEvDG,gBAAkB,OAlUiC,IAkU1B5H,KAAKyH,YAA2B,2HCrT5D,MAAMI,UAAqBrI,IAGxBE,YAAYC,EAAKmI,EAAMC,EAAM1H,GAE1BN,MAAMJ,EADWU,EAAYyH,EAAK1H,YAAc0H,EAC3B,GAAIzH,EAAYyH,EAAKhI,QAAU,QACpDkI,OAAOC,OAAOjI,KAAMkI,MACpBlI,KAAKmI,kBAELnI,KAAK+H,KAAOA,EACR1H,GACDL,KAAKoI,UAAW,EAEhBpI,KAAKK,UAAYA,EACjBL,KAAKgB,OAAS8G,EAAK9G,QAGnBhB,KAAKK,UAAY,OAEvB,CAGAgI,iBACUrI,KAAK+H,YACL/H,KAAKsI,OACZtI,KAAKuI,qBACLxI,MAAMsI,SACT,CAGAG,cAAgB,MAAO,WAAa,CAGpCC,eAAevI,EAAMwI,GAClB1I,KAAKE,KAAOA,EACZF,KAAKiG,KAAO,SACZjG,KAAKsC,KAAM,EACX,MAAMqG,EAAO3I,KAAKC,WAAW,MAAO,GAChC0I,IACD3I,KAAKsC,KAAM,EACXtC,KAAK4I,QAAU,GACX9G,KAAK+G,IAAIF,EAAO7G,KAAKgH,IAAI,IAAM,GAChC9I,KAAK4I,QAAU9G,KAAKgH,IAAI,GAClBH,EAAO,MACb3I,KAAK4I,QAAU9G,KAAKC,MAAM4G,KAEhCD,EAAGK,KAAO/I,KAAKsC,GAClB,CAMA0G,cAAc9I,EAAM+I,EAAKC,EAAKC,EAAMC,EAAMC,EAAUC,EAAaC,EAAYC,GACrEA,IAAMA,EAAO,CAAC,GACnBxJ,KAAKE,KAAOA,EACZF,KAAKyJ,SAAWR,EAChBjJ,KAAK0J,SAAWR,EAChBlJ,KAAKiG,KAAO,SACZjG,KAAKqJ,SAAWA,EAChBrJ,KAAKsC,KAAM,EACX,MAAMqG,EAAO3I,KAAKC,WAAW,MAAO,GAChC0J,EAAU3J,KAAKC,WAAW,SAAU,GAGxC,GAFAD,KAAK4J,QAAUJ,EAAKI,UAAW,EAE3B5J,KAAKC,WAAW,QAAS,CAC1BD,KAAKiG,KAAO,OACZjG,KAAK6J,WAAa,EAClB,IAAIC,EAAU9J,KAAKC,WAAW,mBACdO,IAAZsJ,IACDA,EAAUnJ,WAAWmJ,GACjBtH,OAAOC,SAASqH,KAAU9J,KAAK6J,WAAqB,IAARC,GAEtD,MAAW9J,KAAK+H,MAAMgC,cACnB/J,KAAKiG,KAAO,gBACLjG,KAAKgK,YAEZhK,KAAKiG,KADGuD,EAAKS,OACD,SAEA,SAGG,SAAdjK,KAAKiG,KACNjG,KAAKkK,QAAOC,QAAeC,OAAO,CAACpK,KAAKqK,YAAYlB,GAAOnJ,KAAKqK,YAAYjB,KACrEO,GAAYA,EAAU,GAC7B3J,KAAKsK,OAASX,EACd3J,KAAKkK,QAAOK,QAAiBC,SAASb,GAASS,OAAO,CAACjB,EAAMC,KACrDT,GACJS,GAAQ,IAAGA,EAAO,IACjBD,GAAQ,GAAOA,GAAQC,KACzBD,EAAc,KAAPC,GACVpJ,KAAKsC,KAAM,EACXtC,KAAK4I,QAAU,GACX9G,KAAK+G,IAAIF,EAAO7G,KAAKgH,IAAI,IAAM,GAChC9I,KAAK4I,QAAU9G,KAAKgH,IAAI,GAClBH,EAAO,MACb3I,KAAK4I,QAAU9G,KAAKC,MAAM4G,IAC7B3I,KAAKkK,QAAOO,QAAcC,KAAK1K,KAAK4I,SAASwB,OAAO,CAACjB,EAAMC,KAE3DpJ,KAAKkK,QAAOS,QAAiBP,OAAO,CAACjB,EAAMC,IAE9CpJ,KAAK4K,UAAYzB,EACjBnJ,KAAK6K,UAAYzB,EAEjBpJ,KAAK8K,SAAWvB,GAAc,IAE9B,MAAMwB,EAAQzB,GAAe,CAAC,EAAGtJ,KAAK8K,UAEtC9K,KAAKgL,WAAaD,EAAM,GAAK/K,KAAK8K,SAG/B9K,KAAKkK,KAAKa,MADT/K,KAAK4J,QACU,CAACmB,EAAM,GAAIA,EAAM,IAEjBA,GAGhB/K,KAAKiL,GADU,SAAdjL,KAAKiG,KACI/D,GAAOlC,KAAKkK,KAAKlK,KAAKqK,YAAYnI,IACtClC,KAAKsC,IACDJ,GAAQA,EAAMlC,KAAK4K,UAAc5K,KAAKqJ,SAAWrJ,KAAKkK,KAAKa,QAAQ,GAAG,GAAI,EAAM/K,KAAKkK,KAAKhI,GAE1FlC,KAAKkK,YAEXlK,KAAKkL,OAEZ,MAAMC,EAAOnL,KAAKC,WAAW,OAAQ,KAErCD,KAAKoL,OAASD,EAAO,IACrBnL,KAAKqL,SAAWF,EAAO,IAAQnL,KAAKoL,QAAU,IAC9CpL,KAAKsL,QAAUxJ,KAAKyJ,MAAMJ,EAAK,KAE3BnL,KAAKoL,OAAS,KAAIpL,KAAKoL,OAAS,IAEpC,MAAMN,EAAWhJ,KAAK+G,IAAI7I,KAAK8K,WAAa,IAE5C,GAAkB,SAAd9K,KAAKiG,KAAiB,CACnBjG,KAAKoL,OAAS,IAAGpL,KAAKoL,OAAS,GAEnC,MAAMI,EAAcxL,KAAK6K,UAAY7K,KAAK4K,UACpCa,KAAMC,MAAiBF,EAAcV,GAAU,GACrD,IAAIa,EAAM3L,KAAKC,WAAW,aAAc,MAEnC0L,GAAQH,EAAc,IAAOxL,KAAK0J,SAAW1J,KAAKyJ,aACpDkC,KAAMD,MAAiBF,EAAcxL,KAAKoL,QAAQ,IAErDpL,KAAK4L,OAAS5L,KAAK6L,UAASC,MAAcH,GACtCF,IAAQE,IACT3L,KAAK6L,UAASC,MAAcL,IAE/BzL,KAAKkL,OAASlL,KAAK+L,UACtB,SAAW/L,KAAKsC,IACTtC,KAAKqL,QAAU,IAChBrL,KAAKoL,QAAUpL,KAAKqL,QACpBrL,KAAKqL,QAAU,GAElBrL,KAAKgM,MAAQhM,KAAKC,WAAW,SAAS,GACjCD,KAAK6K,UAAY,KAAS7K,KAAK4K,UAAY,IAA0B,KAAjB5K,KAAK4I,UAAiB5I,KAAKgM,OAAQ,GAC5FhM,KAAKiM,cAAgBjM,KAAKC,WAAW,eAAe,GAEpDD,KAAKkL,OAASlL,KAAKkM,kBACG,WAAdlM,KAAKiG,KAAmB,CAChCjG,KAAKoL,OAAS,GACd,MAAMI,EAAcxL,KAAK6K,UAAY7K,KAAK4K,UACtC5K,KAAKoL,OAASI,IACfxL,KAAKoL,OAAStJ,KAAKC,MAAMyJ,IAC5BxL,KAAKqL,QAAU,EAEfrL,KAAKkL,OAASlL,KAAKmM,YACtB,MACGnM,KAAKoM,MAAQ,EACbpM,KAAKqM,KAAO,EACZrM,KAAKkL,OAASlL,KAAKsM,YAEzB,CAGAC,cACG,OAAOvM,KAAKkK,KAAOlK,KAAKkK,KAAKE,SAAS,GAAK,CAC9C,CAGAoC,cACG,OAAOxM,KAAKkK,KAAOlK,KAAKkK,KAAKE,SAAS,GAAK,CAC9C,CAGA+B,aAAaM,GACV,MAAMC,EAAO5K,KAAKC,MAAM0K,GACxB,GAAIzM,KAAK+H,MAAMgC,aAAc,CAC1B,GAAK2C,EAAO,GAAOA,GAAQ1M,KAAK+H,KAAK4E,aAAe,OAAO,KAC3D,QAASC,EAAI,EAAGA,EAAI5M,KAAK+H,KAAKgC,aAAa3I,SAAUwL,EAAG,CACrD,MAAMC,EAAO7M,KAAK+H,KAAKgC,aAAa6C,GACpC,GAAIC,EAAKC,SAAWJ,EAAM,OAAOG,EAAKE,KACzC,CACH,KAAO,CACJ,MAAM9C,EAASjK,KAAKI,YAAY4M,QAChC,GAAI/C,GAAWyC,GAAQ,GAAOA,EAAOzC,EAAO7I,OACzC,OAAO6I,EAAOyC,EACpB,CACA,OAAO,IACV,CAGAO,YAAYC,EAAqBC,EAAaC,EAAaC,GACpDD,GAAepN,KAAKoL,QAAyB,WAAdpL,KAAKiG,OAAoBjG,KAAKsN,YAAa,GAE9E,MAAMC,EAAS,CAAEC,OAAQ,EAAGC,QAAS,EAAGC,OAAQ,EAAGxD,KAAMlK,KAAKkK,MAI9D,GAFAqD,EAAOI,MAAQJ,EAAOK,OAASL,EAAOM,MAAQ7N,KAAK8N,aAAa9N,KAAKoL,QAEjE8B,EAAqB,CACtB,MAAM3M,EAAMgN,EAAOM,MAAOE,EAA0C,MAAjC/N,KAAK6K,UAAY7K,KAAK4K,WACzD,OAAIrK,EAAI,GAAKP,KAAK4K,UAAYmD,GAAOxN,EAAIyN,QAAQhO,KAAK4K,WAClDrK,EAAIA,EAAIa,OAAO,GAAKpB,KAAK6K,UAAYkD,GAAOxN,EAAIkG,KAAKzG,KAAK6K,WACvDtK,CACV,CAEA,GAAKP,KAAKqL,QAAU,KAAQrL,KAAKsC,KAAyB,KAAjBtC,KAAK4I,SAAkB,CAC7D2E,EAAOI,MAAQJ,EAAOK,OAAS5N,KAAK8N,aAAaP,EAAOM,MAAMzM,OAAQpB,KAAKqL,SAE3E,MAAMP,EAAWhJ,KAAK+G,IAAI7I,KAAKkK,KAAKa,QAAQ,GAAK/K,KAAKkK,KAAKa,QAAQ,IAG9DwC,EAAOK,OAAOxM,QAAUmM,EAAOM,MAAMzM,QAAYmM,EAAOK,OAAOxM,OAAS0J,EAAS,IACnFyC,EAAOI,MAAQJ,EAAOK,OAASL,EAAOM,MAC9B7N,KAAKsL,QAAU,IAAOtL,KAAKsC,MACnCiL,EAAOI,MAAQ3N,KAAK8N,aAAaP,EAAOK,OAAOxM,OAAQpB,KAAKsL,UACvDiC,EAAOI,MAAMvM,QAAUmM,EAAOK,OAAOxM,QAAYmM,EAAOI,MAAMvM,OAAS0J,EAAS,OAAMyC,EAAOI,MAAQJ,EAAOK,QAEvH,CA0CA,GAxCAL,EAAOU,MAAQ,WACZjO,KAAKwN,OAASxN,KAAKyN,QAAUzN,KAAK0N,OAAS,CAC9C,EAEAH,EAAOW,KAAO,SAASC,GACpB,QAAInO,KAAKwN,QAAUxN,KAAK2N,MAAMvM,SAE9BpB,KAAKoO,KAAOpO,KAAK2N,MAAM3N,KAAKwN,UAC5BxN,KAAKqO,MAAQrO,KAAKkK,KAAKlK,KAAKoO,MACxBD,IAASnO,KAAKqO,MAAQvM,KAAKC,MAAM/B,KAAKqO,QAC1CrO,KAAKiG,KAAO,EAEPjG,KAAKyN,QAAUzN,KAAK4N,OAAOxM,QAAYU,KAAK+G,IAAI7I,KAAKqO,MAAQrO,KAAKkK,KAAKlK,KAAK4N,OAAO5N,KAAKyN,WAAa,IACvGzN,KAAKyN,UACLzN,KAAKiG,KAAO,GAGVjG,KAAK0N,OAAS1N,KAAK6N,MAAMzM,QAAYU,KAAK+G,IAAI7I,KAAKqO,MAAQrO,KAAKkK,KAAKlK,KAAK6N,MAAM7N,KAAK0N,UAAY,IACnG1N,KAAK0N,SACL1N,KAAKiG,KAAO,GAER,GACV,EAEAsH,EAAOe,WAAa,WACjB,OAAsB,IAAdtO,KAAKiG,MAAsBjG,KAAK0N,SAAW1N,KAAK6N,MAAMzM,MACjE,EAEAmM,EAAOgB,iBAAmB,WACvB,OAAIvO,KAAK0N,QAAU1N,KAAK6N,MAAMzM,OAAe,KACtCpB,KAAKkK,KAAKlK,KAAK6N,MAAM7N,KAAK0N,QACpC,EAEAH,EAAOiB,aAAe,WAAa,OAAO,IAAM,EAEhDxO,KAAKoM,MAAQ,EACbpM,KAAKqM,KAAO,EAIO,WAAdrM,KAAKiG,OAAuBjG,KAAKsC,KAAQiL,EAAOM,MAAMzM,OAAS,EAAI,CACrE,IAAIqN,EAAW,EAAGC,EAAW,EAAGC,GAAa,EAE7C,IAAKxB,EAAa,CACf,MAAMyB,EAAU9M,KAAKoH,IAAIpH,KAAK+G,IAAI0E,EAAOM,MAAM,IAAK/L,KAAK+G,IAAI0E,EAAOM,MAAMN,EAAOM,MAAMzM,OAAO,KAC1FyN,EAAU/M,KAAKmH,IAAInH,KAAK+G,IAAI0E,EAAOM,MAAM,IAAK/L,KAAK+G,IAAI0E,EAAOM,MAAMN,EAAOM,MAAMzM,OAAO,KACxF0N,EAAQF,EAAU,EAAuC,EAAlC9M,KAAKC,MAAMD,KAAKiN,MAAMH,GAAS,GAAO,EAC7DI,EAAQH,EAAU,EAAuC,EAAlC/M,KAAKC,MAAMD,KAAKiN,MAAMF,GAAS,GAAO,EAEhEF,EAAcC,EAAU,KAEpBA,GAAWC,KACZJ,EAAW3M,KAAKoH,IAAI4F,EAAME,GAAQ,EAClCN,EAAW5M,KAAKmH,IAAI6F,EAAME,GAAQ,EAEzC,CAIA,IAAIC,EAAY,EAAGC,EAAWlP,KAAKqM,KAAM8C,EAAU,KAEnD,QAAS/C,EAAQsC,EAAUtC,GAASqC,EAAUrC,GAAO,EAAG,CACrD,GAAIuC,GAAuB,IAARvC,EAAY,SAC/BpM,KAAKoM,MAAQA,EACbpM,KAAKqM,KAAO,EACZ,IAAI+C,EAAO,GAAI1C,EAAO,EAAG2C,EAAW,EACpC,KAAO3C,EAAKa,EAAOM,MAAMzM,QAAQ,CAC9B,MAAMkO,EAAMtP,KAAKkL,OAAOqC,EAAOM,MAAMnB,IAAO,GAC5C,GAAI0C,EAAKG,QAAQD,GAAO,EACrBF,EAAK3I,KAAK6I,GACVD,GAAYC,EAAIlO,OAChBsL,QAHH,CAMA,KAAM1M,KAAKqM,KAAO,GAAI,MACtB+C,EAAO,GAAI1C,EAAO,EAAG2C,EAAW,CAFhC,CAGH,EAGKjD,GAAUpM,KAAKqM,KAAO,IACxBgD,GAAmC,EAAtB9B,EAAOM,MAAMzM,OAAa,GAEtCiO,EAAWF,IACZA,EAAUE,EACVJ,EAAYjP,KAAKoM,MACjB8C,EAAWlP,KAAKqM,KAEtB,CAEArM,KAAKoM,MAAQ6C,EACbjP,KAAKqM,KAAO6C,EAER7B,IACGrN,KAAKoM,OAAO/J,QAAQmN,KAAM,gEAA+DxP,KAAKoM,uBAC9FpM,KAAKqM,MAAMhK,QAAQmN,KAAM,qDAAoDxP,KAAKqM,oCACtFrM,KAAKqM,KAAO,EACZrM,KAAKoM,MAAQ,EAEnB,CAEA,OAAOmB,CACV,CAGAkC,mBACG,MAAkB,WAAdzP,KAAKiG,MACS,QAAdjG,KAAKiG,MACFjG,KAAKC,WAAW,iBAAiB,EAC3C,CAIAyP,kBAAkBC,EAAKvN,GACpB,GAAIpC,KAAK4P,cAAgB5P,KAAKsI,OAAQ,OAAO,EAE7C,MAAMuH,EAAU7P,KAAKsI,OAAOwH,OAAO,gBACnC,IAAKD,GAA+B,IAAnBA,EAAQlM,OAAe,OAAO,EAE/C,GAAY,UAARgM,EAAiB,CAElB,MAAMI,EAAMF,EAAQG,OAAOC,UAE3BJ,SAAQK,OAAO,QACNC,QAAQ,QAAQ,GAChBC,KAAK,IAAKL,EAAIM,GACdD,KAAK,IAAKL,EAAIO,GACdF,KAAK,QAASL,EAAIxK,OAClB6K,KAAK,SAAUL,EAAIQ,QACnB/K,MAAM,SAAU,QAChBgL,KAAKC,MAAmB,GAE9BzQ,KAAK0Q,UADJ1Q,KAAKqJ,SACWjH,EAAI,GAEJA,EAAI,IAGjB,CACV,CAEA,IAAIuO,EAASd,EAAQe,SAAS,cAW9B,GATI5Q,KAAKqJ,UACNsH,GAAU7O,KAAKC,MAAMK,EAAI,GAAKpC,KAAK0Q,WACnCb,EAAQO,KAAK,YAAc,aAAYO,QAEvCA,GAAU7O,KAAKC,MAAMK,EAAI,GAAKpC,KAAK0Q,WACnCb,EAAQO,KAAK,YAAc,eAAcO,OAEvCA,GAAQd,EAAQO,KAAK,YAAa,MAE3B,SAART,IACDE,EAAQC,OAAO,aAAae,gBACrB7Q,KAAK0Q,UACRC,IAAWd,EAAQe,SAAS,eAAe,CAC5Cf,EAAQe,SAAS,aAAcD,GAC/B,MAAMG,EAAOjB,EAAQe,SAAS,SAAW,EACzC5Q,KAAK+Q,aAAeJ,GAAU3Q,KAAKqJ,UAAYyH,EAAOA,GACtD9Q,KAAKgR,eAAe,EAAG,gBAAiBhR,KAAK+Q,aAAe/Q,KAAKiR,YACpE,CAGH,OAAO,CACV,CAGAC,aAAaC,EAASL,GACnB,IAAKM,WAASC,YAAcrR,KAAKsR,cAAe,OAEhD,IACIC,EAAOC,EAAOC,EAAOC,EAAOC,EAASC,EADrCC,EAAY,KAGhB,MAAMC,KAAYC,QAAUC,QAAQhK,QAEpC8J,EACIG,GAAG,QAASC,IACVA,EAAKC,YAAYC,iBACjBF,EAAKC,YAAYE,kBAEjB,MAAMtC,EAAMoB,EAAQnB,OAAOC,UACvBqC,EAAetS,KAAKqJ,SAAW0G,EAAIQ,OAASR,EAAIxK,MAEpDkM,EAAQF,EAAQJ,EAAQP,SAAS,WACjCc,EAAQF,EAAQL,EAAQP,SAAS,WAG9BgB,EADmB,WAAlB5R,KAAKuS,SACM,EAEmB,SAAlBvS,KAAKuS,SAAuB,EAAI,EAGhDZ,EAAU,CAAC,EAAG3R,KAAK8K,SAAS,EAAG9K,KAAK8K,UACpC,MAAM0H,EAAMxS,KAAKqJ,UAAYiJ,EAAeA,EACxCG,EAAOzS,KAAK0S,gBAAkB,EAAI,EACb,WAArB1S,KAAK2S,aACNhB,EAAQc,IAASD,EAAI,EACrBb,EAAQ,EAAEc,IAASD,EAAI,GACO,UAArBxS,KAAK2S,YAA2B3S,KAAK4S,kBAC9CjB,EAAQ,IAAMa,EAAI,EAClBb,EAAQ,EAAEc,IAASD,IAEnBb,EAAQc,IAASD,EACjBb,EAAQ,IAAMa,EAAI,GAGrBb,EAAQC,GAAa5R,KAAKqJ,SAAWmI,EAAQD,EAE7CM,EAAYV,EAAQjB,OAAO,QACrBE,KAAK,IAAKL,EAAIM,GACdD,KAAK,IAAKL,EAAIO,GACdF,KAAK,QAASL,EAAIxK,OAClB6K,KAAK,SAAUL,EAAIQ,QACnB/K,MAAM,SAAU,QAChBgL,KAAKC,MAAmB,EAAI,GAEjCwB,GAAG,OAAQC,IACT,IAAKL,EAAW,OAEhBK,EAAKC,YAAYC,iBACjBF,EAAKC,YAAYE,kBAEjBd,GAASW,EAAKW,GACdrB,GAASU,EAAKY,GAEd,MAAMtL,EAAIxH,KAAKqJ,SAAWmI,EAAQD,EAClC,IAAIwB,EAAOC,EAAOC,EAAQ,EAE1B,QAASrG,EAAI,EAAGA,EAAI,IAAKA,EAClB9K,KAAK+G,IAAIrB,EAAImK,EAAQ/E,IAAM9K,KAAK+G,IAAIrB,EAAImK,EAAQsB,MAASA,EAAQrG,GAEpE5M,KAAKqJ,UACN0J,EAAQxB,EACRyB,EAAQrB,EAAQsB,KAEhBF,EAAQpB,EAAQsB,GAChBD,EAAQxB,GAGXC,EAAQsB,EAAOrB,EAAQsB,EAAOpB,EAAYqB,KAC1CC,MAAc/B,EAASM,EAAOC,EAAK,GACrCO,GAAG,MAAOC,IACR,IAAKL,EAAW,OAEhBK,EAAKC,YAAYC,iBACjBF,EAAKC,YAAYE,kBAEjB,MAAMc,EAAUhC,EAAQP,SAAS,YAAc,EAE/CO,EAAQP,SAAS,UAAWa,GACpBb,SAAS,UAAWc,GAE5B1R,KAAKoT,aAAepT,KAAKqJ,SAAW8J,EAAU1B,EAAQC,EAAQyB,GAAWrC,EAGtE9Q,KAAKuS,SADU,IAAdX,EACe,SACK,IAAdA,EACS,OAEA,QAEnB5R,KAAKgR,eAAe,EAAG,iBAAkBhR,KAAKuS,SAAU,eAAgBvS,KAAKoT,YAAcpT,KAAKiR,aAEhGY,EAAUhB,SACVgB,EAAY,OAGrBV,EAAQ3L,MAAM,SAAU,QAAQgL,KAAKsB,EACxC,CAGAuB,gBAAgBjR,EAAKkR,EAAQC,GAG1B,OAFKD,IAAQA,EAAS,QACP9S,IAAX+S,IAAsBA,EAASD,GAC/BtT,KAAK8K,SAAW,EACT1I,GAAOpC,KAAK8K,SAAWyI,GAAYnR,GAAOkR,EAC7ClR,IAAQkR,GAAYlR,GAAOpC,KAAK8K,SAAWyI,CACtD,CAGAC,WAAWzF,GAER,OADKA,IAAOA,EAAQ,GAChB/N,KAAK8K,SAAW,EACV9K,KAAK8K,SAAWiD,EACnB/N,KAAK8K,SAAWiD,CAC1B,CAGA2E,gBACG,OAAQ1S,KAAKqJ,UAAcrJ,KAAKwT,aAAe,CAClD,CAIAC,aAAanL,GACV,IAAIoL,EAAS,GAEb,GAAI1T,KAAK2T,YAAc3T,KAAK4T,YAAa,CACtC,IAAIC,EAAM7T,KAAK8K,SAAW,GAAM9K,KAAK2T,WAAa3T,KAAK2T,WACvD,MAAMG,EAAMhS,KAAKC,MAAS,GAAH8R,GACvBA,EAAK/R,KAAKC,MAAM8R,GAEbH,EADC1T,KAAKqJ,SACI,IAAGyK,KAAOD,OAAQ7T,KAAK8K,aAAagJ,KAAOD,IAE3C,IAAGA,KAAMC,KAAO9T,KAAK8K,cAAc+I,MAAOC,GAC1D,CAEAxL,EAAO4H,OAAO,YACPE,KAAK,IAAK,QAAUpQ,KAAKqJ,SAAW,IAAM,KAAOrJ,KAAK8K,SAAW4I,GACjElD,KAAKxQ,KAAK0F,QAAQwE,MAClB1E,MAAM,OAAQkO,EAAS,OAAS,KAC1C,CAKAK,UAAUzL,EAAQwI,EAAMkD,GACjBA,IAAWhU,KAAKiU,MAAQ,IAE5BjU,KAAKuN,OAAOU,QAEZ,IAAI1N,EAAM,GAAI2T,EAAkB,EAMhC,IALuB,SAAnBlU,KAAKmU,YACNrD,EAAO,EACPoD,EAAkB,GAGdlU,KAAKuN,OAAOW,MAAK,IAAO,CAC5B,IAAIkG,EAAKtS,KAAKC,MAAM/B,KAAKqU,UAAU,GAAIC,EAAK,EAExCtU,KAAKuN,OAAOtH,KAAO,IACpBmO,EAAKtS,KAAKC,MAAM/B,KAAKqU,UAAU,IAElC,MAAMhG,EAAQrO,KAAKuN,OAAOc,MAAQrO,KAAKgL,YAElChL,KAAKuU,cAAgBvU,KAAK2T,cAAgB3T,KAAKqT,gBAAgBhF,GAAQvM,KAAK+G,IAAI7I,KAAKuU,eAAgBzS,KAAK+G,IAAI7I,KAAK2T,eAE/F,IAArB3T,KAAKuN,OAAOtH,QAEM,WAAdjG,KAAKiG,MAA+D,OAAxCjG,KAAKkL,OAAOlL,KAAKuN,OAAOa,MAAM,MAAiBgG,EAAKpU,KAAKqU,WAEtFL,GAAWhU,KAAKiU,MAAMxN,KAAK4H,IAG9B6F,EAAkB,EACnBI,GAAMF,EACAtD,EAAO,GACbwD,GAAMF,EAAIA,EAAK,GAEfE,EAAK,EAER/T,GAAOP,KAAKqJ,SAAY,IAAG+K,KAAM/F,KAASiG,IAAQ,IAAGjG,MAAU+F,MAAOE,IACzE,CAEI/T,GACD+H,EAAO4H,OAAO,YACPE,KAAK,IAAK7P,GACViF,MAAM,SAAUxF,KAAKwU,YAAcxU,KAAK0F,QAAQrB,OAChDmB,MAAM,eAAiBxF,KAAKyU,YAAmC,IAApBzU,KAAKyU,WAA2BzU,KAAKyU,WAAZ,MAG7E,MAAMC,EAAO5S,KAAKC,MAAM,IAAK/B,KAAKqU,WAAYM,EAAM7S,KAAKC,MAAM,KAAK/B,KAAKqU,WACzE,MAAO,CAAE,KAAOvD,EAAO,GAAMoD,EAAkBS,EAAMD,EAC1C,EAAI5D,EAAO,GAAMoD,EAAkBS,EAAMD,EACxD,CAIME,WAAWtM,EAAQwI,EAAM+D,GAAM,IAAAC,EAAA9U,KAAA,SAAA+U,KAAA,YAClC,MAAMC,EAAcF,EAAKrF,mBACnBwF,EAAwC,IAA1BH,EAAKI,WAAWC,MAC9BtF,EAAUvH,EAAO4H,OAAO,SAASE,KAAK,QAAS,eAAeQ,SAAS,OAAQE,GAC/EsE,EAAUN,EAAKvH,OAAO6H,SAAWN,EAAKvH,OAAOM,MACnD,IAAIwH,EAAY,EAAGC,EAAa,EAAGC,GAAY,EAC3CC,EAAgB,EAAGC,EAAiB,EAGxC,SAASC,EAAuBC,GAC7BH,EAAgB1T,KAAKoH,IAAIsM,EAAexV,KAAK4V,cAC7CH,EAAiB3T,KAAKoH,IAAIuM,EAAgBzV,KAAK6V,eAE/C,MAAMC,EAAY9V,KAAK4V,aAEvB,GAAIE,KAAgBH,EAAQtM,WAAa4L,GAAiBU,EAAQtM,UAAY4L,KAAkBU,EAAQrT,IAAK,CAC1G,IAAIyT,EAA2B,IAAhB/V,KAAKgW,WAAiC,IAAfhW,KAAKiW,UACtCjW,KAAKgW,WACLhW,KAAKiW,YAAWF,EAAW,GAAI/V,KAAKgW,YADnBD,EAAW,GAAI/V,KAAKiW,UAE1CZ,EAAYvT,KAAKmH,IAAIoM,EAAWU,EAAWD,EAC9C,CAEKT,EAAY,MAAYA,EAAY,KAASM,EAAQtM,WAAa4L,GAAgBK,EAAa,GAAOxE,EAAO,IAC/GyE,GAAY,GAEf,MAAMW,EAAQb,GAAaE,EAAY,EAAI,GACtCW,EAAQ,MAAYA,EAAQ,GAC9BP,EAAQQ,iBAAiB,EAAED,EAAOrG,EACxC,CAEA,MAAMuG,EAAatU,KAAKC,OAAO+S,EAAKzL,UAAYyH,EAAOA,GAAQgE,EAAK/D,cAC9DsF,EAAYvU,KAAKC,OAAO+S,EAAKzL,UAAYyH,EAAOA,GAAQ+D,EAAK/D,IACnE,IAAIwF,EAAU,EAEVF,GACDvG,EAAQO,KAAK,YAAa0E,EAAKzL,SAAY,aAAY+M,KAAiB,eAAcA,MAEzFvG,EAAQe,SAAS,aAAcwF,GAE/BtB,EAAKyB,iBAAiBzB,EAAKI,WAAY,OAAQrF,GAE/C,QAASnC,EAAS,EAAGA,EAAS0H,EAAQhU,SAAUsM,EAAQ,CACrD,MAAM4B,EAAMwF,EAAK5J,OAAOkK,EAAQ1H,IAAS,GACzC,GAAY,OAAR4B,EAAc,SAElB,MAAMK,EAAM,CAAE6G,KAAMlH,EAAKmH,MAAO,EAAGC,OAAQ7G,GAC3C,IAAIzN,EAAMN,KAAKC,MAAM+S,EAAK5K,KAAKkL,EAAQ1H,KAKvC,GAHAiC,EAAIqG,WAActI,EAAS,EAAK5L,KAAK+G,IAAI/G,KAAKC,MAAMK,EAAM0S,EAAK5K,KAAKkL,EAAQ1H,EAAO,MAAQ,EAC3FiC,EAAIsG,UAAavI,EAAS0H,EAAQhU,OAAO,EAAKU,KAAK+G,IAAI/G,KAAKC,MAAM+S,EAAK5K,KAAKkL,EAAQ1H,EAAO,IAAItL,IAAQ,EAEnG4S,EAAa,CACd,MAAML,EAAMhF,EAAIsG,WAAatG,EAAIqG,WAEjC,GADA5T,EAAMN,KAAKC,MAAMK,GAAO0S,EAAKzL,SAAW,GAAIsL,GAAM,GAAKA,KAClDG,EAAKzB,gBAAgBjR,EAAK,GAAI,QACtC,CAMA,GAJAkT,EAAaxT,KAAKoH,IAAIoM,EAAYhG,EAAIlO,QAEtCgB,GAAO0S,EAAK9J,YAEP8J,EAAKP,eAAgBO,EAAKnB,YAAgBmB,EAAKzB,gBAAgBjR,GAAMN,KAAK+G,IAAIiM,EAAKP,eAAgBzS,KAAK+G,IAAIiM,EAAKnB,aAoBtH,IAlBImB,EAAKzL,UACNsG,EAAIU,EAAIgG,EACR1G,EAAIW,EAAIlO,EACRuN,EAAIxL,MAAQ8Q,EAAgBnE,EAAO,EAAK,GAAK,GAAQA,EAAO,EAAK,GAAK,KAEtEnB,EAAIU,EAAIjO,EACRuN,EAAIW,EAAI+F,EACR1G,EAAIxL,MAAQ8Q,EAAgBnE,EAAO,EAAK,GAAK,GAAQA,EAAO,EAAK,GAAK,GAClEgE,EAAKxS,MAAQwS,EAAK9I,QAAU8I,EAAKzL,UAA0B,KAAdsG,EAAIxL,QAClDwL,EAAIxL,MAAQ,GACZwL,EAAIW,GAAKwE,EAAKI,WAAWvR,OAI/BgM,EAAIgH,aAAejB,EAEnBZ,EAAK8B,SAASjH,GAEV2G,GAAYlU,IAAQkU,IAAcxB,EAAKzL,WAAa4L,IAAkBH,EAAKzL,UAAY4L,GAAe,CACvG,MAAM4B,EAAY/U,KAAK+G,IAAIzG,EAAIkU,GAC/BjB,EAAYvT,KAAKmH,IAAIoM,EAAW,GAAIwB,EAAU/B,EAAKI,WAAWvR,KACjE,CAEA2S,EAAUlU,EACb,CAEA,OAAI0S,EAAK1I,OACN0I,EAAK8B,SAAS,CAAEvG,EAAGyE,EAAKzL,SAAgB,EAALyH,EAASgE,EAAKtB,WAAW,GAC5ClD,EAAGwE,EAAKgC,aAAeT,EAAavB,EAAKzL,SAAWyL,EAAKtB,WAAW,IAAK,EAAG1C,EAC5E3M,MAAO2Q,EAAKzL,SAAayH,EAAO,EAAK,GAAK,GAAQgE,EAAKgC,aAAgBhG,EAAO,EAAM,GAAK,GACzF2F,MAAO,EACPD,KAAM,SAAW1B,EAAKiC,UAAU,GAAIjC,EAAK1I,OACzCsK,OAAQ7G,IAGpBiF,EAAKkC,kBAAkBnH,GAASoH,KAAK,KAQzC,GAPG1B,GACD1F,EAAQqH,UAAU,QAAQC,KAAK,WAC3B,MAAMC,KAAMC,MAAUrX,MAAOsX,EAAKF,EAAIhH,KAAK,aAC3CgH,EAAIhH,KAAK,YAAakH,EAAK,eAAe9R,MAAM,cAAe,QACnE,GAGEsP,EAAKzL,SACNwL,EAAK/D,IAAShP,KAAKC,MAAMkT,EAAc,IAAIQ,EAAiBD,EAAgB,GAAIV,EAAKI,WAAWvR,MAAQmN,EAAKsF,MAC3G,CACF,MAAMmB,EAAchC,EAAYC,EAAgB1T,KAAK0V,IAAI,kBAAO1V,KAAK2V,IAAMhC,GAAkB3T,KAAK4V,IAAI,kBAAO5V,KAAK2V,IAAM,IAAO,EAE/H5C,EAAK/D,IAAShP,KAAKC,MAAMD,KAAKoH,IAAI+L,EAAcO,EAAgB,GAAIV,EAAKI,WAAWvR,KAAO,IAAI8R,EAAgB,IAAIX,EAAKI,WAAWvR,KAAM4T,IAAgBnB,CAC5J,CAEA,OAAOvB,GACP,EAnH+B,EAoHrC,CAGA8C,eAAerP,EAAQwI,EAAM8G,GAC1B,GAAIxG,WAASyG,UAAY7X,KAAK8X,kBAAoB9X,KAAKsR,cAAe,CACnE,MAAMuC,EAAK/R,KAAKoH,IAAI0O,EAAM9G,GAAO,IAC3BrE,EAAIzM,KAAKqJ,SAAY,IAAGrJ,KAAK8K,aAAagG,EAAK+C,MAAO7T,KAAK8K,WAAc,IAAG9K,KAAK8K,YAAYgG,EAAK+C,MAAO7T,KAAK8K,WACpHxC,EAAO4H,OAAO,YACPE,KAAK,IAAM,OAAM3D,MACjB2D,KAAK,QAAS,aACd5K,MAAM,UAAW,KACjBA,MAAM,SAAU,YAC1B,CACH,CAGAoN,iBACG,OAAO5S,KAAK+X,WAAc/X,KAAK+X,UAAU5C,SAAWnV,KAAKqJ,SAAW,IAAM,EAC7E,CAGM2O,UAAU1P,EAAQwI,EAAM8G,GAAO,IAAAK,EAAAjY,KAAA,SAAA+U,KAAA,YAClC,IAAKkD,EAAKC,OACP,OAAOD,EAEV,MAAM9G,EAAU7I,EAAO4H,OAAO,SAASE,KAAK,QAAS,cAC/C+H,EAAUF,EAAKrF,iBACrB,IAAIwF,EAAgB,EAAGC,EAAgB,EAAGC,EAAgB,EAE1DL,SAAK1B,iBAAiB0B,EAAKF,UAAW,OAAQ5G,GAE9C8G,EAAKtF,YAAcsF,EAAKM,YAAc,SAAYN,EAAKO,eAAiBP,EAAKvF,iBAAmByF,GAAW,QAAU,MAEjHF,EAAK5O,UACNiP,EAAgBxW,KAAKC,OAAO+O,EAAM8G,EAAM9G,IACxCsH,EAAgBE,EAAgBxW,KAAKC,OAAO+O,EAAKmH,EAAK7E,aACtDiF,EAAgBvW,KAAKC,MAAMkW,EAAKM,YAAcN,EAAKnN,SAAS,EAAKmN,EAAKO,cAAgB,EAAIP,EAAKnN,UAC/FmN,EAAKrB,SAAS,CAAEzS,MAAO,CAAC8T,EAAKtF,YAAe7B,EAAO,EAAKqH,EAAU,MAAQ,UAC1D3B,KAAMyB,EAAKC,OAAQxB,OAAQvF,MAE3CiH,EAAgBtW,KAAKC,MAAMkW,EAAKM,YAAcN,EAAKnN,SAAS,EAAKmN,EAAKO,cAAgB,EAAIP,EAAKnN,UAC/FwN,EAAgBxW,KAAKC,MAAM+O,EAAK8G,EAAM9G,IACtCuH,EAAgBC,EAAgBxW,KAAKC,MAAM+O,EAAKmH,EAAK7E,aACrD6E,EAAKrB,SAAS,CAAEzS,MAAO,CAAC8T,EAAKtF,YAAe7B,EAAO,EAAKqH,EAAU,MAAQ,UAC1D3B,KAAMyB,EAAKC,OAAQxB,OAAQvF,MAAS,EAGvD+B,MAAc/B,EAASiH,EAAeC,GACxBzH,SAAS,UAAW0H,GACpB1H,SAAS,UAAWwH,GACpBxH,SAAS,UAAWyH,GAElCJ,EAAK/G,aAAaC,EAASL,GAEpBmH,EAAKjB,kBAAkB7F,EAAS,EAjCL,EAkCrC,CAIAsH,sBAAsBxH,GACnB,MAAMrO,EAAK5C,KAAK6C,gBACZ6V,EAAO9V,GAAI+V,cAAgB,CAAEpT,MAAO,GAAIgL,OAAQ,IAEpDvQ,KAAKiR,YAAcA,IAAgBjR,KAAKqJ,SAAWqP,EAAKnT,MAAQmT,EAAKnI,QAErEvQ,KAAKsF,gBAAgB,SAErBtF,KAAK4P,YAAc5P,KAAKC,WAAW,eAAe,GAElDD,KAAK4T,YAAc5T,KAAKC,WAAW,eAAgB,IACnDD,KAAK2T,WAAa7R,KAAKC,MAAM/B,KAAK4B,aAAa,cAAe5B,KAAKiR,YAAajR,KAAK4T,YAAc,IAAO,IAC1G5T,KAAKuU,aAAezS,KAAKC,MAAM/B,KAAK4B,aAAa,gBAAiB5B,KAAKiR,YAAa,IACpFjR,KAAKqU,UAAYrU,KAAK4B,aAAa,aAAc5B,KAAKiR,YAAa,KACnEjR,KAAKmU,UAAYnU,KAAKC,WAAW,aAAc,UAC/CD,KAAKwU,WAAaxU,KAAK0C,YAAY,cAAe,IAClD1C,KAAKyU,WAAazU,KAAKC,WAAW,cAAe,GAC7CgR,GAAgBjR,KAAKqU,UAAY,IAClCrU,KAAKqU,WAAarU,KAAKqU,WAE1BrU,KAAKkY,OAASlY,KAAKC,WAAW,cAAe,IAEzCD,KAAKkY,QACNlY,KAAK+X,UAAY/X,KAAKwD,WAAW,QAAS,CAAEG,KAAM,KAAQsN,GAAerO,GAAI8B,gBAAkB,IAC/F1E,KAAK+X,UAAUa,WAAW,IAAK5Y,KAAKqJ,SAAW,IAAM,GAErDrJ,KAAKoT,YAAcpT,KAAK4B,aAAa,eAAgB5B,KAAKiR,YAAa,GACvEjR,KAAKuS,SAAWvS,KAAKC,WAAW,iBAAkB,SAClDD,KAAKuY,YAAiC,WAAlBvY,KAAKuS,SACzBvS,KAAKwY,cAAmC,SAAlBxY,KAAKuS,kBAEpBvS,KAAK+X,iBACL/X,KAAKoT,mBACLpT,KAAKuS,UAIfvS,KAAKkV,WAAalV,KAAKwD,WAAW,SAAU,CAAEG,KAAMsN,EAAc,IAAO,MACzEjR,KAAKkV,WAAW0D,WAAW,KACvB5Y,KAAKkV,WAAWC,QAAOnV,KAAKkV,WAAWC,MAAQ,KACnDnV,KAAK+Q,aAAe/Q,KAAK4B,aAAa,gBAAiB5B,KAAKiR,YAAa,GAErEA,IAAajR,KAAKqU,UAAiC,GAArBrU,KAAKkV,WAAWvR,MAE9C3D,KAAK6Y,aAAgB7Y,KAAKqU,UAAYrU,KAAK6Y,cAC5C7Y,KAAKqU,UAAYrU,KAAK6Y,YAC5B,CAIMC,SAASC,EAAOC,EAAWlI,GAAM,IAAAmI,EAAAjZ,KAAA,SAAA+U,KAAA,YACpC,IAAIzM,EAASyQ,OAEAvY,IAATsQ,IAAoBA,EAAO,GAE1BmI,EAAKC,aACP5Q,EAASyQ,EAAMI,YAAa,IAAGF,EAAK/Y,kBAChCoI,EAAO8Q,QACR9Q,EAASyQ,EAAM7I,OAAO,SAASE,KAAK,QAAU,GAAE6I,EAAK/Y,kBAErDoI,EAAO4O,UAAU,KAAKrG,UAG5BvI,EAAO8H,KAAK,YAAa4I,GAEzBC,EAAKR,wBACLQ,EAAK3Q,OAASA,EACd2Q,EAAKnI,KAAOA,EAEW,WAAnBmI,EAAK9E,YAAwBrD,GAAQA,GAErCmI,EAAKC,YACND,EAAKxF,aAAanL,GAMrB2Q,EAAK1L,OAAS0L,EAAKhM,aAAY,GAFX,GAFA,GACF,GAMlB,MAAMoM,EAAQJ,EAAKlF,UAAUzL,EAAQwI,GAAM,GAI3C,OAFsBmI,EAAKrJ,YAAc0J,QAAQC,QAAQF,GAASJ,EAAKrE,WAAWtM,EAAQwI,EAAMuI,IAE3EpC,KAAKW,IAEvBqB,EAAKtB,eAAerP,EAAQ2Q,EAAKC,WAAapI,EAAOmI,EAAKnI,KAAM8G,GAEzDqB,EAAKjB,UAAU1P,EAAQwI,EAAM8G,IACpC,EAxCiC,EAyCvC,CAKA4B,oBAAoB7U,GACjB3E,KAAKyZ,gBAAkB9U,CAC1B,CAGA+U,gBACG,IAAK1Z,KAAKsI,SAAWtI,KAAK8Q,KAAM,OAEhC9Q,KAAKsI,OAAO4O,UAAU,KAAKrG,SAE3B7Q,KAAKyY,wBAEL,IAAI3H,EAAO9Q,KAAK8Q,KACO,WAAnB9Q,KAAKmU,YAAwBrD,GAAQA,GAErC9Q,KAAKkZ,YACNlZ,KAAKyT,aAAazT,KAAKsI,QAG1B,MAAM+Q,EAAQrZ,KAAK+T,UAAU/T,KAAKsI,OAAQwI,GAAM,GAGhD,OAFsB9Q,KAAK4P,YAAc0J,QAAQC,QAAQF,GAASrZ,KAAK4U,WAAW5U,KAAKsI,OAAQwI,EAAMuI,IAEhFpC,KAAKW,IAEvB5X,KAAK2X,eAAe3X,KAAKsI,OAAQtI,KAAKkZ,WAAapI,EAAO9Q,KAAK8Q,KAAM8G,GAE9D5X,KAAKgY,UAAUhY,KAAKsI,OAAQwI,EAAM8G,KACzCX,KAAK,MACL,EAAI9P,UAAOnH,KAAKyZ,kBACbzZ,KAAKyZ,iBAAgB,EAE9B,CAGAE,mBAAmBZ,EAAOC,EAAWlI,EAAM8I,GACxC,IAAItR,EAASyQ,EAAMI,YAAa,IAAGnZ,KAAKE,mBACpCoI,EAAO8Q,QACR9Q,EAASyQ,EAAM7I,OAAO,SAASE,KAAK,QAAU,GAAEpQ,KAAKE,mBAErDoI,EAAO4O,UAAU,KAAKrG,SAEzBvI,EAAO8H,KAAK,YAAa4I,GAEF,WAAnBhZ,KAAKmU,YAAwBrD,GAAQA,GAGzC,MAAMuI,EAAQrZ,KAAK+T,UAAUzL,EAAQwI,GAAM,GAK3C,OAFe9Q,KAAK4P,aAAegK,EAAaN,QAAQC,QAAQF,GAASrZ,KAAK4U,WAAWtM,EAAQwI,EAAMuI,IAExFpC,KAAKW,IACjB5X,KAAK2X,eAAerP,EAAQwI,EAAM8G,IAC3B,GAEb,CAGAiC,eAAe5Q,EAAKC,GACjBlJ,KAAKgR,eAAe,EAAG,UAAW/H,EAAK,UAAWC,EACrD,CAGA4Q,SACG,MAAMC,EAAW/Z,KAAKI,YAChBwC,EAAK5C,KAAK6C,gBACVT,EAAMQ,EAAGoX,cAAcD,EAASE,MAChCrQ,EAAU5J,KAAKC,WAAW,WAAW,GACrCia,EAAaH,EAAS/M,QAAQ5L,OAC9B6H,EAAOiR,EAAa,EAAK,EAAIla,KAAKC,WAAW,MAAO,GACpDiJ,EAAOgR,EAAa,EAAKA,EAAala,KAAKC,WAAW,MAAO,KACnE,IAAIka,EAAMvX,EAAGwX,aAAaL,EAASM,UAAWN,EAASO,SAGnDP,EAASM,YAAWF,GAAOvX,EAAG8B,gBAElC,IAAIyE,EAAOnJ,KAAKC,WAAW,WACvBmJ,EAAOpJ,KAAKC,WAAW,WACvBkJ,IAASC,IACVD,EAAOF,EAAKG,EAAOF,GAGtBlJ,KAAKgJ,cAAc,OAAQC,EAAKC,EAAKC,EAAMC,EAAM2Q,EAASM,eAAW7Z,EAAW2Z,EAAK,CAAEvQ,UAASK,OAAQiQ,EAAa,IAErHla,KAAKua,UAELva,KAAKkZ,YAAa,EAElB,MAAMsB,EAAUxa,KAAK8Y,SAAS9Y,KAAK0W,UAAQxD,MAAc9Q,EAAIiO,EAAGjO,EAAIkO,IAEpE,OAAItQ,KAAKsR,cAAsBkJ,EAExBA,EAAQvD,KAAK,KACb7F,WAASqJ,aACVza,KAAK0W,OAAOzE,GAAG,cAAeC,IAC3BA,EAAKG,kBACLH,EAAKE,kBAAe,EACpBsI,MAAWxI,EAAMlS,MAAMiX,KAAK0D,IAC1BA,EAAKC,IAAI,wBACTD,EAAKC,IAAI,SAAU,IAAM5a,KAAK6Z,kBAC9B7Z,KAAK6a,oBAAoBF,EAAM,IAC/BA,EAAKG,MAAK,EACX,IACH,EAGJC,MAAe/a,KAAM,CAAEqQ,EAAGjO,EAAIiO,EAAGC,EAAGlO,EAAIkO,EAAG/K,MAAOvF,KAAKqJ,SAAW,GAAK8Q,EAAK5J,OAAQvQ,KAAKqJ,SAAW8Q,EAAM,GACnFa,WAAW,EAAMlB,OAAQrN,GAAKzM,KAAKib,gBAAgBxO,KAE1EzM,KAAK0W,OAAOzE,GAAG,WAAY,IAAMjS,KAAK6Z,kBAElCzI,WAAS8J,WACVlb,KAAK0W,OAAOzE,GAAG,QAASC,IACrBA,EAAKG,kBACLH,EAAKE,iBAEL,MAAMhQ,KAAM+Y,MAAWjJ,EAAMlS,KAAK0W,OAAO1G,QAErCoL,EAAOpb,KAAKqb,kBAAkBnJ,EADtBlS,KAAKqJ,SAAY,EAAIjH,EAAI,GAAK+X,EAAO/X,EAAI,GAAK+X,GAGtDiB,EAAKE,SAAStb,KAAK6Z,eAAeuB,EAAKnS,IAAKmS,EAAKlS,IAAG,EAC1D,EAGV,CAGA+R,gBAAgBM,GACb,MAAMxB,EAAW/Z,KAAKI,YAClBsY,EAAO1Y,KAAK6C,gBAAgB8V,aAC5B6C,EAAKD,EAAKlL,EAAIqI,EAAKnT,MACnBkW,EAAK,EAAIF,EAAKjL,EAAIoI,EAAKnI,OAE3BwJ,EAASE,KAAKyB,OAAOC,KAAO,CAACH,GAC7BzB,EAASE,KAAK2B,MAAMD,KAAO,CAACF,GAE5Bzb,KAAK6b,eAAgB,WAAUL,EAAGM,QAAQ,MAAML,EAAGK,QAAQ,OAC9D,CAIA9K,eAAe+K,GACZ,MAAMC,EAAU,CAAC,EACjB,IAAItP,EAAO,EACX,KAAOA,EAAOuP,UAAU7a,OAAS,GAC9BpB,KAAK+F,aAAaiW,EAASC,UAAUvP,GAAOuP,UAAUvP,EAAK,IAC3D1M,KAAK2B,UAAUsa,UAAUvP,GAAOuP,UAAUvP,EAAK,IAC/CA,GAAQ,EAEX1M,KAAK6G,kBAAkBmV,GAAS,GACZ,IAAhBD,EACG/b,KAAKkZ,WACNlZ,KAAK8Z,SAEL9Z,KAAK0Z,gBACAqC,GACR/b,KAAKkc,WACX,CAGAC,cAAcxM,GACQ,WAAd3P,KAAKiG,MAAqC,SAAdjG,KAAKiG,OAC1B,WAAR0J,IAAkBA,EAAM3P,KAAKsC,IAAM,EAAI,IAE3CqN,EAAMhP,WAAWgP,GACbnN,OAAOC,SAASkN,IAAM3P,KAAKgR,eAAe,EAAG,MAAOrB,EAAK,SAAU,GAC1E,CAGAkL,oBAAoBF,EAAM1U,GACvB,OAAIA,GAAM0U,EAAKC,IAAI,SAAU,IAAM5a,KAAKoc,kBAAkBC,OAAOpW,IAEjE0U,EAAKC,IAAI,gBAAiB,IAAM5a,KAAKmc,cAAc,WACnDxB,EAAK2B,QAAQtc,KAAKsC,MAAQtC,KAAKsK,OAAQ,SAAU,EAAGqF,GAAO3P,KAAKmc,cAAcxM,IAC9EgL,EAAK2B,OAAOtc,KAAKsC,MAAQtC,KAAKsK,QAA4B,KAAjBtK,KAAK4I,QAAiB,QAAS,IAAM5I,KAAKmc,cAAc,KACjGxB,EAAK2B,OAAOtc,KAAKsC,MAAQtC,KAAKsK,QAA4B,IAAjBtK,KAAK4I,QAAgB,OAAQ,IAAM5I,KAAKmc,cAAc,IAC/FxB,EAAK2B,OAAOtc,KAAKsC,MAAQtC,KAAKsK,QAAUxI,KAAK+G,IAAI7I,KAAK4I,QAAU9G,KAAKgH,IAAI,IAAM,GAAK,KAAM,IAAM9I,KAAKmc,cAAcra,KAAKgH,IAAI,KAC5H6R,EAAK2B,QAAQtc,KAAKsC,KAAOtC,KAAKsK,OAAQ,SAAU,EAAG,IAChDqQ,EAAK4B,MAAM,sBAAuBvc,KAAKsK,QAAU,GAAI,SAAS2M,KAAKlW,GAAKf,KAAKgR,eAAe,EAAG,SAAUjQ,KAC5G4Z,EAAKC,IAAI,WAETD,EAAKC,IAAI,YAAa,IAAMD,EAAK4B,MAAM,qBAAsBvc,KAAKC,WAAW,OAAQ,KAAM,OAAOgX,KAAK/U,GAAOlC,KAAKgR,eAAe,EAAG,OAAQ9O,KAE7IyY,EAAKC,IAAI,aACTD,EAAK6B,cAAc,QAASxc,KAAKwU,WAAYiI,GAAOzc,KAAKgR,eAAe,EAAG,cAAeyL,IAC1F9B,EAAK+B,YAAY,OAAQ,EAAG,IAAM,IAAM1c,KAAKqU,UAAUrU,KAAKiR,YAAa4C,GAAM7T,KAAKgR,eAAe,EAAG,aAAc6C,IACpH8G,EAAKgC,cAAc,OAAQ,CAAC,SAAU,SAAU,QAAS3c,KAAKmU,UAAWrD,GAAQ9Q,KAAKgR,eAAe,EAAG,aAAcF,IACtH6J,EAAKC,IAAI,YAEJ5a,KAAK4P,aAAe5P,KAAKkV,aAC3ByF,EAAKC,IAAI,cACTD,EAAK+B,YAAY,UAAU,IAAO,IAAM,IAAM1c,KAAK+Q,aAAa/Q,KAAKiR,YACrDN,GAAU3Q,KAAKgR,eAAe,EAAG,gBAAiBL,IAClEgK,EAAKiC,kBAAkB5c,KAAKkV,WAAY,CAAE2H,QAAS,EAAGC,QAAS,GACzDC,GAAU/c,KAAKgR,eAAe,EAAG,UAAY+L,EAAO7c,KAAM6c,EAAOjc,QACvE6Z,EAAK2B,OAAOtc,KAAKkV,WAAWC,MAAO,SAAU5U,GAAOP,KAAKgR,eAAe,EAAG,eAAgBzQ,EAAM,IAAM,IACvGoa,EAAKC,IAAI,YAGZD,EAAKC,IAAI,YAAa,IAAMD,EAAK4B,MAAM,mBAAoBvc,KAAKkY,QAAQjB,KAAK+F,GAAKhd,KAAKgR,eAAe,EAAG,cAAegM,KAEpHhd,KAAKkY,SACNyC,EAAK+B,YAAY,UAAU,IAAO,IAAM,IAAM1c,KAAKoT,YAAYpT,KAAKiR,YAClDN,GAAU3Q,KAAKgR,eAAe,EAAG,eAAgBL,IAEnEgK,EAAKgC,cAAc,WAAY,CAAC,OAAQ,SAAU,SAAU3c,KAAKuS,SAC9CnQ,GAAOpC,KAAKgR,eAAe,EAAG,iBAAkB5O,IAEnEuY,EAAK2B,OAAOtc,KAAK4S,iBAAkB,SAAUqK,GAAQjd,KAAKgR,eAAe,EAAG,cAAeiM,EAAO,IAAM,IAExGtC,EAAKiC,kBAAkB5c,KAAK+X,UAAW,CAAE8E,QAAS,EAAGC,QAAS,GAAKC,GAAU/c,KAAKgR,eAAe,EAAG,SAAW+L,EAAO7c,KAAM6c,EAAOjc,SAGtI6Z,EAAKC,IAAI,YACF,CACV,yVC5jCH,MAAMsC,UAAsB1d,IAKzBE,YAAYC,EAAKwd,GACdpd,MAAMJ,EAAKwd,EAAQ,GAAI,SACvBnd,KAAKod,QAAS,EACdpd,KAAKqd,KAAOrd,KAAKsd,KAAO,EACxBtd,KAAKud,KAAOvd,KAAKwd,KAAO,EACxBxd,KAAKyd,YAAa,EAClBzd,KAAK0d,aAAe,KACpB1d,KAAK2d,WAAa,EAClB3d,KAAK4d,UAAW,CACnB,CAGAxB,kBAAoB,OAAOpc,IAAM,CAIjC6d,WAAa,OAAO,CAAO,CAI3BC,eAAe7L,GACZjS,KAAK+d,YAAc9L,GAAMb,WAAS4M,WAE9Bhe,KAAKie,UACNje,KAAKie,QAAQC,WAAale,KAAK+d,YACrC,CAEAI,gBAAgBC,GAEbpe,KAAKqe,cAAgBD,CACxB,CAEAE,kBAEG,OAAOte,KAAKqe,aACf,CAGAE,iBAAiBC,GACd,QAAqBhe,IAAhBR,KAAKye,QAA0BD,IAAUxe,KAAK0e,aAAe,CAC/D,MAAMhG,EAAO1Y,KAAK6C,gBAAgB8V,aAClC3Y,KAAKye,OAASze,KAAK4B,aAAa,eAAgB8W,EAAKnT,MAAOoZ,SAAOC,gBAAkBlG,EAAKnT,MAC1FvF,KAAK6e,OAAS7e,KAAK4B,aAAa,iBAAkB8W,EAAKnI,OAAQoO,SAAOG,kBAAoBpG,EAAKnI,OAC/FvQ,KAAK+e,OAAS,EAAI/e,KAAK4B,aAAa,gBAAiB8W,EAAKnT,MAAOoZ,SAAOK,iBAAmBtG,EAAKnT,MAChGvF,KAAKif,OAAS,EAAIjf,KAAK4B,aAAa,cAAe8W,EAAKnI,OAAQoO,SAAOO,eAAiBxG,EAAKnI,MAChG,CAEKvQ,KAAKmf,SACPnf,KAAKiF,kBAERjF,KAAKsF,gBAAgB,UACxB,CAGA8Z,oBAAsB,SAAOC,MAAuBrf,KAAK2d,WAAa,CAItE2B,iBAAiBC,GACdvf,KAAK2d,WAAa4B,GAAQ,EAED,IAApBvf,KAAK2d,aAAuB3d,KAAKwf,aAAc,IAASxf,KAAKyf,YAAa,MAC5Epd,QAAQmN,KAAM,8CAA6CxP,KAAKwf,cAAcxf,KAAKyf,cACnFzf,KAAK2d,WAAa,GAGrB,MAAMzT,EAAOlK,KAAKof,oBAClB,IAAKlV,EAAM,OAEX,MAAMwV,EAAO,CAACxV,EAAKlK,KAAK2f,WAAY3f,KAAKwf,YAC5BtV,EAAKlK,KAAK2f,WAAY3f,KAAKyf,YAC3BvV,EAAKlK,KAAK4f,WAAY5f,KAAKyf,YAC3BvV,EAAKlK,KAAK4f,WAAY5f,KAAKwf,aACpCxf,KAAK2f,WAAa,GAAK3f,KAAK4f,WAAa,IAC1CF,EAAKjZ,KAAKyD,EAAK,EAAGlK,KAAKwf,aACvBE,EAAKjZ,KAAKyD,EAAK,EAAGlK,KAAKyf,cAEtBzf,KAAKwf,WAAa,GAAKxf,KAAKyf,WAAa,IAC1CC,EAAKjZ,KAAKyD,EAAKlK,KAAK2f,WAAY,IAChCD,EAAKjZ,KAAKyD,EAAKlK,KAAK4f,WAAY,KAGnC5f,KAAK6f,cAAgB7f,KAAK2f,WAC1B3f,KAAK8f,cAAgB9f,KAAK4f,WAC1B5f,KAAK+f,cAAgB/f,KAAKwf,WAC1Bxf,KAAKggB,cAAgBhgB,KAAKyf,WAE1Bzf,KAAK2f,WAAa3f,KAAK4f,WAAaF,EAAK,GAAGrP,EAC5CrQ,KAAKwf,WAAaxf,KAAKyf,WAAaC,EAAK,GAAGpP,EAE5C,QAAS2P,EAAI,EAAGA,EAAIP,EAAKte,SAAU6e,EAChCjgB,KAAK2f,WAAa7d,KAAKmH,IAAIjJ,KAAK2f,WAAYD,EAAKO,GAAG5P,GACpDrQ,KAAK4f,WAAa9d,KAAKoH,IAAIlJ,KAAK4f,WAAYF,EAAKO,GAAG5P,GACpDrQ,KAAKwf,WAAa1d,KAAKmH,IAAIjJ,KAAKwf,WAAYE,EAAKO,GAAG3P,GACpDtQ,KAAKyf,WAAa3d,KAAKoH,IAAIlJ,KAAKyf,WAAYC,EAAKO,GAAG3P,EAE1D,CAIA4P,YACG,MAAMnH,EAAQ/Y,KAAKmgB,cAAchH,YAAY,eAE7CJ,EAAM7B,UAAU,UAAUrG,SAC1BkI,EAAM7B,UAAU,UAAUrG,SAE1B,MAAMuP,EAAIpgB,KAAKqgB,iBACTC,EAAItgB,KAAKugB,gBACTC,EAAQxgB,KAAKC,WAAW,SAAS,GACjCwgB,EAAQzgB,KAAKC,WAAW,SAAS,GACjCygB,KAAaC,MAAgBhC,SAAOiC,YACpCC,EAAclC,SAAOmC,WAAa,EAAK9gB,KAAK+gB,SAASpC,SAAOmC,YAAc,QAMhF,GAJI9gB,KAAKghB,WACNhhB,KAAKghB,SAASC,UAAYT,GAGzBxgB,KAAKghB,UAAUC,UAAW,CAC3B,IAAIC,EAAO,GACX,QAASjB,EAAI,EAAGA,EAAIjgB,KAAKghB,SAAS/M,MAAM7S,SAAU6e,EAC/CiB,GAAQlhB,KAAKmhB,QACJ,MAAKf,EAAEpgB,KAAKghB,SAAS/M,MAAMgM,MAAMK,IACjC,IAAGtgB,KAAKghB,SAAS/M,MAAMgM,QAAQG,IAGvCc,GACDnI,EAAM7I,OAAO,YACPE,KAAK,QAAS,SACdA,KAAK,IAAK8Q,GACV1b,MAAM,SAAUqb,GAChBrb,MAAM,eAAgBmZ,SAAOyC,YAC7B5b,MAAM,mBAAoBkb,EAEtC,CAMA,GAJI1gB,KAAKqhB,WACNrhB,KAAKqhB,SAASJ,UAAYR,GAGzBzgB,KAAKqhB,UAAUJ,UAAW,CAC3B,IAAIC,EAAO,GACX,QAASjB,EAAI,EAAGA,EAAIjgB,KAAKqhB,SAASpN,MAAM7S,SAAU6e,EAC/CiB,GAAQlhB,KAAKmhB,QACD,IAAGnhB,KAAKqhB,SAASpN,MAAMgM,QAAQG,IAC/B,MAAKA,EAAEpgB,KAAKqhB,SAASpN,MAAMgM,MAAMK,IAG5CY,GACDnI,EAAM7I,OAAO,YACTE,KAAK,QAAS,SACdA,KAAK,IAAK8Q,GACV1b,MAAM,SAAUqb,GAChBrb,MAAM,eAAgBmZ,SAAOyC,YAC7B5b,MAAM,mBAAoBkb,EAEpC,CACH,CAGAY,WAAWvZ,EAAMjH,GACd,MAAMyM,EAASvN,KAAM,GAAE+H,YAEvB,OAAOwF,EAASA,EAAO+T,WAAWxgB,EAAOsQ,WAASrJ,EAAKwZ,cAAgB,iBAAmBzgB,EAAM0gB,YAAY,EAC/G,CAGAC,cAAcvc,EAAQwc,EAAMC,GACzB,MAAMC,EAAQ,GAAE1c,OAAa2c,EAAQ,GAAE3c,OACvC,GAAIlF,KAAK4hB,KAAU5hB,KAAK6hB,GAAO,OAC/B,IAAI5Y,EAAMjJ,KAAKC,WAAY,GAAEiF,SACzBgE,EAAMlJ,KAAKC,WAAY,GAAEiF,cAEjB1E,IAARyI,IAAmByY,EAAOzY,QAClBzI,IAAR0I,IAAmByY,EAAOzY,GAE1BwY,EAAOC,IACR3hB,KAAK4hB,GAAQF,EACb1hB,KAAK6hB,GAAQF,GAGhB,MAAMG,EAAS,QAAO5c,OAAa6c,EAAS,QAAO7c,OAE9ClF,KAAK8hB,KAAW9hB,KAAK+hB,KAAY/hB,KAAKgiB,uBAAuB9c,KAC/D+D,EAAMjJ,KAAKC,WAAY,GAAEiF,aACzBgE,EAAMlJ,KAAKC,WAAY,GAAEiF,mBAEZ1E,IAARyI,QAA+BzI,IAAR0I,KACzBlJ,KAAK8hB,QAAkBthB,IAARyI,EAAqBjJ,KAAK4hB,GAAQ3Y,EACjDjJ,KAAK+hB,QAAkBvhB,IAAR0I,EAAqBlJ,KAAK6hB,GAAQ3Y,GAG1D,CAGA+Y,cAAcC,EAAO7E,EAAMC,EAAM6E,EAAO5E,EAAMC,EAAM4E,EAAOC,EAAMC,GAC1DtiB,KAAKyd,aACTzd,KAAKkiB,MAAQA,EACbliB,KAAKyhB,cAAc,IAAKpE,EAAMC,GAC9Btd,KAAKmiB,MAAQA,EACbniB,KAAKyhB,cAAc,IAAKlE,EAAMC,GAC9Bxd,KAAKoiB,MAAQA,EACbpiB,KAAKyhB,cAAc,IAAKY,EAAMC,GACjC,CAGAC,eAAeC,EAAUN,EAAO7E,EAAMC,EAAMmF,EAAUN,EAAO5E,EAAMC,GAC5DgF,IACDxiB,KAAK0iB,OAASR,EACdliB,KAAKyhB,cAAc,KAAMpE,EAAMC,IAE9BmF,IACDziB,KAAK2iB,OAASR,EACdniB,KAAKyhB,cAAc,KAAMlE,EAAMC,GAErC,CAKAoF,SAASpZ,GACN,GAAIxJ,KAAK6iB,cAAe,OAExB7iB,KAAK8iB,UAEAtZ,IAAMA,EAAO,CAAEuZ,KAAM,IAE1B/iB,KAAKgjB,QAAS,EACdhjB,KAAKmhB,QAAU3X,EAAK2X,UAAW,EAC/BnhB,KAAKijB,UAAYzZ,EAAKyZ,YAAa,EACnCjjB,KAAKkjB,UAAY1Z,EAAK0Z,YAAa,EAEnCljB,KAAKmjB,KAAOnjB,KAAKC,WAAW,QAAS,GACrCD,KAAKojB,KAAOpjB,KAAKC,WAAW,QAAS,GAErC,MAAMqgB,EAAItgB,KAAKugB,gBAAiBH,EAAIpgB,KAAKqgB,iBAEzCrgB,KAAKqjB,YAAc7Z,EAAKuZ,KAExB/iB,KAAK2f,WAAa3f,KAAKqd,KACvBrd,KAAK4f,WAAa5f,KAAKsd,KAEvBtd,KAAKwf,WAAaxf,KAAKud,KACvBvd,KAAKyf,WAAazf,KAAKwd,KAEnBhU,EAAK8Z,iBACYtjB,KAAKmhB,QAAUnhB,KAAKmjB,KAAOnjB,KAAKojB,OAChCpjB,KAAKyf,WAAa,EACjCzf,KAAKyf,WAAa3d,KAAKgH,IAA8B,IAA1BhH,KAAKQ,IAAItC,KAAKyf,aAEzCzf,KAAKyf,YAAkD,IAAnCzf,KAAKyf,WAAazf,KAAKwf,aAO5ChW,EAAK+Z,YAAc/Z,EAAKga,YAAgBxjB,KAAKujB,YAAcvjB,KAAKwjB,YAAexjB,KAAKgiB,uBAAuB,QAC7GhiB,KAAKujB,UAAY/Z,EAAK+Z,UACtBvjB,KAAKwjB,UAAYha,EAAKga,WAGrBxjB,KAAKyjB,YAAczjB,KAAK0jB,YACzB1jB,KAAK2f,WAAa3f,KAAKyjB,UACvBzjB,KAAK4f,WAAa5f,KAAK0jB,WAGtB1jB,KAAKujB,YAAcvjB,KAAKwjB,YACzBxjB,KAAKwf,WAAaxf,KAAKujB,UACvBvjB,KAAKyf,WAAazf,KAAKwjB,WAG1B,IAAItB,EAAQliB,KAAKkiB,MAAOC,EAAQniB,KAAKmiB,MACjCD,GAAO/b,YAAcwd,YAASzB,KAAQ0B,UAAOD,YAC7CxB,GAAOhc,YAAcwd,YAASxB,KAAQyB,UAAOD,YAEjD3jB,KAAKghB,SAAW,IAAI6C,KAAa7jB,KAAK8jB,SAAU5B,GAAO,GACvDliB,KAAKghB,SAAS+C,WAAW/jB,KAAKgkB,cAC9BhkB,KAAKghB,SAASpR,YAAc5P,KAAKC,WAAW,iBAAiB,GAE7DD,KAAKghB,SAAShY,cAAc,QAAShJ,KAAKqd,KAAMrd,KAAKsd,KAAMtd,KAAK2f,WAAY3f,KAAK4f,WAAY5f,KAAKmhB,QAASnhB,KAAKmhB,QAAU,CAAC,EAAGf,GAAK,CAAC,EAAGE,GACvG,CAAE1W,QAAS5J,KAAKijB,UACd3gB,IAAKtC,KAAKmhB,QAAUnhB,KAAKojB,KAAOpjB,KAAKmjB,KACrC7Y,OAAQtK,KAAKmhB,QAAU3X,EAAKya,SAAWza,EAAK0a,SAC5CC,YAAankB,KAAKmhB,QAClBiD,aAAc,OAEhDpkB,KAAKghB,SAASqD,mBAAmBrkB,KAAM,KAEvCA,KAAKqhB,SAAW,IAAIwC,KAAa7jB,KAAK8jB,SAAU3B,GAAO,GACvDniB,KAAKqhB,SAAS0C,WAAW/jB,KAAKgkB,cAC9BhkB,KAAKqhB,SAASzR,YAAc5P,KAAKC,WAAW,iBAAiB,GAE7DD,KAAKqhB,SAASrY,cAAc,QAAShJ,KAAKud,KAAMvd,KAAKwd,KAAMxd,KAAKwf,WAAYxf,KAAKyf,YAAazf,KAAKmhB,QAASnhB,KAAKmhB,QAAU,CAAC,EAAGb,GAAK,CAAC,EAAGF,GACxG,CAAExW,QAAS5J,KAAKkjB,UACd5gB,IAAKtC,KAAKmhB,QAAUnhB,KAAKmjB,KAAOnjB,KAAKojB,KACrC9Y,OAAQtK,KAAKmhB,QAAU3X,EAAK0a,SAAW1a,EAAKya,SAC5CE,YAAc3a,EAAKuZ,KAAO,GAAM/iB,KAAKmhB,QACrCmD,WAAY9a,EAAK+a,SAAY/a,EAAK+a,QAAUvkB,KAAKwd,KAAQ,GAAMhU,EAAK+a,QAAU,EAC9EH,aAAc,OAEhDpkB,KAAKqhB,SAASgD,mBAAmBrkB,KAAM,IAC1C,CAIAwkB,aAAahC,EAAUC,GACpB,OAAQD,IAAaC,GAAWziB,KAAKyd,UACxC,CAIMgH,WAAW,IAAA3P,EAAA9U,KAAA,SAAA+U,KAAA,YACd,GAAID,EAAK2I,YAAe3I,EAAKuI,OAASvI,EAAKwI,MAAUxI,EAAKyI,OAASzI,EAAK0I,KACrE,OAAO1I,EAAK2I,WAEf,MAAMiH,EAAS5P,EAAK7U,WAAW,SAAU,GACnC0kB,EAAS7P,EAAK7U,WAAW,SAAU,GACzC,IAAI2kB,EAAQ,EAAGC,EAAQ,EAEnB/P,EAAK7U,WAAW,SAAS,KAAQ2kB,GAAQ,GACzC9P,EAAK7U,WAAW,SAAS,KAAQ4kB,GAAQ,GAE7C,MAAMvE,EAAIxL,EAAKyL,gBAAiBH,EAAItL,EAAKuL,iBAEpCvL,EAAKkO,SAGPlO,EAAKgQ,cAELhQ,EAAKqM,SAAU,EAEXrM,EAAK2O,YAAc3O,EAAK4O,WACzB5O,EAAK6K,WAAa7K,EAAK2O,UACvB3O,EAAK8K,WAAa9K,EAAK4O,YAEvB5O,EAAK6K,WAAa7K,EAAKuI,KACvBvI,EAAK8K,WAAa9K,EAAKwI,MAGtBxI,EAAKyO,YAAczO,EAAK0O,WACzB1O,EAAK0K,WAAa1K,EAAKyO,UACvBzO,EAAK2K,WAAa3K,EAAK0O,YAEvB1O,EAAK0K,WAAa1K,EAAKyI,KACvBzI,EAAK2K,WAAa3K,EAAK0I,MAG1B1I,EAAKwK,iBAAiB,GAEtBxK,EAAKkM,SAAW,IAAInZ,IAAaiN,EAAKgP,SAAUhP,EAAMA,EAAKoN,MAAO,MAClEpN,EAAKkM,SAAS+C,WAAWjP,EAAKkP,cAC9BlP,EAAKkM,SAAS9a,OAAS4O,EAAK5O,OAC5B4O,EAAKkM,SAAS+D,cAAiBH,EAAQ,EACvC9P,EAAKkM,SAASgE,WAAaN,EAE3B5P,EAAKuM,SAAW,IAAIxZ,IAAaiN,EAAKgP,SAAUhP,EAAMA,EAAKqN,MAAO,MAClErN,EAAKuM,SAAS0C,WAAWjP,EAAKkP,cAC9BlP,EAAKuM,SAASnb,OAAS4O,EAAK5O,OAC5B4O,EAAKuM,SAAS0D,cAAiBF,EAAQ,EACvC/P,EAAKuM,SAAS2D,WAAaL,EAE3B7P,EAAKmQ,SAAW,IAAIpd,IAAaiN,EAAKgP,SAAUhP,EAAMA,EAAKsN,MAAO,MAClEtN,EAAKmQ,SAASlB,WAAWjP,EAAKkP,cAC9BlP,EAAKmQ,SAAS/e,OAAS4O,EAAK5O,OAE5B4O,EAAKkM,SAAShY,cAAc,QAAS8L,EAAKuI,KAAMvI,EAAKwI,KAAMxI,EAAK6K,WAAY7K,EAAK8K,YAAY,EAAO,CAAC,EAAGU,GAAIA,EAAG,CAAE1W,SAAS,IAC1HkL,EAAKkM,SAASqD,mBAAmBvP,EAAM,KAEvCA,EAAKuM,SAASrY,cAAc,QAAS8L,EAAKyI,KAAMzI,EAAK0I,KAAM1I,EAAK0K,WAAY1K,EAAK2K,YAAY,EAAM,CAACW,EAAG,IAAKA,EAAG,CAAExW,SAAS,IAC1HkL,EAAKuM,SAASgD,mBAAmBvP,EAAM,KAGvCA,EAAKmQ,SAASxc,eAAe,QAASqM,IAGzC,MAAMiE,EAAQjE,EAAKqL,cAAchH,YAAY,eAE7CrE,EAAKkM,SAASlK,cAAe,EAE7B,MAAMoO,EAAapQ,EAAKqM,QAAUrM,EAAKuM,SAAWvM,EAAKkM,SACjDmE,EAAgBrQ,EAAKqM,QAAUrM,EAAKkM,SAAWlM,EAAKuM,SAC1D,IAAI+D,EAEJ,GAAItQ,EAAKjS,iBAAiBwiB,cACvBD,EAAK9L,QAAQC,SAAQ,QAAI,GAClBzE,EAAKkO,OAAQ,CAMpBkC,EAAWI,cAAiBZ,GAAU,EACtCS,EAAcG,cAAiBX,GAAU,EAEzC,MAAMY,EAAML,EAAWpM,SAASC,EAAOuH,EAAGF,EAChB8E,EAAWM,YAAc,KAAQ,eAAcpF,KAC9CsE,EAAS,GAAMtE,EAAI,GAAGqF,OACvBjlB,GAAW,EAAOsU,EAAKjS,gBAAgB6B,eAAiB0b,EAAItL,EAAK4Q,aAE1FC,EAAMR,EAAcrM,SAASC,EAAOuH,EAAGF,EACd+E,EAAcK,YAAe,aAAYlF,KAAO,KAC/CqE,EAAS,EAAKrE,EAAI,GAAGsF,EACtBT,EAAcK,YAAc,EAAI1Q,EAAK+Q,UAAUC,GAEzEV,EAAK9L,QAAQyM,IAAI,CAACR,EAAKI,IAAM1O,KAAK,IAAMnC,EAAKoL,YAChD,KAAO,CACJ,IAAI8F,EAAM,GAENtB,EAAS,GACVsB,EAAIvf,KAAKye,EAAWpM,SAASC,KAAO7F,MAAc,EAAG0R,EAAQ,EAAIxE,EAAI,GAAIwE,IAExED,EAAS,GACVqB,EAAIvf,KAAK0e,EAAcrM,SAASC,KAAO7F,MAAc2R,EAAQ,EAAI,EAAIvE,EAAGF,GAAIyE,IAE/EO,EAAK9L,QAAQyM,IAAIC,GAAK/O,KAAK,KACxB+O,EAAM,GACFtB,EAAS,GACVsB,EAAIvf,KAAKye,EAAWvL,mBAAmBZ,KAAO7F,MAAc,EAAG0R,EAAQ,EAAIxE,EAAI,IAAKwE,EAAkB,IAAXF,IAE1FC,EAAS,GACVqB,EAAIvf,KAAK0e,EAAcxL,mBAAmBZ,KAAO7F,MAAc2R,EAAQ,EAAI,EAAIvE,EAAGF,IAAKyE,EAAkB,IAAXF,IAC1FrL,QAAQyM,IAAIC,KACnB/O,KAAK,IAAMnC,EAAKoL,YACtB,CAEA,OAAOkF,EAAGnO,KAAK,KACZnC,EAAK2I,YAAa,GACX,GACP,EArHW,EAsHjB,CAGAwI,UAAUzD,EAAUC,GACjB,MAAMnC,EAAItgB,KAAKugB,gBAAiBH,EAAIpgB,KAAKqgB,iBACnCtH,EAAQ/Y,KAAKmgB,cAAchH,YAAY,eAC7C,IAAIoM,EAAKI,EAET,OAAInD,IACGxiB,KAAKkmB,aAAelmB,KAAKmmB,YAC1BnmB,KAAKomB,YAAcpmB,KAAKkmB,WACxBlmB,KAAKqmB,YAAcrmB,KAAKmmB,aAEzBnmB,KAAKomB,YAAcpmB,KAAKsmB,MACxBtmB,KAAKqmB,YAAcrmB,KAAKumB,OAE1BvmB,KAAKwmB,UAAY,IAAI3e,IAAa7H,KAAK8jB,SAAU9jB,KAAMA,KAAK0iB,OAAQ,OACpE1iB,KAAKwmB,UAAUzC,WAAW/jB,KAAKgkB,cAC/BhkB,KAAKwmB,UAAUtgB,OAASlG,KAAKkG,OAE7BlG,KAAKwmB,UAAUxd,cAAc,SAAUhJ,KAAKsmB,MAAOtmB,KAAKumB,MAAOvmB,KAAKomB,YAAapmB,KAAKqmB,aAAa,EAAO,CAAC,EAAG/F,GAAIA,EAAG,CAAE1W,SAAS,IAChI5J,KAAKwmB,UAAUnC,mBAAmBrkB,KAAM,MAExCulB,EAAMvlB,KAAKwmB,UAAU1N,SAASC,EAAO,MAAM,IAG1C0J,IACGziB,KAAKymB,aAAezmB,KAAK0mB,YAC1B1mB,KAAK2mB,YAAc3mB,KAAKymB,WACxBzmB,KAAK4mB,YAAc5mB,KAAK0mB,aAExB1mB,KAAK2mB,YAAc3mB,KAAK6mB,MACxB7mB,KAAK4mB,YAAc5mB,KAAK8mB,OAG3B9mB,KAAK+mB,UAAY,IAAIlf,IAAa7H,KAAK8jB,SAAU9jB,KAAMA,KAAK2iB,OAAQ,OACpE3iB,KAAK+mB,UAAUhD,WAAW/jB,KAAKgkB,cAC/BhkB,KAAK+mB,UAAU7gB,OAASlG,KAAKkG,OAE7BlG,KAAK+mB,UAAU/d,cAAc,SAAUhJ,KAAK6mB,MAAO7mB,KAAK8mB,MAAO9mB,KAAK2mB,YAAa3mB,KAAK4mB,aAAa,EAAM,CAACxG,EAAG,IAAKA,EAAG,CAAExW,SAAS,IAChI5J,KAAK+mB,UAAU1C,mBAAmBrkB,KAAM,MAExC2lB,EAAM3lB,KAAK+mB,UAAUjO,SAASC,KAAO7F,MAAcoN,EAAGF,IAAI,IAGtD9G,QAAQyM,IAAI,CAACR,EAAKI,GAC5B,CAKAqB,WAAWxE,EAAUC,GAClB,MAAMwE,EAASzE,GAAYxiB,KAAKknB,KAC5BC,EAAS1E,GAAYziB,KAAKonB,KAC9B,OAAKH,GAAWE,EAET,CACJF,SACAI,IAAKJ,EAASjnB,KAAKknB,KAAOlnB,KAAKqnB,IAC/BrG,SAAUiG,EAASjnB,KAAKwmB,UAAYxmB,KAAKghB,SACzCmC,KAAM8D,EAASjnB,KAAKwmB,UAAUlkB,IAAMtC,KAAKghB,SAAS1e,IAClDqd,WAAYsH,EAASjnB,KAAKomB,YAAcpmB,KAAK2f,WAC7CC,WAAYqH,EAASjnB,KAAKqmB,YAAcrmB,KAAK4f,WAC7CuH,SACAG,IAAKH,EAASnnB,KAAKonB,KAAOpnB,KAAKsnB,IAC/BjG,SAAU8F,EAASnnB,KAAK+mB,UAAY/mB,KAAKqhB,SACzC+B,KAAM+D,EAASnnB,KAAK+mB,UAAUzkB,IAAMtC,KAAKqhB,SAAS/e,IAClDkd,WAAY2H,EAASnnB,KAAK2mB,YAAc3mB,KAAKwf,WAC7CC,WAAY0H,EAASnnB,KAAK4mB,YAAc5mB,KAAKyf,WAC7C0B,QAASnhB,KAAKmhB,QACdzY,GAAI1I,KACJunB,WAAWrnB,EAAMa,GACd,MAAc,MAATb,GAAiBF,KAAKinB,SAAQ/mB,EAAO,MAC5B,MAATA,GAAiBF,KAAKmnB,SAAQjnB,EAAO,MACnCF,KAAK0I,GAAG6e,WAAWrnB,EAAMa,EACnC,EACAugB,WAAWphB,EAAMa,GACd,MAAc,MAATb,GAAiBF,KAAKinB,SAAQ/mB,EAAO,MAC5B,MAATA,GAAiBF,KAAKmnB,SAAQjnB,EAAO,MACnCF,KAAK0I,GAAG4Y,WAAWphB,EAAMa,EACnC,GA1B4Bf,IA4BlC,CAKAwnB,cACG,MAAMxL,EAAU,CAAC,EACjBhc,KAAK+F,aAAaiW,EAAS,eAAgBhc,KAAKye,QAChDze,KAAK+F,aAAaiW,EAAS,iBAAkBhc,KAAK6e,QAClD7e,KAAK+F,aAAaiW,EAAS,gBAAiB,EAAIhc,KAAK+e,QACrD/e,KAAK+F,aAAaiW,EAAS,cAAe,EAAIhc,KAAKif,QACnDjf,KAAK6G,kBAAkBmV,GAAS,GAEhChc,KAAKkc,WACR,CAIA4G,UAEG,MAAM2E,EAAQA,CAACvnB,EAAMwnB,KAClB1nB,KAAKE,IAAOmI,iBACLrI,KAAKE,UACLF,KAAK0nB,EAAM,EAGrBD,EAAM,WAAY,OAClBA,EAAM,WAAY,OAClBA,EAAM,WAAY,OAClBA,EAAM,YAAa,QACnBA,EAAM,YAAa,eAEZznB,KAAKgjB,MACf,CAIA8B,cACG9kB,KAAK8iB,UAEL9iB,KAAK0W,QAAQyC,YAAY,eAAejC,UAAU,KAAKrG,SACvD7Q,KAAKyd,YAAa,CACrB,CAIAkK,sBAEG,EAAIxgB,UAAOnH,KAAK4nB,gBACb5nB,KAAK4nB,eAAc,GAEtB5nB,KAAK8kB,cAEL,MAAM2C,EAASvnB,IACZF,KAAKE,EAAK,OAASF,KAAKE,EAAK,OAAS,EACtCF,KAAM,QAAOE,QAAaF,KAAM,QAAOE,QAAa,EACpDF,KAAM,SAAQE,QAAaF,KAAM,SAAQE,QAAa,GAGzDunB,EAAM,KACNA,EAAM,KACNA,EAAM,KACNA,EAAM,MACNA,EAAM,MAENznB,KAAK0W,QAAQyC,YAAY,eAAejC,UAAU,KAAKrG,SACvD7Q,KAAK0W,QAAQyC,YAAY,gBAAgBjC,UAAU,KAAKrG,QAC3D,CAIAxI,UACGrI,KAAK2nB,qBAED3nB,KAAK0W,SACN1W,KAAK0W,OAAOQ,UAAU,KAAKrG,SAC3B7Q,KAAK0W,OAAOzE,GAAG,YAAa,MAChBA,GAAG,WAAY,MACfA,GAAG,QAAS,MACZA,GAAG,cAAe,MAClBrB,SAAS,kBAAmB,OAGvC5Q,KAAK0d,eACNmK,OAAOC,oBAAoB,UAAW9nB,KAAK0d,cAAc,GACzD1d,KAAK0d,aAAe,aAEhB1d,KAAK+d,mBACL/d,KAAK6iB,qBAEL7iB,KAAKkiB,aACLliB,KAAKmiB,aACLniB,KAAKoiB,aACLpiB,KAAK0iB,cACL1iB,KAAK2iB,cAEL3iB,KAAK0W,cAEL1W,KAAK+nB,sBACL/nB,KAAKgoB,kBAEZ,MAAMplB,EAAK5C,KAAK6C,gBACZD,GAAIqlB,oBAAsBjoB,aACpB4C,EAAGqlB,kBAEbloB,MAAMsI,SACT,CAIAyR,SACG,MAAMlX,EAAK5C,KAAK6C,gBACZD,IAAIA,EAAGqlB,kBAAoBjoB,MAG/BA,KAAKue,mBAEL,MAAM7F,EAAO9V,GAAI+V,cAAgB,CAAEpT,MAAO,GAAIgL,OAAQ,IAChD2X,EAAKpmB,KAAKC,MAAM2W,EAAKnT,MAAQvF,KAAKye,QAClC0J,EAAKrmB,KAAKC,MAAM2W,EAAKnI,QAAU,EAAIvQ,KAAKif,SAC9C,IAEoCmJ,EA2BhCC,EAAUC,EA7BVhI,EAAIxe,KAAKC,MAAM2W,EAAKnT,OAASvF,KAAK+e,OAAS/e,KAAKye,SAChD2B,EAAIte,KAAKC,MAAM2W,EAAKnI,QAAUvQ,KAAKif,OAASjf,KAAK6e,SACjD0J,GAAS,EAAOC,GAAS,EAsB7B,GApBI5lB,GAAI6lB,UACD7lB,EAAG6lB,QAAQC,cAAaH,GAAS,GACjC3lB,EAAG6lB,QAAQE,WAAUH,GAAS,IAGjCD,GACDH,EAAS,cAAaF,KAAMC,gBAAiBD,EAAG9H,KAAK+H,MACpD7H,EAAGF,GAAK,CAACA,EAAGE,IAEb8H,KAAQlV,MAAcgV,EAAIC,GAI7BnoB,KAAK6lB,SAAWqC,EAChBloB,KAAK4oB,SAAWT,EAChBnoB,KAAK6oB,aAAevI,EACpBtgB,KAAK8oB,cAAgB1I,EACrBpgB,KAAK+oB,cAAgBR,EACrBvoB,KAAKgpB,cAAgBR,EAEjBxoB,KAAKod,OAAQ,OAAOpd,KAGxBA,KAAK0W,OAAS1W,KAAKmgB,cAIfngB,KAAK0W,OAAO0C,SACbpZ,KAAK0W,OAAS1W,KAAKipB,YAAY,oBAAoB/Y,OAAO,SAASE,KAAK,QAAS,cAE5EpQ,KAAKsR,eACPtR,KAAK0W,OAAOxG,OAAO,aAAasG,KAAK,IAExC6R,EAAWroB,KAAK0W,OAAOxG,OAAO,YAE9BoY,EAAWtoB,KAAK0W,OAAOxG,OAAO,WACXE,KAAK,QAAS,cACdA,KAAK,IAAK,GACVA,KAAK,IAAK,GACVA,KAAK,WAAY,UAEpCpQ,KAAK0W,OAAOxG,OAAO,SAASE,KAAK,QAAS,cAC1CpQ,KAAK0W,OAAOxG,OAAO,SAASE,KAAK,QAAS,iBAE1CiY,EAAWroB,KAAK0W,OAAOyC,YAAY,QACnCmP,EAAWtoB,KAAK0W,OAAOyC,YAAY,gBAGtCnZ,KAAKyd,YAAa,EAElBzd,KAAK0W,OAAOtG,KAAK,YAAagY,GAE9BC,EAASjY,KAAK,IAAK,GACVA,KAAK,IAAK,GACVA,KAAK,QAASkQ,GACdlQ,KAAK,SAAUgQ,GACfhQ,KAAK,KAAMpQ,KAAK0F,QAAQwjB,IAAM,MAC9B9Y,KAAK,KAAMpQ,KAAK0F,QAAQyjB,IAAM,MAC9B3Y,KAAKxQ,KAAKmf,QAAQjV,MAClBsG,KAAKxQ,KAAK0F,QAAQwE,MAE3Boe,EAASlY,KAAK,QAASkQ,GACdlQ,KAAK,SAAUgQ,GACfhQ,KAAK,UAAY,OAAMkQ,KAAKF,KAErC,IAAIgF,EAAK9L,QAAQC,SAAQ,GAEzB,OAAIvZ,KAAKC,WAAW,cACjBD,KAAK6iB,eAAgB,EACrB7iB,KAAKiiB,gBACLmD,EAAKplB,KAAKykB,WAAWxN,KAAK,IAAMjX,KAAKopB,qBAGjChE,EAAGnO,KAAK,IAAejX,KACjC,CAGAqpB,YAAc,OAAOrpB,KAAK6lB,UAAY,CAAG,CAGzCH,YAAc,OAAO1lB,KAAK4oB,UAAY,CAAG,CAGzCrI,gBAAkB,OAAOvgB,KAAK6oB,cAAgB,CAAG,CAGjDxI,iBAAmB,OAAOrgB,KAAK8oB,eAAiB,CAAG,CAGnDQ,eACG,MAAO,CACJjZ,EAAGrQ,KAAK6lB,UAAY,EACpBvV,EAAGtQ,KAAK4oB,UAAY,EACpBrjB,MAAOvF,KAAKugB,gBACZhQ,OAAQvQ,KAAKqgB,iBACbrH,UAAWhZ,KAAK0W,QAAQtG,KAAK,cAAgB,GAC7CmZ,aAAc,EACdC,aAAc,EAEpB,CAGAxmB,iBACG,OAAOhD,KAAK6C,gBAAgBG,gBAC/B,CAMAymB,0BAA0B9kB,GACvB3E,KAAK+nB,kBAAiB5gB,UAAOxC,GAAWA,EAAU,IACrD,CAMA+kB,6BAA6B/kB,GAC1B3E,KAAKgoB,qBAAoB7gB,UAAOxC,GAAWA,EAAU,IACxD,CAKMglB,KAAKtM,EAAMC,EAAMC,EAAMC,EAAM6E,EAAMC,GAAM,IAAArK,EAAAjY,KAAA,SAAA+U,KAAA,YAE5C,GAAIkD,EAAK0F,WAAY,OAAO,EAEf,MAATN,GAAgBA,EAAOC,EAAMA,EAAOC,EAAMA,OAAO/c,GACxC,MAAT6c,GAAgBG,EAAOD,EAAMA,EAAOD,EAAMD,EAAOC,OAAO9c,GAC/C,MAAT6c,IAAgBgF,EAAO/E,EAAMgF,EAAO/E,EAAMF,EAAOC,EAAOC,OAAO/c,GAEnE,IAAIopB,EAAUvM,IAASC,EAAOuM,EAAUtM,IAASC,EAAOsM,EAAUzH,IAASC,EACvEyH,GAAW,EAAOC,GAAW,EAAOC,GAAW,EAEnD,GAAIL,EAAQ,CACT,IAAI3mB,EAAM,EACNoa,GAAQpF,EAAKoF,OAAQA,EAAOpF,EAAKoF,KAAMpa,KACvCqa,GAAQrF,EAAKqF,OAAQA,EAAOrF,EAAKqF,KAAMra,KAC/B,IAARA,IAAa2mB,GAAS,EAAOG,GAAW,EAC/C,MACGA,EAAY1M,IAASC,GAAmB,IAATD,EAGlC,GAAIwM,EAAQ,CACT,IAAI5mB,EAAM,EACNsa,GAAQtF,EAAKsF,OAAQA,EAAOtF,EAAKsF,KAAMta,KACvCua,GAAQvF,EAAKuF,OAAQA,EAAOvF,EAAKuF,KAAMva,KAC/B,IAARA,IAAa4mB,GAAS,EAAOG,GAAW,EAC/C,MACGA,EAAYzM,IAASC,GAAmB,IAATD,EAGlC,GAAIuM,EAAQ,CACT,IAAI7mB,EAAM,EAENof,GAAQpK,EAAKoK,OAAQA,EAAOpK,EAAKoK,KAAMpf,KACvCqf,GAAQrK,EAAKqK,OAAQA,EAAOrK,EAAKqK,KAAMrf,KAC/B,IAARA,IAAa6mB,GAAS,EAAOG,GAAW,EAC/C,MACGA,EAAY5H,IAASC,GAAmB,IAATD,EAGlC,IAAI/G,GAAU,EAAO4O,EAAM,GAAIC,EAAM,GAAIC,EAAM,GAAIC,GAAe,EAClE,MAAMrkB,EAAM,CACNG,UAAY,GAAEC,6BACdG,OAAQ,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GACxB+jB,MAAO,EAAC,GAAO,GAAO,GAAO,GAAO,GAAO,IAGjDC,GAAeA,CAAC5U,EAAS6I,OACjBA,MAAS,EAACrX,UAAOwO,EAAQ6U,iBAE9BH,GAAe,EAEXT,IAAWpL,IAAS7I,EAAQ6U,cAAc,IAAKnN,EAAMC,MACtDrF,EAAKwL,UAAYpG,EACjBpF,EAAKyL,UAAYpG,EACjBhC,GAAU,EAAM4O,EAAM,IACtBN,GAAS,EACT5jB,EAAIO,OAAO,GAAK8W,EAAMrX,EAAIO,OAAO,GAAK+W,EACtCtX,EAAIskB,MAAM,GAAKtkB,EAAIskB,MAAM,IAAK,GAE7BT,IAAWrL,IAAS7I,EAAQ6U,cAAc,IAAKjN,EAAMC,MACtDvF,EAAKsL,UAAYhG,EACjBtF,EAAKuL,UAAYhG,EACjBlC,GAAU,EAAM6O,EAAM,IACtBN,GAAS,EACT7jB,EAAIO,OAAO,GAAKgX,EAAMvX,EAAIO,OAAO,GAAKiX,EACtCxX,EAAIskB,MAAM,GAAKtkB,EAAIskB,MAAM,IAAK,GAE7BR,IAAWtL,IAAS7I,EAAQ6U,cAAc,IAAKnI,EAAMC,MACtDrK,EAAKwS,UAAYpI,EACjBpK,EAAKyS,UAAYpI,EACjBhH,GAAU,EAAM8O,EAAM,IACtBN,GAAS,EACT9jB,EAAIO,OAAO,GAAK8b,EAAMrc,EAAIO,OAAO,GAAK+b,EACtCtc,EAAIskB,MAAM,GAAKtkB,EAAIskB,MAAM,IAAK,KA+BpC,OA1BIV,GAAUC,GAAUC,IACrB7R,EAAK0S,eAAehV,GAAW4U,GAAa5U,KAG1C0U,GAAgBpS,EAAK4K,eACvB0H,GAAa,MAAM,IAGlBR,GAAYC,GAAYC,KACrBF,IACG9R,EAAKwL,YAAcxL,EAAKyL,YAAapI,GAAU,EAAM4O,EAAM,KAC/DjS,EAAKwL,UAAYxL,EAAKyL,UAAY,EAClC1d,EAAIO,OAAO,GAAKP,EAAIO,OAAO,IAAK,GAE/ByjB,IACG/R,EAAKsL,YAActL,EAAKuL,YAAalI,GAAU,EAAM6O,EAAM,KAC/DlS,EAAKsL,UAAYtL,EAAKuL,UAAY,EAClCxd,EAAIO,OAAO,GAAKP,EAAIO,OAAO,IAAK,GAE/B0jB,IACGhS,EAAKwS,YAAcxS,EAAKyS,YAAapP,GAAU,EAAM8O,EAAM,KAC/DnS,EAAKwS,UAAYxS,EAAKyS,UAAY,EAClC1kB,EAAIO,OAAO,GAAKP,EAAIO,OAAO,IAAK,MAIjC+U,IAEDrD,EAAKtQ,gBACNsQ,EAAKhR,gBAAgB,OAAQ,CAAEd,UAAY,GAAEC,8BAA6BwkB,OAAQ5kB,IAE9EiS,EAAK4S,kBAAkB,MAAO,OAASX,EAAMC,EAAMC,GAAKnT,KAAK,KAAM,GAAM,EA7GpC,EA8G/C,CAIM6T,WAAW5qB,EAAMwhB,EAAMC,GAAM,IAAA1I,EAAAjZ,KAAA,SAAA+U,KAAA,YAChC,MAA2CrI,EAA7B,CAAC,IAAK,IAAK,IAAK,KAAM,MAAoB6C,QAAQrP,GAGhE,GAAI+Y,EAAK0E,aAAe1E,EAAK/Y,EAAK,YAAewM,EAAO,EACrD,OAAO,EAEV,IAAIqe,EAAUrJ,IAASC,EAAOqJ,GAAW,EAEzC,GAAID,EAAQ,CACT,IAAI9nB,EAAM,EACNye,GAAQzI,EAAK/Y,EAAK,SAAUwhB,EAAOzI,EAAK/Y,EAAK,OAAQ+C,KACrD0e,GAAQ1I,EAAK/Y,EAAK,SAAUyhB,EAAO1I,EAAK/Y,EAAK,OAAQ+C,KAC7C,IAARA,IAAa8nB,GAAS,EAAOC,GAAW,EAC/C,MACGA,EAAYtJ,IAASC,GAAmB,IAATD,EAGlC,IAAIpG,GAAU,EAAO+O,GAAe,EACpC,MAAMrkB,EAAM,CACLG,UAAY,GAAEC,6BACdG,OAAQ,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GACpC+jB,MAAO,EAAC,GAAO,GAAO,GAAO,GAAO,GAAO,GAAO,GAAO,GAAO,GAAO,IAG7EC,EAAeA,CAAC5U,EAAS6I,MAClBA,KAAS,EAACrX,UAAOwO,GAAS6U,iBAE/BH,GAAe,EAEXU,IAAWvM,GAAS7I,EAAQ6U,cAActqB,EAAK,GAAIwhB,EAAMC,MAC1D1I,EAAK,QAAU/Y,EAAO,OAASwhB,EAC/BzI,EAAK,QAAU/Y,EAAO,OAASyhB,EAC/BrG,GAAU,EACVyP,GAAS,EACT/kB,EAAIO,OAAY,EAALmG,GAAUgV,EAAM1b,EAAIO,OAAY,EAALmG,EAAO,GAAKiV,EAClD3b,EAAIskB,MAAW,EAAL5d,GAAU1G,EAAIskB,MAAW,EAAL5d,EAAO,IAAK,KAkBhD,OAbIqe,GACD9R,EAAK0R,eAAehV,GAAW4U,EAAa5U,KAG1C0U,GAAgBpR,EAAK4J,eACvB0H,EAAa,MAAM,GAElBS,IACG/R,EAAM,QAAO/Y,UAAe+Y,EAAM,QAAO/Y,UAAYob,GAAU,GACnErC,EAAM,QAAO/Y,QAAa+Y,EAAM,QAAO/Y,QAAa,EACpD8F,EAAIO,OAAY,EAALmG,GAAU1G,EAAIO,OAAY,EAALmG,EAAO,IAAK,KAG1C4O,IAEDrC,EAAKtR,gBACNsR,EAAKhS,gBAAgB,OAAQ,CAAEd,UAAY,GAAEC,8BAA6BwkB,OAAQ5kB,IAE9EiT,EAAK4R,kBAAkB,MAAQ,OAAMne,KAAQuK,KAAK,KAAM,GAAM,EA3DrC,EA4DnC,CAGAgU,aAAaljB,GACV,OAAO/H,KAAM,QAAO+H,UAAe/H,KAAM,QAAO+H,OACnD,CAIMsU,OAAO6O,EAAKC,EAAKC,GAAK,IAAAC,EAAArrB,KAAA,SAAA+U,KAAA,YACzB,MAAY,QAARmW,EACMG,EAAKhP,OAAO,MAAMpF,KAAK,IAAMoU,EAAKhP,OAAO,OAAOpF,KAAK,IAAMoU,EAAKhP,OAAO,QAEpE,OAAR6O,GAA0B,OAARA,EACbG,EAAKP,WAAWI,EAAK,EAAG,GAAGjU,KAAKqE,IAChCA,GAAS+P,EAAKrJ,uBAAuBkJ,EAAK,UACvC5P,YAIF4P,EAAQ,IAAaA,EAAMC,EAAMC,GAAM,KAC9CzoB,SAAMuoB,KAAQE,EAAMF,EAAI3b,QAAQ,MAAQ,EAAG4b,EAAMD,EAAI3b,QAAQ,MAAQ,EAAG2b,EAAMA,EAAI3b,QAAQ,MAAQ,GAE/F8b,EAAK1B,KAAKuB,EAAM,OAAI1qB,EAAW0qB,EAAM,OAAI1qB,EAC/B2qB,EAAM,OAAI3qB,EAAW2qB,EAAM,OAAI3qB,EAC/B4qB,EAAM,OAAI5qB,EAAW4qB,EAAM,OAAI5qB,GAAWyW,KAAKqE,IACzDA,GAAW4P,GAAKG,EAAKrJ,uBAAuB,IAAK,UACjD1G,GAAW6P,GAAKE,EAAKrJ,uBAAuB,IAAK,UACjD1G,GAAW8P,GAAKC,EAAKrJ,uBAAuB,IAAK,UAE9C1G,IACP,EAtBsB,EAuB5B,CAIA0G,uBAAuBja,EAAMjH,GAC1B,GAAa,UAATiH,EAED,YADA/H,KAAKsrB,eAAiBtrB,KAAKurB,eAAiBvrB,KAAKwrB,oBAAiBhrB,GAGrE,IAAKuH,GAAiB,QAATA,EACV,OAAO/H,KAAKsrB,gBAAkBtrB,KAAKurB,gBAAkBvrB,KAAKwrB,eAE7D,GAAc,MAATzjB,GAA2B,MAATA,GAA2B,MAATA,EAAe,OAExD,MAAM0jB,EAAM,gBAAkB1jB,EAC9B,QAAcvH,IAAVM,EAAqB,OAAOd,KAAKyrB,GAEvB,WAAV3qB,EAMAA,IAAOd,KAAKyrB,IAAO,GAJpBzrB,KAAKyrB,QAAsBjrB,IAAdR,KAAKyrB,EAKxB,CAGAC,sBAAsB/Q,EAAM1U,GACX,MAATA,GAA2B,MAATA,GAEvB0U,EAAKC,IAAI,SAAU,IAAM5a,KAAKqc,OAAOpW,GAMxC,CAGA0lB,gBAAgBvb,EAAMtP,GACnB,MAAMkb,EAAU,CAAC,EACjBhc,KAAK+F,aAAaiW,EAAS5L,EAAMtP,GACjCd,KAAK2B,UAAUyO,EAAMtP,GACrBd,KAAK6G,kBAAkBmV,GAAS,GAChChc,KAAKkc,WACR,CAGA0P,gBAAgBjR,EAAM1U,GAKnB,GAFa,QAATA,IAAgBA,EAAO,KAEb,MAATA,GAA2B,MAATA,GAA2B,OAATA,GAA4B,OAATA,EAAgB,CACzE,MAAMsH,EAASvN,KAAKiG,EAAK,WACzB,QAAKsH,IACLoN,EAAKC,IAAI,WAAa3U,EAAKsb,cAAgB,SACpChU,EAAOsN,oBAAoBF,EAAM1U,GAC3C,CAEA,MAAM4lB,EAAwB,IAAhBlR,EAAKhX,OAEnB,OACGgX,EAAKC,IADJiR,EACQ,eAEA,aAER7rB,KAAKyjB,YAAczjB,KAAK0jB,WACzB/I,EAAKC,IAAI,WAAY,IAAM5a,KAAKqc,OAAO,MACtCrc,KAAKujB,YAAcvjB,KAAKwjB,WACzB7I,EAAKC,IAAI,WAAY,IAAM5a,KAAKqc,OAAO,MACtCrc,KAAKyqB,YAAczqB,KAAK0qB,WACzB/P,EAAKC,IAAI,WAAY,IAAM5a,KAAKqc,OAAO,MACtCrc,KAAKkmB,aAAelmB,KAAKmmB,YAC1BxL,EAAKC,IAAI,YAAa,IAAM5a,KAAKqc,OAAO,OACvCrc,KAAKymB,aAAezmB,KAAK0mB,YAC1B/L,EAAKC,IAAI,YAAa,IAAM5a,KAAKqc,OAAO,OAC3C1B,EAAKC,IAAI,aAAc,IAAM5a,KAAKqc,OAAO,QAEzC1B,EAAKC,IAAI,aAETD,EAAK2B,OAAOtc,KAAK8rB,mBAAoB,gBAAiB,IAAM9rB,KAAK+rB,kBAAkB,WAE/E/rB,KAAKghB,UACNrG,EAAK2B,OAAOtc,KAAKghB,SAASC,UAAW,SAAUhE,GAAQjd,KAAK2rB,gBAAgB,QAAS1O,IACpFjd,KAAKqhB,UACN1G,EAAK2B,OAAOtc,KAAKqhB,SAASJ,UAAW,SAAUhE,GAAQjd,KAAK2rB,gBAAgB,QAAS1O,IACpFjd,KAAKghB,WAAahhB,KAAKwmB,WACxB7L,EAAK2B,OAAOtc,KAAKghB,SAAS+D,cAAe,SAAU9H,GAAQjd,KAAK2rB,gBAAgB,QAAS1O,IACxFjd,KAAKqhB,WAAarhB,KAAK+mB,WACxBpM,EAAK2B,OAAOtc,KAAKqhB,SAAS0D,cAAe,SAAU9H,GAAQjd,KAAK2rB,gBAAgB,QAAS1O,IACxFjd,KAAKghB,WAAahhB,KAAKwmB,YACxB7L,EAAKC,IAAI,eACTD,EAAK2B,OAAoC,IAA7Btc,KAAKghB,SAASgE,WAAkB,MAAO,IAAMhlB,KAAK2rB,gBAAgB,SAAU,IACxFhR,EAAK2B,OAAoC,IAA7Btc,KAAKghB,SAASgE,WAAkB,SAAU,IAAMhlB,KAAK2rB,gBAAgB,SAAU,IAC3FhR,EAAK2B,OAAoC,IAA7Btc,KAAKghB,SAASgE,WAAkB,sBAAuB,IAAMhlB,KAAK2rB,gBAAgB,SAAU,IACxGhR,EAAK2B,OAAoC,IAA7Btc,KAAKghB,SAASgE,WAAkB,uBAAwB,IAAMhlB,KAAK2rB,gBAAgB,SAAU,IACzGhR,EAAKC,IAAI,YAER5a,KAAKqhB,WAAarhB,KAAK+mB,YACxBpM,EAAKC,IAAI,eACTD,EAAK2B,OAAoC,IAA7Btc,KAAKqhB,SAAS2D,WAAkB,MAAO,IAAMhlB,KAAK2rB,gBAAgB,SAAU,IACxFhR,EAAK2B,OAAoC,IAA7Btc,KAAKqhB,SAAS2D,WAAkB,SAAU,IAAMhlB,KAAK2rB,gBAAgB,SAAU,IAC3FhR,EAAK2B,OAAoC,IAA7Btc,KAAKqhB,SAAS2D,WAAkB,sBAAuB,IAAMhlB,KAAK2rB,gBAAgB,SAAU,IACxGhR,EAAK2B,OAAoC,IAA7Btc,KAAKqhB,SAAS2D,WAAkB,uBAAwB,IAAMhlB,KAAK2rB,gBAAgB,SAAU,IACzGhR,EAAKC,IAAI,YAGZD,EAAKqR,kBAAkBhsB,KAAM6rB,EAAQ,GAAK,UAC1ClR,EAAKC,IAAI,aAETD,EAAKC,IAAI,eACT,CAAC,MAAO,MAAO,OAAQ,MAAO,QAAQqR,QAAQC,GAAOvR,EAAKC,IAAK,SAAQsR,IAAO,IAAMlsB,KAAK6C,gBAAgBspB,OAAOD,EAAK,QAAU,SAAQA,OACvIvR,EAAKC,IAAI,YAEF,CACV,CAGA2M,WAAWxf,EAAMqW,GAAO,OAAOpe,KAAM,GAAE+H,aAAgBqkB,YAAYhO,IAAQ,CAAG,CAK9EiO,eAAeC,EAAWpa,GACvB,MAAMqa,EAAYD,EACZzrB,KAAIsa,MAAWjJ,EAAMlS,KAAKmgB,cAAcnQ,QAC9C,IAAIzI,EAAoB,MAAd+kB,EAAqB,EAAI,EAE/BtsB,KAAKmhB,UAAS5Z,EAAK,EAAIA,GAE3B,MAAMilB,EAAaxsB,KAAKunB,WAAW+E,EAAWzrB,EAAE0G,IAEhDvH,KAAKysB,iBAAiBF,EARoB,OAQI,GAAED,OAAetsB,KAAKshB,WAAWgL,EAAWE,KAAgB,GAAE1qB,KAAKC,MAAMlB,EAAE,OAAOiB,KAAKC,MAAMlB,EAAE,MAChJ,CAIA6rB,iBACO1sB,KAAKsR,gBACTqb,KAAiB1kB,OAAOjI,MACxBA,KAAK4sB,sBACR,CAIAxD,iBAAiByD,GACd,SAAI7sB,KAAKsR,gBAAmBF,WAASyG,SAAYzG,WAASqJ,gBAG1DkS,KAAiB1kB,OAAOjI,MACnB6sB,GACF7sB,KAAK8sB,wBACD9sB,KAAK+sB,sBAAsBF,GACrC,CAIAG,kBACG,CAIHC,cAAcllB,GAEX,OADe/H,KAAK+H,EAAK,YACVoU,cAAc,SAChC,oCC/mCH,MAAM+Q,UAAoB1tB,IAGvBE,YAAYC,EAAKwtB,EAAKC,GACnBrtB,MAAMJ,EAAKwtB,EAAK,GAAI,OACpBntB,KAAKmtB,IAAMA,EACXntB,KAAKotB,MAAQA,EACbptB,KAAKqtB,cAAgB,IAChBrtB,KAAKotB,OAAkB,OAARD,IAEdntB,KAAKqtB,cADJF,EAAIG,UACgB,MAAQH,EAAIG,UAEZ,MAAQC,YAAUC,cAE7CxtB,KAAKytB,SAAW,GAChBztB,KAAK0tB,YAAa,EAClB1tB,KAAK2qB,eAAiB3qB,KAAK2tB,oBAE3B,MAAMlhB,EAAIzM,KAAK4tB,aACVnhB,EAAE2M,SAAW3M,EAAEmE,SAAS,iBAC1B5Q,KAAK6tB,YAAa,EACxB,CAIAvc,cACG,YAAwB9Q,IAApBR,KAAK6tB,WACC7tB,KAAK6tB,gBAEXvc,oBAGCtR,KAAKotB,QAASptB,KAAK0tB,aACd1tB,KAAKgH,kBAAkBsK,aAGpC,CAIAwc,UAAY,OAAO,CAAO,CAG1BC,aACG,OAAO,CACV,CAIAC,eACG,OAAOhuB,KAAKiuB,UAAUjuB,KAAKqtB,cAC9B,CAKAa,iBACG,OAAOluB,KAAKmuB,kBAAoB,IACnC,CAIAC,eAAezY,EAAS6I,KAChBxe,KAAKmuB,kBAAoB3P,KAC3Bxe,KAAKmuB,iBAAmBxY,EAC9B,CAGAtN,UACOrI,KAAKquB,aACNhsB,QAAQiB,MAAM,uDAEjBtD,KAAKytB,SAASxB,QAAQzkB,GAAKA,EAAEa,WAE7B,MAAMimB,EAAQtuB,KAAKguB,eACdM,EAAMlV,UACRkV,EAAM1d,SAAS,cAAe,MACzB5Q,KAAKotB,OAAOkB,EAAMzd,iBAGnB7Q,KAAKmuB,wBACLnuB,KAAKioB,yBACLjoB,KAAKuuB,kBACLvuB,KAAKwuB,cACLxuB,KAAKyuB,cACLzuB,KAAK0uB,kBACL1uB,KAAK2uB,mBACL3uB,KAAKquB,mBACLruB,KAAK6D,WAEZ7D,KAAKytB,SAAW,GAChBztB,KAAKmtB,IAAM,KACXntB,KAAK4uB,YAAc,KACnB5uB,KAAK6uB,UAAY,KACjB7uB,KAAKqtB,mBAAgB7sB,EACrBR,KAAK0tB,YAAa,KAElBoB,MAAgB,CAAElsB,GAAI5C,KAAM+uB,QAAQ,IAEpChvB,MAAMsI,SACT,CAIA+T,kBAAoB,OAAOpc,KAAKioB,iBAAmB,CAGnD+G,cAAgB,OAAOhvB,KAAK0uB,YAAc,CAAG,CAG7ChqB,eAAiB,OAAO1E,KAAK2uB,aAAe,CAAG,CAG/ChW,aACG,MAAO,CACJtI,EAAGrQ,KAAKwuB,QAAU,EAClBle,EAAGtQ,KAAKyuB,QAAU,EAClBlpB,MAAOvF,KAAKgvB,cACZze,OAAQvQ,KAAK0E,eAEnB,CAGA4kB,eACG,MAAM5gB,EAAK1I,KAAKoc,kBAChB,GAAI1T,EAAI,OAAOA,EAAG4gB,eAElB,MAAMhJ,EAAItgB,KAAKgvB,cACT5O,EAAIpgB,KAAK0E,eACTgU,EAAO,CAAC,EAEdA,SAAKuW,IAAMntB,KAAKC,MAAM,GAAIue,GAC1B5H,EAAKwW,IAAMptB,KAAKC,MAAM,GAAIqe,GAC1B1H,EAAKnT,MAAQ,EAAEmT,EAAKuW,IACpBvW,EAAKnI,OAAS,EAAEmI,EAAKwW,IACrBxW,EAAKrI,EAAIvO,KAAKC,MAAMue,EAAE,EAAI5H,EAAKuW,KAC/BvW,EAAKpI,EAAIxO,KAAKC,MAAMqe,EAAE,EAAI1H,EAAKwW,KAC/BxW,EAAK6Q,aAAe7Q,EAAKuW,IACzBvW,EAAK8Q,aAAe9Q,EAAKwW,IACzBxW,EAAKM,aAAY9F,MAAcwF,EAAKrI,EAAGqI,EAAKpI,IAAM,GAC3CoI,CACV,CAGAyW,WAAWtR,GACR,YAAqBrd,IAAbqd,GAA4BA,EAAsB,KAAX7d,KAAKmtB,GACvD,CAIAiC,gBAAgB9tB,GACb,MAAK6F,UAAO7F,GAEZ,QAASH,EAAInB,KAAKytB,SAASrsB,OAAO,EAAGD,GAAK,IAAKA,EACxCG,EAAStB,KAAKytB,SAAStsB,MACxBnB,KAAKytB,SAAStsB,GAAGkH,UACjBrI,KAAKytB,SAAS4B,OAAOluB,EAAG,GAGjC,CAMAmuB,gBAAgB5iB,GACb,MAAM6iB,EAAOvvB,KAAKytB,SAAS/gB,GAAOsZ,EAAM,GACxC,IAAIwJ,EAAU9iB,EACd,QAASvL,EAAInB,KAAKytB,SAASrsB,OAAO,EAAGD,GAAK,IAAKA,GACvCA,IAAMuL,GAAS1M,KAAKytB,SAAStsB,GAAGsuB,YAAYF,MAC9CvJ,EAAIvf,KAAKzG,KAAKytB,SAAStsB,IACvBnB,KAAKytB,SAAS4B,OAAOluB,EAAG,GACpBA,GAAKuL,GAAM8iB,KAIrBxJ,SAAIiG,QAAQtW,IACTA,EAAQtN,UACJrI,KAAKmuB,mBAAqBxY,WACpB3V,KAAKmuB,iBACZqB,GAAU,OAITA,CACV,CAKAE,iBAAiBC,EAASC,GACvBvtB,eAAQmN,KAAK,6CACN,IACV,CAMAqgB,eAAeC,EAAQC,EAASC,GAC7B,OAAOhwB,KAAKytB,SAASwC,KAAKzoB,IACvB,MAAM0oB,EAAO1oB,EAAEpH,YACf,SAAK8vB,KAEDJ,GAAWI,IAASJ,MACnBC,IAAYC,GACbD,GAAYG,EAAKC,QAAUJ,GAC3BC,GAAYE,EAAK/pB,YAAc6pB,GALjB,EAQxB,CAIAhtB,iBACG,MAAMJ,EAAK5C,KAAK6vB,oBAAervB,OAAWA,EAAY,GAAE4F,2BAExD,OAAIxD,EAAWA,EAAGI,kBAEbhD,KAAKowB,eACPpwB,KAAKowB,aAAe,CACjBjqB,UAAY,GAAEC,kBACdiqB,QAAS,CAAC,CAAEC,SAAU,EAAGC,OAAQ,CAAEA,OAAQ,qBACjC,CAAED,SAAU,KAAOC,OAAQ,CAAEA,OAAQ,qBACrC,CAAED,SAAU,IAAMC,OAAQ,CAAEA,OAAQ,sBACpC,CAAED,SAAU,KAAOC,OAAQ,CAAEA,OAAQ,qBACrC,CAAED,SAAU,GAAKC,OAAQ,CAAEA,OAAQ,sBACnC,CAAED,SAAU,KAAOC,OAAQ,CAAEA,OAAQ,uBACrC,CAAED,SAAU,IAAMC,OAAQ,CAAEA,OAAQ,sBACpC,CAAED,SAAU,KAAOC,OAAQ,CAAEA,OAAQ,sBACrC,CAAED,SAAU,EAAGC,OAAQ,CAAEA,OAAQ,uBAC1CC,cAAc,EACdC,aAAa,IACjB,EACAC,cAAW1wB,KAAKowB,aAAe,GAAEhqB,oBAG7BpG,KAAKowB,aACf,CAIAO,iBAAmB,OAAO3wB,KAAKytB,SAASrsB,MAAQ,CAMhDusB,oBAAoBiD,EAAU3qB,GACtBA,IAAMA,EAAO,OACL,YAATA,GAAoB2qB,EAAS5wB,MACjC,QAASmB,EAAI,EAAGA,EAAInB,KAAKytB,SAASrsB,SAAUD,EAAG,CAC5C,MAAM0vB,EAAM7wB,KAAKytB,SAAStsB,IAC1B,EAAIgG,UAAO0pB,EAAIlD,qBACC,YAAT1nB,GAAoB4qB,EAAIlD,oBAAoBiD,EAAU3qB,GACzC,SAATA,GAAiB2qB,EAASC,EACxC,CACH,CAKAC,qBAAqBC,GAClB/wB,KAAKgxB,oBAAsBD,CAC9B,CAKAE,gBAAgBC,EAAMC,EAAYxb,EAASyb,EAAUC,GACpC,WAATH,IAAS,EAAa/pB,UAAOnH,KAAK8uB,kBACpC9uB,KAAK8uB,gBAAgBqC,EAAYxb,EAASyb,GAEzCpxB,KAAKgxB,qBACNhxB,KAAKgxB,oBAAoB,CAAEE,OAAMC,aAAYxb,UAASyb,WAAUC,SACtE,CAGAC,oBAAoB3b,EAASvT,EAAKivB,GAC/B,MAAME,EAAYvxB,KAAKotB,QAAUptB,KAAK0tB,WAClC3mB,EAAOwqB,EAAWvxB,KAAOA,KAAKgH,sBAElBxG,IAAZmV,IAAuBA,EAAU3V,MAEjCoC,IAAQmvB,IACTnvB,KAAMovB,MAAkBxxB,KAAKguB,eAAgB5rB,KAAG,EAEnD0sB,MAAgB,CAAElsB,GAAI5C,KAAM+uB,QAAQ,IAEpChoB,EAAKkqB,gBAAgB,SAAUjxB,KAAM2V,EAASvT,EAAKivB,EACtD,CAIAI,eAAenR,EAAGF,GACf,MAAMsR,EAAW1xB,KAAKqlB,cACtBrlB,KAAKqlB,cAAgBjU,WAASugB,WAAcrR,EAAIlP,WAASugB,SAASpsB,OAAW6a,EAAIhP,WAASugB,SAASphB,QAC/FmhB,IAAa1xB,KAAKqlB,eACnBrlB,KAAK4xB,gBACX,CAIAC,cACG,OAAO,CACV,CAIAC,eACGzvB,QAAQiB,MAAM,6CACjB,CAGAyuB,gBAAgBC,EAAcC,GAE3B,IAA4CC,EAAMC,EAA9CC,EAAS,KAAMC,EAAM,KAAM3Z,EAAO,KAEtC,GAAIsZ,EAAe,EAAG,CACnB,GAAIhyB,KAAKsyB,YACN,OAAON,EAAe,EAUzB,GARAK,EAAMryB,KAAKuyB,aACPF,EAAIjZ,UAGRgZ,EAASC,EAAIzhB,SAAS,iBAEtB8H,EAAO1Y,KAAKwyB,eAAeR,EAAc,KAAMI,IAE1C1Z,EAAK4C,SAA6B,IAAjB0W,GACnB,OAAO,EAELhyB,KAAKsR,gBACP4gB,EAAOlyB,KAAKipB,YAAY,aAAcjpB,KAAKqtB,gBAE9C8E,EAAQE,EAAIlZ,YAAY,mBAC3B,KAAO,CACJ,MAAMsZ,EAAYzyB,KAAK4tB,YAEa,WAAhC6E,EAAUjtB,MAAM,aACjBitB,EAAUjtB,MAAM,WAAY,YAE/B6sB,EAAMI,EAAUviB,OAAO,OAClBE,KAAK,QAAS,sBACdQ,SAAS,cAAe5Q,MACxB4Q,SAAS,cAAe,IACxBA,SAAS,oBAAoB,GAElC5Q,KAAK0yB,iBAEA1yB,KAAKsR,gBAAkBtR,KAAK2yB,eAC9BN,EAAIniB,OAAO,aAAasG,KAAK,eAEhC2b,EAAQE,EAAIniB,OAAO,YAAYE,KAAK,QAAS,mBACxCpQ,KAAKsR,eACP6gB,EAAM3sB,MAAM,iBAAkB,eACxByM,GAAG,WAAYC,GAAQlS,KAAK4yB,WAAW1gB,GAAM,IAC7CD,GAAG,QAAS,IAAMjS,KAAKsxB,oBAAoBtxB,KAAM,OACjDiS,GAAG,aAAc,IAAMjS,KAAKysB,oBAC5Bxa,GAAG,cAAeb,WAASqJ,YAAcvI,GAAQlS,KAAK6yB,eAAe3gB,GAAQ,MAGtFmgB,EAAIniB,OAAO,SAASE,KAAK,QAAS,oBAClCiiB,EAAIniB,OAAO,SAASE,KAAK,QAAS,cAC7BpQ,KAAKsR,gBACP4gB,EAAOG,EAAIniB,OAAO,SACPE,KAAK,QAAS,cACdQ,SAAS,WAAqC,SAAzBQ,WAAS0hB,aAC9BliB,SAAS,WAAYQ,WAAS2hB,cAG5CX,EAAS,IACLpyB,KAAKmtB,KAAOntB,KAAKmtB,IAAI6F,SAAS,IAAMhzB,KAAKmtB,IAAI6F,SAAS,KACvDZ,EAASpyB,KAAKmtB,IAAI6F,SAAS,GAAKhzB,KAAKmtB,IAAI6F,SAAS,IAC7CZ,EAAS,IAASA,EAAS,MAAKA,EAAS,MAG7CpyB,KAAKsyB,aACNG,EAAUjtB,MAAM,WAAY,QAC5BkT,EAAO,CAAEnT,MAAOvF,KAAKmtB,IAAI6F,SAAS,GAAIziB,OAAQvQ,KAAKmtB,IAAI6F,SAAS,MAC3Dta,EAAKnT,QAAUmT,EAAKnI,UACtBmI,KAAOua,MAAeR,KAEzB/Z,EAAO1Y,KAAKwyB,eAAe,EAAGP,EAAUG,EAC9C,CAEA,OAAApyB,KAAKoF,cAAc,CAAED,QAAS,KAAMd,MAAO,IAEtCqU,EAAKnT,OAAS2tB,GAASxa,EAAKnI,QAAU2iB,GACxCb,EAAI7sB,MAAM,UAAW,QACrBnD,QAAQmN,KAAM,0CAAyCkJ,EAAKnT,WAAWmT,EAAKnI,UAC5EmI,EAAKnT,MAAQ,IAAKmT,EAAKnI,OAAS,KAEhC8hB,EAAI7sB,MAAM,UAAW,MAEpBxF,KAAKsyB,YACND,EAAIjiB,KAAK,IAAK,GACVA,KAAK,IAAK,GACVA,KAAK,QAASsI,EAAKnT,OACnB6K,KAAK,SAAUsI,EAAKnI,QACpB/K,MAAM,WAAY,YAEvB6sB,EAAIjiB,KAAK,IAAK,GACVA,KAAK,IAAK,GACV5K,MAAM,QAAS,QACfA,MAAM,SAAU,QAChBA,MAAM,WAAY,YAClBA,MAAM,OAAQ,GAAGA,MAAM,MAAO,GAAGA,MAAM,SAAU,GAAGA,MAAM,QAAS,GAGzE6sB,EAAI7sB,MAAM,SAAU4L,WAAS+hB,SAAW,eAAiB,MAEzDd,EAAIjiB,KAAK,UAAY,OAAMsI,EAAKnT,SAASmT,EAAKnI,UAC1CH,KAAK,sBAAuB,QAC5BQ,SAAS,gBAAiBwhB,GAC1BxhB,SAAS,SAAU,GACnBA,SAAS,SAAU,GACnBA,SAAS,aAAc8H,EAAKnT,OAC5BqL,SAAS,cAAe8H,EAAKnI,QAEjCvQ,KAAKwuB,OAAS,EACdxuB,KAAKyuB,OAAS,EACdzuB,KAAK0uB,WAAahW,EAAKnT,MACvBvF,KAAK2uB,YAAcjW,EAAKnI,OAExB4hB,EAAM/hB,KAAK,IAAM,QAAOsI,EAAKnT,SAASmT,EAAKnI,aACrCC,KAAKxQ,KAAKmf,QAAQjV,MAExBlK,KAAKyxB,eAAe/Y,EAAKnT,MAAOmT,EAAKnI,QAEjCvQ,KAAKozB,cAAgBlB,GACtBlyB,KAAKozB,aAAalB,EAAMxZ,EAAKnT,MAAOmT,EAAKnI,SAErC,CACV,CAIA8iB,uBACA,CAGAT,WAAW1gB,EAAMohB,EAAaC,GAK3B,GAJArhB,GAAME,iBACNF,GAAMG,kBAGFihB,GAAetzB,KAAK0H,YAA6C,QAA9B1H,KAAKwzB,YAAY,SACrD,OAEH,MAAMC,EAAUzzB,KAAKuyB,aACfmB,EAAeD,EAAQ7iB,SAAS,gBAEtC,IAAI5Q,KAAKotB,OAAUptB,KAAK0tB,aAAgBgG,GAAiB1zB,KAAK2zB,oBAAuB3zB,KAAKytB,UAO9EiG,GAAiBH,EAIlBG,IAAiB1zB,KAAKmtB,KAC9BntB,KAAKwzB,aAAY,GACjBC,EAAQ7iB,SAAS,eAAgB,QACxB2iB,GAAaD,GACtBjxB,QAAQiB,MAAM,2CAPdtD,KAAKwzB,aAAY,GAAM,GACvBC,EAAQ7iB,SAAS,eAAgB5Q,KAAKmtB,MAAG,EACzC2B,MAAgB,CAAElsB,GAAI5C,KAAM+uB,QAAQ,SAV8D,CAElG,GADI/uB,KAAKsyB,cACJtyB,KAAKwzB,aAAYD,GAAoB,UAAW,OACnB,QAA9BvzB,KAAKwzB,YAAY,SAClBC,EAAQ7iB,SAAS,eAAgB,OAAI,EAErCke,MAAgB,CAAElsB,GAAI5C,KAAM+uB,QAAQ,GAC1C,CAUA,OAAO/uB,KAAK4zB,aAAY,EAC3B,CAIAC,aAAaC,GACV,IAAK9zB,KAAK0tB,WACP,OAAA1tB,KAAK+xB,gBAAgB+B,EAAc,EAAI,IAChC,EAGV,MAAMC,EAAa/zB,KAAKiuB,UAAUjuB,KAAKg0B,UACjCP,EAAUzzB,KAAKuyB,aACfhtB,EAAQwuB,EAAWnjB,SAAS,cAC5BL,EAASwjB,EAAWnjB,SAAS,eAC7B8iB,EAAeD,EAAQ7iB,SAAS,gBACtC,IAAIqjB,GAAc,EACd3T,EAAI/a,EAAO6a,EAAI7P,EAAQF,EAAI,EAAGC,EAAI,EAClC4jB,EAAU,KAAMC,EAAW,KAAMjC,EAAO,KAE5C,OAAIlyB,KAAKmtB,KAAKlT,MAAQja,KAAKmtB,KAAKiH,QAC7B/jB,EAAIvO,KAAKC,MAAMwD,EAAQvF,KAAKmtB,IAAIlT,KAAKyB,OAAOC,KAAK,IACjDrL,EAAIxO,KAAKC,MAAMwO,EAASvQ,KAAKmtB,IAAIlT,KAAK2B,MAAMD,KAAK,IACjD2E,EAAIxe,KAAKC,MAAMwD,EAAQvF,KAAKmtB,IAAIiH,MAAM1Y,OAAOC,KAAK,IAClDyE,EAAIte,KAAKC,MAAMwO,EAASvQ,KAAKmtB,IAAIiH,MAAMxY,MAAMD,KAAK,KAGjD+X,IACDO,GAAc,EACVP,IAAiB1zB,KAAKmtB,IACvB8G,GAAc,EAEdj0B,KAAK2tB,oBAAoB/qB,IAAYA,EAAGxC,cAAgBszB,IAAcO,GAAc,IAAS,QAE5FA,IAAe3T,EAAI/a,EAAO6a,EAAI7P,EAAQF,EAAIC,EAAI,IAGjDwjB,GACDI,EAAUl0B,KAAKguB,eACfmG,EAAWD,EAAQ/a,YAAY,oBAC1BnZ,KAAKsR,gBACP4gB,EAAOlyB,KAAKipB,YAAY,aAAcjpB,KAAKqtB,kBAE9C6G,EAAUH,EAAW5a,YAAY,qBAC5BjJ,OAAO,WACPC,QAAQ,cAAgBnQ,KAAKqtB,eAAe,GAC5Cjd,KAAK,MAAOpQ,KAAKqtB,eACjBzc,SAAS,cAAe5Q,MAExBA,KAAKsR,eACP4iB,EAAQhkB,OAAO,aAAasG,KAAK,eAEpC2d,EAAWD,EAAQhkB,OAAO,YAAYE,KAAK,QAAS,mBAEpD8jB,EAAQhkB,OAAO,SAASE,KAAK,QAAS,oBACjCpQ,KAAKsR,gBACP4gB,EAAOgC,EAAQhkB,OAAO,SACPE,KAAK,QAAS,cACdQ,SAAS,WAAqC,SAAzBQ,WAAS0hB,aAC9BliB,SAAS,WAAYQ,WAAS2hB,cAG5C3hB,WAASqJ,aACV0Z,EAASliB,GAAG,cAAeC,GAAQlS,KAAK6yB,eAAe3gB,IAErDlS,KAAKsR,eACP6iB,EAAS3uB,MAAM,iBAAkB,eACxByM,GAAG,WAAYC,GAAQlS,KAAK4yB,WAAW1gB,GAAM,IAC7CD,GAAG,QAAS,IAAMjS,KAAKsxB,oBAAoBtxB,KAAM,OACjDiS,GAAG,aAAc,IAAMjS,KAAKysB,qBAI3CzsB,KAAKoF,cAAc,CAAEgL,KAAMpQ,KAAKmtB,MAEhCntB,KAAKyF,cAAc,CAAE2K,KAAMpQ,KAAKmtB,IAAKkH,OAAiC,IAAzBr0B,KAAKmtB,IAAImH,YAAoB,OAAS,KAEnFJ,EAAQ1uB,MAAM,UAAWyuB,EAAc,KAAO,QACtC7jB,KAAK,UAAY,OAAMkQ,KAAKF,KAC5BhQ,KAAK,sBAAuB,QAC5BA,KAAK,IAAKC,GACVD,KAAK,IAAKE,GACVF,KAAK,QAASkQ,GACdlQ,KAAK,SAAUgQ,GACfxP,SAAS,SAAUP,GACnBO,SAAS,SAAUN,GACnBM,SAAS,aAAc0P,GACvB1P,SAAS,cAAewP,GAEhCpgB,KAAKwuB,OAASne,EACdrQ,KAAKyuB,OAASne,EACdtQ,KAAK0uB,WAAapO,EAClBtgB,KAAK2uB,YAAcvO,EAEnB+T,EAAS/jB,KAAK,IAAM,QAAOkQ,KAAKF,QACvB5P,KAAKxQ,KAAKmf,QAAQjV,MAClBsG,KAAKxQ,KAAK0F,QAAQwE,MAE3BlK,KAAKyxB,eAAenR,EAAGF,GAGnB8T,EAAQtjB,SAAS,WAAa2jB,YAAUC,QAAQC,SACjDz0B,KAAK4tB,YAAY9d,OAAO,WAAa9P,KAAKqtB,eACrC7nB,MAAM,UAAWyuB,EAAc,GAAK,QAGxCj0B,KAAKozB,cAAgBlB,GAAMlyB,KAAKozB,aAAalB,EAAM5R,EAAGF,GAEnD6T,CACV,CAGAN,mBACG,OAAO3zB,KAAKmtB,KAAKuH,aAAazE,KAAKrwB,GAAOA,EAAIuG,YAAe,GAAEC,yBAClE,CAMAuuB,SAAS1uB,GACN,MAAM2uB,EAAQ,CAAE3uB,KAAMA,GAAQ,UAC9B,YAAyBzF,IAArBR,KAAKquB,aACNruB,KAAKquB,YAAc,CAACuG,GACbtb,QAAQC,SAAQ,OAGN,IAAfqb,EAAM3uB,MAAmBjG,KAAKquB,YAAYwG,UAAU,CAACC,EAAGloB,IAAOA,EAAI,GAAOkoB,EAAE7uB,OAAS2uB,EAAM3uB,MAAS,KAEzGjG,KAAKquB,YAAY5nB,KAAKmuB,GACf,IAAItb,QAAQyb,IAChBH,EAAM1qB,KAAO6qB,IAEnB,CAIAC,cACG,QAAyBx0B,IAArBR,KAAKquB,YACN,OAAOhsB,QAAQmN,KAAK,8BAEvB,GADAxP,KAAKquB,YAAY4G,QACe,IAA5Bj1B,KAAKquB,YAAYjtB,cACXpB,KAAKquB,gBACV,CACF,MAAMuG,EAAQ50B,KAAKquB,YAAY,GAC3BuG,EAAM1qB,OAAQ0qB,EAAM1qB,cAAe0qB,EAAM1qB,KAChD,CACH,CAGMgrB,aAAgC,SAAAngB,KAAA,YACnC1S,eAAQC,IAAI,2DACL,IAAK,EAFuB,EAGtC,CAIM6yB,eAAezoB,GAAM,IAAAoI,EAAA9U,KAAA,SAAA+U,KAAA,YACxB,QAAavU,IAATkM,EACD,OAAIoI,EAAKsY,QACNtY,EAAKsgB,eAAgBC,MAAOC,WAG/BxgB,EAAK3R,gBAAkB2R,EAAKqY,KAAKuH,aAAatzB,QAAU,EAEjD0T,EAAK6f,UAAS,GAAM1d,KAAK,IAAMnC,EAAKqgB,eAAe,IAG7D,GAAKrgB,EAAKqY,OAAQzgB,GAAQoI,EAAK3R,iBAa/B,OAAO2R,EAAKogB,WAAWpgB,EAAKgP,SAAUhP,EAAKqY,IAAIuH,YAAYhoB,GAAO,IAAIuK,KAAKse,OAEpEC,YAASD,KACVA,EAAGE,YAAa,GAEZ3gB,EAAKqgB,eAAezoB,EAAK,KAfhC,GAFAoI,EAAKkgB,cAEDlgB,EAAKsgB,UAAW,CACjB,MAAMM,OAAcL,MAAOC,UAAYxgB,EAAKsgB,UACxCM,EAAU,KAAMrzB,QAAQC,IAAK,wBAA+B,KAARozB,GAAc5Z,QAAQ,cACvEhH,EAAKsgB,SACf,CAYA,EA9BqB,EA+B3B,CAIAO,uBAAuBvX,GACpB,MAAMqP,EAAW,GAAImI,EAAQ,GAG7B,OAAA51B,KAAKytB,UAAUxB,QAAQrsB,KACpB,EAAIuH,UAAOvH,EAAIi2B,sBAAsBpI,EAAShnB,KAAK7G,EAAG,GAGrDwe,IAAKA,EAAI0X,MAAQrI,EAASrsB,QAE9BqsB,EAASxB,QAAQrsB,IACd,MAAMm2B,EAAOn2B,EAAIi2B,oBAAoBzX,IAAQ,CAAE4X,UAAW,MAC1DJ,EAAMnvB,KAAKsvB,GACP3X,GAAKqP,WAAUsI,EAAKpgB,QAAU/V,KAG9Bg2B,CACV,CAIAK,eAAeC,GACZl2B,KAAKuyB,aAAa/sB,MAAM,SAAW0wB,GAAQ9kB,WAAS+hB,SAAY,eAAiB,KACpF,CAIAvH,gBAAgBjR,GAEVA,EAAKC,IADJ5a,KAAKotB,MACG,kBAEA,gBAEZzS,EAAK2B,OAAOtc,KAAK8rB,mBAAoB,gBAAiB,IAAM9rB,KAAK+rB,kBAAkB,WAE9E/rB,KAAK0H,aACPiT,EAAKqR,kBAAkBhsB,MACnBA,KAAKotB,OACNzS,EAAKwb,iBAAgB,GAAO,EAAOxmB,IACpB,SAARA,GAAgB3P,KAAKi2B,gBAAe,IAKjDtb,EAAKC,IAAI,cAAW,EAEhBzT,UAAOnH,KAAKo2B,cAAU,EAAKjvB,UAAOnH,KAAKq2B,kBACxC1b,EAAK2B,OAAOtc,KAAKo2B,aAAc,WAAYnZ,GAAQjd,KAAKq2B,gBAAgBpZ,KAAK,EAE5E9V,UAAOnH,KAAKs2B,kBAAc,EAAKnvB,UAAOnH,KAAKu2B,qBAAiB,EAAKpvB,UAAOnH,KAAKw2B,eAC1Ex2B,KAAKw2B,gBACN7b,EAAK2B,OAAOtc,KAAKs2B,iBAAkB,eAAgB,IAAMt2B,KAAKu2B,kBAAkB,YAGlFv2B,KAAKwzB,eAAkBxzB,KAAK0tB,YAAc1tB,KAAK2zB,qBAChDhZ,EAAK2B,OAAsC,OAA9Btc,KAAKwzB,YAAY,SAAoB,YAAcxzB,KAAKotB,MAAQ,SAAW,OAAQ,IAAMptB,KAAK4yB,cAE9G,MAAM6D,EAAQz2B,KAAKqtB,gBAAkBrtB,KAAKotB,MAAQ,SAAW,OAC7DzS,SAAKC,IAAI,eACT,CAAC,MAAO,MAAO,OAAQ,MAAO,QAAQqR,QAAQC,GAAOvR,EAAKC,IAAK,GAAE6b,KAASvK,IAAO,IAAMlsB,KAAKmsB,OAAOD,EAAKlsB,KAAKotB,MAAQ,GAAEqJ,KAASvK,OAChIvR,EAAKC,IAAI,YAEF,CACV,CAIAiY,eAAe3gB,GACRA,EAAKG,kBAGNH,EAAKG,kBACLH,EAAKE,iBAELpS,KAAKoc,mBAAmB+B,oBAAgB,EAG3CzD,MAAWxI,EAAMlS,MAAMiX,KAAK0D,IACzB3a,KAAK4rB,gBAAgBjR,GACd3a,KAAK02B,mBAAmB/b,KAC/B1D,KAAK0D,GAAQA,EAAKG,OACxB,CAIMoB,UAAUya,GAAQ,IAAA1e,EAAAjY,KAAA,SAAA+U,KAAA,YACrB,MAAM6hB,EAAe3e,EAAK0c,SAASgC,GACnC,IAAqB,IAAjBC,EACDv0B,eAAQC,IAAI,2BACL,EAGV,IAAIu0B,GAAe,EACnB,MAAMC,EAAapqB,IAChB,KAAOA,EAAOuL,EAAKwV,SAASrsB,QAAQ,CACjC,MAAMyvB,EAAM5Y,EAAKwV,SAAS/gB,KAC1B,IAAInM,EAAM,EAIV,IAHIs2B,GAAgBhG,EAAIxD,iBACrB9sB,EAAMswB,EAAI/W,OAAO6c,KAAM,EAEtBI,aAAUx2B,GACX,OAAOA,EAAI0W,KAAK,IAAM6f,EAAWpqB,GACvC,CACA,OAAO,GAGV,OAAOkqB,EAAa3f,KAAK,KAClBgB,EAAKmV,MACNnV,EAAK8Z,gBAAgB,GAErB8E,EAAe5e,EAAK4b,cAAa,GAE7BiD,EAAW,KAClB7f,KAAK,QACD+f,UAAmB/e,GACpBA,EAAKjR,kBAAkBiqB,gBAAgB,YAAahZ,GACvDA,EAAK+c,eACE,GACP,EAjCkB,EAkCxB,CAGAlb,OAAO6c,GACJ,OAAO32B,KAAKkc,UAAUya,EACzB,CAKAM,qBACG,MAAMC,EAAOl3B,KAAKguB,eAClB,IAAKkJ,EAAK9d,SAAW8d,EAAKtmB,SAAS,WAAa2jB,YAAUC,QAAQC,QAAS,OAAO,EAElF,QAAS7nB,EAAI,EAAGA,EAAI5M,KAAKytB,SAASrsB,SAAUwL,EACzC,MAAIzF,UAAOnH,KAAKytB,SAAS7gB,GAAGqqB,qBACrBj3B,KAAKytB,SAAS7gB,GAAGqqB,qBAAsB,OAAO,EAGxD,OAAO,CACV,CAGAE,kBAAkBxzB,EAAM6a,GAIrB,GAHIxe,KAAKo3B,iBAGJp3B,KAAKotB,OAASptB,KAAK0tB,WAAY,OAAO,EAE3C,MAAMkJ,EAAe52B,KAAK20B,SAAS,iBACnC,IAAqB,IAAjBiC,EAAwB,OAAO,IAErB,IAATjzB,IAA4B,IAATA,KAAmB6a,EAAQ7a,EAAMA,EAAO,SAE5D6xB,YAAS7xB,IAASA,EAAK6a,QAAOA,GAAQ,GAErCA,IAAOA,EAAQxe,KAAKi3B,sBAEzB,IAAI3b,GAAU,EACd,MAAMwb,EAAapqB,IACX4O,GAAY5O,GAAQ1M,KAAKytB,SAASrsB,QACpCpB,KAAKg1B,cACE1Z,MAGH+b,cAAWr3B,KAAKytB,SAAS/gB,GAAMoN,OAAO0E,EAAQ,SAAW,WAAWvH,KAAK,IAAM6f,EAAWpqB,EAAK,IAIzG,OAAOkqB,EAAa3f,KAAK,KACtBqE,EAAUtb,KAAK+xB,gBAAgBvT,EAAQ,EAAI,EAAG7a,GAE1C2X,GAAWtb,KAAKotB,OAASptB,KAAKmtB,KAAOntB,KAAK2yB,gBAAkB3yB,KAAKs3B,eAAiBt3B,KAAKsR,gBACpFtR,KAAKu3B,eACNC,aAAax3B,KAAKu3B,eACrBv3B,KAAKu3B,cAAgBE,WAAW,KAE7B,UADOz3B,KAAKu3B,eACPv3B,KAAKmtB,KAAK6F,SAAU,OACzB,MAAM0E,EAAK13B,KAAKgvB,cAAe2I,EAAK33B,KAAK0E,eACpCgzB,EAAK,GAAOC,EAAK,IAAQ33B,KAAKmtB,IAAI6F,SAAS,KAAO0E,GAAQ13B,KAAKmtB,IAAI6F,SAAS,KAAO2E,KACrF33B,KAAKmtB,IAAI6F,SAAS,GAAK0E,EACvB13B,KAAKmtB,IAAI6F,SAAS,GAAK2E,EACvB33B,KAAK43B,cAAe,YAAWF,KAAMC,MAAK,EAE7C,MAKCb,EAAW,IAExB,CAIAe,aAAaj4B,GACV,QAAKA,IAELI,KAAKmtB,IAAIppB,OAASnE,EAAImE,OACtB/D,KAAKmtB,IAAIvsB,MAAQhB,EAAIgB,MAEjBZ,KAAKotB,OACNptB,KAAKmtB,IAAIjV,OAAStY,EAAIsY,OACtBlY,KAAKmtB,IAAI6F,SAAWpzB,EAAIozB,WAExBhzB,KAAKmtB,IAAIlT,KAAOra,EAAIqa,KACpBja,KAAKmtB,IAAIiH,MAAQx0B,EAAIw0B,QAGjB,EACV,CAKA0D,iBAAiBC,EAAYC,EAAKtrB,GAC3BqrB,GAAcC,GAAOA,EAAItrB,SAAgClM,IAAtBu3B,EAAW7xB,SAE3ClG,KAAKytB,SAASle,QAAQwoB,GAAc,GACrC/3B,KAAKytB,SAAShnB,KAAKsxB,GACtBA,EAAWzwB,aAAa0wB,EAAItrB,GAAM4gB,WAC7ByK,EAAW/2B,SAAQ+2B,EAAW/2B,OAASg3B,EAAItrB,GAAM3I,QAAU/D,KAAKgB,QAE3E,CAGAi3B,mBAAmBC,GAChB,GAAIA,EAAKC,WAAaD,EAAKE,UAAW,CACnC,MAAMC,EAASr4B,KAAKs4B,gBAAeC,QACnC,QAASp3B,EAAI,EAAGA,EAAI+2B,EAAKC,UAAU/2B,SAAUD,EAC1Ck3B,EAAOH,EAAKC,UAAUh3B,IAAM+2B,EAAKE,UAAUj3B,EAChD,CAGD,MAAMq3B,EAAQ,IAAIh5B,IAAkBI,EAAMs4B,EAAKO,QAC/CD,EAAME,aAAaR,GACnBM,EAAM14B,QAAUo4B,EAAKS,SACrBH,EAAMx3B,OAASk3B,EAAKn0B,OAEpBm0B,EAAKU,QAAUJ,EAAMv4B,WAAW,UAAW,IAE3C,MAAM44B,EAAgBA,CAACC,EAAaC,KACjC,MAAMtc,EAAM+b,EAAM91B,YAAYq2B,EAAW,IACrCtc,IAAK7c,EAAIk5B,IAAW,EAAIE,MAASvc,EAAKzc,KAAKs4B,aAAW,OAIrC93B,IAAnBZ,EAAIq5B,iBAAiDz4B,IAAnBZ,EAAIs5B,iBAAiD14B,IAAnBZ,EAAIu5B,aAC1EN,EAAc,aAAc,cAC5Bj5B,EAAIs5B,WAAaV,EAAMv4B,WAAW,aAAcL,EAAIs5B,YACpDt5B,EAAIu5B,WAAaX,EAAMv4B,WAAW,aAAcL,EAAIu5B,kBAI/B34B,IAAnBZ,EAAIw5B,iBAAiD54B,IAAnBZ,EAAIy5B,aACxCR,EAAc,aAAc,cAC5Bj5B,EAAIy5B,WAAab,EAAMv4B,WAAW,aAAcL,EAAIy5B,kBAI7B74B,IAArBZ,EAAI05B,mBAAqD94B,IAArBZ,EAAI25B,mBAAoD/4B,IAApBZ,EAAI45B,cAC9EX,EAAc,eAAgB,gBAC9Bj5B,EAAI25B,aAAef,EAAMv4B,WAAW,eAAgBL,EAAI25B,cACxD35B,EAAI45B,YAAchB,EAAMv4B,WAAW,cAAeL,EAAI45B,mBAIjCh5B,IAAnBZ,EAAI65B,iBAAiDj5B,IAAnBZ,EAAI85B,iBAAiDl5B,IAAnBZ,EAAI+5B,iBAAgDn5B,IAAlBZ,EAAIg6B,YAC5Gf,EAAc,aAAc,cAC5Bj5B,EAAI85B,WAAalB,EAAMv4B,WAAW,aAAcL,EAAI85B,YACpD95B,EAAI+5B,WAAanB,EAAMv4B,WAAW,aAAcL,EAAI+5B,YACpD/5B,EAAIg6B,UAAYpB,EAAMv4B,WAAW,YAAaL,EAAIg6B,WAGxD,CAKMC,aAAa7B,EAAKtrB,GAAM,IAAAuM,EAAAjZ,KAAA,SAAA+U,KAAA,YAa3B,QAZavU,IAATkM,IACDA,GAAO,EAEPuM,EAAK6gB,WAAa,CAAC,EACnB7gB,EAAK9V,gBAAkB60B,EAAMA,EAAI52B,OAAS,EAC1C6X,EAAKnW,gBAAkB,UAGnBmW,EAAK8gB,cAEVrtB,GAEGsrB,GAAOtrB,GAAQsrB,EAAI52B,OACrB,cAAO6X,EAAK6gB,kBACL7gB,EAAKnW,gBACLmW,EAGV,MAAMif,EAAOF,EAAItrB,GACXxG,EAASgyB,EAAK5K,UACpB,IAAIrqB,EAAMgW,EAAK6gB,WAAW5zB,GACtB6xB,EAAa,KAMjB,GAJI90B,EAAKA,IAAYA,EAAI,EACzBgW,EAAK6gB,WAAW5zB,GAAUjD,EAGtBi1B,EAAK8B,OAAQ,OAAO/gB,EAAK4gB,aAAa7B,EAAKtrB,GAI/C,QAASvL,EAAI,EAAGA,EAAI8X,EAAKwU,SAASrsB,SAAUD,EACzC,GAAI8X,EAAKwU,SAAStsB,GAAG+E,SAAWA,GACf,KAARjD,EAAW,CAAE80B,EAAa9e,EAAKwU,SAAStsB,GAAI,KAAO,CAG/D,GAAI42B,EAAY,CACb,GAAIG,EAAK/xB,YAAe,GAAEC,yBAEvB,OAAO2xB,EAAWkC,cAAc/B,GAAMjhB,KAAKijB,IACxCjhB,EAAK6e,iBAAiBoC,EAAUlC,EAAKtrB,GAC9BuM,EAAK4gB,aAAa7B,EAAKtrB,KAOpC,IAAI8N,EAEJ,OALI0d,EAAK/xB,YAAe,GAAEC,6BACvB6S,EAAKgf,mBAAmBC,GAIvBH,EAAWF,aAAaK,EAAKiC,WAAajC,EAAKO,SAAWP,EAAMA,EAAKU,SAAW,IAAI,KACrFpe,EAAUud,EAAWje,WAAO,EAExBud,cAAW7c,GAASvD,KAAK,IAAMgC,EAAK4gB,aAAa7B,EAAKtrB,GAChE,CAEA,GAAIwrB,EAAK/xB,YAAe,GAAEC,yBAAwB,CAC/C,MAAMg0B,EAASlC,EAEd/G,EAAa,IAAIjE,EAAYjU,EAAK6K,SAAUsW,GAAQ,GACrDjJ,EAAWkJ,cAAc,IACzBlJ,EAAWmJ,mBAAmBrhB,EAAKoU,eACnC8D,EAAW7pB,aAAa4wB,EAAK5K,WAC7B6D,EAAWnwB,OAASk3B,EAAKn0B,OAEzBotB,EAAW0C,eAEPqE,EAAKxD,aAAewD,EAAKxD,YAAYtzB,OAAS,GAC/C+vB,EAAWoJ,gBAGd,MAAMC,EAAYrJ,EAAWsJ,iBAAiBtJ,EAAW9D,eAEzD,OAAO8D,EAAW0I,aAAa3B,EAAKxD,aAAazd,KAAK,KACnDka,EAAWsJ,iBAAiBD,GACrBvhB,EAAK4gB,aAAa7B,EAAKtrB,IAEpC,CAKA,GAFAuM,EAAK8gB,YAAc/B,EAAItrB,GAAM3I,QAAUkV,EAAKjY,OAExCk3B,EAAK/xB,YAAe,GAAEC,4BAA2B,CAElD,MAAMs0B,EAAa,CAAEC,MAAO,EAAGC,QAAS,EAAGC,QAAS,EAAGC,OAAQ,EAAGC,SAAU,GAE5E,GAAI7C,EAAK8C,QAAUN,EAAWI,OAC3B9yB,cAAOC,OAAO0W,SAAQuZ,EAAKO,SACpBxf,EAAK4gB,aAAa7B,EAAKtrB,GAGjC,GAAIwrB,EAAK8C,QAAUN,EAAWG,QAAS,CACpC,MAAMI,EAAe,GAAIjV,EAAMkS,EAAKO,QAAQzS,IAC5C,QAAS/F,EAAI,EAAGA,EAAI+F,EAAI5kB,SAAU6e,EAAG,CAClC,MAAM/f,EAAO8lB,EAAI/F,GAAGib,QAAS1zB,EAAItH,EAAKqP,QAAQ,KAC1C/H,EAAI,IACLyzB,EAAav0B,SAASxG,EAAKqC,MAAM,EAAGiF,KAAOtH,EAAKqC,MAAMiF,EAAE,GAC9D,CAEAyR,SAAKqf,YAAc2C,EAGZhiB,EAAK4gB,aAAa7B,EAAKtrB,EACjC,CAEA,GAAIwrB,EAAK8C,QAAUN,EAAWK,SAAU,CACrC,MAAM/U,EAAMkS,EAAKO,QAAQzS,IAAKmV,EAAU,GACxC,QAASlb,EAAI,EAAGA,EAAI+F,EAAI5kB,SAAU6e,EAC/Bkb,EAAQlb,GAAK+F,EAAI/F,GAAGib,QACvBjiB,SAAKmiB,eAAiB,IAAIC,KAAaF,GAChCliB,EAAK4gB,aAAa7B,EAAKtrB,EACjC,CAEA,IAAKuM,EAAKmD,kBACP,OAAOnD,EAAKic,WAAWjc,EAAK6K,SAAU,CAAE3d,UAAW,SAAUm1B,QAAQ,GAAQ,IACjErkB,KAAK,IAAMgC,EAAK4gB,aAAa7B,EAAKtrB,EAAK,IAGtDuM,EAAKgf,mBAAmBC,EAC3B,CAGA,OAAOjf,EAAKic,WAAWjc,EAAK6K,SAAUoU,EAAKiC,WAAajC,EAAKO,SAAWP,EAAMA,EAAKU,SAAW,IAAI3hB,KAAK8gB,IACpG9e,EAAK6e,iBAAiBC,EAAYC,EAAKtrB,GAChCuM,EAAK4gB,aAAa7B,EAAKtrB,IAC9B,EA9HwB,EA+H9B,CAIA6uB,SAASr1B,EAAQs1B,GACd,SAASC,EAAMC,GACZ,SAAKA,KAAW,EAAC/4B,SAAM+4B,MACnBA,IAAYx1B,GACTs1B,GAAWE,EAAQt6B,OAAS8E,EAAO9E,QAClCs6B,EAAQnsB,QAAQrJ,KAAaw1B,EAAQt6B,OAAS8E,EAAO9E,OAChE,CAEA,GAAIq6B,EAAMz7B,KAAKkG,QAAS,OAAOlG,KAE/B,IAAKA,KAAKytB,SAAU,OAAO,KAE3B,QAAStsB,EAAE,EAAGA,EAAEnB,KAAKytB,SAASrsB,SAAUD,EAAG,CACxC,IAAI0vB,EAAM7wB,KAAKytB,SAAStsB,GAOxB,IALKq6B,MAAUr0B,UAAO0pB,EAAI0K,UACvB1K,EAAMA,EAAI0K,SAASr1B,GACZu1B,EAAM5K,EAAI3qB,UACjB2qB,EAAM,MAELA,EAAK,OAAOA,CACnB,CAEA,OAAO,IACV,CAKMoJ,cAAc/B,GAAM,IAAA7M,EAAArrB,KAAA,SAAA+U,KAAA,YAGvB,IAAKmjB,IAASA,EAAKxD,YAChB,OAAOrJ,EAWV,GAHIA,EAAK+B,OAAS/B,EAAK3jB,YAAcwwB,EAAKhgB,SAAWmT,EAAKiM,qBAAwBqE,SAAa,MAC5FA,SAASC,MAAQ1D,EAAKhgB,aAEL1X,IAAhB6qB,EAAKnlB,OAAsB,CAG5BmlB,EAAK/jB,aAAa4wB,EAAK5K,WAEvBjC,EAAKuD,YAAcsJ,EACnB7M,EAAK8B,IAAM+K,EAEP7M,EAAK/Z,eAAiB+Z,EAAK+B,QAC3B/B,EAAKiH,aAAc,GAEvB,MAAMuJ,EAASxQ,EAAKuC,YAAYxd,KAAK,MAErC,OAAKib,EAAK/Z,gBAAkB+Z,EAAKyQ,aAAezQ,EAAK0Q,UAAYF,MAAUl5B,SAAMk5B,KAC9ExQ,EAAK0Q,SAAW,IAAIC,KAAcH,EAAQ,KAAMxQ,GAChDA,EAAK0Q,SAASnY,OAAOiY,GAAQ,GAC7BxQ,EAAK4Q,OAAO5Q,EAAK0Q,SAASG,kBAAe,EACzCC,MAAkB9Q,EAAK0Q,WAG1B1Q,EAAK0G,gBAAgB,GACrB1G,EAAKkP,eAAc,GAEZlP,EAAKwO,aAAa3B,EAAKxD,YACjC,CAGArJ,EAAKwM,aAAaK,GAGd7M,EAAK+B,MACN/B,EAAK0G,gBAAgB,GAErB1G,EAAKwI,cAAa,GAGrB,IAAIuI,GAAa,EAAOC,GAAc,EAGtC,QAASl7B,EAAI,EAAGA,EAAIkqB,EAAKoC,SAASrsB,SAAUD,EAAG,CAC5C,IAAI0vB,EAAMxF,EAAKoC,SAAStsB,QACLX,IAAfqwB,EAAI3qB,SAERgyB,EAAKxD,YAAYzI,QAAQsD,IAClBsB,GAAQtB,EAAKjC,YAAcuD,EAAI3qB,SAChC2qB,EAAM,KAAMuL,GAAa,KAI3BvL,IAEDxF,EAAKoC,SAAS4B,OAAOluB,IAAK,GAC1B0vB,EAAIxoB,UACJg0B,GAAc,EACVhR,EAAK8C,mBAAqB0C,UACpBxF,EAAK8C,kBAErB,CAKA,GAHIkO,UACMhR,EAAKkD,YAEV6N,EAAY,CACd,IAAI1zB,EAAK2iB,EAAKjP,kBAEV1T,GAAImV,aAAYnV,EAAK,MACzB,QAASvH,EAAI,EAAGA,EAAIkqB,EAAKoC,SAASrsB,SAAUD,EAChDuH,IAAO2iB,EAAKoC,SAAStsB,IACXkqB,EAAKoC,SAAStsB,GAAGkH,UAEvBgjB,EAAKoC,SAAW,UACTpC,EAAK8C,iBACRzlB,IACD2iB,EAAKoC,SAAShnB,KAAKiC,GACnBA,EAAGif,qBACHjf,EAAGoR,UAEFuR,EAAKiR,kBAAkBjR,EAAKiR,mBAChCjR,EAAKkP,eAAc,EACtB,CAEA,MAAMC,EAAYnP,EAAKoP,iBAAiBpP,EAAKgC,eAE7C,OAAOhC,EAAKwO,aAAa3B,EAAKxD,aAAazd,KAAK,KAC7CoU,EAAKoP,iBAAiBD,IAAS,EAE3BxD,UAAmB3L,GACpBA,EAAKrkB,kBAAkBiqB,gBAAgB,YAAa5F,GAChDA,GACP,EAxGoB,EAyG1B,CAMMkR,YAAYrxB,GAAQ,IAAAsxB,EAAAx8B,KAAA,SAAA+U,KAAA,YACvB,MAAgB,QAAX7J,GAAiC,SAAXA,GAAkC,QAAXA,GAAiC,QAAXA,EAC9DsxB,EAAKC,cAAa,EAAMvxB,GAAQ+L,KAAK1W,IACzC,IAAKA,GAAmB,QAAX2K,EAAmB,OAAO3K,EACvC,MAAMm8B,EAAQn8B,EAAIgP,QAAQ,WAC1B,OAAQmtB,EAAQ,EAAKn8B,EAAIgC,MAAMm6B,EAAM,GAAK,KAIzC,EAAG,EATa,EAU1B,CAIAC,gBAAgBz8B,GACZ,MAAM08B,EAAM58B,KAAKguB,eAAehe,OAAO6sB,wBACnC3qB,EAAO,CAAE4qB,QAASF,EAAIG,KAAK,GAAIC,QAASJ,EAAIK,IAAM,IAGtD,GAAa,QAAT/8B,EACD,SAAOg9B,mBAAgB,IAAMl9B,KAAK6yB,eAAe3gB,GAAO,IAE3D,IAAiBirB,EAAbC,EAAO,KAEX,OAAQl9B,GACL,IAAK,QACL,IAAK,QACL,IAAK,QACFk9B,EAAOp9B,KAAKkuB,iBACZiP,EAAUj9B,EAAK,GACf,MACH,IAAK,QACFk9B,EAAOp9B,KAAKoc,kBACZ,MACH,QAAS,CACN,MAAM1P,EAAOhG,SAASxG,GAClBsC,OAAO66B,UAAU3wB,KAAO0wB,EAAOp9B,KAAKytB,SAAS/gB,GACpD,EAGH,SAAKvF,UAAOi2B,GAAMxR,kBAElB,EAAOlR,MAAWxI,EAAMkrB,GAAMnmB,KAAK0D,KACXyiB,EAAKxR,gBAAgBjR,EAAMwiB,IAC5BC,EAAKl3B,SACtBk3B,EAAK1G,mBAAmB/b,EAAMwiB,GAASlmB,KAAK,OAAMimB,mBAAgB,IAAMviB,EAAKG,OAAQ,IAAG,QAL9F,CAOJ,CAIAqR,OAAOlmB,EAAMq3B,EAAaC,GAClBA,IACFA,GAAYv9B,KAAKqtB,gBAAkBrtB,KAAKotB,MAAQ,SAAW,QAAU,IAAMnnB,GAE9EjG,KAAKy8B,aAAaa,EAAar3B,GAAMgR,KAAKumB,IACvC,IAAKA,EACF,OAAOn7B,QAAQiB,MAAO,yBAAwBi6B,MAEjDE,QAASF,EAAoB,QAATt3B,EAAkBu3B,EAAU,oCAAoCE,mBAAmBF,GAAQ,EAErH,CAIAG,gBACG,OAAO,IACV,CAIMlB,aAAaa,EAAaM,GAAa,IAAAC,EAAA79B,KAAA,SAAA+U,KAAA,YAC1C,MAAM+oB,EAA6B,UAAhBR,EACbpG,EAAO4G,EAAYD,EAAK1d,YAAY0d,EAAKxQ,eAAkBiQ,EAAcO,EAAKtL,aAAesL,EAAK7P,eAClGrY,EAAW2nB,IAAgBQ,EAAaD,EAAK72B,iBAAmB62B,EAChEE,EAAQ,GAEd,GAAI7G,EAAK9d,QACN,MAAO,GAEV,GAAI0kB,IAAcR,EAAa,CAC5B,MAAMU,EAAOH,EAAKtL,aAAapZ,YAAY,gBACtC6kB,EAAK5kB,UACP2kB,EAAMt3B,KAAK,CAAEw3B,KAAMJ,EAAKtL,aAAcyL,SACtC9G,EAAKlnB,OAAOkuB,aAAaF,EAAKhuB,OAAQknB,EAAKlnB,OAAOmuB,YAExD,CAEKL,GAEFnoB,EAAQgY,oBAAoB/qB,IACzB,MAAMwY,EAAO,CAAE6iB,KAAMr7B,EAAGorB,gBACxB+P,EAAMt3B,KAAK2U,GAGX,MAAM8W,EAAOtvB,EAAGqmB,YAAY,aAAc4U,EAAKxQ,eAC/CjS,EAAKgjB,UAAYlM,EAAKliB,OAClBoL,EAAKgjB,YACNhjB,EAAKijB,UAAYjjB,EAAKgjB,UAAUE,WAChCljB,EAAKmjB,UAAYnjB,EAAKgjB,UAAUI,YAChCtM,EAAKrhB,UAGR,MAAM4tB,EAAO77B,EAAGwZ,kBAChB,KAAI,EAACjV,UAAOs3B,GAAMC,aAAa,EAACv3B,UAAOs3B,GAAME,cAAe,OAE5D,MAAMC,EAAQH,EAAKE,eAEnB,GAAKC,IAAUrK,YAAUC,QAAQC,SAAamK,IAAUrK,YAAUC,QAAQqK,MAAQ,OAElF,MAAMC,EAAML,EAAKM,aAAaxK,YAAUC,QAAQqK,OAC1CG,EAASP,EAAKQ,SAASC,WAE7BT,EAAKC,SAAS,GAEd,MAAMS,EAAUH,EAAOI,UAAU,aAG7BR,IAAUrK,YAAUC,QAAQqK,QAC7BzjB,EAAKikB,QAAUjkB,EAAK6iB,KAAKnuB,OAAO,IAAMgvB,EAAIQ,QAC1ClkB,EAAKikB,QAAQxuB,UAGhB,MAAM0uB,EAAYd,EAAKte,cACvB/E,EAAKokB,WAAaD,EAAUvvB,OACxBoL,EAAKokB,aACNpkB,EAAKqkB,WAAarkB,EAAKokB,WAAWhB,YAClCe,EAAU1uB,UAIbuK,EAAKskB,IAAMtkB,EAAK6iB,KAAK0B,OAAO,QAAS,qBACrBvvB,KAAK,IAAK0uB,EAAIzuB,GACdD,KAAK,IAAK0uB,EAAIxuB,GACdF,KAAK,QAAS4uB,EAAOz5B,OACrB6K,KAAK,SAAU4uB,EAAOzuB,QACtBH,KAAK,OAAQ+uB,EAAO,EACpC,QAGN,IAAI55B,EAAQ2xB,EAAKtmB,SAAS,cAAeL,EAAS2mB,EAAKtmB,SAAS,eAChE,GAAIktB,EAAW,CACZ,MAAMp1B,EAAKm1B,EAAKzhB,kBAChB7W,EAAQmD,EAAG6X,gBACXhQ,EAAS7H,EAAG2X,gBACf,CAEA,MAAM1Q,EAAuB,QAAhBiuB,EACR,CAAE5tB,KAAMknB,EAAKlnB,OAAQzK,QAAOgL,SAAQqvB,eAAgB9B,IAAU,EAC9D+B,MAAa,eAAct6B,cAAkBgL,yCAA8C2mB,EAAKlnB,OAAO8vB,mBAE5G,SAAOC,MAAWpwB,EAAKiuB,GAAa3mB,KAAK1W,IACtC,QAASY,EAAI,EAAGA,EAAI48B,EAAM38B,SAAUD,EAAG,CACpC,MAAMia,EAAO2iB,EAAM58B,GAEnBia,EAAKskB,KAAK7uB,SAEV,MAAM0e,EAAOnU,EAAK6iB,KAAK9kB,YAAY,qBAE/BiC,EAAKikB,SACNjkB,EAAK6iB,KAAKjuB,OAAOkuB,aAAa9iB,EAAKikB,QAAQrvB,OAAQuf,EAAKvf,QAEvDoL,EAAKokB,YACNjQ,EAAKvf,OAAOkuB,aAAa9iB,EAAKokB,WAAYpkB,EAAKqkB,YAE9CrkB,EAAKgjB,WACNhjB,EAAKijB,UAAUH,aAAa9iB,EAAKgjB,UAAWhjB,EAAKmjB,WAEhDnjB,EAAK4iB,MACN5iB,EAAK6iB,KAAKjuB,OAAOkuB,aAAa9iB,EAAK4iB,KAAKhuB,OAAQoL,EAAK6iB,KAAKjuB,OAAOmuB,WACvE,CACA,OAAO59B,GACP,EArGuC,EAsG7C,CAGAy/B,eAAeC,EAAU/tB,GACtB,GAAiB,mBAAb+tB,EACD,OAAOjgC,KAAKmsB,OAAO,OAAO,GAE7B,GAAiB,eAAb8T,EACD,OAAOjgC,KAAK4yB,aAEf,GAAiB,gBAAbqN,EACD,OAAOjgC,KAAKmsB,OAAO,OAAO,GAE7B,GAAiB,oBAAb8T,EAGD,OAFA/tB,GAAME,iBACNF,GAAMG,mBAAgB,EAClB6tB,aAAa,KAEVxlB,MAAWxI,EAAMlS,MAAMiX,KAAK0D,IAChCA,EAAKC,IAAI,gBAGND,EAAKC,IADJ5a,KAAKotB,MACG,SAEA,MAFU,MAAOptB,KAAK28B,iBAI9B38B,KAAKoc,mBACNzB,EAAKC,IAAI,QAAS,QAAS5a,KAAK28B,iBAEnC,MAAM8B,EAAOz+B,KAAKkuB,iBASlB,GAPIuQ,IACD9jB,EAAKC,IAAI,SAAU,QAAS5a,KAAK28B,iBACjChiB,EAAKC,IAAI,SAAU,QAAS5a,KAAK28B,kBAAe,EAC5Cx1B,UAAOs3B,EAAK0B,eAAkB1B,EAAK0B,eAAiB,GACrDxlB,EAAKC,IAAI,SAAU,QAAS5a,KAAK28B,kBAGnC38B,KAAKytB,UAAUrsB,OAAQ,CACxBuZ,EAAKC,IAAI,aACT,MAAMwlB,EAAQ,GACdpgC,KAAKytB,SAASxB,QAAQ,CAACrpB,EAAI8J,KACxB,MAAM9M,EAAMgD,GAAIxC,YAChB,IAAKR,GAAQwgC,EAAM7wB,QAAQ3P,IAAQ,GAAMgD,EAAG6sB,cAAe,OAC3D,IAAIvvB,KAAOiH,UAAOvE,EAAGy9B,cAAgBz9B,EAAGy9B,eAAkBzgC,EAAIuG,WAAa,GACvEjG,IAAMA,GAAQ,MAClBA,MAAQiH,UAAOvE,EAAG09B,eAAiB19B,EAAG09B,gBAAmB1gC,EAAIuwB,OAAU,OAAMzjB,IAC7EiO,EAAKC,IAAI1a,EAAMwM,EAAM1M,KAAK28B,iBAC1ByD,EAAM35B,KAAK7G,EAAG,EAEpB,CAEA+a,EAAKG,MAAK,GAMhB,IAAIylB,GAAO,EACX,MAAMC,EAAM,GAEZ,QAAS5zB,EAAI,EAAGA,EAAI5M,KAAKytB,SAASrsB,SAAUwL,EAAG,CAC5C,MAAMhK,EAAK5C,KAAKytB,SAAS7gB,IAEzB,EAAIzF,UAAOvE,EAAGo9B,iBACXQ,EAAI/5B,KAAK7D,EAAGo9B,eAAeC,EAAU/tB,KAEnCquB,MAAQp5B,UAAOvE,EAAG69B,eACpBF,EAAO39B,EAAG69B,YAAYR,IAAQ,EAC1BlJ,aAAUwJ,IAAOC,EAAI/5B,KAAK85B,GAEpC,CAEA,OAAOjnB,QAAQyM,IAAIya,EACtB,CAIAE,aAAaC,EAAKC,EAASX,EAAUY,GAClC,GAAKzvB,WAAS0vB,UAAW9gC,KAAKsR,cAA9B,CAEKtR,KAAK+gC,WAAU/gC,KAAK+gC,SAAW,IAGpC,QAAS5/B,EAAI,EAAGA,EAAInB,KAAK+gC,SAAS3/B,SAAUD,EACzC,GAAInB,KAAK+gC,SAAS5/B,GAAG8+B,WAAaA,EAAU,OAK/C,GAHAjgC,KAAK+gC,SAASt6B,KAAK,CAAEk6B,MAAKC,UAASX,WAAUY,aAE/B7gC,KAAKotB,OAAUptB,KAAK0tB,YACS,IAA5BuS,EAAS1wB,QAAQ,QAA+B,eAAb0wB,EAA4B,CAC3E,MAAMe,EAAKhhC,KAAKgH,iBACZg6B,GAAOA,IAAOhhC,MAAOghC,EAAGN,aAAaC,EAAKC,EAASX,EAC1D,CAd6C,CAehD,CAIA1F,cAAc0G,GACXjhC,KAAK0gC,aAAa,SAAU,aAAc1gC,KAAKotB,MAAQ,iBAAmB,cAAe,oBAErFhc,WAASqJ,aACVza,KAAK0gC,aAAa,WAAY,uBAAwB,qBAEpC1gC,KAAKotB,OAASptB,KAAK0tB,YAAc1tB,KAAK2zB,oBAExC3zB,KAAKwzB,YAAY,YACjCxzB,KAAK0gC,aAAa,SAAU,iBAAkB,cAE7CO,GAAajhC,KAAK+7B,WACnB/7B,KAAK0gC,aAAa,UAAW,aAAc,aAC3C1gC,KAAK0gC,aAAa,gBAAiB,gBAAiB,gBAE1D,CAIA9O,iBACQ5xB,KAAK+gC,WAEVG,KAAkBj5B,OAAOjI,MACzBA,KAAK4xB,iBACR,CAGAxX,aAAa/Q,EAAU8Q,EAAKgnB,GACzB,IAAIzoB,EAAMnY,EACV,MAAM6gC,EAAO/3B,GAAW,EAAK,EACvBg4B,EAAOA,CAAC30B,EAAMvM,IAAUuM,EAAOyN,EAAIwB,KAAKva,OAAU+Y,EAAIwB,KAAKjP,GAAQvM,EACnEmhC,EAAUA,KACF5oB,IACFA,EAAOyoB,EAAgBA,EAAc7X,eAAiBtpB,KAAK2Y,cACvDD,GAGhB,GAAIyoB,EAAe,CAChB,MAAMI,EAAOF,EAAK,GAAIn3B,EAAOb,EAAW,MAAQ,WAClC7I,IAAT+gC,GAAuBJ,EAAcj3B,KACvC3J,EAAM4gC,EAAcj3B,GAAMq3B,GAChC,MAEY/gC,IAARD,IACDA,EAAM8I,EAAWi4B,IAAU/wB,OAAS,GAEvC,MAAMvO,EAAOq/B,EAAK,EAAG,GAErB9gC,UAAO6gC,EAF0BC,EAAK,EAAG,GAIrCr/B,IACDzB,GAAO6gC,GAAQ/3B,EAAWi4B,IAAU/wB,OAAS+wB,IAAU/7B,OAASvD,GAE5DF,KAAKC,MAAMxB,EACrB,CAMAyZ,cAAc5X,EAAK++B,GAChB,MAAO,CACJ9wB,EAAGrQ,KAAKoa,cAAa,EAAOhY,EAAIsZ,OAAQylB,GACxC7wB,EAAGtQ,KAAKoa,cAAa,EAAMhY,EAAIwZ,MAAOulB,GAE5C,CAGA9G,cAAcx6B,GACX,MAAMstB,EAAMntB,KAAKI,YACjB,IAAK+sB,EAAK,OAEV,MAAM1gB,EAAI,IAAI+0B,KAAY3hC,GAErBG,KAAKyoB,UAASzoB,KAAKyoB,QAAU,CAAC,GAEnCzgB,OAAOC,OAAOjI,KAAKyoB,QAAS,CAAEgZ,cAAc,EAAMC,aAAa,EAAOC,eAAe,EAAOjZ,aAAa,EAAOC,UAAU,KAEtHlc,EAAEgvB,MAAM,aAAehvB,EAAEgvB,MAAM,YAAUz7B,KAAKyoB,QAAQgZ,aAAezhC,KAAKyoB,QAAQiZ,aAAc,IAChGj1B,EAAEgvB,MAAM,YAAchvB,EAAEgvB,MAAM,WAAWz7B,KAAKyoB,QAAQgZ,cAAe,EAAOzhC,KAAKyoB,QAAQiZ,aAAc,IACvGj1B,EAAEgvB,MAAM,cAAgBhvB,EAAEgvB,MAAM,YAAUz7B,KAAKyoB,QAAQkZ,eAAgB,GACvEl1B,EAAEgvB,MAAM,YAAWz7B,KAAKyoB,QAAQC,aAAc,GAC9Cjc,EAAEgvB,MAAM,cAAaz7B,KAAKyoB,QAAQE,UAAW,GAE7Clc,EAAEgvB,MAAM,WAAUtO,EAAIiM,WAAa,GACnC3sB,EAAEgvB,MAAM,UAAStO,EAAIyU,MAAQ,GAC7Bn1B,EAAEgvB,MAAM,UAAStO,EAAI0U,MAAQ,GAC7Bp1B,EAAEgvB,MAAM,UAAStO,EAAI2U,MAAQ,GAC7Br1B,EAAEgvB,MAAM,SAAQtO,EAAIyU,MAAQzU,EAAI0U,MAAQ1U,EAAI2U,MAAQ,GACpDr1B,EAAEgvB,MAAM,WAAUtO,EAAI4U,OAAS,GAC/Bt1B,EAAEgvB,MAAM,WAAUtO,EAAI6U,OAAS,GAC/Bv1B,EAAEgvB,MAAM,UAAStO,EAAI4U,OAAS5U,EAAI6U,OAAS,GAC3Cv1B,EAAEgvB,MAAM,WAAUtO,EAAI8U,OAAS,GAC/Bx1B,EAAEgvB,MAAM,WAAUtO,EAAI+U,OAAS,GAC/Bz1B,EAAEgvB,MAAM,UAAStO,EAAI8U,OAAS9U,EAAI+U,OAAS,EAClD,CAGA,WAAaC,CAAKxiC,EAAKwtB,EAAKttB,GAAK,SAAAkV,KAAA,YAC9B,MAAMY,EAAU,IAAIuX,EAAYvtB,EAAKwtB,GAAK,GAC1CxX,EAAQ0kB,cAAcx6B,GAElB8V,EAAQ4c,aAAanZ,SACtBzD,EAAQ+X,YAAa,EACrB/X,EAAQ0X,cAAgB,GACxB1X,EAAQ+c,iBAER/c,EAAQ2kB,mBAAmB3kB,EAAQqe,UAGtCre,EAAQke,eAEJle,EAAQysB,gBAAgBC,aAAa1sB,EAAQ+X,YAAc/X,EAAQge,qBACpEhe,EAAQ4kB,gBAGX,MAAMC,EAAY7kB,EAAQ+X,WAAa/X,EAAQ8kB,iBAAiB9kB,EAAQ0X,oBAAiB7sB,EAEzFsuB,eAAgB,CAAElsB,GAAI+S,EAASoZ,QAAQ,IAGhCpZ,EAAQwf,iBAAiBle,KAAK,KAClCtB,EAAQic,iBAERjc,EAAQ8kB,iBAAiBD,GAClB7kB,GACP,EA5B2B,EA6BjC,ECnlDH,MAAM2sB,EAAY,mBAAmBC,MAAM,IACrCC,EAAQ,EAAC,WAAa,QAAS,MAAO,KACtCC,EAAQ,CAAC,GAAI,GAAI,EAAG,GACpBC,EAAI,CAAC,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WACpF,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UACpF,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UACpF,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAG/F,MAAMC,EAEJjjC,YAAYkjC,GACV5iC,KAAK6iC,OAAS,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAE3DD,GACF5iC,KAAK8iC,GAAK,WACV9iC,KAAKoU,GAAK,UACVpU,KAAKsU,GAAK,UACVtU,KAAK+iC,GAAK,WACV/iC,KAAKgjC,GAAK,WACVhjC,KAAKijC,GAAK,WACVjjC,KAAKkjC,GAAK,WACVljC,KAAKmjC,GAAK,aAEVnjC,KAAK8iC,GAAK,WACV9iC,KAAKoU,GAAK,WACVpU,KAAKsU,GAAK,WACVtU,KAAK+iC,GAAK,WACV/iC,KAAKgjC,GAAK,WACVhjC,KAAKijC,GAAK,WACVjjC,KAAKkjC,GAAK,UACVljC,KAAKmjC,GAAK,YAGZnjC,KAAKqB,MAAQrB,KAAKojC,MAAQpjC,KAAKqjC,MAAQrjC,KAAKsjC,OAAS,EACrDtjC,KAAKujC,UAAYvjC,KAAKwjC,QAAS,EAC/BxjC,KAAK+M,OAAQ,EACb/M,KAAK4iC,MAAQA,CACf,CAGAp8B,OAAOi9B,GACL,GAAIzjC,KAAKujC,UACP,OAEF,MAAMG,EAAgC,iBAAZD,EACpBriC,EAASqiC,EAAQriC,OAAQyhC,EAAS7iC,KAAK6iC,OAE7C,IAAIc,EAAiB/2B,EAAXg3B,EAAQ,EAElB,KAAOA,EAAQxiC,GAAQ,CAUrB,GATIpB,KAAKwjC,SACPxjC,KAAKwjC,QAAS,EACdX,EAAO,GAAK7iC,KAAKqB,MACjBwhC,EAAO,IAAMA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAC1CA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAC3CA,EAAO,GAAKA,EAAO,GAAKA,EAAO,IAAMA,EAAO,IAC5CA,EAAO,IAAMA,EAAO,IAAMA,EAAO,IAAMA,EAAO,IAAM,GAGpDa,EACF,IAAK92B,EAAI5M,KAAKojC,MAAOQ,EAAQxiC,GAAUwL,EAAI,KAAMg3B,EAC/Cf,EAAOj2B,GAAK,IAAM62B,EAAQG,IAAUnB,EAAY,EAAN71B,UAE5C,IAAKA,EAAI5M,KAAKojC,MAAOQ,EAAQxiC,GAAUwL,EAAI,KAAMg3B,EAC/CD,EAAOF,EAAQI,WAAWD,GACtBD,EAAO,IACTd,EAAOj2B,GAAK,IAAM+2B,GAAQlB,EAAY,EAAN71B,KACzB+2B,EAAO,MACdd,EAAOj2B,GAAK,KAAO,IAAQ+2B,GAAQ,IAAOlB,EAAY,EAAN71B,KAChDi2B,EAAOj2B,GAAK,KAAO,IAAe,GAAP+2B,IAAiBlB,EAAY,EAAN71B,MACzC+2B,EAAO,OAAUA,GAAQ,OAClCd,EAAOj2B,GAAK,KAAO,IAAQ+2B,GAAQ,KAAQlB,EAAY,EAAN71B,KACjDi2B,EAAOj2B,GAAK,KAAO,IAAS+2B,GAAQ,EAAK,KAAUlB,EAAY,EAAN71B,KACzDi2B,EAAOj2B,GAAK,KAAO,IAAe,GAAP+2B,IAAiBlB,EAAY,EAAN71B,OAElD+2B,EAAO,QAAoB,KAAPA,IAAiB,GAAqC,KAA9BF,EAAQI,aAAaD,IACjEf,EAAOj2B,GAAK,KAAO,IAAQ+2B,GAAQ,KAAQlB,EAAY,EAAN71B,KACjDi2B,EAAOj2B,GAAK,KAAO,IAAS+2B,GAAQ,GAAM,KAAUlB,EAAY,EAAN71B,KAC1Di2B,EAAOj2B,GAAK,KAAO,IAAS+2B,GAAQ,EAAK,KAAUlB,EAAY,EAAN71B,KACzDi2B,EAAOj2B,GAAK,KAAO,IAAe,GAAP+2B,IAAiBlB,EAAY,EAAN71B,MAKxD5M,KAAK8jC,cAAgBl3B,EACrB5M,KAAKqjC,OAASz2B,EAAI5M,KAAKojC,MACnBx2B,GAAK,IACP5M,KAAKqB,MAAQwhC,EAAO,IACpB7iC,KAAKojC,MAAQx2B,EAAI,GACjB5M,KAAK+jC,OACL/jC,KAAKwjC,QAAS,GAEdxjC,KAAKojC,MAAQx2B,CACjB,CACA,OAAI5M,KAAKqjC,MAAQ,aACfrjC,KAAKsjC,QAAUtjC,KAAKqjC,MAAQ,WAAc,EAC1CrjC,KAAKqjC,MAAQrjC,KAAKqjC,MAAQ,YAErBrjC,IACT,CAEAgkC,WACE,GAAIhkC,KAAKujC,UACP,OACFvjC,KAAKujC,WAAY,EACjB,MAAMV,EAAS7iC,KAAK6iC,OACdj2B,EAAI5M,KAAK8jC,cACfjB,EAAO,IAAM7iC,KAAKqB,MAClBwhC,EAAOj2B,GAAK,IAAM41B,EAAU,EAAJ51B,GACxB5M,KAAKqB,MAAQwhC,EAAO,IAChBj2B,GAAK,KACF5M,KAAKwjC,QACRxjC,KAAK+jC,OACPlB,EAAO,GAAK7iC,KAAKqB,MACjBwhC,EAAO,IAAMA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAC5CA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAC3CA,EAAO,GAAKA,EAAO,GAAKA,EAAO,IAAMA,EAAO,IAC5CA,EAAO,IAAMA,EAAO,IAAMA,EAAO,IAAMA,EAAO,IAAM,GAEtDA,EAAO,IAAM7iC,KAAKsjC,QAAU,EAAItjC,KAAKqjC,QAAU,GAC/CR,EAAO,IAAM7iC,KAAKqjC,OAAS,EAC3BrjC,KAAK+jC,MACP,CAEAA,OACE,MAAMlB,EAAS7iC,KAAK6iC,OACpB,IACiBoB,EAAGC,EAAIC,EAAIC,EAAKC,EAAIC,EAAI3M,EAAI4M,EAAIC,EAAIC,EAAIC,GADrDC,EAAI3kC,KAAK8iC,GAAI8B,EAAI5kC,KAAKoU,GAAIywB,EAAI7kC,KAAKsU,GAAI7H,EAAIzM,KAAK+iC,GAAIjO,EAAI90B,KAAKgjC,GAAI8B,EAAI9kC,KAAKijC,GAAI8B,EAAI/kC,KAAKkjC,GACvF9iB,EAAIpgB,KAAKmjC,GAEb,IAAKc,EAAI,GAAIA,EAAI,KAAMA,EAErBI,EAAKxB,EAAOoB,EAAI,IAChBC,GAAOG,IAAO,EAAMA,GAAM,KAASA,IAAO,GAAOA,GAAM,IAAQA,IAAO,EACtEA,EAAKxB,EAAOoB,EAAI,GAChBE,GAAOE,IAAO,GAAOA,GAAM,KAASA,IAAO,GAAOA,GAAM,IAAQA,IAAO,GACvExB,EAAOoB,GAAKpB,EAAOoB,EAAI,IAAMC,EAAKrB,EAAOoB,EAAI,GAAKE,EAAM,EAI1D,IADAO,GAAKE,EAAIC,EACJZ,EAAI,EAAGA,EAAI,GAAIA,GAAK,EACnBjkC,KAAK+M,OACH/M,KAAK4iC,OACP2B,EAAK,OACLF,EAAKxB,EAAO,GAAK,WACjBziB,EAAIikB,EAAK,UAAa,EACtB53B,EAAI43B,EAAK,SAAY,IAErBE,EAAK,UACLF,EAAKxB,EAAO,GAAK,UACjBziB,EAAIikB,EAAK,WAAc,EACvB53B,EAAI43B,EAAK,UAAa,GAExBrkC,KAAK+M,OAAQ,IAEbm3B,GAAOS,IAAM,EAAMA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAASA,IAAM,GAAOA,GAAK,IAC9ER,GAAOrP,IAAM,EAAMA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAASA,IAAM,GAAOA,GAAK,GAC9EyP,EAAKI,EAAIC,EACTR,EAAMG,EAAMI,EAAIE,EAAKH,GACrB/M,EAAM7C,EAAIgQ,GAAOhQ,EAAIiQ,EACrBV,EAAKjkB,EAAI+jB,EAAKxM,EAAK+K,EAAEuB,GAAKpB,EAAOoB,GACjCK,EAAKJ,EAAKE,EACVhkB,EAAI3T,EAAI43B,EAAM,EACd53B,EAAI43B,EAAKC,EAAM,GAEjBJ,GAAOz3B,IAAM,EAAMA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAASA,IAAM,GAAOA,GAAK,IAC9E03B,GAAO/jB,IAAM,EAAMA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAASA,IAAM,GAAOA,GAAK,GAC9EokB,EAAK/3B,EAAIk4B,EACTP,EAAMI,EAAM/3B,EAAIm4B,EAAKL,EACrB5M,EAAMvX,EAAI0U,GAAO1U,EAAI0kB,EACrBT,EAAKU,EAAIZ,EAAKxM,EAAK+K,EAAEuB,EAAI,GAAKpB,EAAOoB,EAAI,GACzCK,EAAKJ,EAAKE,EACVW,EAAIF,EAAIR,EAAM,EACdQ,EAAIR,EAAKC,EAAM,EACfJ,GAAOW,IAAM,EAAMA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAASA,IAAM,GAAOA,GAAK,IAC9EV,GAAOY,IAAM,EAAMA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAASA,IAAM,GAAOA,GAAK,GAC9EN,EAAKI,EAAIp4B,EACT23B,EAAMK,EAAMI,EAAIF,EAAKH,EACrB7M,EAAMoN,EAAI3kB,GAAO2kB,EAAIjQ,EACrBuP,EAAKS,EAAIX,EAAKxM,EAAK+K,EAAEuB,EAAI,GAAKpB,EAAOoB,EAAI,GACzCK,EAAKJ,EAAKE,EACVU,EAAIF,EAAIP,EAAM,EACdO,EAAIP,EAAKC,EAAM,EACfJ,GAAOU,IAAM,EAAMA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAASA,IAAM,GAAOA,GAAK,IAC9ET,GAAOW,IAAM,EAAMA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAASA,IAAM,GAAOA,GAAK,GAC9EJ,GAAKE,EAAIC,EACTT,EAAMM,GAAME,EAAIn4B,EAAKg4B,EACrB9M,EAAMmN,EAAIC,GAAOD,EAAI1kB,EACrBikB,EAAKvP,EAAIqP,EAAKxM,EAAK+K,EAAEuB,EAAI,GAAKpB,EAAOoB,EAAI,GACzCK,EAAKJ,EAAKE,EACVtP,EAAI6P,EAAIN,EAAM,EACdM,EAAIN,EAAKC,EAAM,EACftkC,KAAKglC,qBAAsB,EAG7BhlC,KAAK8iC,GAAK9iC,KAAK8iC,GAAK6B,EAAK,EACzB3kC,KAAKoU,GAAKpU,KAAKoU,GAAKwwB,EAAK,EACzB5kC,KAAKsU,GAAKtU,KAAKsU,GAAKuwB,EAAK,EACzB7kC,KAAK+iC,GAAK/iC,KAAK+iC,GAAKt2B,EAAK,EACzBzM,KAAKgjC,GAAKhjC,KAAKgjC,GAAKlO,EAAK,EACzB90B,KAAKijC,GAAKjjC,KAAKijC,GAAK6B,EAAK,EACzB9kC,KAAKkjC,GAAKljC,KAAKkjC,GAAK6B,EAAK,EACzB/kC,KAAKmjC,GAAKnjC,KAAKmjC,GAAK/iB,EAAK,CAC3B,CAEA6kB,SACEjlC,KAAKgkC,WAEL,MAAMlB,EAAK9iC,KAAK8iC,GAAI1uB,EAAKpU,KAAKoU,GAAIE,EAAKtU,KAAKsU,GAAIyuB,EAAK/iC,KAAK+iC,GAAIC,EAAKhjC,KAAKgjC,GAAIC,EAAKjjC,KAAKijC,GAChFC,EAAKljC,KAAKkjC,GAAIC,EAAKnjC,KAAKmjC,GAC9Bnd,EAAM,CACH8c,GAAM,GAAM,IAAOA,GAAM,GAAM,IAAOA,GAAM,EAAK,IAAW,IAALA,EACvD1uB,GAAM,GAAM,IAAOA,GAAM,GAAM,IAAOA,GAAM,EAAK,IAAW,IAALA,EACvDE,GAAM,GAAM,IAAOA,GAAM,GAAM,IAAOA,GAAM,EAAK,IAAW,IAALA,EACvDyuB,GAAM,GAAM,IAAOA,GAAM,GAAM,IAAOA,GAAM,EAAK,IAAW,IAALA,EACvDC,GAAM,GAAM,IAAOA,GAAM,GAAM,IAAOA,GAAM,EAAK,IAAW,IAALA,EACvDC,GAAM,GAAM,IAAOA,GAAM,GAAM,IAAOA,GAAM,EAAK,IAAW,IAALA,EACvDC,GAAM,GAAM,IAAOA,GAAM,GAAM,IAAOA,GAAM,EAAK,IAAW,IAALA,GAE1D,OAAKljC,KAAK4iC,OACR5c,EAAIvf,KAAM08B,GAAM,GAAM,IAAOA,GAAM,GAAM,IAAOA,GAAM,EAAK,IAAW,IAALA,GAC5Dnd,CACT,CAEAkf,MACE,MAAMz4B,EAAIzM,KAAKilC,SACf,IAAI1kC,EAAM,GACV,QAASqM,EAAI,EAAGA,EAAIH,EAAErL,SAAUwL,EAC7BrM,GAAO+hC,EAAW71B,EAAEG,IAAM,EAAK,IAAO01B,EAAiB,GAAP71B,EAAEG,IACrD,OAAOrM,CACT,CAEA4kC,WACE,OAAOnlC,KAAKklC,KACd,EAUF,SAASE,EAAS3B,EAASzd,EAAKqf,GAC9B,MAAMxkC,EAAI,IAAI8hC,GAAO,GACrB9hC,SAAE2F,OAAOi9B,GACT5iC,EAAE2F,OAAOwf,GACFqf,EAASxkC,EAAEqkC,MAAQrkC,EAAEokC,QAC9B,CCzPA,SAASK,EAAKC,EAAK1kC,EAAG2kC,GACnB,MAAMC,ED6OT,SAASC,EAAOjC,EAAS4B,GACvB,MAAMxkC,EAAI,IAAI8hC,GAAO,GACrB9hC,SAAE2F,OAAOi9B,GACF4B,EAASxkC,EAAEqkC,MAAQrkC,EAAEokC,QAC9B,CCjPgBS,CANC,GAMmBH,GAG3BI,EAAK,GAAIC,EAAK,GACpB,KAAOH,EAAKrkC,OAHO,IAIhBqkC,EAAKh/B,KAAK,GACb,QAASmG,EAAI,EAAGA,EAAI64B,EAAKrkC,SAAUwL,EAAG,CACnC,MAAM+2B,EAAO8B,EAAK74B,GAClB+4B,EAAGl/B,KANO,GAMFk9B,GACRiC,EAAGn/B,KAPoB,GAOfk9B,EACX,CAEA,MAAMI,EAAOqB,EAASQ,OAAWplC,IAANglC,EAAmB3kC,EAAI,IAAIglC,WAAWhlC,EAAG2kC,IAEpE,OAAOJ,EAASO,EAAI5B,GAAM,EAC7B,CAQA,MAAM+B,EAEHpmC,YAAYqmC,EAAMC,EAAMC,EAASC,GAC9BlmC,KAAKmmC,KAAOJ,EACZ/lC,KAAKomC,OAAS,KACdpmC,KAAKgG,IAAM,KACXhG,KAAKqmC,IAAML,EACXhmC,KAAKuN,OAAS04B,EACdjmC,KAAKsmC,QAAUJ,EAEflmC,KAAKumC,YAAY,GAAI,UACxB,CAGAA,YAAYC,EAAMvgC,GACf,IAAIwgC,EAAMzmC,KAAKmmC,KAAMO,EAAU,MAAOC,EAAO,KAC7C,GAAa,YAAT1gC,EACDwgC,GAAOzmC,KAAKqmC,IAAM,eAAiB,eAC/BrmC,KAAKuN,SAAQk5B,GAAO,IAAMzmC,KAAKuN,OAAOq5B,YAAY5mC,KAAKsmC,YAC3DjkC,QAAQC,IAAK,oBAAmBmkC,WAAazmC,KAAKqmC,OAClDrmC,KAAKomC,OAAS,kBACG,UAATngC,EAAkB,CAC1B,GAAqB,OAAhBjG,KAAKomC,QAAqC,UAAhBpmC,KAAKomC,OAAqB,OACzDK,GAAQ,eAAczmC,KAAKomC,eACvBpmC,KAAKuN,SAAQk5B,GAAO,IAAMzmC,KAAKuN,OAAOq5B,YAAY5mC,KAAKsmC,YAC3DtmC,KAAKomC,OAAS,QACdM,EAAU,WACb,MAA4B,OAAhB1mC,KAAKomC,QAA4C,iBAAhBpmC,KAAKomC,OAC1CS,UAAQC,KAAKzkC,QAAQiB,MAAM,kBAEhCmjC,GAAO,eAAiBzmC,KAAKomC,OACzBpmC,KAAKuN,SAAQk5B,GAAO,IAAMzmC,KAAKuN,OAAOq5B,YAAY5mC,KAAKsmC,YAC9C,UAATrgC,IAAkBwgC,GAAO,WAG5BD,IACGxmC,KAAKqmC,IAENI,GAAO,YAAWM,aAAUP,IAG5BE,EAAU,UACVC,EAAOH,OAIbQ,qBAAkBP,EAAKC,EAAS,SAASnmC,GAMtC,GAHIP,KAAKuN,OAAOvH,MAAQhG,OACrBA,KAAKuN,OAAOvH,IAAM,MAET,OAARzF,EACD,OAAOP,KAAKuN,OAAO05B,eAAe,MAErC,GAAIjnC,KAAKuN,OAAO84B,IAAK,CAMlB,MAAMa,EAAQ,IAAIrB,WAAWtlC,GAC7B,IAAI4mC,EAAM,GAAIv6B,EAAI,EAAG+D,EAASu2B,EAAM9lC,OACpC,GAAIuP,EAAS,EACV,OAAKk2B,UAAQC,KAAKzkC,QAAQiB,MAAO,0CAAyCqN,KACnE3Q,KAAKuN,OAAO05B,eAAe,MAGrC,KAAOr6B,EAAI,GAAGu6B,GAAOC,OAAOC,aAAaH,EAAMt6B,MAC/C,GAAY,SAARu6B,EAAgB,CAEjB,IADAA,EAAM,GACEv6B,EAAI+D,GAA8C,MAAlCy2B,OAAOC,aAAaH,EAAMt6B,KAC/Cu6B,GAAOC,OAAOC,aAAaH,EAAMt6B,QAClCA,EACF+D,EAAS/D,EAAIlG,SAASygC,EAAIG,OAC7B,CAGA,IADAH,EAAM,GACCv6B,EAAI+D,GAAQw2B,GAAOC,OAAOC,aAAaH,EAAMt6B,MAEhDu6B,GAEEnnC,KAAKuN,OAAO05B,eADH,aAARE,GAC0B,KAECA,GAE9Bx2B,EAASu2B,EAAM9lC,QAChBpB,KAAKuN,OAAO05B,eAAe1mC,EAAKoQ,EACtC,SAAsD,yBAA3C3Q,KAAKunC,kBAAkB,gBAA4C,CAE3E,MAAMC,EAAYxnC,KAAKunC,kBAAkB,kBACrCC,GAAWxnC,KAAKuN,OAAO05B,eAAeO,GAC1CxnC,KAAKuN,OAAO05B,eAAe1mC,EAAK,EACnC,KAAO,CAEJ,GAAIA,KAAO,EAACoC,SAAMpC,GAAM,CACrB,IAAI4mC,EAAM,GACV,MAAMD,EAAQ,IAAIrB,WAAWtlC,GAC7B,QAASqM,EAAI,EAAGA,EAAIs6B,EAAM9lC,SAAUwL,EACjCu6B,GAAOC,OAAOC,aAAaH,EAAMt6B,IACpCrM,EAAM4mC,CACT,CAEGnnC,KAAKuN,OAAO05B,eADH,aAAR1mC,GAC0B,KAEAA,EACjC,CACH,EAAG,WACAP,KAAKuN,OAAO05B,eAAe,KAAM,QACpC,GAAG,GAAMhwB,KAAKjR,IACXA,EAAIuH,OAASvN,KACRA,KAAKgG,MACPhG,KAAKgG,IAAMA,GACdA,EAAIyhC,KAAKd,EAAI,EAEnB,CAGAM,eAAe1mC,EAAKmnC,GACjB,GAAY,OAARnnC,EAMD,OALA,EAAI4G,UAAOnH,KAAK2nC,UACb3nC,KAAK2nC,QAAQ,6BAA+B3nC,KAAKomC,QAAU,QAC7C,UAAZsB,IAAY,EAAYvgC,UAAOnH,KAAK4nC,UACtC5nC,KAAK4nC,QAAQ,oBAChB5nC,KAAKomC,OAAS,OAEE,OAAR7lC,IACRA,EAAM,IAET,IAAIsnC,EAAc,EAElB,GAAoB,YAAhB7nC,KAAKomC,OAAsB,CAC5B,IAAK7lC,EAIF,OAHAP,KAAKomC,OAAS,aACVj/B,UAAOnH,KAAK2nC,UACb3nC,KAAK2nC,QAAQ,wBAInB3nC,KAAKomC,OAAS1/B,SAASnG,GACvBsnC,EAAc,IACdxlC,QAAQC,IAAK,uCAAsCtC,KAAKomC,WAAQ,EAC5Dj/B,UAAOnH,KAAK8nC,SACb9nC,KAAK8nC,QACX,SAA2B,UAAhB9nC,KAAKomC,OAGb,aAFA,EAAIj/B,UAAOnH,KAAK4nC,UACb5nC,KAAK4nC,YAGR,EAAIzgC,UAAOnH,KAAK+nC,YAAcxnC,GAC3BP,KAAK+nC,UAAU,CAAEvB,KAAMjmC,EAAKoQ,OAAQ+2B,GAAS,CAI9C1nC,KAAKgG,KACPyxB,WAAW,KAAaz3B,KAAKgG,KAAKhG,KAAKumC,YAAY,GAAI,QAAO,EAAMsB,EAC1E,CAGAJ,KAAKN,GAAOnnC,KAAKumC,YAAYY,EAAM,CAGnCa,QAAUhoC,KAAKumC,YAAY,GAAI,QAAU,EAY5C,MAAM0B,EAEHvoC,YAAYqxB,GACT/wB,KAAK+wB,SAAWA,EAChB/wB,KAAKkoC,SAAW,GAChBloC,KAAKiD,IAAM,KACXklC,eAAY,gBAAiB,QAAQlxB,KAAK1W,GAAOP,KAAKooC,YAAY7nC,GACrE,CAGA6nC,YAAY7nC,GACJA,IACLP,KAAKkoC,SAAWvhC,KAAK0hC,MAAM9nC,IAAG,EAC1B4G,UAAOnH,KAAK8nC,SAAS9nC,KAAK8nC,SAC9B9nC,KAAKsoC,gBACR,CAGAb,OACmC,SAA5BznC,KAAKkoC,SAASloC,KAAKiD,OACpBjD,KAAKiD,MACLw0B,WAAW,IAAMz3B,KAAKsoC,gBAAiB,IAE7C,CAGAN,QAAS,CAGTM,gBAEG,GAAItoC,KAAKuoC,cAAe,OACxB,MAAM9R,EAAQz2B,KAAKkoC,SAASloC,KAAKiD,KAE5BwzB,GACS,SAAVA,IACJz2B,KAAKuoC,eAAgB,EACrBvoC,KAAKiD,SACLklC,eAAY1R,EAAQA,EAAMlnB,QAAQ,QAAU,EAAI,MAAQ,QAAS0H,KAAK1W,IAEnE,GADAP,KAAKuoC,eAAgB,GAChBhoC,EAAK,OACV,MAAMiH,EAAIivB,EAAMlnB,QAAQ,OAClBi5B,EAAQhhC,EAAI,EAAKhF,OAAOkE,SAAS+vB,EAAMl0B,MAAMiF,EAAE,EAAGivB,EAAMlnB,QAAQ,IAAK/H,KAAO,GAClF,EAAIL,UAAOnH,KAAK+wB,SAAS0X,cACtBzoC,KAAK+wB,SAAS0X,YAAYD,EAAMjoC,EAAK,GACxCk3B,WAAW,IAAMz3B,KAAKsoC,gBAAiB,GAAE,GAE/C,EAWH,MAAMI,EAEHhpC,YAAYipC,EAAaC,GACtB5oC,KAAKiG,KAAO0iC,EACZ3oC,KAAK6oC,MAAQ,EACb7oC,KAAK4oC,QAAUA,GAAW,GAC1B5oC,KAAK8oC,QAAU9oC,KAAK4oC,QACpB5oC,KAAK+oC,KAAO/oC,KAAK4oC,QACjB5oC,KAAKgpC,SAAW,EAChBhpC,KAAKipC,SAAW,CACnB,CAMAC,YAAYC,GACT,OAAIA,MAASxmC,SAAMwmC,IAAK,EACd3T,YAASx1B,KAAKopC,WAAappC,KAAKopC,UAAUD,QAAS3oC,EAEtDR,KAAKopC,SACf,CAIAC,YAAYC,GAAQtpC,KAAKopC,UAAYE,CAAM,CAQ3CC,YAAY3pC,GAAOI,KAAK+wB,SAAWnxB,CAAK,CAGxCyI,iBACUrI,KAAK+wB,SACZ/wB,KAAKgoC,OAAM,EACd,CAIAwB,eAAeC,EAAQviC,EAAQyI,EAAK+5B,GAIjC,GAHI1pC,KAAK+wB,aAAY5pB,UAAOnH,KAAK+wB,SAAS7pB,KACvClH,KAAK+wB,SAAS7pB,GAAQlH,KAAM2P,EAAK+5B,GAEhCD,GAAUzpC,KAAK2pC,SAAU,CAC1B,MAAMC,EAAK5hC,OAAO6hC,KAAK7pC,KAAK2pC,UAC5B,QAAS1pB,EAAI,EAAGA,EAAI2pB,EAAGxoC,SAAU6e,EAC9BjgB,KAAK2pC,SAASC,EAAG3pB,IAAIupB,gBAAe,EAAOtiC,EAAQyI,EAAK+5B,EAC9D,CACH,CAIAjB,YAAYD,EAAMsB,EAAK3vB,GACpB,GAAIna,KAAK+pC,gBAEN,cAAO/pC,KAAK+pC,gBACZ/pC,KAAK6oC,MAAQ,EACN7oC,KAAKwpC,gBAAe,EAAO,qBAGrC,GAAKhB,EAAO,GAAMxoC,KAAK2pC,SAAU,CAC9B,MAAMK,EAAUhqC,KAAK2pC,SAASnB,GAC9B,GAAIwB,EACD,OAAOA,EAAQvB,YAAY,EAAGqB,EAAK3vB,EACzC,CAEA,MAAM8vB,EAAc9vB,GAAQA,EAAM,EAClC,KAAK8vB,GAAiBjqC,KAAKkqC,UAAalqC,KAAKkqC,SAAS9oC,QACnD,OAAOpB,KAAKwpC,gBAAe,EAAO,iBAAkBM,EAAK3vB,GAEvDna,KAAKkqC,WAAUlqC,KAAKkqC,SAAW,IAChCD,IAAa9vB,OAAM3Z,GAEvBR,KAAKkqC,SAASzjC,KAAK,CAAE0jC,OAAO,EAAML,MAAK3vB,OAC1C,CAIAiwB,mBACQpqC,KAAKkqC,WAAUlqC,KAAKkqC,SAAW,IACpC,MAAM9uB,EAAO,CAAE+uB,OAAO,EAAOL,IAAK,KAAM3vB,IAAK,GAC7C,OAAAna,KAAKkqC,SAASzjC,KAAK2U,GACZA,CACV,CAIAivB,kBAAkBjvB,EAAMkvB,EAAMC,GAC3BnvB,EAAK+uB,OAAQ,EACb/uB,EAAK0uB,IAAMQ,EACXlvB,EAAKjB,IAAMowB,EACXvqC,KAAKwqC,cACR,CAIAA,eACG,IAAIxqC,KAAKyqC,gBAAmBzqC,KAAKkqC,SAEjC,KADAlqC,KAAKyqC,gBAAiB,EACdzqC,KAAKkqC,SAAS9oC,OAAS,GAAMpB,KAAKkqC,SAAS,GAAGC,OAAO,CAC1D,MAAMO,EAAQ1qC,KAAKkqC,SAASjV,QAC5Bj1B,KAAKwpC,gBAAe,EAAO,iBAAkBkB,EAAMZ,IAAKY,EAAMvwB,IACjE,CAC6B,IAAzBna,KAAKkqC,SAAS9oC,eACRpB,KAAKkqC,gBACRlqC,KAAKyqC,eACf,CAGAzC,MAAMxpB,GACH,GAAIxe,KAAK2qC,OAIN,OAHA3qC,KAAK2qC,OAAOlD,KAAM,WAAUznC,KAAK4qC,YAAa,UACvC5qC,KAAK2qC,OAAOhB,SAAS3pC,KAAK4qC,uBAC1B5qC,KAAK2qC,OAIX3qC,KAAK6qC,UACNrT,aAAax3B,KAAK6qC,gBACX7qC,KAAK6qC,SAGX7qC,KAAK0H,YAAe1H,KAAK6oC,MAAQ,IAClC7oC,KAAK6oC,MAAQrqB,GAAQ,EAAK,EAC1Bxe,KAAK0H,WAAWkgC,QAAU,KAC1B5nC,KAAK0H,WAAWsgC,eACThoC,KAAK0H,WAElB,CAKAojC,QAAQC,GAAW,OAAO/qC,KAAK8oC,UAAYiC,GAAW,EAAI,CAG1DC,gBAAkB,OAAQhrC,KAAK4oC,QAAc5oC,KAAK8oC,QAAU9oC,KAAK4oC,QAAxB,CAAiC,CAK1EnB,KAAKqC,EAAKtB,GACP,GAAIxoC,KAAK2qC,OACN,OAAO3qC,KAAK2qC,OAAOlD,KAAKqC,EAAK9pC,KAAK4qC,WAErC,IAAK5qC,KAAK0H,YAAe1H,KAAK6oC,OAAS,EAAI,OAAO,EAE7CrmC,OAAO66B,UAAUmL,KAAOA,EAAO,GAEhCxoC,KAAK8oC,SAAW,GAAGzmC,QAAQiB,MAAO,4CAA2CtD,KAAK8oC,WAEtF,MAAM5jC,EAAU,GAAElF,KAAKgpC,cAAchpC,KAAK+oC,QAAQ/oC,KAAK8oC,WAAWN,KAClExoC,KAAK+oC,KAAO,EACZ/oC,KAAK8oC,UAEL,IAAI/E,EAAO,OACX,OAGA/jC,KAAK0H,WAAW+/B,KAAM,GAAE1D,KAAQ7+B,IAAS4kC,MAEtB,cAAd9pC,KAAKiG,MAAwC,aAAdjG,KAAKiG,QAClCjG,KAAK6qC,SAASrT,aAAax3B,KAAK6qC,SACpC7qC,KAAK6qC,QAAUpT,WAAW,IAAMz3B,KAAKirC,YAAa,OAG9C,CACV,CAMAC,SAASjlC,EAAMklC,EAAOrB,GACnB,IAAIr9B,EAAIzM,KAAKorC,SACR3+B,IAAGA,EAAIzM,KAAKorC,SAAW,CAAC,GAC7B3+B,EAAExG,GAAQ6jC,EACLr9B,EAAG,GAAExG,eACPwG,EAAG,GAAExG,aAAkBwxB,WAAW,YAAehrB,EAAG,GAAExG,aAAiBjG,KAAKynC,KAAKh7B,EAAExG,GAAK,EAAMklC,GACpG,CAIAE,OAAOvB,EAAKtB,EAAM8C,GAEf,IAAKA,EACF,OAAO7T,WAAWz3B,KAAKqrC,OAAOE,KAAKvrC,KAAM8pC,EAAKtB,GAAM,GAAO,GAI9D,QAFahoC,IAATgoC,IAAoBA,EAAO,GAE3BgD,MAAMC,QAAQ3B,GAAM,CACrB,QAAS3oC,EAAI,EAAGA,EAAI2oC,EAAI1oC,SAAUD,EAC/BnB,KAAKyoC,YAAYD,KAAM7lC,SAAMmnC,EAAI3oC,IAAM2oC,EAAI3oC,GAAKwF,KAAKC,UAAUkjC,EAAI3oC,KAAK,GAC3EnB,KAAKwqC,cACR,MAAWV,GACR9pC,KAAKyoC,YAAYD,KAAM7lC,SAAMmnC,GAAOA,EAAMnjC,KAAKC,UAAUkjC,GAC/D,CAKAmB,mBACUjrC,KAAK6qC,QACZ7qC,KAAKynC,KAAK,YAAa,EAC1B,CAIAiE,aAAaprB,EAAGF,GACTymB,UAAQC,KAAOD,UAAQ8E,KACxB3rC,KAAKynC,KAAM,UAASnnB,KAAKF,IAAK,UAChByH,OAAW,QAAgB1gB,UAAO0gB,QAAQ+jB,WACxD/jB,OAAO+jB,SAAStrB,EAAGF,EACzB,CAIAyrB,gBACG,GAAI7rC,KAAK2qC,OACN,OAAO3qC,KAAK2qC,OAAOkB,gBAEtB,MAAM7B,EAAU,IAAItB,EAAgB,UAAW1oC,KAAK4oC,SACpDoB,SAAQD,iBAAkB,EAErB/pC,KAAK2pC,WACP3pC,KAAK2pC,SAAW,CAAC,EACjB3pC,KAAK8rC,cAAgB,GAGxB9B,EAAQW,OAAS3qC,KACjBgqC,EAAQY,UAAY5qC,KAAK8rC,gBAGzB9rC,KAAK2pC,SAASK,EAAQY,WAAaZ,EAG5BA,CACV,CAGA+B,cAAgB,OAAO/rC,KAAK6oC,MAAQ,CAAG,CAGvCmD,eAAiB,OAAOhsC,KAAK4qC,WAAa5qC,KAAK2qC,OAAS3qC,KAAK4qC,UAAY,CAAG,CAK5EqB,QAAQ9F,GACL,MAAIxjC,SAAMwjC,IAAUA,EAAK52B,QAAQ,KAAO,EAAI,CACzCvP,KAAKksC,KAAO/F,EAAK5jC,MAAM,EAAG4jC,EAAK52B,QAAQ,MACvC,MAAM9C,KAAI0/B,aAAUhG,GACpBnmC,KAAKulC,IAAM94B,EAAE2/B,IAAI,OACjBpsC,KAAKqsC,MAAQ5/B,EAAE2/B,IAAI,QACtB,MACGpsC,KAAKksC,KAAO/F,SACLnmC,KAAKulC,WACLvlC,KAAKqsC,KAElB,CAKAC,QAAQC,GACL,IAAKA,IAAkBvsC,KAAKiG,OAASjG,KAAKksC,KACvC,OAAOlsC,KAAKksC,KACf,IAAInG,EAAO/lC,KAAKksC,KAChB,GAAqC,IAAjCK,EAAch9B,QAAQ,OAAc,CACrC,MAAMi9B,EAAMzG,EAAK0G,YAAY,IAAK1G,EAAK3kC,OAAO,GAC9C2kC,EAAOA,EAAKxjC,MAAM,EAAGiqC,GAAOD,EAAchqC,MAAM,EACnD,MACGwjC,GAAQwG,EAEX,OAAOxG,CACV,CAIAa,YAAY8F,GACT,IAAIpD,EAAO,GAKX,OAJItpC,KAAKulC,MAEN+D,GAAS,OADChE,EAAKtlC,KAAKulC,IAAM,WAAUmH,aACXA,KAExB1sC,KAAKqsC,QACF/C,IAAMA,GAAQ,KAClBA,GAAS,SAAQtpC,KAAKqsC,SAElB/C,CACV,CAIAqD,QAAQT,GACLlsC,KAAKgoC,SACAkE,GAAQlsC,KAAKksC,OAAMA,EAAOlsC,KAAKksC,MAEpC,IAAIQ,EAAO,EAEX,MAAME,EAAaC,IAChB,GAAmB,IAAf7sC,KAAK6oC,MAAa,OAEjBgE,GAAYxqC,QAAQC,IAAK,iCAA+B+yB,MAAO8P,cAEhEnlC,KAAK0H,aACN1H,KAAK0H,WAAWsgC,eACThoC,KAAK0H,YAGVwkC,KACFA,EAAOrkB,OAAOilB,SAASZ,OACXA,EAAK38B,QAAQ,KAAO,IAAG28B,EAAOA,EAAK3pC,MAAM,EAAG2pC,EAAK38B,QAAQ,OACjE28B,GAAQA,EAAKO,YAAY,KAAO,IAAGP,EAAOA,EAAK3pC,MAAM,EAAG2pC,EAAKO,YAAY,KAAO,KAEvFzsC,KAAKksC,KAAOA,EACZQ,IAEIG,GAAYxqC,QAAQC,IAAK,yBAAwB4pC,KAEjDQ,EAAO,MAAGK,MAAc,qBAAoBb,KAEhD,IAAI/F,EAAO+F,EAEO,SAAdlsC,KAAKiG,MACNkgC,GAAQ,gBACRnmC,KAAK0H,WAAa,IAAIugC,EAAejoC,MACrCqC,QAAQC,IAAK,0BAAyB6jC,MACf,cAAdnmC,KAAKiG,MAAyB4mC,GACvC1G,EAAOA,EAAK6G,QAAQ,UAAW,SAASA,QAAQ,WAAY,UAAY,iBACxE7G,GAAQ,IAAMnmC,KAAK4mC,YAAY8F,GAC/BrqC,QAAQC,IAAK,uBAAsB6jC,KACnCnmC,KAAK0H,WAAa,IAAIulC,UAAU9G,KAEhCA,GAAQ,gBACR9jC,QAAQC,IAAK,sBAAqB6jC,KAClCnmC,KAAK0H,WAAa,IAAIo+B,EAAeK,EAAqB,gBAAdnmC,KAAKiG,KAAyBjG,KAAM0sC,IAG9E1sC,KAAK0H,aAEV1H,KAAK0H,WAAWogC,OAAS,KAClB4E,EAAO,MAAGK,QACd/sC,KAAK6oC,MAAQ,EAGb7oC,KAAKynC,KAAM,SADCznC,KAAKulC,KAAO,KACE,GAC1BvlC,KAAKwpC,gBAAe,EAAO,oBAAmB,EAGjDxpC,KAAK0H,WAAWqgC,UAAYjT,IACzB,IAAIgV,EAAMhV,EAAE0R,KAEZ,GAAIxmC,KAAKktC,YAAa,CACnB,MAAMC,EAAUntC,KAAKktC,YAKrB,UAHOltC,KAAKktC,mBACLltC,KAAKotC,iBAERtD,aAAeuD,KAAM,CAEtB,MAAMC,EAAS,IAAIC,WAAcC,GAAQxtC,KAAKoqC,mBAE9CkD,EAAOG,OAASC,IACb,IAAIC,GAASD,EAAME,OAAOD,OAS1B3tC,KAAKqqC,kBAAkBmD,GAAOG,GAAQ,EAAC,EAE1CL,EAAOO,kBAAkB/D,EAAKhV,EAAEnkB,QAAU,EAC7C,KAAO,CAEJ,IAAIg9B,EAAS7D,EAQb9pC,KAAKyoC,YAAY0E,EAASQ,EAAQ7Y,EAAEnkB,QAAU,EACjD,CAEA,MACH,CAEA,KAAI,EAAChO,SAAMmnC,GACR,OAAOznC,QAAQC,IAAK,oCAAmCwnC,GAE1D,MAAMgE,EAAKhE,EAAIv6B,QAAQ,KAEjBw+B,GADcjE,EAAIvnC,MAAM,EAAGurC,GACtBhE,EAAIv6B,QAAQ,IAAKu+B,EAAK,IAC3BE,EAASxrC,OAAOkE,SAASojC,EAAIvnC,MAAMurC,EAAK,EAAGC,IAC3CE,EAAKnE,EAAIv6B,QAAQ,IAAKw+B,EAAK,GAC3BG,EAAS1rC,OAAOkE,SAASojC,EAAIvnC,MAAMwrC,EAAK,EAAGE,IAC3CE,EAAKrE,EAAIv6B,QAAQ,IAAK0+B,EAAK,GAE3BG,EAAKtE,EAAIv6B,QAAQ,IAAK4+B,EAAK,GAC3B3F,EAAOhmC,OAAOkE,SAASojC,EAAIvnC,MAAM4rC,EAAK,EAAGC,IAW/C,GAAIJ,GAAUhuC,KAAKipC,SAChB,OAAO5mC,QAAQC,IAAK,gCAA+B0rC,QAAahuC,KAAKipC,YAQxE,GANAjpC,KAAKipC,SAAW+E,EAChBhuC,KAAK+oC,OACL/oC,KAAK8oC,SAAWoF,EAEhBpE,EAAMA,EAAIvnC,MAAM6rC,EAAK,GAER,IAAT5F,GAED,GADAnmC,QAAQC,IAAK,sBAAqBwnC,KACtB,UAARA,EACD9pC,KAAKgoC,OAAM,GACXhoC,KAAKwpC,gBAAe,EAAM,0BAAmB,GACT,IAA5BM,EAAIv6B,QAAQ,YAAmB,CACvC,MAAM8+B,EAASvE,EAAIvnC,MAAM,GACzBvC,KAAKgoC,OAAM,GACX,IAAIkE,SAAevQ,SAAa,IAAeA,SAAS2S,IAAM,KAC9D,MAAI3rC,SAAMupC,WAAiBrkB,OAAW,KAAgBA,QAAQ0mB,QAAS,CACpE,MAAM/mC,EAAI0kC,EAAK38B,QAAQ,SACnB/H,EAAI,IAAG0kC,EAAOA,EAAK3pC,MAAM,EAAGiF,IAChCqgB,OAAO0mB,QAAQC,aAAa3mB,OAAO0mB,QAAQ1F,WAAOroC,EAAY,GAAE0rC,SAAYmC,IAC/E,aAAkBI,eAAmB,KAClCA,eAAeC,QAAQ,iBAAkBL,GAC5CvB,SAAS6B,QAAO,EACnB,MAC6B,eAArB7E,EAAIvnC,MAAM,EAAG,KACrBvC,KAAKktC,YAAc1E,EACnBxoC,KAAKotC,iBAAmBtD,EAAIvnC,MAAM,KAClB,mBAARunC,EACR9pC,KAAKyoC,YAAYD,EAAM,IAAIoG,YAAY,GAAI,GAE3C5uC,KAAKyoC,YAAYD,EAAMsB,GAEtB9pC,KAAK+oC,KAAO,GACb/oC,KAAKynC,KAAK,QAAS,EAAC,EAG1BznC,KAAK0H,WAAWkgC,QAAUj4B,WAChB3P,KAAK0H,YACP1H,KAAK6oC,MAAQ,GAAe,gBAARl5B,KACtBtN,QAAQC,IAAI,oBACZtC,KAAK6oC,MAAQ,EACb7oC,KAAKwpC,gBAAe,EAAM,qBAAmB,EAInDxpC,KAAK0H,WAAWigC,QAAUkH,IACvBxsC,QAAQC,IAAK,mBAAkBusC,WAAa7uC,KAAK6oC,SAC7C7oC,KAAK6oC,MAAQ,IACd7oC,KAAKwpC,gBAAe,EAAM,mBAAoBqF,GAC9C7uC,KAAK6oC,MAAQ,KAEnB,EAGKv3B,kBACFmmB,WAAWmV,EAAY,KAAI,EAGjCA,GAAW,EACd,CAOAkC,YACG9uC,KAAKynC,KAAK,eAAgB,EAC7B,CAMAsH,sBACqB,SAAd/uC,KAAKiG,MAET4hB,OAAOmnB,iBAAiB,UAAW98B,KACb,MAAbA,EAAKqzB,KAA8B,MAAbrzB,EAAKqzB,MAAiBrzB,EAAK+8B,UACpD/8B,EAAKG,kBACLH,EAAKE,iBACL/P,QAAQC,IAAI,uDACZtC,KAAK8uC,YAAU,EAGxB,ECnvBH,MAAMI,UAAuBhiB,EAG1BxtB,YAAYC,EAAKq/B,GACdj/B,MAAMJ,EAAKq/B,GAAQ,GACnBh/B,KAAK0H,WAAa,KAClB1H,KAAKmvC,gBAAkB/9B,WAASg+B,QAChCpvC,KAAKqvC,UAAW,EACH,OAAR1vC,GAA6B,OAAXq/B,IAEpB5tB,WAASugB,SAASpsB,MAAQ,GAC1B6L,WAASugB,SAASphB,OAAS,GAEjC,CAGAlI,iBACUrI,KAAK0H,kBACL1H,KAAKsvC,SAETtvC,KAAKuvC,iBACLvvC,KAAKwvC,cAAc,iBACfxvC,KAAKuvC,gBAEZxvC,MAAMsI,SACT,CAGAonC,gBACG,MAAMC,EAAS1vC,KAAK4tB,UAAU,UAE9B,OADY8hB,EAAOt2B,QAAU,GAAKs2B,EAAO9+B,SAAS,YACjC,QACpB,CAGA4+B,cAAcvpC,EAAM0pC,GACjB,MAAMD,EAAS1vC,KAAK4tB,UAAU,UACzB8hB,EAAOt2B,UACJnT,IAAMA,EAAO,UAClBypC,EAAO9+B,SAAS,SAAU3K,GAC1BypC,EAAO9+B,SAAS,kBAA6B,WAAT3K,GAAsB0pC,EAAgBA,EAAgB,MAC1F3vC,KAAKuvC,gBAA4B,WAATtpC,EAE9B,CAIM2pC,aAAaC,EAAahU,GAAQ,IAAA/mB,EAAA9U,KAAA,SAAA+U,KAAA,YAErC,GADgBD,EAAK26B,kBACLI,EACb,OAAO,EAEV,MAAMH,EAAS56B,EAAK8Y,UAAU,UACxBkiB,EAAWJ,EAAO5/B,OAAO,gBACzBkoB,EAAM,GACZ,IAC6BxZ,EADzBuxB,EAAUL,EAAO5/B,OAAO,eACxB2uB,EAAO3pB,EAAK8Y,YAEhB,KAAO6Q,EAAKzuB,OAAOmuB,YAChBnG,EAAIvxB,KAAKg4B,EAAKzuB,OAAOggC,YAAYvR,EAAKzuB,OAAOmuB,aAUhD,GARK4R,EAAQ32B,UAAM,EAChB/Q,MAAQ0nC,EAAQ//B,QACd8/B,EAAS12B,UAAM,EACjB/Q,MAAQynC,EAAS9/B,QAEpB8E,EAAK06B,cAAc,UACnBE,EAAOO,KAAK,IAEQ,WAAhBJ,EAA0B,CAC3BpR,EAAOiR,EACP,QAASvuC,EAAI,EAAGA,EAAI62B,EAAI52B,SAAUD,EAC/Bs9B,EAAKzuB,OAAOkgC,YAAYlY,EAAI72B,IAC/B2T,EAAK06B,cAAcK,GACnBrxB,GAAQ,CACX,KAAO,CACJ,MAAM0C,EAAO,IAAIivB,KAAYT,EAAO1/B,OAAQ6/B,QAE7BrvC,IAAXq7B,IACDA,EAA0C,IAAhCgU,EAAYtgC,QAAQ,QAAiB,EAAI,GAEtDkvB,KAAOpnB,MAAU6J,EAAKkvB,aAAavU,IACnC4C,EAAKtuB,QAAQ,iBAAiB,GAAM3K,MAAM,WAAY,YAEvC,IAAXq2B,GAEDkU,KAAU14B,MAAU6J,EAAKkvB,aAAa,IACtCL,EAAQ5/B,QAAQ,eAAe,GAAM3K,MAAM,WAAY,YAEvDuqC,KAAU14B,MAAU6J,EAAKkvB,aAAa,IACtCL,EAAQ5/B,QAAQ,cAAc,GAAM3K,MAAM,WAAY,cAEtDuqC,KAAU14B,MAAU6J,EAAKkvB,aAAa,EAAIvU,IAC1CkU,EAAQ5/B,QAAQ,cAAc,GAAM3K,MAAM,WAAY,aAIzD,QAASrE,EAAI,EAAGA,EAAI62B,EAAI52B,SAAUD,EAC/Bs9B,EAAKzuB,OAAOkgC,YAAYlY,EAAI72B,IAE/B2T,EAAK06B,cAAcK,EAAa,kBAGhCH,EAAO9+B,SAAS,MAAO,KAC1B,CAGAy/B,eAAO5R,EAAKzuB,OAAQwO,IACb,CAAK,EA7DyB,EA8DxC,CAKM8xB,iBAAiBrqC,GAAM,IAAAgS,EAAAjY,KAAA,SAAA+U,KAAA,YAK1B,UAJOkD,EAAKs4B,aAERtqC,IAAMgS,EAAKs4B,aAAe,CAAEC,GAAG,EAAOC,GAAG,KAAM,EAE/CtpC,UAAO8Q,EAAKy4B,uBACb,OAAOz4B,EAAKy4B,sBAAsBzqC,GAErC,IAAuB41B,EAAnB8U,EAAS,SAEb,OAAQ1qC,GACL,IAAK,KAAM0qC,EAAS,SAAU9U,EAAS,EAAG,MAC1C,IAAK,IACL,IAAK,SAAU8U,EAAS,WAAY9U,EAAS,EAAG,MAChD,IAAK,IACL,IAAK,OAAQ8U,EAAS,YAAa9U,EAAS,EAAG,MAC/C,IAAK,MAAO8U,EAAS,WAAY9U,EAAS,EAAG,MAC7C,IAAK,QAAS8U,EAAS,YAAa9U,EAAS,EAGhD,OAAO5jB,EAAK23B,aAAae,EAAQ9U,EAAQ,EApBf,EAqB7B,CAIM+U,iBAAqC,SAAA77B,KAAA,YAExC,OAAO,CAAM,EAF2B,EAG3C,CAIM87B,gBAAgBC,EAAMjxC,EAAKoG,GAAM,IAAAgT,EAAAjZ,KAAA,SAAA+U,KAAA,YACpC,MAAMg8B,EAAiC,WAAzB93B,EAAKw2B,iBAA2C,MAATxpC,EAAiB,eAAiB,cACjF6K,EAAOmI,EAAK2U,UAAU,UAAU9d,OAAOihC,GAC7C,OAAOjgC,EAAKsI,QAAU,KAAOH,EAAKic,WAAWpkB,EAAKd,OAAQ8gC,EAAMjxC,EAAK,EAHjC,EAIvC,CAKAmxC,UACG,QAAKhxC,KAAK87B,aACVz5B,QAAQmN,KAAK,6DACN,EACV,CAKAyhC,YAAYnH,GACJ9pC,KAAKgxC,YAAQ,EACfjE,MAAajD,EAAK,IACxB,CAGAoH,iBAAiBza,GACd,MAAMrY,EAAMqY,EAAMlnB,QAAQ,KAC1BvP,KAAKu8B,YAAY9F,EAAMl0B,MAAM6b,EAAI,IAC5BnH,KAAK1W,GAAOP,KAAK43B,cAAe,QAAOnB,KAASl2B,KACxD,CAKA4wC,gBAAgB1a,GACbz2B,KAAK43B,cAAc,WAAanB,EACnC,CAIAmB,cAAckS,GACX,QAAI9pC,KAAK0H,YAAYojC,YAClB9qC,KAAK0H,WAAW+/B,KAAKqC,IACd,EAIb,CAIAsH,eAAe5yB,GACRxe,KAAK0H,aACN1H,KAAK0H,WAAWsgC,MAAMxpB,GACtBxe,KAAK0H,WAAWW,iBACTrI,KAAK0H,WAElB,CAIA2pC,aAAa9jC,GACVvN,KAAKoxC,iBAELpxC,KAAK0H,WAAa6F,EAClBvN,KAAK0H,WAAW6hC,YAAYvpC,MAC5BA,KAAK0H,WAAWilC,SACnB,CAIA2E,iBAAiBpxC,EAAMioB,GACpB,IAAKnoB,KAAK0H,WACP,OACE1H,KAAK0H,WAAW6pC,UAClBvxC,KAAK0H,WAAW6pC,QAAU,CAAC,GAE9B,MAAMhkC,EAASvN,KAAK0H,WAAW6pC,QAAQrxC,GACvC,QAAWM,IAAP2nB,EACD,YAAkB3nB,IAAX+M,EAEC,UAAP4a,EACG5a,IAAUiqB,aAAajqB,UAAgBvN,KAAK0H,WAAW6pC,QAAQrxC,KAC1DqN,GAAU/K,OAAO66B,UAAUlV,KACpCnoB,KAAK0H,WAAW6pC,QAAQrxC,GAAQu3B,WAAW,YAAez3B,KAAK0H,WAAW6pC,QAAQrxC,EAAI,EAAMioB,GAClG,CAIAqpB,oBACA,CAIAC,oBACQzxC,KAAKs3B,iBACPoa,OACN,CAIAC,eAAepkC,EAAQu8B,GAGpB,GAAY,UAARA,EACD9pC,KAAKyxC,oBACLzxC,KAAKoxC,gBAAe,QAAI,GACI,UAApBtH,EAAIvnC,MAAM,EAAG,GAAgB,CAErC,MAAMqvC,GADN9H,EAAMA,EAAIvnC,MAAM,IACDgN,QAAQ,KACnBrJ,EAAS4jC,EAAIvnC,MAAM,EAAGqvC,GACtB1Z,KAAOmQ,SAAMyB,EAAIvnC,MAAMqvC,EAAG,IAC9B5xC,KAAK20B,UAAS,GACT1d,KAAK,MACEjX,KAAKkG,QAAUgyB,GAAMlF,UACvBhzB,KAAK6xC,cAAc3Z,EAAKlF,SAAS,GAAIkF,EAAKlF,SAAS,GAAE,GACxD/b,KAAK,IAAMjX,KAAKi6B,cAAc/B,IAChCjhB,KAAK,KACF1J,EAAOk6B,KAAM,YAAWvhC,KACxBlG,KAAKg1B,aAAY,EAE5B,SAA+B,SAApB8U,EAAIvnC,MAAM,EAAG,GAAe,CACpC,MAAM3C,KAAMyoC,SAAMyB,EAAIvnC,MAAM,IAE5BvC,KAAK8xC,aAAalyC,EACrB,SAA+B,cAApBkqC,EAAIvnC,MAAM,EAAG,GACrBvC,KAAK+xC,qBAAqBjI,EAAIvnC,MAAM,SAAE,GACX,SAApBunC,EAAIvnC,MAAM,EAAG,GAAe,CAEnC,MAAMqvC,GADN9H,EAAMA,EAAIvnC,MAAM,IACDgN,QAAQ,KACnByiC,EAAQlI,EAAIvnC,MAAM,EAAGqvC,GACrBK,EAAMnI,EAAIvnC,MAAMqvC,EAAG,GACnBM,EAAS,SAAQF,KACrB,GAAa,QAARC,GAA2B,QAARA,GAA2B,SAARA,EACxCjyC,KAAKu8B,YAAY0V,EAAIvwC,eAChBuV,KAAK1W,GAAOgN,EAAOk6B,KAAKyK,EAAQ3xC,SAAI,GACJ,IAA7B0xC,EAAI1iC,QAAQ,aAAoB,CACxC,MAAMg9B,EAAgB0F,EAAI1vC,MAAM,GAChC,IAAI,EAAC4E,UAAOnH,KAAKmyC,cAEX,CACH,MAAMC,EAAO,IAAI1J,EAAgBn7B,EAAOtH,MAGxCmsC,EAAK7I,YAAY,CACd8I,SAAUryC,KAEVwxC,oBACA,EAEAG,eAAeW,EAAcxI,GAC1B,MAAMyI,EAA4C,IAA9BzI,EAAIv6B,QAAQ,cAAuBu6B,EAAIvnC,MAAM,IAAM,GACvEvC,KAAKqyC,SAASF,aAAaI,EAAYD,GACzBr7B,KAAK1W,GAAOgN,EAAOk6B,KAAKyK,GAAS3xC,EAAM,OAAS,UACjE,EAEAkxC,oBAEGlkC,EAAOk6B,KAAKyK,EAAQ,QACvB,EAEAM,mBAEGjlC,EAAOk6B,KAAKyK,EAAQ,QACvB,IAIH,IAAInM,EAAOx4B,EAAO2+B,KAClB,GAAqC,IAAjCK,EAAch9B,QAAQ,OAAc,CACrC,MAAMi9B,EAAMzG,EAAK0G,YAAY,IAAK1G,EAAK3kC,OAAO,GAC9C2kC,EAAOA,EAAKxjC,MAAM,EAAGiqC,GAAOD,EAAchqC,MAAM,EACnD,MACGwjC,GAAQwG,EAGX6F,EAAKzF,QAAQ5G,EAChB,MAtCGx4B,EAAOk6B,KAAKyK,EAAQ,QAuC1B,MACG7vC,QAAQC,IAAI,wBAA0B2vC,GACtC1kC,EAAOk6B,KAAKyK,EAElB,SAAgC,YAApBpI,EAAIvnC,MAAM,EAAG,IAA0C,YAApBunC,EAAIvnC,MAAM,EAAG,GAAmB,CAC5E,MAAM0D,EAAO6jC,EAAI,GACb2I,KAAOpK,SAAMyB,EAAIvnC,MAAM,IAC3BvC,KAAK4wC,eAAe3qC,EAAMwsC,EAC7B,SAA+B,UAApB3I,EAAIvnC,MAAM,EAAG,GAAgB,CACrC,MAAMmwC,EAAO5I,EAAIvnC,MAAM,GACnB0P,EAA6B,MAAxBygC,EAAKA,EAAKtxC,OAAO,GAC1BpB,KAAK2yC,YAAYD,EAAKnwC,MAAM,EAAGmwC,EAAKtxC,OAAO,GAAI6Q,EAClD,MACG5P,QAAQC,IAAK,yBAAwBwnC,EAAI1oC,eAAe0oC,EAAIvnC,MAAM,EAAG,MAC3E,CAGA6E,sBAAsBnB,EAAMD,EAAK2P,EAASzO,GACvC,KAAKlH,KAAK0H,YAAe1B,GAAQA,EAAIG,WAChCwP,EAAQzP,SAAU,EAACvD,SAAMgT,EAAQzP,SAAS,OAAO,KAEtD,GAAID,GAAQiB,EAAQ,CAEZyO,EAAQi9B,YAAWj9B,EAAQi9B,UAAY,CAAC,GAE7C,MAAMC,EAAUl9B,EAAQi9B,UAAU3sC,GAElC,GAAI4sC,EAAS,CACV,MAAM1qB,OAASkN,MAAOC,UACtB,IAAKud,EAAQC,KAAQ3qB,EAAK0qB,EAAQC,IAAM,IACrCD,SAAQE,SAAW/sC,GACZ,SAEH2P,EAAQi9B,UAAU3sC,EAC5B,CAEA0P,EAAQi9B,UAAU3sC,GAAQD,CAC7B,CAEAA,EAAIuB,GAAKoO,EAAQzP,OAEbgB,GACIlH,KAAKgzC,aAAYhzC,KAAKgzC,WAAa,GACxChtC,EAAIitC,MAAQjzC,KAAKgzC,cAEjBhtC,EAAIitC,MAAQ,EAGf,MAAMnJ,EAAMnjC,KAAKC,UAAUZ,GAE3B,OAAIA,EAAIitC,QACLjtC,EAAIktC,MAAQjtC,EACZD,EAAImtC,SAAWx9B,EACf3P,EAAIotC,QAAUlsC,EACdlB,EAAI8sC,SAAUzd,MAAOC,UAEhBt1B,KAAKsvC,WAAUtvC,KAAKsvC,SAAW,CAAC,GACrCtvC,KAAKsvC,SAAStpC,EAAIitC,OAASjtC,GAK9BhG,KAAK43B,cAAc,OAASkS,GACrB9jC,CACV,CAIMqtC,kBAAkB19B,EAAS29B,EAAUL,GAAO,IAAA5nB,EAAArrB,KAAA,SAAA+U,KAAA,YAC/C,OAAO,IAAIuE,QAAQyb,IAChB1J,EAAKjkB,sBAAsB,GAAI,CAC5BjB,UAAY,GAAEC,8BACdktC,SAAUA,GAAY,GACtBC,UAAWN,GACXt9B,EAASof,EAAW,EACvB,EAP4C,EAQlD,CAGAye,WAAW79B,EAAS89B,EAAMC,GAEvB,GAAK1zC,KAAK0H,WAEV,IAAIgsC,MAAW/wC,SAAM+wC,GAAU,CAC5B,MAAMv5B,EAAMu5B,EAAQtyC,OAKpB,GAJK+Y,EAAM,GAAOu5B,EAAQnkC,QAAQ,QAAU4K,EAAM,EAAIu5B,EAAU,IAC3Dv5B,EAAM,GAAOu5B,EAAQnkC,QAAQ,QAAU4K,EAAM,EAAIu5B,EAAU,IAC3Dv5B,EAAM,GAAOu5B,EAAQnkC,QAAQ,QAAU4K,EAAM,IAAIu5B,EAAU,KAE/C,MAAZA,GAAiC,MAAZA,GAAiC,MAAZA,EAG5C,OAAOrxC,QAAQC,IAAK,0BAAyBoxC,mBAF7CD,EAAOC,EAAU,QAAUD,CAGhC,CAEDzzC,KAAKoH,sBAAsB,GAAI,CAAEjB,UAAY,GAAEC,8BAA6BqtC,QAAQ99B,EAAO,CAC9F,CAGAo8B,qBAAqBjI,GAClB,MAAMoI,KAAQ7J,SAAMyB,GACpB,IAAKoI,IAAUA,EAAMe,QAAUjzC,KAAKsvC,SAAU,OAAO,EAErD,MAAMtpC,EAAMhG,KAAKsvC,SAAS4C,EAAMe,OAChC,IAAKjtC,EAAK,OAAO,SAGVhG,KAAKsvC,SAAS4C,EAAMe,OAGvBjtC,EAAIktC,OAASltC,EAAImtC,UAAUP,WACxB5sC,EAAImtC,SAASP,UAAU5sC,EAAIktC,SAAWltC,UAChCA,EAAImtC,SAASP,UAAU5sC,EAAIktC,OAGpCltC,EAAIotC,SACLptC,EAAIotC,QAAQlB,EAAOlsC,GAGlBA,EAAI+sC,WAAa/sC,EAAImtC,SAASP,UAAU5sC,EAAIktC,QAC7ClzC,KAAKoH,sBAAsBpB,EAAIktC,MAAOltC,EAAI+sC,SAAU/sC,EAAImtC,SAAUntC,EAAIotC,QAC5E,CAGMT,YAAYD,EAAMzgC,GAAI,IAAAuqB,EAAAx8B,KAAA,SAAA+U,KAAA,YACzB,OAAQ29B,GACL,IAAK,OACL,IAAK,YACL,IAAK,SACL,IAAK,UAAW,MAChB,IAAK,WAAYlW,EAAKzQ,kBAAkB9Z,GAE3C,OAAO,CAAK,EARa,EAS5B,CAKA0hC,eAAe1tC,EAAM0P,EAAS+9B,GAE3B,GAAK1zC,KAAK0H,YAAe1H,KAAK0H,WAAWojC,QAAQ,KAAM,EAACnoC,SAAMsD,GAI9D,OADK0P,IAASA,EAAU3V,MAChBiG,GACL,IAAK,QACF5D,QAAQC,IAAI,oDACZ,MACH,IAAK,QACL,IAAK,OACFD,QAAQC,IAAI,gDACZ,MACH,IAAK,aACFD,QAAQC,IAAI,+CACZ,MACH,QAC6B,UAArB2D,EAAK1D,MAAM,EAAG,IAAmBoT,GAASzP,OAC5ClG,KAAKwzC,WAAW79B,EAAS1P,EAAK1D,MAAM,GAAImxC,GAExCrxC,QAAQC,IAAI,sBAAuB2D,GAK/C,CAIA+5B,eAAeC,EAAU/tB,GACtB,MAAiB,cAAb+tB,EACMjgC,KAAK4zC,YAAY5zC,KAAM,KAAM,UACtB,iBAAbigC,EACMjgC,KAAKu2B,kBAAkB,UAC1Bx2B,MAAMigC,eAAeC,EAAU/tB,EACzC,CAGAokB,iBACG,GAAIt2B,KAAKgxC,UAAW,OAAO,EAC3B,GAAIhxC,KAAK+7B,SACN,OAAO/7B,KAAK+7B,SAAS8X,YACxB,MAAMC,KAAKC,QACX,QAAOD,GAAKA,EAAGE,eAClB,CAIAxd,eACG,OAAOx2B,KAAKgxC,WAAahxC,KAAK+7B,aAAYgY,OAC7C,CAIAxd,kBAAkBsS,GACX7oC,KAAKgxC,YAELhxC,KAAK+7B,SACN/7B,KAAK+7B,SAASkY,iBAAiB,GAAIpL,IAAK,EAExCkL,SAAeE,iBAAiB,GAAIpL,GAEvC7oC,KAAK2zC,eAAe,QAAS3zC,MAChC,CAIAk0C,oBAAoBC,GACbn0C,KAAKgxC,YAEEhxC,KAAK+7B,aAAYgY,SAAehY,WAEvCqY,cAAcD,EACrB,CAGAE,SACG,OAAIr0C,KAAKgxC,YACFhxC,KAAK+7B,UAAUuY,eAAgB,EACzC,CAIAC,YACOv0C,KAAKgxC,YAEThxC,KAAK8wB,qBAAqB,MAEtB9wB,KAAKw0C,WACNx0C,KAAKw0C,SAASC,gBAAgBC,aAC9B10C,KAAKw0C,SAASG,iBACP30C,KAAKw0C,UAEfx0C,KAAK+7B,UAAU6Y,eAAc,GAC7B50C,KAAK2zC,eAAe,QAAS3zC,MAChC,CAIA60C,kBACG,MAAO,CAAEC,OAAQ,CAAE1jC,SAAQ2jC,EAAA3jC,SAAEwS,OAAMmxB,EAAAnxB,OAAEykB,MAAK0M,EAAA1M,MAAE2M,OAAMD,EAAAC,OAAEC,WAAUF,EAAAE,WAAEC,UAASz1C,EAAA01C,GAAEC,aAAYA,MAC1F,CAKMxB,YAAY7b,EAAY9xB,EAAMiwB,GAAM,IAAA2H,EAAA79B,KAAA,SAAA+U,KAAA,YACvC,GAAI8oB,EAAKmT,YAAcnT,EAAK9B,SACzB,OAAO,EAEV,GAAI8B,EAAK9B,SAASuY,aACf,MAAc,WAATpe,IAAgC,IAATA,EACzB2H,EAAK0W,YAELxc,GAAYl1B,iBAAiByuB,oBAAoByG,IAE7C,EAGV,IAAa,IAAT7B,EACD,OAAO,EAEV,MAAMhE,EAAO2L,EAAK9B,SAASsZ,oBAE3BC,YAAaC,UAAUrjB,EAAMojB,KAAaE,QAAS,GAAI,sBAAuB,WACjEhwC,MAAM,SAAU,OAAOyM,GAAG,QAAS,IAAM4rB,EAAK9B,SAAS0Z,WAAW,QAE/EH,KAAaC,UAAUrjB,EAAMojB,KAAaI,OAAQ,GAAI,oBAAqB,WAC9DlwC,MAAM,SAAU,OAAOyM,GAAG,QAAS,IAAM4rB,EAAK9B,SAAS0Z,WAAW,UAE/EH,KAAaC,UAAUrjB,EAAMojB,KAAaK,MAAO,GAAI,aAAc,WACtDnwC,MAAM,SAAU,OAAOyM,GAAG,QAAS,IAAM4rB,EAAK0W,aAG3D1W,EAAK9B,SAAS6Z,kBAAkB,oFAChC/X,EAAK9B,SAAS8Z,gBAAgB,OAC9BhY,EAAK9B,SAAS+Z,kBAAkB7vC,GAAQ,SAEjC,IAAIqT,QAAQyb,IAChBghB,KAAY9+B,KAAK++B,KACd3+B,QAAU,oBAAoBb,KAAK,IAEnCw/B,EAAIC,GAAGC,QAAQ,CAAC,8BAA+B,2BAA4B,CAACC,EAAWC,KACpF,MAAMC,EAAS,IAAIF,EAAU,CAAE5oC,OAAQ,OAEvC6oC,EAAQxyB,OAAO,CACZ0yB,SAAU,wBACVC,SAAU1Y,EAAKgX,gBAAgB,SAC/B59B,KAAKu/B,IACLA,EAAKC,SAASJ,GAEdG,EAAKE,QAAQ,mBAEb7Y,EAAK2W,SAAWgC,EAGhB3Y,EAAK/M,qBAAqB0lB,EAAK/B,gBAAgBkC,kBAAkBpL,KAAKiL,EAAK/B,kBAE3E1c,GAAYl1B,iBAAiByuB,oBAAoByG,GAEjD8F,EAAK8V,eAAe,QAAS9V,GAE7B9I,GAAY,EAAI,EAClB,EACH,EACH,EACD,EA5DoC,EA6D1C,CAIA6hB,cACGv0C,eAAQiB,MAAM,kDACP,EACV,CAGAuuC,cAAcgF,EAAOC,IACbD,IAAUC,GAAS92C,KAAKsR,eAAiBtR,KAAKs3B,cAAgBt3B,KAAK6tB,YAExE7tB,KAAK0H,YAAYgkC,aAAamL,EAAOC,EACxC,CAGA,WAAa3U,CAAKxiC,EAAKo3C,GAAgB,SAAAhiC,KAAA,YACpC,MAAMiiC,GAAYD,EACdC,IACDD,KAAMnzB,UAAQ,GAAExd,mBAEnB,MAAMuP,EAAU,IAAIu5B,EAAevvC,EAAKo3C,GACxCphC,SAAQshC,eAAiBD,EACzBrhC,EAAQoc,gBAAgB,IAAC,EAEzBjD,MAAgB,CAAElsB,GAAI+S,EAASoZ,QAAQ,IAEhCpZ,EAAQwf,iBAAiBle,KAAK,KAClCtB,EAAQ4kB,gBACR5kB,EAAQic,iBACDjc,GACP,EAfiC,EAgBvC,EAOH,SAASuhC,GAAiBv3C,EAAKu4B,GAC5B,MAAMviB,EAAU,IAAIu5B,EAAevvC,EAAK,MACxCgW,SAAQshC,eAAgB,EACxBthC,EAAQkY,cAAavc,iBACdqE,EAAQgf,UAAS,GAAM1d,KAAK,IAAMtB,EAAQskB,cAAc/B,IAAOjhB,KAAK,KACxEtB,EAAQqf,cACRrf,EAAQic,iBACDjc,GAEb,CAEA,SAMewhC,GAAaC,EAAAC,GAAA,OAAAC,GAAAC,MAAAv3C,KAAAic,UAAA,CAiB5B,SAAAq7B,kBAAAviC,KAjBA,UAA6BY,EAAS6hC,GACnC,OAAK7hC,GAIMA,EAAQ4c,aAAanZ,QAAU81B,EAAe/M,KAAKxsB,EAAQmO,SAAU,MAAsBxK,QAAQC,SAAQ,IAE5GtC,KAAK,KACZ,IAAoB,IAAfugC,GAAyB7hC,EAAQwK,cAAchH,YAAY,eAAeC,QAC5E,OAAO8D,EAAcilB,KAAKxsB,EAAQmO,SAAU,QAAMnhB,SAAM60C,GAAcA,EAAa,GAAE,GACxFvgC,KAAK,KACLtB,EAAQ2kB,qBACD3kB,IAVA2D,QAAQm+B,OAAOC,MAAM,yCAYlC,IAACH,MAAAv3C,KAAAic,UAAA,CAKD,SAAS07B,GAAgBhhB,EAAQpb,GAC9B,MAAM7S,EAAK1I,KAAKoc,kBAChB,IAAK1T,EACF,OAAOrG,QAAQC,IAAI,+BAEtB,MAAMoW,EAAOhQ,EAAG4gB,eACVsuB,EAAKl/B,EAAKrI,EACVwnC,EAAKn/B,EAAKpI,EACVwnC,EAAKp/B,EAAKnT,MAEVwyC,EAAK/3C,KAAK6C,gBAAgB6B,eAC1Bk3B,EAAQ57B,KAAKI,YACb43C,EAAcF,EACdG,EAAWj4C,KAAKwD,WAAW,OAAQ,CAAEG,KAAM,IAAMU,MAAO,QAASF,MAAO,KAC9E,IAAI+zC,EAAel4C,KAAK4B,aAAa,SAAUm2C,EAAI,KAC/CI,EAAen4C,KAAK4B,aAAa,SAAUm2C,EAAI,KAEnD,GAAe,SAAXphB,EAAmB,CACpBwhB,EAAe58B,EAAKhL,OACpB2nC,EAAeL,EAAKt8B,EAAKjL,EAAIiL,EAAKhL,OAClC,MAAMyL,EAAU,CAAC,EACjBhc,KAAK+F,aAAaiW,EAAS,SAAUk8B,EAAeH,GACpD/3C,KAAK+F,aAAaiW,EAAS,SAAUm8B,EAAeJ,GACpD/3C,KAAK6G,kBAAkBmV,GAAS,EACnC,CAEAhc,KAAKua,WAAQ,EAEbrH,MAAclT,KAAK0W,OAAQkhC,EAAI91C,KAAKC,MAAM81C,EAAGK,EAAaC,IAE1D,MAAMxoC,EAAM,CAAEU,EAAG2nC,EAAY,EAAG1nC,EAAG6nC,EAAa,EAAG3hC,KAAMolB,EAAMwc,MAAO3hC,MAAO,GAE7E,OAAAzW,KAAKuW,iBAAiB0hC,EAAU,QAEhCj4C,KAAK4W,SAASjH,GAEP3P,KAAKgX,oBAAoBC,KAAK,OAClC8D,MAAe/a,KAAM,CAAEqQ,EAAGunC,EAAItnC,EAAGxO,KAAKC,MAAM81C,EAAGK,EAAaC,GAAe5yC,MAAOyyC,EAAaznC,OAAQ4nC,EAChFE,SAAU,GAAIC,UAAW,GAAIC,aAAa,EAAMz+B,OAAQrN,GAAKzM,KAAK8Z,OAAO,OAAQrN,KAE9G,CAmKA,SAAS+rC,KACN,MAAMC,EAAOz4C,KAAKI,YACZiyB,EAAMryB,KAAKuyB,aACX+M,EAAS,eAAiBmZ,EAAK30C,QAAQ20C,EAAKz0C,QAAQy0C,EAAK10C,OAC/D,IAAIi6B,EAAO3L,EAAIlZ,YAAY,gBAEvB6kB,EAAK5kB,UACN4kB,EAAO3L,EAAIsN,OAAO,WAAY,gBAAgBvvB,KAAK,QAAS,gBAE/D,IAAIwkB,EAAQoJ,EAAK7kB,YAAY,IAAMmmB,GACnC,GAAI1K,EAAMxb,QAAS,CAChBwb,EAAQoJ,EAAK9tB,OAAO,SACPE,KAAK,OAAQ,YACbA,KAAK,QAASkvB,GACd9oB,KAAM,8BAA6BiiC,EAAK30C,0BAA0B20C,EAAKz0C,QAAUy0C,EAAKz0C,QAAU,yBAAyBy0C,EAAK10C,OAAS00C,EAAK10C,OAAS,kBAAkB00C,EAAKC,WACzL,MAAM9G,EAAK6G,EAAKC,KAAKnpC,QAAQ,WACvBopC,EAAKF,EAAKC,KAAKjM,YAAY,YACjC,GAAImF,EAAK,GAAK+G,EAAK/G,EAAI,CACpB,MAAMgH,EAASH,EAAKC,KAAKn2C,MAAMqvC,EAAK,EAAG+G,EAAK,GAC7BF,EAAKC,KAAKnpC,QAAQ,6BAA+B,GAG7DqlB,EAAMhkB,SAAS,eAAgB,CAAE1Q,KAAMu4C,EAAK30C,QAASoH,OAAQ,MAAO0tC,UAC1E,CACH,CAEA,OAAIH,EAAKI,WACN74C,KAAK6C,gBAAgBgB,WAAa40C,IAE9B,CACV,CAIA,SAASK,GAAUn5C,EAAKC,EAAKC,GAC1B,MAAM8V,EAAU,IAAI9N,IAAalI,EAAKC,EAAKC,GAC3C8V,SAAQmC,iBAAkB,EACnBq/B,GAAcxhC,GAAS,GACrBsB,KAAK,IAAMtB,EAAQmE,UACnB7C,KAAK,IAAMtB,EACvB,CAIA,SAASojC,GAAWp5C,EAAKC,EAAKC,GAC3B,MAAM2H,EAAI,IAAI0V,EAAcvd,EAAKC,GACjC,MAAY,OAARC,IAAc2H,EAAE4V,QAAS,GACtB+5B,GAAc3vC,GAAG,GAAOyP,KAAK,IAAMzP,EAAEsS,SAC/C,EA/MAk/B,qBAAiB,GAAE5yC,kBAAiB,CAEjC6yC,cAAcC,GACLA,EAAO3oB,QAAU,QAG1BxP,SAASrU,GACN,OAAO1M,KAAKm7B,QAAQzuB,EACvB,EAEAysC,gBAAgBC,GACb,MAAMC,EAAOr5C,KAAKs5C,SAClB,IAA8BC,EAA1BC,EAAI,EAAGC,EAAIJ,EAAKj4C,OAAO,EAE3B,GAAIg4C,EAAKC,EAAK,GAAI,OAAO,EACzB,GAAID,GAAMC,EAAKI,GAAI,OAAOA,EAAE,EAE5B,GAAIz5C,KAAK05C,eAAgB,CACtB,KAAOF,EAAIC,EAAE,GACVF,EAAMz3C,KAAKC,OAAOy3C,EAAEC,GAAG,GACnBJ,EAAKE,GAAOH,EAAIK,EAAIF,EAAUC,EAAID,EAEzC,OAAOC,CACV,CAGA,OAAO13C,KAAKyJ,OAAO6tC,EAAGC,EAAK,KAAOA,EAAKI,EAAE,GAAKJ,EAAK,KAAOI,EAAE,GAC/D,EAEAE,gBAAgBP,GACb,MAAMQ,EAAQ55C,KAAKm5C,gBAAgBC,GACnC,OAAQQ,EAAQ,EAAK,GAAK55C,KAAK+gB,SAAS64B,EAC3C,EAEAC,aACG,OAAO75C,KAAKs5C,UAAat5C,KAAKs5C,SAASl4C,OAAS,EAAKpB,KAAKs5C,SAAW,IACxE,EAEAQ,uBACU95C,KAAKs5C,QACf,EAEAS,UAAUj5C,EAAOk5C,EAAQC,GACtB,MAAMC,EAAOD,EAAO3pB,SAAW0pB,EAAO1pB,SAClC6pB,EAAKF,EAAO3pB,SAAWxvB,EACvBs5C,EAAKt5C,EAAQk5C,EAAO1pB,SAExB,IAAKtwB,KAAKwwB,cAAiB0pB,GAAQ,EAChC,OAAQC,EAAKC,EAAMH,EAAO1pB,OAASypB,EAAOzpB,OAG7C,MAAM8pB,KAAOC,MAAOt6C,KAAKi5C,cAAce,EAAOzpB,SAC1CgqB,KAAOD,MAAOt6C,KAAKi5C,cAAcgB,EAAO1pB,SAK5C,SAJY+pB,MAAOx4C,KAAKC,OAAOs4C,EAAKZ,EAAEU,EAAKI,EAAKd,EAAEW,GAAIF,GACnCp4C,KAAKC,OAAOs4C,EAAKtV,EAAEoV,EAAKI,EAAKxV,EAAEqV,GAAIF,GACnCp4C,KAAKC,OAAOs4C,EAAKzV,EAAEuV,EAAKI,EAAK3V,EAAEwV,GAAIF,IAEzC/U,UAChB,EAEAqV,oBAAoBrgC,GACjB,MAAM6L,EAAM,GACZ,IAAItZ,EAAO,EAEX,KAAOsZ,EAAI5kB,OAAS+Y,GAAK,CACtB,MAAMrZ,EAAQklB,EAAI5kB,QAAU+Y,EAAI,GAE/Bya,EAAQ50B,KAAKqwB,QAAQ3jB,GAEtB,GAAK5K,KAAK+G,IAAI+rB,EAAMtE,SAAWxvB,GAAS,MAAY4L,IAAS1M,KAAKqwB,QAAQjvB,OAAS,EAAI,CACpF4kB,EAAIvf,KAAKzG,KAAKi5C,cAAcrkB,EAAMrE,SAClC,QACH,CAEA,MAAMriB,EAAOlO,KAAKqwB,QAAQ3jB,EAAK,GAC3BwB,EAAKoiB,UAAYxvB,EAClB4L,IAEAsZ,EAAIvf,KAAKzG,KAAK+5C,UAAUj5C,EAAO8zB,EAAO1mB,GAC5C,CAEA,OAAO8X,CACV,EAEA5iB,gBAAgBtC,GAEb,IAAKd,KAAKqwB,QACP,MAAO,QACY,iBAAVvvB,GAAwBA,EAAQ,EACzCA,EAAQ,EACFA,EAAQ,IACdA,EAAQ,GAIX,IAAI8zB,EAAO1mB,EAAOlO,KAAKqwB,QAAQ,GAC/B,QAAS3jB,EAAO,EAAGA,EAAO1M,KAAKqwB,QAAQjvB,OAAO,IAAKsL,EAAM,CAGtD,GAFAkoB,EAAQ1mB,EAEJpM,KAAK+G,IAAI+rB,EAAMtE,SAAWxvB,GAAS,KACpC,OAAOd,KAAKi5C,cAAcrkB,EAAMrE,QAGnC,GADAriB,EAAOlO,KAAKqwB,QAAQ3jB,EAAK,GACrBwB,EAAKoiB,SAAWxvB,EACjB,OAAOd,KAAK+5C,UAAUj5C,EAAO8zB,EAAO1mB,EAC1C,CAEA,OAAOlO,KAAKi5C,cAAc/qC,EAAKqiB,OAClC,EAEAkqB,aAAaxxC,EAAKC,GAEflJ,KAAKyJ,SAAWR,EAChBjJ,KAAK0J,SAAWR,CACnB,EAEAwxC,cAAc3xC,EAAM4xC,EAASt4B,EAAMC,EAAMs4B,GAMtC,GALA56C,KAAKs5C,SAAW,UACTt5C,KAAK05C,eACZ15C,KAAK66C,QAAUx4B,EACfriB,KAAK86C,QAAUx4B,EAEXvZ,EAAM,CACH/I,KAAK86C,SAAW,IAAG96C,KAAK86C,QAAU,GAClC96C,KAAK66C,SAAW,IAEd76C,KAAK66C,aADcr6C,IAAjBo6C,GAAgCA,GAAgB,EACnC,KAAO56C,KAAK86C,QAEVF,EAAe,GAAOA,EAAa,IAAQ,GAAIA,EAAe,GAEjF56C,KAAK66C,SAAW76C,KAAK86C,UACtB96C,KAAK66C,QAAU,KAAO76C,KAAK86C,SAE9B,MAAMC,EAASj5C,KAAKQ,IAAItC,KAAK66C,SAAS/4C,KAAKQ,IAAI,IAE3C04C,GADSl5C,KAAKQ,IAAItC,KAAK86C,SAASh5C,KAAKQ,IAAI,IAC5By4C,GAAQJ,EACzB36C,KAAKs5C,SAAS7yC,KAAKzG,KAAK66C,SACxB,QAASI,EAAM,EAAGA,EAAMN,EAASM,IAC9Bj7C,KAAKs5C,SAAS7yC,KAAK3E,KAAKgH,KAAKiyC,EAASC,EAAGC,GAAOn5C,KAAKQ,IAAI,MAC5DtC,KAAKs5C,SAAS7yC,KAAKzG,KAAK86C,SACxB96C,KAAK05C,gBAAiB,CACzB,KAAO,CACC15C,KAAK66C,UAAY76C,KAAK86C,SAA8B,IAAjB96C,KAAK66C,UAC1C76C,KAAK86C,SAAW,IAAKh5C,KAAK+G,IAAI7I,KAAK86C,SACnC96C,KAAK66C,SAAW,IAAK/4C,KAAK+G,IAAI7I,KAAK66C,UAEtC,MAAMG,GAAMh7C,KAAK86C,QAAQ96C,KAAK66C,SAASF,EACvC,QAASM,EAAM,EAAGA,GAAON,EAASM,IAC/Bj7C,KAAKs5C,SAAS7yC,KAAKzG,KAAK66C,QAAUG,EAAGC,EAC3C,GAEKj7C,KAAKm7B,SAAYn7B,KAAKm7B,QAAQ/5B,SAAWu5C,KAC3C36C,KAAKm7B,QAAUn7B,KAAKw6C,oBAAoBG,GAC9C","names":["RObjectPainter","ObjectPainter","constructor","dom","obj","opt","csstype","super","this","v7EvalAttr","name","dflt","getObject","cssprefix","type_check","res","undefined","typ1","typ2","parseFloat","fAttr","m","value","v","rstyle","fBlocks","blks","k","length","block","selector","fId","fCssClass","map","toLowerCase","v7SetAttr","v7EvalLength","sizepx","Math","round","norm","px","val","operand","pos","console","log","slice","Number","isFinite","v7EvalColor","isStr","pp","getPadPainter","_auto_color_cnt","pal","getHistPalette","cnt","num","_num_primitives","getColorOrdinal","_auto_colors","error","ordinal","v7EvalFont","dflts","fontScale","size","rfont","_dfltRFont","fFamily","fStyle","fWeight","text_angle","text_align","align","text_color","color","font_family","font_style","font_weight","text_size","getPadHeight","handler","FontHandler","setNameStyleWeight","setAngle","setAlign","setColor","createv7AttFill","prefix","pattern","createAttFill","color_as_svg","createv7AttLine","width","style","createAttLine","lineatt","setBorder","createv7AttMarker","refsize","createAttMarker","v7AttrChange","req","kind","snapid","_typename","nsREX","ids","names","values","update","push","parseInt","JSON","stringify","v7SendAttrChanges","do_update","canp","getCanvPainter","v7SubmitRequest","method","isFunc","submitDrawableRequest","_pending_request","assignSnapId","id","p","v7CommMode","_websocket","v7NormalMode","v7OfflineMode","RAxisPainter","arg1","axis","Object","assign","AxisPainterMethods","initAxisPainter","embedded","cleanup","axis_g","cleanupAxisPainter","getAxisType","configureZAxis","fp","_log","logbase","abs","exp","logz","configureAxis","min","max","smin","smax","vertical","frame_range","axis_range","opts","full_min","full_max","_symlog","reverse","timeoffset","toffset","fLabelsIndex","own_labels","labels","func","d3_scaleTime","domain","convertDate","symlog","d3_scaleSymlog","constant","d3_scaleLog","base","d3_scaleLinear","scale_min","scale_max","gr_range","range","axis_shift","gr","format","ndiv","nticks","nticks2","nticks3","floor","scale_range","tf2","chooseTimeFormat","tf1","tfunc1","tfunc2","d3_timeFormat","formatTime","noexp","moreloglabels","formatLog","formatLabels","order","ndig","formatNormal","getScaleMin","getScaleMax","d","indx","fNBinsNoOver","i","pair","second","first","fLabels","createTicks","only_major_as_array","optionNoexp","optionNoopt","optionInt","noticksopt","handle","nminor","nmiddle","nmajor","minor","middle","major","produceTicks","delta","unshift","reset","next","doround","tick","grpos","last_major","next_major_grpos","get_modifier","maxorder","minorder","exclorder3","maxtick","mintick","ord1","log10","ord2","bestorder","bestndig","bestlen","lbls","totallen","lbl","indexOf","warn","isCenteredLabels","processLabelsMove","arg","optionUnlab","label_g","select","box","node","getBBox","append","classed","attr","x","y","height","call","addHighlightStyle","drag_pos0","offset","property","remove","side","labelsOffset","changeAxisAttr","scalingSize","addTitleDrag","title_g","settings","MoveResize","isBatchMode","acc_x","acc_y","new_x","new_y","alt_pos","curr_indx","drag_rect","drag_move","d3_drag","subject","on","evnt","sourceEvent","preventDefault","stopPropagation","title_length","titlePos","off","swap","isReverseAxis","title_align","isTitleRotated","dx","dy","set_x","set_y","besti","makeTranslate","basepos","titleOffset","isInsideGrRange","delta1","delta2","getGrRange","drawMainLine","ending","endingSize","endingStyle","sz","sz7","drawTicks","main_draw","ticks","ticks_plusminus","ticksSide","h1","ticksSize","h2","startingSize","ticksColor","ticksWidth","gap0","gap","drawLabels","gaps","_this","_asyncToGenerator","center_lbls","rotate_lbls","labelsFont","angle","lbl_pos","textscale","maxtextlen","lbls_tilt","max_lbl_width","max_lbl_height","process_drawtext_ready","painter","result_width","result_height","textwidth","maxwidth","gap_before","gap_after","scale","scaleTextDrawing","fix_offset","fix_coord","lastpos","startTextDrawing","text","latex","draw_g","post_process","drawText","axis_step","has_obstacle","formatExp","finishTextDrawing","then","selectAll","each","txt","d3_select","tr","tilt_height","sin","PI","cos","addZoomingRect","lgaps","Zooming","disable_zooming","titleFont","drawTitle","_this2","fTitle","rotated","title_shift_x","title_shift_y","title_basepos","titleCenter","titleOpposite","extractDrawAttributes","rect","getPadRect","roundAngle","maxTickSize","drawAxis","layer","transform","_this3","standalone","selectChild","empty","tgaps","Promise","resolve","setAfterDrawHandler","_afterDrawAgain","drawAxisAgain","drawAxisOtherPlace","only_ticks","zoomStandalone","redraw","drawable","getCoordinate","fPos","labels_len","len","getPadLength","fVertical","fLength","createG","promise","ContextMenu","createMenu","menu","add","fillAxisContextMenu","show","addDragHandler","only_move","positionChanged","ZoomWheel","d3_pointer","item","analyzeWheelEvent","changed","drag","xn","yn","fHoriz","fArr","fVert","submitCanvExec","toFixed","redraw_mode","changes","arguments","redrawPad","changeAxisLog","getFramePainter","unzoom","addchk","input","addRColorMenu","col","addSizeMenu","addSelectMenu","addRAttrTextItems","noangle","noalign","change","t","flag","RFramePainter","tframe","mode3d","xmin","xmax","ymin","ymax","axes_drawn","keys_handler","projection","v7_frame","is_root6","setFrameActive","enabledKeys","HandleKeys","control","enableKeys","setLastEventPos","pnt","fLastEventPnt","getLastEventPos","updateAttributes","force","fX1NDC","modified_NDC","gStyle","fPadLeftMargin","fY1NDC","fPadBottomMargin","fX2NDC","fPadRightMargin","fY2NDC","fPadTopMargin","fillatt","getProjectionFunc","getEarthProjectionFunc","recalculateRange","Proj","scale_ymin","scale_ymax","pnts","scale_xmin","scale_xmax","original_xmin","original_xmax","original_ymin","original_ymax","n","drawGrids","getFrameSvg","h","getFrameHeight","w","getFrameWidth","gridx","gridy","grid_style","getSvgLineStyle","fGridStyle","grid_color","fGridColor","getColor","x_handle","draw_grid","grid","swap_xy","fGridWidth","y_handle","axisAsText","toUpperCase","toPrecision","_setAxisRange","vmin","vmax","nmin","nmax","nzmin","nzmax","zoomChangedInteractive","setAxesRanges","xaxis","yaxis","zaxis","zmin","zmax","setAxes2Ranges","second_x","second_y","x2axis","y2axis","createXY","self_drawaxes","cleanXY","ndim","v6axes","reverse_x","reverse_y","logx","logy","scales_ndim","extra_y_space","zoom_ymin","zoom_ymax","zoom_xmin","zoom_xmax","clTAxis","create","TAxisPainter","getDom","setPadName","getPadName","symlog_y","symlog_x","logcheckmin","logminfactor","assignFrameMembers","log_min_nz","ymin_nz","hasDrawnAxes","drawAxes","ticksx","ticksy","sidex","sidey","cleanupAxes","draw_swapside","draw_ticks","z_handle","draw_horiz","draw_vertical","pr","_fast_drawing","disable_ticks","pr1","invert_side","disable_x_draw","getFrameY","pr2","disable_y_draw","_frame_x","can_adjust_frame","all","arr","drawAxes2","zoom_x2min","zoom_x2max","scale_x2min","scale_x2max","x2min","x2max","x2_handle","zoom_y2min","zoom_y2max","scale_y2min","scale_y2max","y2min","y2max","y2_handle","getGrFuncs","use_x2","grx2","use_y2","gry2","grx","gry","revertAxis","sizeChanged","clean","grname","cleanFrameDrawings","create3DScene","window","removeEventListener","_click_handler","_dblclick_handler","frame_painter_ref","lm","tm","trans","top_rect","main_svg","rotate","fixpos","options","RotateFrame","FixFrame","_frame_y","_frame_width","_frame_height","_frame_rotate","_frame_fixpos","getLayerSvg","rx","ry","addInteractivity","getFrameX","getFrameRect","hint_delta_x","hint_delta_y","configureUserClickHandler","configureUserDblclickHandler","zoom","zoom_x","zoom_y","zoom_z","unzoom_x","unzoom_y","unzoom_z","r_x","r_y","r_z","is_any_check","flags","checkZooming","canZoomInside","zoom_zmin","zoom_zmax","forEachPainter","ranges","interactiveRedraw","zoomSingle","zoom_v","unzoom_v","isAxisZoomed","dox","doy","doz","_this4","zoom_changed_x","zoom_changed_y","zoom_changed_z","fld","fillObjectOfflineMenu","changeFrameAttr","fillContextMenu","alone","isTooltipAllowed","setTooltipAllowed","addAttributesMenu","forEach","fmt","saveAs","revertPoint","showAxisStatus","axis_name","hint_name","axis_value","showObjectStatus","addKeysHandler","FrameInteractive","addFrameKeysHandler","for_second_axes","addBasicInteractivity","addFrameInteractivity","setRootPadRange","toggleAxisLog","RPadPainter","pad","iscan","this_pad_name","fObjectID","internals","id_counter","painters","has_canvas","forEachPainterInPad","selectDom","batch_mode","isRoot6","isEditable","svg_this_pad","getPadSvg","getMainPainter","main_painter_ref","setMainPainter","_doing_draw","svg_p","pads_cache","_pad_x","_pad_y","_pad_width","_pad_height","draw_object","pad_frame","selectActivePad","active","getPadWidth","szx","szy","getRootPad","cleanPrimitives","splice","removePrimitive","prim","resindx","isSecondary","findInPrimitives","objname","objtype","findPainterFor","selobj","selname","seltype","find","pobj","fName","fDfltPalette","fColors","fOrdinal","fColor","fInterpolate","fNormalized","addMethods","getNumPainters","userfunc","sub","registerForPadEvents","receiver","pad_events_receiver","producePadEvent","what","padpainter","position","place","selectObjectPainter","istoppad","getAbsPosInCanvas","setFastDrawing","was_fast","SmallPad","showPadButtons","isGrayscale","setGrayscale","createCanvasSvg","check_resize","new_size","btns","frect","factor","svg","_fixed_size","getCanvSvg","testMainResize","render_to","setTopPainter","online_canvas","enlargePad","padContextMenu","ToolBarSide","ToolBarVert","fWinSize","getElementRect","lmt","DarkMode","alignButtons","drawItemNameOnCanvas","is_dblclick","is_escape","enlargeMain","svg_can","pad_enlarged","hasObjectsToDraw","checkResize","createPadSvg","only_resize","svg_parent","pad_name","pad_visible","svg_pad","svg_rect","fSize","color0","fBorderMode","constants","Embed3D","Overlay","fPrimitives","syncDraw","entry","findIndex","e","resolveFunc","confirmDraw","shift","drawObject","drawPrimitives","_start_tm","Date","getTime","op","isObject","_primitive","spenttm","processPadTooltipEvent","hints","processTooltipEvent","nproc","hint","user_info","changeDarkMode","mode","addSettingsMenu","hasMenuBar","actiavteMenuBar","hasEventStatus","activateStatusBar","canStatusBar","fname","fillObjectExecMenu","reason","sync_promise","showsubitems","redrawNext","isPromise","getActivePad","needRedrawByResize","elem","checkCanvasResize","_ignore_resize","getPromise","embed_canvas","_resize_tmout","clearTimeout","setTimeout","cw","ch","sendWebsocket","updateObject","addObjectPainter","objpainter","lst","extractTObjectProp","snap","fColIndex","fColValue","colors","root_colors","getRootColors","pattr","fObject","assignObject","fCssType","fOption","extract_color","member_name","attr_name","addColor","fLineColor","fLineWidth","fLineStyle","fFillColor","fFillStyle","fMarkerColor","fMarkerStyle","fMarkerSize","fTextColor","fTextAlign","fTextAngle","fTextSize","drawNextSnap","_snaps_map","next_rstyle","fDummy","redrawPadSnap","ppainter","fDrawable","subpad","decodeOptions","addToPadPrimitives","addPadButtons","prev_name","selectCurrentPad","webSnapIds","kNone","kObject","kColors","kStyle","kPalette","fKind","ListOfColors","fString","palette","custom_palette","ColorPalette","$dummy","findSnap","onlyid","check","checkid","document","title","mainid","use_openui","brlayout","BrowserLayout","setDom","drawing_divid","registerForResize","isanyfound","isanyremove","removePadButtons","createImage","_this5","produceImage","separ","itemContextMenu","rrr","getBoundingClientRect","clientX","left","clientY","top","postponePromise","selkind","selp","isInteger","full_canvas","filename","imgdata","saveFile","encodeURIComponent","findActivePad","file_format","_this6","use_frame","items","defs","prnt","insertBefore","firstChild","btns_node","btns_prnt","parentNode","btns_next","nextSibling","main","render3D","access3dKind","can3d","Embed","sz2","getSizeFor3d","canvas","renderer","domElement","dataUrl","toDataURL","foreign","clname","svg_frame","frame_node","frame_next","img","insert","reset_tranform","compressSVG","innerHTML","svgToImage","clickPadButton","funcname","closeMenu","getDimension","shown","getClassName","getObjectName","done","prs","clickButton","addPadButton","btn","tooltip","keyname","ToolBar","_buttons","cp","is_online","PadButtonsHandler","frame_painter","sign","getV","getRect","user","DrawOptions","GlobalColors","LocalColors","IgnorePalette","fLogx","fLogy","fLogz","fGridx","fGridy","fTickx","fTicky","draw","matchObjectType","clTPad","HEX_CHARS","split","EXTRA","SHIFT","K","Sha256","is224","blocks","h0","h3","h4","h5","h6","h7","start","bytes","hBytes","finalized","hashed","message","notString","code","index","charCodeAt","lastByteIndex","hash","finalize","j","s0","s1","maj","t1","t2","ab","da","cd","bc","a","b","c","f","g","chromeBugWorkAround","digest","hex","toString","sha256_2","as_hex","HMAC","key","o","kbis","sha256","ko","ki","Uint8Array","LongPollSocket","addr","_raw","_handle","_counter","path","connid","raw","counter","nextRequest","data","url","reqmode","post","getConnArgs","browser","qt5","btoa_func","createHttpRequest","processRequest","u8Arr","str","String","fromCharCode","trim","getResponseHeader","extra_hdr","send","_offset","onerror","onclose","dummy_tmout","onopen","onmessage","close","FileDumpSocket","protocol","httpRequest","getProtocol","parse","nextOperation","wait_for_file","chid","provideData","WebWindowHandle","socket_kind","credits","state","cansend","ackn","send_seq","recv_seq","getUserArgs","field","user_args","setUserArgs","args","setReceiver","invokeReceiver","brdcst","arg2","channels","ks","keys","msg","wait_first_recv","channel","force_queue","msgqueue","ready","reserveQueueItem","markQueueItemDone","_msg","_len","processQueue","_loop_msgqueue","front","master","channelid","timerid","canSend","numsend","getRelCanSend","keepAlive","sendLast","tmout","_delayed","inject","immediate","bind","Array","isArray","resizeWindow","cef3","resizeTo","createChannel","freechannelid","isConnected","getChannelId","setHRef","href","decodeUrl","get","token","getHRef","relative_path","ddd","lastIndexOf","ntry","connect","retry_open","first_time","location","showProgress","replace","WebSocket","next_binary","binchid","next_binary_hash","Blob","reader","FileReader","qitem","onload","event","result","target","readAsArrayBuffer","i0","i1","seq_id","i2","credit","i3","i4","newkey","URL","history","replaceState","sessionStorage","setItem","reload","ArrayBuffer","err","askReload","addReloadKeyHandler","addEventListener","ctrlKey","RCanvasPainter","tooltip_allowed","Tooltip","v7canvas","_submreq","_changed_layout","setLayoutKind","getLayoutKind","origin","main_selector","changeLayout","layout_kind","sidebar2","sidebar","removeChild","html","appendChild","GridDisplay","getGridFrame","resize","toggleProjection","proj_painter","X","Y","showUI5ProjectionArea","layout","drawProjection","drawInSidePanel","canv","sel","testUI5","showMessage","saveCanvasAsFile","sendSaveCommand","closeWebsocket","useWebsocket","websocketTimeout","_tmouts","onWebsocketOpened","onWebsocketClosed","closeCurrentWindow","onWebsocketMsg","p1","resizeBrowser","redrawObject","processDrawableReply","cmdid","cmd","reply","showUI5Panel","conn","cpainter","panel_handle","panel_name","onWebsocketError","hist","that","showSection","_requests","prevreq","_tm","_nextreq","_nextreqid","reqid","_kind","_painter","_method","submitMenuRequest","menukind","menureqid","submitExec","exec","subelem","processChanges","activateGed","hasStatus","hp","getHPainter","hasStatusLine","createStatusLine","showCanvasStatus","msgs","showStatus","hasGed","hasContent","removeGed","ged_view","getController","cleanupGed","destroy","deleteContent","getUi5PanelData","jsroot","core","toJSON","loadScript","EAxisBits","rb","getColorExec","createBrowserBtns","ToolbarIcons","createSVG","diamand","toggleKind","circle","cross","setBrowserContent","setBrowserTitle","toggleBrowserKind","loadOpenui5","sap","ui","require","JSONModel","XMLView","oModel","viewName","viewData","oGed","setModel","placeAt","padEventsReceiver","produceJSON","fullW","fullH","can","nocanvas","normal_canvas","drawRPadSnapshot","ensureRCanvas","_x","_x2","_ensureRCanvas","apply","frame_kind","reject","Error","drawRFrameTitle","fx","fy","fw","ph","title_width","textFont","title_margin","title_height","fText","minwidth","minheight","no_change_x","drawRFont","font","fSrc","p2","base64","fDefault","drawRAxis","drawRFrame","registerMethods","extractRColor","rcolor","getContourIndex","zc","cntr","fContour","mid","l","r","fCustomContour","getContourColor","zindx","getContour","deleteContour","calcColor","entry1","entry2","dist","r1","r2","col1","d3_rgb","col2","createPaletteColors","setFullRange","createContour","nlevels","zminpositive","colzmin","colzmax","logmin","dz","level"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["../node_modules/jsroot/modules/base/RObjectPainter.mjs","../node_modules/jsroot/modules/gpad/RAxisPainter.mjs","../node_modules/jsroot/modules/gpad/RFramePainter.mjs","../node_modules/jsroot/modules/gpad/RPadPainter.mjs","../node_modules/jsroot/modules/base/sha256.mjs","../node_modules/jsroot/modules/webwindow.mjs","../node_modules/jsroot/modules/gpad/RCanvasPainter.mjs"],"sourcesContent":["import { isStr, isFunc, nsREX } from '../core.mjs';\nimport { FontHandler } from './FontHandler.mjs';\nimport { ObjectPainter } from './ObjectPainter.mjs';\n\n\nconst kNormal = 1, /* kLessTraffic = 2, */ kOffline = 3;\n\nclass RObjectPainter extends ObjectPainter {\n\n   constructor(dom, obj, opt, csstype) {\n      super(dom, obj, opt);\n      this.csstype = csstype;\n   }\n\n   /** @summary Evaluate v7 attributes using fAttr storage and configured RStyle */\n   v7EvalAttr(name, dflt) {\n      const obj = this.getObject();\n      if (!obj) return dflt;\n      if (this.cssprefix) name = this.cssprefix + name;\n\n      const type_check = res => {\n         if (dflt === undefined) return res;\n         const typ1 = typeof dflt, typ2 = typeof res;\n         if (typ1 === typ2) return res;\n         if (typ1 === 'boolean') {\n            if (typ2 === 'string') return (res !== '') && (res !== '0') && (res !== 'no') && (res !== 'off');\n            return !!res;\n         }\n         if ((typ1 === 'number') && (typ2 === 'string'))\n            return parseFloat(res);\n         return res;\n      };\n\n      if (obj.fAttr?.m) {\n         const value = obj.fAttr.m[name];\n         if (value) return type_check(value.v); // found value direct in attributes\n      }\n\n      if (this.rstyle?.fBlocks) {\n         const blks = this.rstyle.fBlocks;\n         for (let k = 0; k < blks.length; ++k) {\n            const block = blks[k],\n                  match = (this.csstype && (block.selector === this.csstype)) ||\n                          (obj.fId && (block.selector === ('#' + obj.fId))) ||\n                          (obj.fCssClass && (block.selector === ('.' + obj.fCssClass)));\n\n            if (match && block.map?.m) {\n               const value = block.map.m[name.toLowerCase()];\n               if (value) return type_check(value.v);\n            }\n         }\n      }\n\n      return dflt;\n   }\n\n   /** @summary Set v7 attributes value */\n   v7SetAttr(name, value) {\n      const obj = this.getObject();\n      if (this.cssprefix) name = this.cssprefix + name;\n\n      if (obj?.fAttr?.m)\n         obj.fAttr.m[name] = { v: value };\n   }\n\n   /** @summary Decode pad length from string, return pixel value */\n   v7EvalLength(name, sizepx, dflt) {\n      if (sizepx <= 0) sizepx = 1;\n\n      const value = this.v7EvalAttr(name);\n\n      if (value === undefined)\n         return Math.round(dflt*sizepx);\n\n      if (typeof value === 'number')\n         return Math.round(value*sizepx);\n\n      if (value === null)\n         return 0;\n\n      let norm = 0, px = 0, val = value, operand = 0, pos = 0;\n\n      while (val) {\n         // skip empty spaces\n         while ((pos < val.length) && ((val[pos] === ' ') || (val[pos] === '\\t')))\n            ++pos;\n\n         if (pos >= val.length)\n            break;\n\n         if ((val[pos] === '-') || (val[pos] === '+')) {\n            if (operand) {\n               console.log('Fail to parse RPadLength ' + value);\n               return dflt;\n            }\n            operand = (val[pos] === '-') ? -1 : 1;\n            pos++;\n            continue;\n         }\n\n         if (pos > 0) { val = val.slice(pos); pos = 0; }\n\n         while ((pos < val.length) && (((val[pos] >= '0') && (val[pos] <= '9')) || (val[pos] === '.'))) pos++;\n\n         const v = parseFloat(val.slice(0, pos));\n         if (!Number.isFinite(v)) {\n            console.log(`Fail to parse RPadLength ${value}`);\n            return Math.round(dflt*sizepx);\n         }\n\n         val = val.slice(pos);\n         pos = 0;\n         if (!operand) operand = 1;\n         if (val && (val[0] === '%')) {\n            val = val.slice(1);\n            norm += operand*v*0.01;\n         } else if ((val.length > 1) && (val[0] === 'p') && (val[1] === 'x')) {\n            val = val.slice(2);\n            px += operand*v;\n         } else\n            norm += operand*v;\n\n         operand = 0;\n      }\n\n      return Math.round(norm*sizepx + px);\n   }\n\n   /** @summary Evaluate RColor using attribute storage and configured RStyle */\n   v7EvalColor(name, dflt) {\n      let val = this.v7EvalAttr(name, '');\n      if (!val || !isStr(val)) return dflt;\n\n      if (val === 'auto') {\n         const pp = this.getPadPainter();\n         if (pp?._auto_color_cnt !== undefined) {\n            const pal = pp.getHistPalette(),\n                  cnt = pp._auto_color_cnt++;\n            let num = pp._num_primitives - 1;\n            if (num < 2) num = 2;\n            val = pal ? pal.getColorOrdinal((cnt % num) / num) : 'blue';\n            if (!this._auto_colors) this._auto_colors = {};\n            this._auto_colors[name] = val;\n         } else if (this._auto_colors && this._auto_colors[name])\n            val = this._auto_colors[name];\n         else {\n            console.error(`Autocolor ${name} not defined yet - please check code`);\n            val = '';\n         }\n      } else if (val[0] === '[') {\n         const ordinal = parseFloat(val.slice(1, val.length-1));\n         val = 'black';\n         if (Number.isFinite(ordinal)) {\n             const pal = this.getPadPainter()?.getHistPalette();\n             if (pal) val = pal.getColorOrdinal(ordinal);\n         }\n      }\n      return val;\n   }\n\n   /** @summary Evaluate RAttrText properties\n     * @return {Object} FontHandler, can be used directly for the text drawing */\n   v7EvalFont(name, dflts, fontScale) {\n      if (!dflts)\n         dflts = {};\n      else if (typeof dflts === 'number')\n         dflts = { size: dflts };\n\n      const pp = this.getPadPainter(),\n            rfont = pp?._dfltRFont || { fFamily: 'Arial', fStyle: '', fWeight: '' },\n            text_angle = this.v7EvalAttr(name + '_angle', 0),\n            text_align = this.v7EvalAttr(name + '_align', dflts.align || 'none'),\n            text_color = this.v7EvalColor(name + '_color', dflts.color || 'none'),\n            font_family = this.v7EvalAttr(name + '_font_family', rfont.fFamily || 'Arial'),\n            font_style = this.v7EvalAttr(name + '_font_style', rfont.fStyle || ''),\n            font_weight = this.v7EvalAttr(name + '_font_weight', rfont.fWeight || '');\n       let text_size = this.v7EvalAttr(name + '_size', dflts.size || 12);\n\n       if (isStr(text_size)) text_size = parseFloat(text_size);\n       if (!Number.isFinite(text_size) || (text_size <= 0)) text_size = 12;\n       if (!fontScale) fontScale = pp?.getPadHeight() || 100;\n\n       const handler = new FontHandler(null, text_size, fontScale);\n       handler.setNameStyleWeight(font_family, font_style, font_weight);\n\n       if (text_angle) handler.setAngle(360 - text_angle);\n       if (text_align !== 'none') handler.setAlign(text_align);\n       if (text_color !== 'none') handler.setColor(text_color);\n\n       return handler;\n    }\n\n   /** @summary Create this.fillatt object based on v7 fill attributes */\n   createv7AttFill(prefix) {\n      if (!prefix || !isStr(prefix)) prefix = 'fill_';\n\n      const color = this.v7EvalColor(prefix + 'color', ''),\n            pattern = this.v7EvalAttr(prefix + 'style', 0);\n\n      this.createAttFill({ pattern, color, color_as_svg: true });\n   }\n\n   /** @summary Create this.lineatt object based on v7 line attributes */\n   createv7AttLine(prefix) {\n      if (!prefix || !isStr(prefix)) prefix = 'line_';\n\n      const color = this.v7EvalColor(prefix + 'color', 'black'),\n            width = this.v7EvalAttr(prefix + 'width', 1),\n            style = this.v7EvalAttr(prefix + 'style', 1),\n            pattern = this.v7EvalAttr(prefix + 'pattern');\n\n      this.createAttLine({ color, width, style, pattern });\n\n      if (prefix === 'border_')\n         this.lineatt.setBorder(this.v7EvalAttr(prefix + 'rx', 0), this.v7EvalAttr(prefix + 'ry', 0));\n   }\n\n    /** @summary Create this.markeratt object based on v7 attributes */\n   createv7AttMarker(prefix) {\n      if (!prefix || !isStr(prefix)) prefix = 'marker_';\n\n      const color = this.v7EvalColor(prefix + 'color', 'black'),\n            size = this.v7EvalAttr(prefix + 'size', 0.01),\n            style = this.v7EvalAttr(prefix + 'style', 1),\n            refsize = (size >= 1) ? 1 : (this.getPadPainter()?.getPadHeight() || 100);\n\n      this.createAttMarker({ color, size, style, refsize });\n   }\n\n   /** @summary Create RChangeAttr, which can be applied on the server side\n     * @private */\n   v7AttrChange(req, name, value, kind) {\n      if (!this.snapid)\n         return false;\n\n      if (!req._typename) {\n         req._typename = `${nsREX}RChangeAttrRequest`;\n         req.ids = [];\n         req.names = [];\n         req.values = [];\n         req.update = true;\n      }\n\n      if (this.cssprefix) name = this.cssprefix + name;\n      req.ids.push(this.snapid);\n      req.names.push(name);\n      let obj = null;\n\n      if ((value === null) || (value === undefined)) {\n        if (!kind) kind = 'none';\n        if (kind !== 'none') console.error(`Trying to set ${kind} for none value`);\n      }\n\n      if (!kind) {\n         switch (typeof value) {\n            case 'number': kind = 'double'; break;\n            case 'boolean': kind = 'boolean'; break;\n         }\n      }\n\n      obj = { _typename: `${nsREX}RAttrMap::` };\n      switch (kind) {\n         case 'none': obj._typename += 'NoValue_t'; break;\n         case 'boolean': obj._typename += 'BoolValue_t'; obj.v = !!value; break;\n         case 'int': obj._typename += 'IntValue_t'; obj.v = parseInt(value); break;\n         case 'double': obj._typename += 'DoubleValue_t'; obj.v = parseFloat(value); break;\n         default: obj._typename += 'StringValue_t'; obj.v = isStr(value) ? value : JSON.stringify(value); break;\n      }\n\n      req.values.push(obj);\n      return true;\n   }\n\n   /** @summary Sends accumulated attribute changes to server */\n   v7SendAttrChanges(req, do_update) {\n      const canp = this.getCanvPainter();\n      if (canp && req?._typename) {\n         if (do_update !== undefined)\n            req.update = !!do_update;\n         canp.v7SubmitRequest('', req);\n      }\n   }\n\n   /** @summary Submit request to server-side drawable\n    * @param kind defines request kind, only single request a time can be submitted\n    * @param req is object derived from DrawableRequest, including correct _typename\n    * @param method is method of painter object which will be called when getting reply */\n   v7SubmitRequest(kind, req, method) {\n      const canp = this.getCanvPainter();\n      if (!isFunc(canp?.submitDrawableRequest)) return null;\n\n      // special situation when snapid not yet assigned - just keep ref until snapid is there\n      // maybe keep full list - for now not clear if really needed\n      if (!this.snapid) {\n         this._pending_request = { kind, req, method };\n         return req;\n      }\n\n      return canp.submitDrawableRequest(kind, req, this, method);\n   }\n\n   /** @summary Assign snapid to the painter\n     * @desc Overwrite default method */\n   assignSnapId(id) {\n      this.snapid = id;\n      if (this.snapid && this._pending_request) {\n         const p = this._pending_request;\n         this.v7SubmitRequest(p.kind, p.req, p.method);\n         delete this._pending_request;\n      }\n   }\n\n   /** @summary Return communication mode with the server\n     * @desc\n     * kOffline means no server there,\n     * kLessTraffic advise not to send commands if offline functionality available\n     * kNormal is standard functionality with RCanvas on server side */\n   v7CommMode() {\n      const canp = this.getCanvPainter();\n      if (!canp || !canp.submitDrawableRequest || !canp._websocket)\n         return kOffline;\n\n      return kNormal;\n   }\n\n   v7NormalMode() { return this.v7CommMode() === kNormal; }\n\n   v7OfflineMode() { return this.v7CommMode() === kOffline; }\n\n} // class RObjectPainter\n\nexport { RObjectPainter };\n","import { settings, isFunc } from '../core.mjs';\nimport { select as d3_select, pointer as d3_pointer,\n         drag as d3_drag, timeFormat as d3_timeFormat,\n         scaleTime as d3_scaleTime, scaleSymlog as d3_scaleSymlog,\n         scaleLog as d3_scaleLog, scaleLinear as d3_scaleLinear } from '../d3.mjs';\nimport { makeTranslate, addHighlightStyle } from '../base/BasePainter.mjs';\nimport { AxisPainterMethods, chooseTimeFormat } from './TAxisPainter.mjs';\nimport { createMenu } from '../gui/menu.mjs';\nimport { addDragHandler } from './TFramePainter.mjs';\nimport { RObjectPainter } from '../base/RObjectPainter.mjs';\n\n\n/**\n * @summary Axis painter for v7\n *\n * @private\n */\n\nclass RAxisPainter extends RObjectPainter {\n\n   /** @summary constructor */\n   constructor(dom, arg1, axis, cssprefix) {\n      const drawable = cssprefix ? arg1.getObject() : arg1;\n      super(dom, drawable, '', cssprefix ? arg1.csstype : 'axis');\n      Object.assign(this, AxisPainterMethods);\n      this.initAxisPainter();\n\n      this.axis = axis;\n      if (cssprefix) { // drawing from the frame\n         this.embedded = true; // indicate that painter embedded into the histo painter\n         // this.csstype = arg1.csstype; // for the moment only via frame one can set axis attributes\n         this.cssprefix = cssprefix;\n         this.rstyle = arg1.rstyle;\n      } else {\n         // this.csstype = 'axis';\n         this.cssprefix = 'axis_';\n      }\n   }\n\n   /** @summary cleanup painter */\n   cleanup() {\n      delete this.axis;\n      delete this.axis_g;\n      this.cleanupAxisPainter();\n      super.cleanup();\n   }\n\n   /** @summary Use in GED to identify kind of axis */\n   getAxisType() { return 'RAttrAxis'; }\n\n   /** @summary Configure only base parameters, later same handle will be used for drawing  */\n   configureZAxis(name, fp) {\n      this.name = name;\n      this.kind = 'normal';\n      this.log = false;\n      const _log = this.v7EvalAttr('log', 0);\n      if (_log) {\n         this.log = true;\n         this.logbase = 10;\n         if (Math.abs(_log - Math.exp(1)) < 0.1)\n            this.logbase = Math.exp(1);\n         else if (_log > 1.9)\n            this.logbase = Math.round(_log);\n      }\n      fp.logz = this.log;\n   }\n\n   /** @summary Configure axis painter\n     * @desc Axis can be drawn inside frame <g> group with offset to 0 point for the frame\n     * Therefore one should distinguish when caclulated coordinates used for axis drawing itself or for calculation of frame coordinates\n     * @private */\n   configureAxis(name, min, max, smin, smax, vertical, frame_range, axis_range, opts) {\n      if (!opts) opts = {};\n      this.name = name;\n      this.full_min = min;\n      this.full_max = max;\n      this.kind = 'normal';\n      this.vertical = vertical;\n      this.log = false;\n      const _log = this.v7EvalAttr('log', 0),\n          _symlog = this.v7EvalAttr('symlog', 0);\n      this.reverse = opts.reverse || false;\n\n      if (this.v7EvalAttr('time')) {\n         this.kind = 'time';\n         this.timeoffset = 0;\n         let toffset = this.v7EvalAttr('timeOffset');\n         if (toffset !== undefined) {\n            toffset = parseFloat(toffset);\n            if (Number.isFinite(toffset)) this.timeoffset = toffset*1000;\n         }\n      } else if (this.axis?.fLabelsIndex) {\n         this.kind = 'labels';\n         delete this.own_labels;\n      } else if (opts.labels)\n         this.kind = 'labels';\n       else\n         this.kind = 'normal';\n\n\n      if (this.kind === 'time')\n         this.func = d3_scaleTime().domain([this.convertDate(smin), this.convertDate(smax)]);\n       else if (_symlog && (_symlog > 0)) {\n         this.symlog = _symlog;\n         this.func = d3_scaleSymlog().constant(_symlog).domain([smin, smax]);\n      } else if (_log) {\n         if (smax <= 0) smax = 1;\n         if ((smin <= 0) || (smin >= smax))\n            smin = smax * 0.0001;\n         this.log = true;\n         this.logbase = 10;\n         if (Math.abs(_log - Math.exp(1)) < 0.1)\n            this.logbase = Math.exp(1);\n         else if (_log > 1.9)\n            this.logbase = Math.round(_log);\n         this.func = d3_scaleLog().base(this.logbase).domain([smin, smax]);\n      } else\n         this.func = d3_scaleLinear().domain([smin, smax]);\n\n      this.scale_min = smin;\n      this.scale_max = smax;\n\n      this.gr_range = axis_range || 1000; // when not specified, one can ignore it\n\n      const range = frame_range ?? [0, this.gr_range];\n\n      this.axis_shift = range[1] - this.gr_range;\n\n      if (this.reverse)\n         this.func.range([range[1], range[0]]);\n      else\n         this.func.range(range);\n\n      if (this.kind === 'time')\n         this.gr = val => this.func(this.convertDate(val));\n      else if (this.log)\n         this.gr = val => (val < this.scale_min) ? (this.vertical ? this.func.range()[0]+5 : -5) : this.func(val);\n      else\n         this.gr = this.func;\n\n      delete this.format;// remove formatting func\n\n      const ndiv = this.v7EvalAttr('ndiv', 508);\n\n      this.nticks = ndiv % 100;\n      this.nticks2 = (ndiv % 10000 - this.nticks) / 100;\n      this.nticks3 = Math.floor(ndiv/10000);\n\n      if (this.nticks > 20) this.nticks = 20;\n\n      const gr_range = Math.abs(this.gr_range) || 100;\n\n      if (this.kind === 'time') {\n         if (this.nticks > 8) this.nticks = 8;\n\n         const scale_range = this.scale_max - this.scale_min,\n               tf2 = chooseTimeFormat(scale_range / gr_range, false);\n         let tf1 = this.v7EvalAttr('timeFormat', '');\n\n         if (!tf1 || (scale_range < 0.1 * (this.full_max - this.full_min)))\n            tf1 = chooseTimeFormat(scale_range / this.nticks, true);\n\n         this.tfunc1 = this.tfunc2 = d3_timeFormat(tf1);\n         if (tf2 !== tf1)\n            this.tfunc2 = d3_timeFormat(tf2);\n\n         this.format = this.formatTime;\n      } else if (this.log) {\n         if (this.nticks2 > 1) {\n            this.nticks *= this.nticks2; // all log ticks (major or minor) created centrally\n            this.nticks2 = 1;\n         }\n         this.noexp = this.v7EvalAttr('noexp', false);\n         if ((this.scale_max < 300) && (this.scale_min > 0.3) && (this.logbase === 10)) this.noexp = true;\n         this.moreloglabels = this.v7EvalAttr('moreloglbls', false);\n\n         this.format = this.formatLog;\n      } else if (this.kind === 'labels') {\n         this.nticks = 50; // for text output allow max 50 names\n         const scale_range = this.scale_max - this.scale_min;\n         if (this.nticks > scale_range)\n            this.nticks = Math.round(scale_range);\n         this.nticks2 = 1;\n\n         this.format = this.formatLabels;\n      } else {\n         this.order = 0;\n         this.ndig = 0;\n         this.format = this.formatNormal;\n      }\n   }\n\n   /** @summary Return scale min */\n   getScaleMin() {\n      return this.func ? this.func.domain()[0] : 0;\n   }\n\n   /** @summary Return scale max */\n   getScaleMax() {\n      return this.func ? this.func.domain()[1] : 0;\n   }\n\n   /** @summary Provide label for axis value */\n   formatLabels(d) {\n      const indx = Math.round(d);\n      if (this.axis?.fLabelsIndex) {\n         if ((indx < 0) || (indx >= this.axis.fNBinsNoOver)) return null;\n         for (let i = 0; i < this.axis.fLabelsIndex.length; ++i) {\n            const pair = this.axis.fLabelsIndex[i];\n            if (pair.second === indx) return pair.first;\n         }\n      } else {\n         const labels = this.getObject().fLabels;\n         if (labels && (indx >= 0) && (indx < labels.length))\n            return labels[indx];\n      }\n      return null;\n   }\n\n   /** @summary Creates array with minor/middle/major ticks */\n   createTicks(only_major_as_array, optionNoexp, optionNoopt, optionInt) {\n      if (optionNoopt && this.nticks && (this.kind === 'normal')) this.noticksopt = true;\n\n      const handle = { nminor: 0, nmiddle: 0, nmajor: 0, func: this.func };\n\n      handle.minor = handle.middle = handle.major = this.produceTicks(this.nticks);\n\n      if (only_major_as_array) {\n         const res = handle.major, delta = (this.scale_max - this.scale_min)*1e-5;\n         if (res[0] > this.scale_min + delta) res.unshift(this.scale_min);\n         if (res[res.length-1] < this.scale_max - delta) res.push(this.scale_max);\n         return res;\n      }\n\n      if ((this.nticks2 > 1) && (!this.log || (this.logbase === 10))) {\n         handle.minor = handle.middle = this.produceTicks(handle.major.length, this.nticks2);\n\n         const gr_range = Math.abs(this.func.range()[1] - this.func.range()[0]);\n\n         // avoid black filling by middle-size\n         if ((handle.middle.length <= handle.major.length) || (handle.middle.length > gr_range/3.5))\n            handle.minor = handle.middle = handle.major;\n          else if ((this.nticks3 > 1) && !this.log) {\n            handle.minor = this.produceTicks(handle.middle.length, this.nticks3);\n            if ((handle.minor.length <= handle.middle.length) || (handle.minor.length > gr_range/1.7)) handle.minor = handle.middle;\n         }\n      }\n\n      handle.reset = function() {\n         this.nminor = this.nmiddle = this.nmajor = 0;\n      };\n\n      handle.next = function(doround) {\n         if (this.nminor >= this.minor.length) return false;\n\n         this.tick = this.minor[this.nminor++];\n         this.grpos = this.func(this.tick);\n         if (doround) this.grpos = Math.round(this.grpos);\n         this.kind = 3;\n\n         if ((this.nmiddle < this.middle.length) && (Math.abs(this.grpos - this.func(this.middle[this.nmiddle])) < 1)) {\n            this.nmiddle++;\n            this.kind = 2;\n         }\n\n         if ((this.nmajor < this.major.length) && (Math.abs(this.grpos - this.func(this.major[this.nmajor])) < 1)) {\n            this.nmajor++;\n            this.kind = 1;\n         }\n         return true;\n      };\n\n      handle.last_major = function() {\n         return (this.kind !== 1) ? false : this.nmajor === this.major.length;\n      };\n\n      handle.next_major_grpos = function() {\n         if (this.nmajor >= this.major.length) return null;\n         return this.func(this.major[this.nmajor]);\n      };\n\n      handle.get_modifier = function() { return null; };\n\n      this.order = 0;\n      this.ndig = 0;\n\n      // at the moment when drawing labels, we can try to find most optimal text representation for them\n\n      if ((this.kind === 'normal') && !this.log && (handle.major.length > 0)) {\n         let maxorder = 0, minorder = 0, exclorder3 = false;\n\n         if (!optionNoexp) {\n            const maxtick = Math.max(Math.abs(handle.major[0]), Math.abs(handle.major[handle.major.length-1])),\n                mintick = Math.min(Math.abs(handle.major[0]), Math.abs(handle.major[handle.major.length-1])),\n                ord1 = (maxtick > 0) ? Math.round(Math.log10(maxtick)/3)*3 : 0,\n                ord2 = (mintick > 0) ? Math.round(Math.log10(mintick)/3)*3 : 0;\n\n             exclorder3 = (maxtick < 2e4); // do not show 10^3 for values below 20000\n\n             if (maxtick || mintick) {\n                maxorder = Math.max(ord1, ord2) + 3;\n                minorder = Math.min(ord1, ord2) - 3;\n             }\n         }\n\n         // now try to find best combination of order and ndig for labels\n\n         let bestorder = 0, bestndig = this.ndig, bestlen = 1e10;\n\n         for (let order = minorder; order <= maxorder; order+=3) {\n            if (exclorder3 && (order===3)) continue;\n            this.order = order;\n            this.ndig = 0;\n            let lbls = [], indx = 0, totallen = 0;\n            while (indx<handle.major.length) {\n               const lbl = this.format(handle.major[indx], true);\n               if (lbls.indexOf(lbl) < 0) {\n                  lbls.push(lbl);\n                  totallen += lbl.length;\n                  indx++;\n                  continue;\n               }\n               if (++this.ndig > 11) break; // not too many digits, anyway it will be exponential\n               lbls = []; indx = 0; totallen = 0;\n            }\n\n            // for order === 0 we should virually remove '0.' and extra label on top\n            if (!order && (this.ndig < 4))\n               totallen -= (handle.major.length * 2 + 3);\n\n            if (totallen < bestlen) {\n               bestlen = totallen;\n               bestorder = this.order;\n               bestndig = this.ndig;\n            }\n         }\n\n         this.order = bestorder;\n         this.ndig = bestndig;\n\n         if (optionInt) {\n            if (this.order) console.warn(`Axis painter - integer labels are configured, but axis order ${this.order} is preferable`);\n            if (this.ndig) console.warn(`Axis painter - integer labels are configured, but ${this.ndig} decimal digits are required`);\n            this.ndig = 0;\n            this.order = 0;\n         }\n      }\n\n      return handle;\n   }\n\n   /** @summary Is labels should be centered */\n   isCenteredLabels() {\n      if (this.kind === 'labels') return true;\n      if (this.kind === 'log') return false;\n      return this.v7EvalAttr('labels_center', false);\n   }\n\n   /** @summary Used to move axis labels instead of zooming\n     * @private */\n   processLabelsMove(arg, pos) {\n      if (this.optionUnlab || !this.axis_g) return false;\n\n      const label_g = this.axis_g.select('.axis_labels');\n      if (!label_g || (label_g.size() !== 1)) return false;\n\n      if (arg === 'start') {\n         // no moving without labels\n         const box = label_g.node().getBBox();\n\n         label_g.append('rect')\n                 .classed('drag', true)\n                 .attr('x', box.x)\n                 .attr('y', box.y)\n                 .attr('width', box.width)\n                 .attr('height', box.height)\n                 .style('cursor', 'move')\n                 .call(addHighlightStyle, true);\n         if (this.vertical)\n            this.drag_pos0 = pos[0];\n          else\n            this.drag_pos0 = pos[1];\n\n\n         return true;\n      }\n\n      let offset = label_g.property('fix_offset');\n\n      if (this.vertical) {\n         offset += Math.round(pos[0] - this.drag_pos0);\n         label_g.attr('transform', `translate(${offset})`);\n      } else {\n         offset += Math.round(pos[1] - this.drag_pos0);\n         label_g.attr('transform', `translate(0,${offset})`);\n      }\n      if (!offset) label_g.attr('transform', null);\n\n      if (arg === 'stop') {\n         label_g.select('rect.drag').remove();\n         delete this.drag_pos0;\n         if (offset !== label_g.property('fix_offset')) {\n            label_g.property('fix_offset', offset);\n            const side = label_g.property('side') || 1;\n            this.labelsOffset = offset / (this.vertical ? -side : side);\n            this.changeAxisAttr(1, 'labels_offset', this.labelsOffset / this.scalingSize);\n         }\n      }\n\n      return true;\n   }\n\n   /** @summary Add interactive elements to draw axes title */\n   addTitleDrag(title_g, side) {\n      if (!settings.MoveResize || this.isBatchMode()) return;\n\n      let drag_rect = null,\n          acc_x, acc_y, new_x, new_y, alt_pos, curr_indx;\n\n      const drag_move = d3_drag().subject(Object);\n\n      drag_move\n         .on('start', evnt => {\n            evnt.sourceEvent.preventDefault();\n            evnt.sourceEvent.stopPropagation();\n\n            const box = title_g.node().getBBox(), // check that elements visible, request precise value\n                title_length = this.vertical ? box.height : box.width;\n\n            new_x = acc_x = title_g.property('shift_x');\n            new_y = acc_y = title_g.property('shift_y');\n\n            if (this.titlePos === 'center')\n               curr_indx = 1;\n            else\n               curr_indx = (this.titlePos === 'left') ? 0 : 2;\n\n            // let d = ((this.gr_range > 0) && this.vertical) ? title_length : 0;\n            alt_pos = [0, this.gr_range/2, this.gr_range]; // possible positions\n            const off = this.vertical ? -title_length : title_length,\n                swap = this.isReverseAxis() ? 2 : 0;\n            if (this.title_align === 'middle') {\n               alt_pos[swap] += off/2;\n               alt_pos[2-swap] -= off/2;\n            } else if ((this.title_align === 'begin') ^ this.isTitleRotated()) {\n               alt_pos[1] -= off/2;\n               alt_pos[2-swap] -= off;\n            } else { // end\n               alt_pos[swap] += off;\n               alt_pos[1] += off/2;\n            }\n\n            alt_pos[curr_indx] = this.vertical ? acc_y : acc_x;\n\n            drag_rect = title_g.append('rect')\n                 .attr('x', box.x)\n                 .attr('y', box.y)\n                 .attr('width', box.width)\n                 .attr('height', box.height)\n                 .style('cursor', 'move')\n                 .call(addHighlightStyle, true);\n              // .style('pointer-events','none'); // let forward double click to underlying elements\n          }).on('drag', evnt => {\n               if (!drag_rect) return;\n\n               evnt.sourceEvent.preventDefault();\n               evnt.sourceEvent.stopPropagation();\n\n               acc_x += evnt.dx;\n               acc_y += evnt.dy;\n\n               const p = this.vertical ? acc_y : acc_x;\n               let set_x, set_y, besti = 0;\n\n               for (let i = 1; i < 3; ++i)\n                  if (Math.abs(p - alt_pos[i]) < Math.abs(p - alt_pos[besti])) besti = i;\n\n               if (this.vertical) {\n                  set_x = acc_x;\n                  set_y = alt_pos[besti];\n               } else {\n                  set_x = alt_pos[besti];\n                  set_y = acc_y;\n               }\n\n               new_x = set_x; new_y = set_y; curr_indx = besti;\n               makeTranslate(title_g, new_x, new_y);\n          }).on('end', evnt => {\n               if (!drag_rect) return;\n\n               evnt.sourceEvent.preventDefault();\n               evnt.sourceEvent.stopPropagation();\n\n               const basepos = title_g.property('basepos') || 0;\n\n               title_g.property('shift_x', new_x)\n                      .property('shift_y', new_y);\n\n               this.titleOffset = (this.vertical ? basepos - new_x : new_y - basepos) * side;\n\n               if (curr_indx === 1)\n                  this.titlePos = 'center';\n                else if (curr_indx === 0)\n                  this.titlePos = 'left';\n                else\n                  this.titlePos = 'right';\n\n               this.changeAxisAttr(0, 'title_position', this.titlePos, 'title_offset', this.titleOffset / this.scalingSize);\n\n               drag_rect.remove();\n               drag_rect = null;\n            });\n\n      title_g.style('cursor', 'move').call(drag_move);\n   }\n\n   /** @summary checks if value inside graphical range, taking into account delta */\n   isInsideGrRange(pos, delta1, delta2) {\n      if (!delta1) delta1 = 0;\n      if (delta2 === undefined) delta2 = delta1;\n      if (this.gr_range < 0)\n         return (pos >= this.gr_range - delta2) && (pos <= delta1);\n      return (pos >= -delta1) && (pos <= this.gr_range + delta2);\n   }\n\n   /** @summary returns graphical range */\n   getGrRange(delta) {\n      if (!delta) delta = 0;\n      if (this.gr_range < 0)\n         return this.gr_range - delta;\n      return this.gr_range + delta;\n   }\n\n   /** @summary If axis direction is negative coordinates direction */\n   isReverseAxis() {\n      return !this.vertical !== (this.getGrRange() > 0);\n   }\n\n   /** @summary Draw axis ticks\n     * @private */\n   drawMainLine(axis_g) {\n      let ending = '';\n\n      if (this.endingSize && this.endingStyle) {\n         let sz = (this.gr_range > 0) ? -this.endingSize : this.endingSize;\n         const sz7 = Math.round(sz*0.7);\n         sz = Math.round(sz);\n         if (this.vertical)\n            ending = `l${sz7},${sz}M0,${this.gr_range}l${-sz7},${sz}`;\n         else\n            ending = `l${sz},${sz7}M${this.gr_range},0l${sz},${-sz7}`;\n      }\n\n      axis_g.append('svg:path')\n            .attr('d', 'M0,0' + (this.vertical ? 'v' : 'h') + this.gr_range + ending)\n            .call(this.lineatt.func)\n            .style('fill', ending ? 'none' : null);\n   }\n\n   /** @summary Draw axis ticks\n     * @return {Object} with gaps on left and right side\n     * @private */\n   drawTicks(axis_g, side, main_draw) {\n      if (main_draw) this.ticks = [];\n\n      this.handle.reset();\n\n      let res = '', ticks_plusminus = 0;\n      if (this.ticksSide === 'both') {\n         side = 1;\n         ticks_plusminus = 1;\n      }\n\n      while (this.handle.next(true)) {\n         let h1 = Math.round(this.ticksSize/4), h2 = 0;\n\n         if (this.handle.kind < 3)\n            h1 = Math.round(this.ticksSize/2);\n\n         const grpos = this.handle.grpos - this.axis_shift;\n\n         if ((this.startingSize || this.endingSize) && !this.isInsideGrRange(grpos, -Math.abs(this.startingSize), -Math.abs(this.endingSize))) continue;\n\n         if (this.handle.kind === 1) {\n            // if not showing labels, not show large tick\n            if ((this.kind === 'labels') || (this.format(this.handle.tick, true) !== null)) h1 = this.ticksSize;\n\n            if (main_draw) this.ticks.push(grpos); // keep graphical positions of major ticks\n         }\n\n         if (ticks_plusminus > 0)\n            h2 = -h1;\n         else if (side < 0) {\n            h2 = -h1; h1 = 0;\n         } else\n            h2 = 0;\n\n         res += this.vertical ? `M${h1},${grpos}H${h2}` : `M${grpos},${-h1}V${-h2}`;\n      }\n\n      if (res) {\n         axis_g.append('svg:path')\n               .attr('d', res)\n               .style('stroke', this.ticksColor || this.lineatt.color)\n               .style('stroke-width', !this.ticksWidth || (this.ticksWidth === 1) ? null : this.ticksWidth);\n       }\n\n       const gap0 = Math.round(0.25*this.ticksSize), gap = Math.round(1.25*this.ticksSize);\n       return { '-1': (side > 0) || ticks_plusminus ? gap : gap0,\n                  1: (side < 0) || ticks_plusminus ? gap : gap0 };\n   }\n\n   /** @summary Performs labels drawing\n     * @return {Promise} with gaps in both direction */\n   async drawLabels(axis_g, side, gaps) {\n      const center_lbls = this.isCenteredLabels(),\n            rotate_lbls = this.labelsFont.angle !== 0,\n            label_g = axis_g.append('svg:g').attr('class', 'axis_labels').property('side', side),\n            lbl_pos = this.handle.lbl_pos || this.handle.major;\n      let textscale = 1, maxtextlen = 0, lbls_tilt = false,\n          max_lbl_width = 0, max_lbl_height = 0;\n\n      // function called when text is drawn to analyze width, required to correctly scale all labels\n      function process_drawtext_ready(painter) {\n         max_lbl_width = Math.max(max_lbl_width, this.result_width);\n         max_lbl_height = Math.max(max_lbl_height, this.result_height);\n\n         const textwidth = this.result_width;\n\n         if (textwidth && ((!painter.vertical && !rotate_lbls) || (painter.vertical && rotate_lbls)) && !painter.log) {\n            let maxwidth = this.gap_before*0.45 + this.gap_after*0.45;\n            if (!this.gap_before) maxwidth = 0.9*this.gap_after; else\n            if (!this.gap_after) maxwidth = 0.9*this.gap_before;\n            textscale = Math.min(textscale, maxwidth / textwidth);\n         }\n\n         if ((textscale > 0.0001) && (textscale < 0.8) && !painter.vertical && !rotate_lbls && (maxtextlen > 5) && (side > 0))\n            lbls_tilt = true;\n\n         const scale = textscale * (lbls_tilt ? 3 : 1);\n         if ((scale > 0.0001) && (scale < 1))\n            painter.scaleTextDrawing(1/scale, label_g);\n      }\n\n      const fix_offset = Math.round((this.vertical ? -side : side) * this.labelsOffset),\n            fix_coord = Math.round((this.vertical ? -side : side) * gaps[side]);\n      let lastpos = 0;\n\n      if (fix_offset)\n         label_g.attr('transform', this.vertical ? `translate(${fix_offset})` : `translate(0,${fix_offset})`);\n\n      label_g.property('fix_offset', fix_offset);\n\n      this.startTextDrawing(this.labelsFont, 'font', label_g);\n\n      for (let nmajor = 0; nmajor < lbl_pos.length; ++nmajor) {\n         const lbl = this.format(lbl_pos[nmajor], true);\n         if (lbl === null) continue;\n\n         const arg = { text: lbl, latex: 1, draw_g: label_g };\n         let pos = Math.round(this.func(lbl_pos[nmajor]));\n\n         arg.gap_before = (nmajor > 0) ? Math.abs(Math.round(pos - this.func(lbl_pos[nmajor-1]))) : 0;\n         arg.gap_after = (nmajor < lbl_pos.length-1) ? Math.abs(Math.round(this.func(lbl_pos[nmajor+1])-pos)) : 0;\n\n         if (center_lbls) {\n            const gap = arg.gap_after || arg.gap_before;\n            pos = Math.round(pos - (this.vertical ? 0.5*gap : -0.5*gap));\n            if (!this.isInsideGrRange(pos, 5)) continue;\n         }\n\n         maxtextlen = Math.max(maxtextlen, lbl.length);\n\n         pos -= this.axis_shift;\n\n         if ((this.startingSize || this.endingSize) && !this.isInsideGrRange(pos, -Math.abs(this.startingSize), -Math.abs(this.endingSize))) continue;\n\n         if (this.vertical) {\n            arg.x = fix_coord;\n            arg.y = pos;\n            arg.align = rotate_lbls ? ((side < 0) ? 23 : 20) : ((side < 0) ? 12 : 32);\n         } else {\n            arg.x = pos;\n            arg.y = fix_coord;\n            arg.align = rotate_lbls ? ((side < 0) ? 12 : 32) : ((side < 0) ? 20 : 23);\n            if (this.log && !this.noexp && !this.vertical && arg.align === 23) {\n               arg.align = 21;\n               arg.y += this.labelsFont.size;\n            }\n         }\n\n         arg.post_process = process_drawtext_ready;\n\n         this.drawText(arg);\n\n         if (lastpos && (pos !== lastpos) && ((this.vertical && !rotate_lbls) || (!this.vertical && rotate_lbls))) {\n            const axis_step = Math.abs(pos-lastpos);\n            textscale = Math.min(textscale, 0.9*axis_step/this.labelsFont.size);\n         }\n\n         lastpos = pos;\n      }\n\n      if (this.order) {\n         this.drawText({ x: this.vertical ? side*5 : this.getGrRange(5),\n                         y: this.has_obstacle ? fix_coord : (this.vertical ? this.getGrRange(3) : -3*side),\n                         align: this.vertical ? ((side < 0) ? 30 : 10) : ((this.has_obstacle ^ (side < 0)) ? 13 : 10),\n                         latex: 1,\n                         text: '#times' + this.formatExp(10, this.order),\n                         draw_g: label_g });\n      }\n\n      return this.finishTextDrawing(label_g).then(() => {\n        if (lbls_tilt) {\n           label_g.selectAll('text').each(function() {\n               const txt = d3_select(this), tr = txt.attr('transform');\n               txt.attr('transform', tr + ' rotate(25)').style('text-anchor', 'start');\n           });\n         }\n\n         if (this.vertical)\n            gaps[side] += Math.round(rotate_lbls ? 1.2*max_lbl_height : max_lbl_width + 0.4*this.labelsFont.size) - side*fix_offset;\n         else {\n            const tilt_height = lbls_tilt ? max_lbl_width * Math.sin(25/180*Math.PI) + max_lbl_height * (Math.cos(25/180*Math.PI) + 0.2) : 0;\n\n            gaps[side] += Math.round(Math.max(rotate_lbls ? max_lbl_width + 0.4*this.labelsFont.size : 1.2*max_lbl_height, 1.2*this.labelsFont.size, tilt_height)) + fix_offset;\n         }\n\n         return gaps;\n      });\n   }\n\n   /** @summary Add zomming rect to axis drawing */\n   addZoomingRect(axis_g, side, lgaps) {\n      if (settings.Zooming && !this.disable_zooming && !this.isBatchMode()) {\n         const sz = Math.max(lgaps[side], 10),\n               d = this.vertical ? `v${this.gr_range}h${-side*sz}v${-this.gr_range}` : `h${this.gr_range}v${side*sz}h${-this.gr_range}`;\n         axis_g.append('svg:path')\n               .attr('d', `M0,0${d}z`)\n               .attr('class', 'axis_zoom')\n               .style('opacity', '0')\n               .style('cursor', 'crosshair');\n      }\n   }\n\n   /** @summary Returns true if axis title is rotated */\n   isTitleRotated() {\n      return this.titleFont && (this.titleFont.angle !== (this.vertical ? 270 : 0));\n   }\n\n   /** @summary Draw axis title */\n   async drawTitle(axis_g, side, lgaps) {\n      if (!this.fTitle)\n         return this;\n\n      const title_g = axis_g.append('svg:g').attr('class', 'axis_title'),\n            rotated = this.isTitleRotated();\n      let title_shift_x = 0, title_shift_y = 0, title_basepos = 0;\n\n      this.startTextDrawing(this.titleFont, 'font', title_g);\n\n      this.title_align = this.titleCenter ? 'middle' : (this.titleOpposite ^ (this.isReverseAxis() || rotated) ? 'begin' : 'end');\n\n      if (this.vertical) {\n         title_basepos = Math.round(-side*(lgaps[side]));\n         title_shift_x = title_basepos + Math.round(-side*this.titleOffset);\n         title_shift_y = Math.round(this.titleCenter ? this.gr_range/2 : (this.titleOpposite ? 0 : this.gr_range));\n         this.drawText({ align: [this.title_align, ((side < 0) ^ rotated ? 'top' : 'bottom')],\n                         text: this.fTitle, draw_g: title_g });\n      } else {\n         title_shift_x = Math.round(this.titleCenter ? this.gr_range/2 : (this.titleOpposite ? 0 : this.gr_range));\n         title_basepos = Math.round(side*lgaps[side]);\n         title_shift_y = title_basepos + Math.round(side*this.titleOffset);\n         this.drawText({ align: [this.title_align, ((side > 0) ^ rotated ? 'top' : 'bottom')],\n                         text: this.fTitle, draw_g: title_g });\n      }\n\n      makeTranslate(title_g, title_shift_x, title_shift_y)\n                   .property('basepos', title_basepos)\n                   .property('shift_x', title_shift_x)\n                   .property('shift_y', title_shift_y);\n\n      this.addTitleDrag(title_g, side);\n\n      return this.finishTextDrawing(title_g);\n   }\n\n   /** @summary Extract major draw attributes, which are also used in interactive operations\n     * @private  */\n   extractDrawAttributes(scalingSize) {\n      const pp = this.getPadPainter(),\n          rect = pp?.getPadRect() || { width: 10, height: 10 };\n\n      this.scalingSize = scalingSize || (this.vertical ? rect.width : rect.height);\n\n      this.createv7AttLine('line_');\n\n      this.optionUnlab = this.v7EvalAttr('labels_hide', false);\n\n      this.endingStyle = this.v7EvalAttr('ending_style', '');\n      this.endingSize = Math.round(this.v7EvalLength('ending_size', this.scalingSize, this.endingStyle ? 0.02 : 0));\n      this.startingSize = Math.round(this.v7EvalLength('starting_size', this.scalingSize, 0));\n      this.ticksSize = this.v7EvalLength('ticks_size', this.scalingSize, 0.02);\n      this.ticksSide = this.v7EvalAttr('ticks_side', 'normal');\n      this.ticksColor = this.v7EvalColor('ticks_color', '');\n      this.ticksWidth = this.v7EvalAttr('ticks_width', 1);\n      if (scalingSize && (this.ticksSize < 0))\n         this.ticksSize = -this.ticksSize;\n\n      this.fTitle = this.v7EvalAttr('title_value', '');\n\n      if (this.fTitle) {\n         this.titleFont = this.v7EvalFont('title', { size: 0.03 }, scalingSize || pp?.getPadHeight() || 10);\n         this.titleFont.roundAngle(180, this.vertical ? 270 : 0);\n\n         this.titleOffset = this.v7EvalLength('title_offset', this.scalingSize, 0);\n         this.titlePos = this.v7EvalAttr('title_position', 'right');\n         this.titleCenter = (this.titlePos === 'center');\n         this.titleOpposite = (this.titlePos === 'left');\n      } else {\n         delete this.titleFont;\n         delete this.titleOffset;\n         delete this.titlePos;\n      }\n\n      // TODO: remove old scaling factors for labels and ticks\n      this.labelsFont = this.v7EvalFont('labels', { size: scalingSize ? 0.05 : 0.03 });\n      this.labelsFont.roundAngle(180);\n      if (this.labelsFont.angle) this.labelsFont.angle = 270;\n      this.labelsOffset = this.v7EvalLength('labels_offset', this.scalingSize, 0);\n\n      if (scalingSize) this.ticksSize = this.labelsFont.size*0.5; // old lego scaling factor\n\n      if (this.maxTickSize && (this.ticksSize > this.maxTickSize))\n         this.ticksSize = this.maxTickSize;\n   }\n\n   /** @summary Performs axis drawing\n     * @return {Promise} which resolved when drawing is completed */\n   async drawAxis(layer, transform, side) {\n      let axis_g = layer;\n\n      if (side === undefined) side = 1;\n\n      if (!this.standalone) {\n         axis_g = layer.selectChild(`.${this.name}_container`);\n         if (axis_g.empty())\n            axis_g = layer.append('svg:g').attr('class', `${this.name}_container`);\n         else\n            axis_g.selectAll('*').remove();\n      }\n\n      axis_g.attr('transform', transform);\n\n      this.extractDrawAttributes();\n      this.axis_g = axis_g;\n      this.side = side;\n\n      if (this.ticksSide === 'invert') side = -side;\n\n      if (this.standalone)\n         this.drawMainLine(axis_g);\n\n      const optionNoopt = false,  // no ticks position optimization\n            optionInt = false,    // integer labels\n            optionNoexp = false;  // do not create exp\n\n      this.handle = this.createTicks(false, optionNoexp, optionNoopt, optionInt);\n\n      // first draw ticks\n      const tgaps = this.drawTicks(axis_g, side, true),\n             // draw labels\n            labelsPromise = this.optionUnlab ? Promise.resolve(tgaps) : this.drawLabels(axis_g, side, tgaps);\n\n      return labelsPromise.then(lgaps => {\n         // when drawing axis on frame, zoom rect should be always outside\n         this.addZoomingRect(axis_g, this.standalone ? side : this.side, lgaps);\n\n         return this.drawTitle(axis_g, side, lgaps);\n      });\n   }\n\n   /** @summary Assign handler, which is called when axis redraw by interactive changes\n     * @desc Used by palette painter to reassign iteractive handlers\n     * @private */\n   setAfterDrawHandler(handler) {\n      this._afterDrawAgain = handler;\n   }\n\n   /** @summary Draw axis with the same settings, used by interactive changes */\n   drawAxisAgain() {\n      if (!this.axis_g || !this.side) return;\n\n      this.axis_g.selectAll('*').remove();\n\n      this.extractDrawAttributes();\n\n      let side = this.side;\n      if (this.ticksSide === 'invert') side = -side;\n\n      if (this.standalone)\n         this.drawMainLine(this.axis_g);\n\n      // first draw ticks\n      const tgaps = this.drawTicks(this.axis_g, side, false),\n            labelsPromise = this.optionUnlab ? Promise.resolve(tgaps) : this.drawLabels(this.axis_g, side, tgaps);\n\n      return labelsPromise.then(lgaps => {\n         // when drawing axis on frame, zoom rect should be always outside\n         this.addZoomingRect(this.axis_g, this.standalone ? side : this.side, lgaps);\n\n         return this.drawTitle(this.axis_g, side, lgaps);\n      }).then(() => {\n         if (isFunc(this._afterDrawAgain))\n            this._afterDrawAgain();\n      });\n   }\n\n   /** @summary Draw axis again on opposite frame size */\n   drawAxisOtherPlace(layer, transform, side, only_ticks) {\n      let axis_g = layer.selectChild(`.${this.name}_container2`);\n      if (axis_g.empty())\n         axis_g = layer.append('svg:g').attr('class', `${this.name}_container2`);\n      else\n         axis_g.selectAll('*').remove();\n\n      axis_g.attr('transform', transform);\n\n      if (this.ticksSide === 'invert') side = -side;\n\n      // draw ticks again\n      const tgaps = this.drawTicks(axis_g, side, false),\n\n           // draw labels again\n           promise = this.optionUnlab || only_ticks ? Promise.resolve(tgaps) : this.drawLabels(axis_g, side, tgaps);\n\n      return promise.then(lgaps => {\n         this.addZoomingRect(axis_g, side, lgaps);\n         return true;\n      });\n   }\n\n   /** @summary Change zooming in standalone mode */\n   zoomStandalone(min, max) {\n      this.changeAxisAttr(1, 'zoomMin', min, 'zoomMax', max);\n   }\n\n   /** @summary Redraw axis, used in standalone mode for RAxisDrawable */\n   redraw() {\n      const drawable = this.getObject(),\n            pp = this.getPadPainter(),\n            pos = pp.getCoordinate(drawable.fPos),\n            reverse = this.v7EvalAttr('reverse', false),\n            labels_len = drawable.fLabels.length,\n            min = (labels_len > 0) ? 0 : this.v7EvalAttr('min', 0),\n            max = (labels_len > 0) ? labels_len : this.v7EvalAttr('max', 100);\n      let len = pp.getPadLength(drawable.fVertical, drawable.fLength);\n\n      // in vertical direction axis drawn in negative direction\n      if (drawable.fVertical) len -= pp.getPadHeight();\n\n      let smin = this.v7EvalAttr('zoomMin'),\n          smax = this.v7EvalAttr('zoomMax');\n      if (smin === smax) {\n         smin = min; smax = max;\n      }\n\n      this.configureAxis('axis', min, max, smin, smax, drawable.fVertical, undefined, len, { reverse, labels: labels_len > 0 });\n\n      this.createG();\n\n      this.standalone = true;  // no need to clean axis container\n\n      const promise = this.drawAxis(this.draw_g, makeTranslate(pos.x, pos.y));\n\n      if (this.isBatchMode()) return promise;\n\n      return promise.then(() => {\n         if (settings.ContextMenu) {\n            this.draw_g.on('contextmenu', evnt => {\n               evnt.stopPropagation(); // disable main context menu\n               evnt.preventDefault();  // disable browser context menu\n               createMenu(evnt, this).then(menu => {\n                 menu.add('header:RAxisDrawable');\n                 menu.add('Unzoom', () => this.zoomStandalone());\n                 this.fillAxisContextMenu(menu, '');\n                 menu.show();\n               });\n            });\n         }\n\n         addDragHandler(this, { x: pos.x, y: pos.y, width: this.vertical ? 10 : len, height: this.vertical ? len : 10,\n                                only_move: true, redraw: d => this.positionChanged(d) });\n\n         this.draw_g.on('dblclick', () => this.zoomStandalone());\n\n         if (settings.ZoomWheel) {\n            this.draw_g.on('wheel', evnt => {\n               evnt.stopPropagation();\n               evnt.preventDefault();\n\n               const pos = d3_pointer(evnt, this.draw_g.node()),\n                   coord = this.vertical ? (1 - pos[1] / len) : pos[0] / len,\n                   item = this.analyzeWheelEvent(evnt, coord);\n\n               if (item.changed) this.zoomStandalone(item.min, item.max);\n            });\n         }\n      });\n   }\n\n   /** @summary Process interactive moving of the axis drawing */\n   positionChanged(drag) {\n      const drawable = this.getObject(),\n          rect = this.getPadPainter().getPadRect(),\n          xn = drag.x / rect.width,\n          yn = 1 - drag.y / rect.height;\n\n      drawable.fPos.fHoriz.fArr = [xn];\n      drawable.fPos.fVert.fArr = [yn];\n\n      this.submitCanvExec(`SetPos({${xn.toFixed(4)},${yn.toFixed(4)}})`);\n   }\n\n   /** @summary Change axis attribute, submit changes to server and redraw axis when specified\n     * @desc Arguments as redraw_mode, name1, value1, name2, value2, ... */\n   changeAxisAttr(redraw_mode) {\n      const changes = {};\n      let indx = 1;\n      while (indx < arguments.length - 1) {\n         this.v7AttrChange(changes, arguments[indx], arguments[indx+1]);\n         this.v7SetAttr(arguments[indx], arguments[indx+1]);\n         indx += 2;\n      }\n      this.v7SendAttrChanges(changes, false); // do not invoke canvas update on the server\n      if (redraw_mode === 1) {\n         if (this.standalone)\n            this.redraw();\n         else\n            this.drawAxisAgain();\n      } else if (redraw_mode)\n         this.redrawPad();\n   }\n\n   /** @summary Change axis log scale kind */\n   changeAxisLog(arg) {\n      if ((this.kind === 'labels') || (this.kind === 'time')) return;\n      if (arg === 'toggle') arg = this.log ? 0 : 10;\n\n      arg = parseFloat(arg);\n      if (Number.isFinite(arg)) this.changeAxisAttr(2, 'log', arg, 'symlog', 0);\n   }\n\n   /** @summary Provide context menu for axis */\n   fillAxisContextMenu(menu, kind) {\n      if (kind) menu.add('Unzoom', () => this.getFramePainter().unzoom(kind));\n\n      menu.add('sub:Log scale', () => this.changeAxisLog('toggle'));\n      menu.addchk(!this.log && !this.symlog, 'linear', 0, arg => this.changeAxisLog(arg));\n      menu.addchk(this.log && !this.symlog && (this.logbase === 10), 'log10', () => this.changeAxisLog(10));\n      menu.addchk(this.log && !this.symlog && (this.logbase === 2), 'log2', () => this.changeAxisLog(2));\n      menu.addchk(this.log && !this.symlog && Math.abs(this.logbase - Math.exp(1)) < 0.1, 'ln', () => this.changeAxisLog(Math.exp(1)));\n      menu.addchk(!this.log && this.symlog, 'symlog', 0, () =>\n         menu.input('set symlog constant', this.symlog || 10, 'float').then(v => this.changeAxisAttr(2, 'symlog', v)));\n      menu.add('endsub:');\n\n      menu.add('Divisions', () => menu.input('Set axis devisions', this.v7EvalAttr('ndiv', 508), 'int').then(val => this.changeAxisAttr(2, 'ndiv', val)));\n\n      menu.add('sub:Ticks');\n      menu.addRColorMenu('color', this.ticksColor, col => this.changeAxisAttr(1, 'ticks_color', col));\n      menu.addSizeMenu('size', 0, 0.05, 0.01, this.ticksSize/this.scalingSize, sz => this.changeAxisAttr(1, 'ticks_size', sz));\n      menu.addSelectMenu('side', ['normal', 'invert', 'both'], this.ticksSide, side => this.changeAxisAttr(1, 'ticks_side', side));\n      menu.add('endsub:');\n\n      if (!this.optionUnlab && this.labelsFont) {\n         menu.add('sub:Labels');\n         menu.addSizeMenu('offset', -0.05, 0.05, 0.01, this.labelsOffset/this.scalingSize,\n                         offset => this.changeAxisAttr(1, 'labels_offset', offset));\n         menu.addRAttrTextItems(this.labelsFont, { noangle: 1, noalign: 1 },\n               change => this.changeAxisAttr(1, 'labels_' + change.name, change.value));\n         menu.addchk(this.labelsFont.angle, 'rotate', res => this.changeAxisAttr(1, 'labels_angle', res ? 180 : 0));\n         menu.add('endsub:');\n      }\n\n      menu.add('sub:Title', () => menu.input('Enter axis title', this.fTitle).then(t => this.changeAxisAttr(1, 'title_value', t)));\n\n      if (this.fTitle) {\n         menu.addSizeMenu('offset', -0.05, 0.05, 0.01, this.titleOffset/this.scalingSize,\n                           offset => this.changeAxisAttr(1, 'title_offset', offset));\n\n         menu.addSelectMenu('position', ['left', 'center', 'right'], this.titlePos,\n                            pos => this.changeAxisAttr(1, 'title_position', pos));\n\n         menu.addchk(this.isTitleRotated(), 'rotate', flag => this.changeAxisAttr(1, 'title_angle', flag ? 180 : 0));\n\n         menu.addRAttrTextItems(this.titleFont, { noangle: 1, noalign: 1 }, change => this.changeAxisAttr(1, 'title_' + change.name, change.value));\n      }\n\n      menu.add('endsub:');\n      return true;\n   }\n\n} // class RAxisPainter\n\nexport { RAxisPainter };\n","import { gStyle, settings, create, isFunc, isStr, clTAxis, nsREX } from '../core.mjs';\nimport { pointer as d3_pointer } from '../d3.mjs';\nimport { getSvgLineStyle } from '../base/TAttLineHandler.mjs';\nimport { makeTranslate } from '../base/BasePainter.mjs';\nimport { TAxisPainter } from './TAxisPainter.mjs';\nimport { RAxisPainter } from './RAxisPainter.mjs';\nimport { FrameInteractive, getEarthProjectionFunc } from './TFramePainter.mjs';\nimport { RObjectPainter } from '../base/RObjectPainter.mjs';\n\n\n/**\n * @summary Painter class for RFrame, main handler for interactivity\n *\n * @private\n */\n\nclass RFramePainter extends RObjectPainter {\n\n   /** @summary constructor\n     * @param {object|string} dom - DOM element for drawing or element id\n     * @param {object} tframe - RFrame object */\n   constructor(dom, tframe) {\n      super(dom, tframe, '', 'frame');\n      this.mode3d = false;\n      this.xmin = this.xmax = 0; // no scale specified, wait for objects drawing\n      this.ymin = this.ymax = 0; // no scale specified, wait for objects drawing\n      this.axes_drawn = false;\n      this.keys_handler = null;\n      this.projection = 0; // different projections\n      this.v7_frame = true; // indicator of v7, used in interactive part\n   }\n\n   /** @summary Returns frame painter - object itself */\n   getFramePainter() { return this; }\n\n   /** @summary Returns true if it is ROOT6 frame\n    * @private */\n   is_root6() { return false; }\n\n   /** @summary Set active flag for frame - can block some events\n    * @private */\n   setFrameActive(on) {\n      this.enabledKeys = on && settings.HandleKeys;\n      // used only in 3D mode\n      if (this.control)\n         this.control.enableKeys = this.enabledKeys;\n   }\n\n   setLastEventPos(pnt) {\n      // set position of last context menu event, can be\n      this.fLastEventPnt = pnt;\n   }\n\n   getLastEventPos() {\n      // return position of last event\n      return this.fLastEventPnt;\n   }\n\n   /** @summary Update graphical attributes */\n   updateAttributes(force) {\n      if ((this.fX1NDC === undefined) || (force && !this.modified_NDC)) {\n         const rect = this.getPadPainter().getPadRect();\n         this.fX1NDC = this.v7EvalLength('margins_left', rect.width, gStyle.fPadLeftMargin) / rect.width;\n         this.fY1NDC = this.v7EvalLength('margins_bottom', rect.height, gStyle.fPadBottomMargin) / rect.height;\n         this.fX2NDC = 1 - this.v7EvalLength('margins_right', rect.width, gStyle.fPadRightMargin) / rect.width;\n         this.fY2NDC = 1 - this.v7EvalLength('margins_top', rect.height, gStyle.fPadTopMargin) / rect.height;\n      }\n\n      if (!this.fillatt)\n         this.createv7AttFill();\n\n      this.createv7AttLine('border_');\n   }\n\n   /** @summary Returns coordinates transformation func */\n   getProjectionFunc() { return getEarthProjectionFunc(this.projection); }\n\n   /** @summary Rcalculate frame ranges using specified projection functions\n     * @desc Not yet used in v7 */\n   recalculateRange(Proj) {\n      this.projection = Proj || 0;\n\n      if ((this.projection === 2) && ((this.scale_ymin <= -90) || (this.scale_ymax >=90))) {\n         console.warn(`Mercator Projection: latitude out of range ${this.scale_ymin} ${this.scale_ymax}`);\n         this.projection = 0;\n      }\n\n      const func = this.getProjectionFunc();\n      if (!func) return;\n\n      const pnts = [func(this.scale_xmin, this.scale_ymin),\n                   func(this.scale_xmin, this.scale_ymax),\n                   func(this.scale_xmax, this.scale_ymax),\n                   func(this.scale_xmax, this.scale_ymin)];\n      if (this.scale_xmin < 0 && this.scale_xmax > 0) {\n         pnts.push(func(0, this.scale_ymin));\n         pnts.push(func(0, this.scale_ymax));\n      }\n      if (this.scale_ymin < 0 && this.scale_ymax > 0) {\n         pnts.push(func(this.scale_xmin, 0));\n         pnts.push(func(this.scale_xmax, 0));\n      }\n\n      this.original_xmin = this.scale_xmin;\n      this.original_xmax = this.scale_xmax;\n      this.original_ymin = this.scale_ymin;\n      this.original_ymax = this.scale_ymax;\n\n      this.scale_xmin = this.scale_xmax = pnts[0].x;\n      this.scale_ymin = this.scale_ymax = pnts[0].y;\n\n      for (let n = 1; n < pnts.length; ++n) {\n         this.scale_xmin = Math.min(this.scale_xmin, pnts[n].x);\n         this.scale_xmax = Math.max(this.scale_xmax, pnts[n].x);\n         this.scale_ymin = Math.min(this.scale_ymin, pnts[n].y);\n         this.scale_ymax = Math.max(this.scale_ymax, pnts[n].y);\n      }\n   }\n\n   /** @summary Draw axes grids\n     * @desc Called immediately after axes drawing */\n   drawGrids() {\n      const layer = this.getFrameSvg().selectChild('.axis_layer');\n\n      layer.selectAll('.xgrid').remove();\n      layer.selectAll('.ygrid').remove();\n\n      const h = this.getFrameHeight(),\n            w = this.getFrameWidth(),\n            gridx = this.v7EvalAttr('gridX', false),\n            gridy = this.v7EvalAttr('gridY', false),\n            grid_style = getSvgLineStyle(gStyle.fGridStyle),\n            grid_color = (gStyle.fGridColor > 0) ? this.getColor(gStyle.fGridColor) : 'black';\n\n      if (this.x_handle)\n         this.x_handle.draw_grid = gridx;\n\n      // add a grid on x axis, if the option is set\n      if (this.x_handle?.draw_grid) {\n         let grid = '';\n         for (let n = 0; n < this.x_handle.ticks.length; ++n) {\n            grid += this.swap_xy\n                  ? `M0,${h+this.x_handle.ticks[n]}h${w}`\n                  : `M${this.x_handle.ticks[n]},0v${h}`;\n         }\n\n         if (grid) {\n            layer.append('svg:path')\n                 .attr('class', 'xgrid')\n                 .attr('d', grid)\n                 .style('stroke', grid_color)\n                 .style('stroke-width', gStyle.fGridWidth)\n                 .style('stroke-dasharray', grid_style);\n         }\n      }\n\n      if (this.y_handle)\n         this.y_handle.draw_grid = gridy;\n\n      // add a grid on y axis, if the option is set\n      if (this.y_handle?.draw_grid) {\n         let grid = '';\n         for (let n = 0; n < this.y_handle.ticks.length; ++n) {\n            grid += this.swap_xy\n                     ? `M${this.y_handle.ticks[n]},0v${h}`\n                     : `M0,${h+this.y_handle.ticks[n]}h${w}`;\n         }\n\n         if (grid) {\n            layer.append('svg:path')\n               .attr('class', 'ygrid')\n               .attr('d', grid)\n               .style('stroke', grid_color)\n               .style('stroke-width', gStyle.fGridWidth)\n               .style('stroke-dasharray', grid_style);\n         }\n      }\n   }\n\n   /** @summary Converts 'raw' axis value into text */\n   axisAsText(axis, value) {\n      const handle = this[`${axis}_handle`];\n\n      return handle ? handle.axisAsText(value, settings[axis.toUpperCase() + 'ValuesFormat']) : value.toPrecision(4);\n   }\n\n   /** @summary Set axix range */\n   _setAxisRange(prefix, vmin, vmax) {\n      const nmin = `${prefix}min`, nmax = `${prefix}max`;\n      if (this[nmin] !== this[nmax]) return;\n      let min = this.v7EvalAttr(`${prefix}_min`),\n          max = this.v7EvalAttr(`${prefix}_max`);\n\n      if (min !== undefined) vmin = min;\n      if (max !== undefined) vmax = max;\n\n      if (vmin < vmax) {\n         this[nmin] = vmin;\n         this[nmax] = vmax;\n      }\n\n      const nzmin = `zoom_${prefix}min`, nzmax = `zoom_${prefix}max`;\n\n      if ((this[nzmin] === this[nzmax]) && !this.zoomChangedInteractive(prefix)) {\n         min = this.v7EvalAttr(`${prefix}_zoomMin`);\n         max = this.v7EvalAttr(`${prefix}_zoomMax`);\n\n         if ((min !== undefined) || (max !== undefined)) {\n            this[nzmin] = (min === undefined) ? this[nmin] : min;\n            this[nzmax] = (max === undefined) ? this[nmax] : max;\n         }\n      }\n   }\n\n   /** @summary Set axes ranges for drawing, check configured attributes if range already specified */\n   setAxesRanges(xaxis, xmin, xmax, yaxis, ymin, ymax, zaxis, zmin, zmax) {\n      if (this.axes_drawn) return;\n      this.xaxis = xaxis;\n      this._setAxisRange('x', xmin, xmax);\n      this.yaxis = yaxis;\n      this._setAxisRange('y', ymin, ymax);\n      this.zaxis = zaxis;\n      this._setAxisRange('z', zmin, zmax);\n   }\n\n   /** @summary Set secondary axes ranges */\n   setAxes2Ranges(second_x, xaxis, xmin, xmax, second_y, yaxis, ymin, ymax) {\n      if (second_x) {\n         this.x2axis = xaxis;\n         this._setAxisRange('x2', xmin, xmax);\n      }\n      if (second_y) {\n         this.y2axis = yaxis;\n         this._setAxisRange('y2', ymin, ymax);\n      }\n   }\n\n   /** @summary Create x,y objects which maps user coordinates into pixels\n     * @desc Must be used only for v6 objects, see TFramePainter for more details\n     * @private */\n   createXY(opts) {\n      if (this.self_drawaxes) return;\n\n      this.cleanXY(); // remove all previous configurations\n\n      if (!opts) opts = { ndim: 1 };\n\n      this.v6axes = true;\n      this.swap_xy = opts.swap_xy || false;\n      this.reverse_x = opts.reverse_x || false;\n      this.reverse_y = opts.reverse_y || false;\n\n      this.logx = this.v7EvalAttr('x_log', 0);\n      this.logy = this.v7EvalAttr('y_log', 0);\n\n      const w = this.getFrameWidth(), h = this.getFrameHeight();\n\n      this.scales_ndim = opts.ndim;\n\n      this.scale_xmin = this.xmin;\n      this.scale_xmax = this.xmax;\n\n      this.scale_ymin = this.ymin;\n      this.scale_ymax = this.ymax;\n\n      if (opts.extra_y_space) {\n         const log_scale = this.swap_xy ? this.logx : this.logy;\n         if (log_scale && (this.scale_ymax > 0))\n            this.scale_ymax = Math.exp(Math.log(this.scale_ymax)*1.1);\n         else\n            this.scale_ymax += (this.scale_ymax - this.scale_ymin)*0.1;\n      }\n\n      // if (opts.check_pad_range) {\n         // take zooming out of pad or axis attributes - skip!\n      // }\n\n      if ((opts.zoom_ymin !== opts.zoom_ymax) && ((this.zoom_ymin === this.zoom_ymax) || !this.zoomChangedInteractive('y'))) {\n         this.zoom_ymin = opts.zoom_ymin;\n         this.zoom_ymax = opts.zoom_ymax;\n      }\n\n      if (this.zoom_xmin !== this.zoom_xmax) {\n         this.scale_xmin = this.zoom_xmin;\n         this.scale_xmax = this.zoom_xmax;\n      }\n\n      if (this.zoom_ymin !== this.zoom_ymax) {\n         this.scale_ymin = this.zoom_ymin;\n         this.scale_ymax = this.zoom_ymax;\n      }\n\n      let xaxis = this.xaxis, yaxis = this.yaxis;\n      if (xaxis?._typename !== clTAxis) xaxis = create(clTAxis);\n      if (yaxis?._typename !== clTAxis) yaxis = create(clTAxis);\n\n      this.x_handle = new TAxisPainter(this.getDom(), xaxis, true);\n      this.x_handle.setPadName(this.getPadName());\n      this.x_handle.optionUnlab = this.v7EvalAttr('x_labels_hide', false);\n\n      this.x_handle.configureAxis('xaxis', this.xmin, this.xmax, this.scale_xmin, this.scale_xmax, this.swap_xy, this.swap_xy ? [0, h] : [0, w],\n                                      { reverse: this.reverse_x,\n                                        log: this.swap_xy ? this.logy : this.logx,\n                                        symlog: this.swap_xy ? opts.symlog_y : opts.symlog_x,\n                                        logcheckmin: this.swap_xy,\n                                        logminfactor: 0.0001 });\n\n      this.x_handle.assignFrameMembers(this, 'x');\n\n      this.y_handle = new TAxisPainter(this.getDom(), yaxis, true);\n      this.y_handle.setPadName(this.getPadName());\n      this.y_handle.optionUnlab = this.v7EvalAttr('y_labels_hide', false);\n\n      this.y_handle.configureAxis('yaxis', this.ymin, this.ymax, this.scale_ymin, this.scale_ymax, !this.swap_xy, this.swap_xy ? [0, w] : [0, h],\n                                      { reverse: this.reverse_y,\n                                        log: this.swap_xy ? this.logx : this.logy,\n                                        symlog: this.swap_xy ? opts.symlog_x : opts.symlog_y,\n                                        logcheckmin: (opts.ndim < 2) || this.swap_xy,\n                                        log_min_nz: opts.ymin_nz && (opts.ymin_nz < this.ymax) ? 0.5 * opts.ymin_nz : 0,\n                                        logminfactor: 3e-4 });\n\n      this.y_handle.assignFrameMembers(this, 'y');\n   }\n\n   /** @summary Identify if requested axes are drawn\n     * @desc Checks if x/y axes are drawn. Also if second side is already there */\n   hasDrawnAxes(second_x, second_y) {\n      return !second_x && !second_y ? this.axes_drawn : false;\n   }\n\n   /** @summary Draw configured axes on the frame\n     * @desc axes can be drawn only for main histogram  */\n   async drawAxes() {\n      if (this.axes_drawn || (this.xmin === this.xmax) || (this.ymin === this.ymax))\n         return this.axes_drawn;\n\n      const ticksx = this.v7EvalAttr('ticksX', 1),\n            ticksy = this.v7EvalAttr('ticksY', 1);\n      let sidex = 1, sidey = 1;\n\n      if (this.v7EvalAttr('swapX', false)) sidex = -1;\n      if (this.v7EvalAttr('swapY', false)) sidey = -1;\n\n      const w = this.getFrameWidth(), h = this.getFrameHeight();\n\n      if (!this.v6axes) {\n         // this is partially same as v6 createXY method\n\n         this.cleanupAxes();\n\n         this.swap_xy = false;\n\n         if (this.zoom_xmin !== this.zoom_xmax) {\n            this.scale_xmin = this.zoom_xmin;\n            this.scale_xmax = this.zoom_xmax;\n         } else {\n            this.scale_xmin = this.xmin;\n            this.scale_xmax = this.xmax;\n         }\n\n         if (this.zoom_ymin !== this.zoom_ymax) {\n            this.scale_ymin = this.zoom_ymin;\n            this.scale_ymax = this.zoom_ymax;\n         } else {\n            this.scale_ymin = this.ymin;\n            this.scale_ymax = this.ymax;\n         }\n\n         this.recalculateRange(0);\n\n         this.x_handle = new RAxisPainter(this.getDom(), this, this.xaxis, 'x_');\n         this.x_handle.setPadName(this.getPadName());\n         this.x_handle.snapid = this.snapid;\n         this.x_handle.draw_swapside = (sidex < 0);\n         this.x_handle.draw_ticks = ticksx;\n\n         this.y_handle = new RAxisPainter(this.getDom(), this, this.yaxis, 'y_');\n         this.y_handle.setPadName(this.getPadName());\n         this.y_handle.snapid = this.snapid;\n         this.y_handle.draw_swapside = (sidey < 0);\n         this.y_handle.draw_ticks = ticksy;\n\n         this.z_handle = new RAxisPainter(this.getDom(), this, this.zaxis, 'z_');\n         this.z_handle.setPadName(this.getPadName());\n         this.z_handle.snapid = this.snapid;\n\n         this.x_handle.configureAxis('xaxis', this.xmin, this.xmax, this.scale_xmin, this.scale_xmax, false, [0, w], w, { reverse: false });\n         this.x_handle.assignFrameMembers(this, 'x');\n\n         this.y_handle.configureAxis('yaxis', this.ymin, this.ymax, this.scale_ymin, this.scale_ymax, true, [h, 0], -h, { reverse: false });\n         this.y_handle.assignFrameMembers(this, 'y');\n\n         // only get basic properties like log scale\n         this.z_handle.configureZAxis('zaxis', this);\n      }\n\n      const layer = this.getFrameSvg().selectChild('.axis_layer');\n\n      this.x_handle.has_obstacle = false;\n\n      const draw_horiz = this.swap_xy ? this.y_handle : this.x_handle,\n            draw_vertical = this.swap_xy ? this.x_handle : this.y_handle;\n      let pr;\n\n      if (this.getPadPainter()?._fast_drawing)\n         pr = Promise.resolve(true); // do nothing\n       else if (this.v6axes) {\n         // in v7 ticksx/y values shifted by 1 relative to v6\n         // In v7 ticksx === 0 means no ticks, ticksx === 1 equivalent to === 0 in v6\n\n         const can_adjust_frame = false, disable_x_draw = false, disable_y_draw = false;\n\n         draw_horiz.disable_ticks = (ticksx <= 0);\n         draw_vertical.disable_ticks = (ticksy <= 0);\n\n         const pr1 = draw_horiz.drawAxis(layer, w, h,\n                                   draw_horiz.invert_side ? null : `translate(0,${h})`,\n                                   (ticksx > 1) ? -h : 0, disable_x_draw,\n                                   undefined, false, this.getPadPainter().getPadHeight() - h - this.getFrameY()),\n\n          pr2 = draw_vertical.drawAxis(layer, w, h,\n                                   draw_vertical.invert_side ? `translate(${w})` : null,\n                                   (ticksy > 1) ? w : 0, disable_y_draw,\n                                   draw_vertical.invert_side ? 0 : this._frame_x, can_adjust_frame);\n\n         pr = Promise.all([pr1, pr2]).then(() => this.drawGrids());\n      } else {\n         let arr = [];\n\n         if (ticksx > 0)\n            arr.push(draw_horiz.drawAxis(layer, makeTranslate(0, sidex > 0 ? h : 0), sidex));\n\n         if (ticksy > 0)\n            arr.push(draw_vertical.drawAxis(layer, makeTranslate(sidey > 0 ? 0 : w, h), sidey));\n\n         pr = Promise.all(arr).then(() => {\n            arr = [];\n            if (ticksx > 1)\n               arr.push(draw_horiz.drawAxisOtherPlace(layer, makeTranslate(0, sidex < 0 ? h : 0), -sidex, ticksx === 2));\n\n            if (ticksy > 1)\n               arr.push(draw_vertical.drawAxisOtherPlace(layer, makeTranslate(sidey < 0 ? 0 : w, h), -sidey, ticksy === 2));\n            return Promise.all(arr);\n         }).then(() => this.drawGrids());\n      }\n\n      return pr.then(() => {\n         this.axes_drawn = true;\n         return true;\n      });\n   }\n\n   /** @summary Draw secondary configuread axes */\n   drawAxes2(second_x, second_y) {\n      const w = this.getFrameWidth(), h = this.getFrameHeight(),\n            layer = this.getFrameSvg().selectChild('.axis_layer');\n      let pr1, pr2;\n\n      if (second_x) {\n         if (this.zoom_x2min !== this.zoom_x2max) {\n            this.scale_x2min = this.zoom_x2min;\n            this.scale_x2max = this.zoom_x2max;\n         } else {\n           this.scale_x2min = this.x2min;\n           this.scale_x2max = this.x2max;\n         }\n         this.x2_handle = new RAxisPainter(this.getDom(), this, this.x2axis, 'x2_');\n         this.x2_handle.setPadName(this.getPadName());\n         this.x2_handle.snapid = this.snapid;\n\n         this.x2_handle.configureAxis('x2axis', this.x2min, this.x2max, this.scale_x2min, this.scale_x2max, false, [0, w], w, { reverse: false });\n         this.x2_handle.assignFrameMembers(this, 'x2');\n\n         pr1 = this.x2_handle.drawAxis(layer, null, -1);\n      }\n\n      if (second_y) {\n         if (this.zoom_y2min !== this.zoom_y2max) {\n            this.scale_y2min = this.zoom_y2min;\n            this.scale_y2max = this.zoom_y2max;\n         } else {\n            this.scale_y2min = this.y2min;\n            this.scale_y2max = this.y2max;\n         }\n\n         this.y2_handle = new RAxisPainter(this.getDom(), this, this.y2axis, 'y2_');\n         this.y2_handle.setPadName(this.getPadName());\n         this.y2_handle.snapid = this.snapid;\n\n         this.y2_handle.configureAxis('y2axis', this.y2min, this.y2max, this.scale_y2min, this.scale_y2max, true, [h, 0], -h, { reverse: false });\n         this.y2_handle.assignFrameMembers(this, 'y2');\n\n         pr2 = this.y2_handle.drawAxis(layer, makeTranslate(w, h), -1);\n      }\n\n      return Promise.all([pr1, pr2]);\n   }\n\n   /** @summary Return functions to create x/y points based on coordinates\n     * @desc In default case returns frame painter itself\n     * @private */\n   getGrFuncs(second_x, second_y) {\n      const use_x2 = second_x && this.grx2,\n          use_y2 = second_y && this.gry2;\n      if (!use_x2 && !use_y2) return this;\n\n      return {\n         use_x2,\n         grx: use_x2 ? this.grx2 : this.grx,\n         x_handle: use_x2 ? this.x2_handle : this.x_handle,\n         logx: use_x2 ? this.x2_handle.log : this.x_handle.log,\n         scale_xmin: use_x2 ? this.scale_x2min : this.scale_xmin,\n         scale_xmax: use_x2 ? this.scale_x2max : this.scale_xmax,\n         use_y2,\n         gry: use_y2 ? this.gry2 : this.gry,\n         y_handle: use_y2 ? this.y2_handle : this.y_handle,\n         logy: use_y2 ? this.y2_handle.log : this.y_handle.log,\n         scale_ymin: use_y2 ? this.scale_y2min : this.scale_ymin,\n         scale_ymax: use_y2 ? this.scale_y2max : this.scale_ymax,\n         swap_xy: this.swap_xy,\n         fp: this,\n         revertAxis(name, v) {\n            if ((name === 'x') && this.use_x2) name = 'x2';\n            if ((name === 'y') && this.use_y2) name = 'y2';\n            return this.fp.revertAxis(name, v);\n         },\n         axisAsText(name, v) {\n            if ((name === 'x') && this.use_x2) name = 'x2';\n            if ((name === 'y') && this.use_y2) name = 'y2';\n            return this.fp.axisAsText(name, v);\n         }\n      };\n   }\n\n   /** @summary function called at the end of resize of frame\n     * @desc Used to update attributes on the server\n     * @private */\n   sizeChanged() {\n      const changes = {};\n      this.v7AttrChange(changes, 'margins_left', this.fX1NDC);\n      this.v7AttrChange(changes, 'margins_bottom', this.fY1NDC);\n      this.v7AttrChange(changes, 'margins_right', 1 - this.fX2NDC);\n      this.v7AttrChange(changes, 'margins_top', 1 - this.fY2NDC);\n      this.v7SendAttrChanges(changes, false); // do not invoke canvas update on the server\n\n      this.redrawPad();\n   }\n\n   /** @summary Remove all x/y functions\n     * @private */\n   cleanXY() {\n      // remove all axes drawings\n      const clean = (name, grname) => {\n         this[name]?.cleanup();\n         delete this[name];\n         delete this[grname];\n      };\n\n      clean('x_handle', 'grx');\n      clean('y_handle', 'gry');\n      clean('z_handle', 'grz');\n      clean('x2_handle', 'grx2');\n      clean('y2_handle', 'gry2');\n\n      delete this.v6axes; // marker that v6 axes are used\n   }\n\n   /** @summary Remove all axes drawings\n     * @private */\n   cleanupAxes() {\n      this.cleanXY();\n\n      this.draw_g?.selectChild('.axis_layer').selectAll('*').remove();\n      this.axes_drawn = false;\n   }\n\n   /** @summary Removes all drawn elements of the frame\n     * @private */\n   cleanFrameDrawings() {\n      // cleanup all 3D drawings if any\n      if (isFunc(this.create3DScene))\n         this.create3DScene(-1);\n\n      this.cleanupAxes();\n\n      const clean = (name) => {\n         this[name+'min'] = this[name+'max'] = 0;\n         this[`zoom_${name}min`] = this[`zoom_${name}max`] = 0;\n         this[`scale_${name}min`] = this[`scale_${name}max`] = 0;\n      };\n\n      clean('x');\n      clean('y');\n      clean('z');\n      clean('x2');\n      clean('y2');\n\n      this.draw_g?.selectChild('.main_layer').selectAll('*').remove();\n      this.draw_g?.selectChild('.upper_layer').selectAll('*').remove();\n   }\n\n   /** @summary Fully cleanup frame\n     * @private */\n   cleanup() {\n      this.cleanFrameDrawings();\n\n      if (this.draw_g) {\n         this.draw_g.selectAll('*').remove();\n         this.draw_g.on('mousedown', null)\n                    .on('dblclick', null)\n                    .on('wheel', null)\n                    .on('contextmenu', null)\n                    .property('interactive_set', null);\n      }\n\n      if (this.keys_handler) {\n         window.removeEventListener('keydown', this.keys_handler, false);\n         this.keys_handler = null;\n      }\n      delete this.enabledKeys;\n      delete this.self_drawaxes;\n\n      delete this.xaxis;\n      delete this.yaxis;\n      delete this.zaxis;\n      delete this.x2axis;\n      delete this.y2axis;\n\n      delete this.draw_g; // frame <g> element managet by the pad\n\n      delete this._click_handler;\n      delete this._dblclick_handler;\n\n      const pp = this.getPadPainter();\n      if (pp?.frame_painter_ref === this)\n         delete pp.frame_painter_ref;\n\n      super.cleanup();\n   }\n\n   /** @summary Redraw frame\n     * @private */\n   redraw() {\n      const pp = this.getPadPainter();\n      if (pp) pp.frame_painter_ref = this;\n\n      // first update all attributes from objects\n      this.updateAttributes();\n\n      const rect = pp?.getPadRect() ?? { width: 10, height: 10 },\n            lm = Math.round(rect.width * this.fX1NDC),\n            tm = Math.round(rect.height * (1 - this.fY2NDC));\n      let w = Math.round(rect.width * (this.fX2NDC - this.fX1NDC)),\n          h = Math.round(rect.height * (this.fY2NDC - this.fY1NDC)),\n          rotate = false, fixpos = false, trans;\n\n      if (pp?.options) {\n         if (pp.options.RotateFrame) rotate = true;\n         if (pp.options.FixFrame) fixpos = true;\n      }\n\n      if (rotate) {\n         trans = `rotate(-90,${lm},${tm}) translate(${lm-h},${tm})`;\n         [w, h] = [h, w];\n      } else\n         trans = makeTranslate(lm, tm);\n\n\n      // update values here to let access even when frame is not really updated\n      this._frame_x = lm;\n      this._frame_y = tm;\n      this._frame_width = w;\n      this._frame_height = h;\n      this._frame_rotate = rotate;\n      this._frame_fixpos = fixpos;\n\n      if (this.mode3d) return this; // no need for real draw in mode3d\n\n      // this is svg:g object - container for every other items belonging to frame\n      this.draw_g = this.getFrameSvg();\n\n      let top_rect, main_svg;\n\n      if (this.draw_g.empty()) {\n         this.draw_g = this.getLayerSvg('primitives_layer').append('svg:g').attr('class', 'root_frame');\n\n         if (!this.isBatchMode())\n            this.draw_g.append('svg:title').text('');\n\n         top_rect = this.draw_g.append('svg:rect');\n\n         main_svg = this.draw_g.append('svg:svg')\n                           .attr('class', 'main_layer')\n                           .attr('x', 0)\n                           .attr('y', 0)\n                           .attr('overflow', 'hidden');\n\n         this.draw_g.append('svg:g').attr('class', 'axis_layer');\n         this.draw_g.append('svg:g').attr('class', 'upper_layer');\n      } else {\n         top_rect = this.draw_g.selectChild('rect');\n         main_svg = this.draw_g.selectChild('.main_layer');\n      }\n\n      this.axes_drawn = false;\n\n      this.draw_g.attr('transform', trans);\n\n      top_rect.attr('x', 0)\n              .attr('y', 0)\n              .attr('width', w)\n              .attr('height', h)\n              .attr('rx', this.lineatt.rx || null)\n              .attr('ry', this.lineatt.ry || null)\n              .call(this.fillatt.func)\n              .call(this.lineatt.func);\n\n      main_svg.attr('width', w)\n              .attr('height', h)\n              .attr('viewBox', `0 0 ${w} ${h}`);\n\n      let pr = Promise.resolve(true);\n\n      if (this.v7EvalAttr('drawAxes')) {\n         this.self_drawaxes = true;\n         this.setAxesRanges();\n         pr = this.drawAxes().then(() => this.addInteractivity());\n      }\n\n      return pr.then(() => { return this; });\n   }\n\n   /** @summary Returns frame X position */\n   getFrameX() { return this._frame_x || 0; }\n\n   /** @summary Returns frame Y position */\n   getFrameY() { return this._frame_y || 0; }\n\n   /** @summary Returns frame width */\n   getFrameWidth() { return this._frame_width || 0; }\n\n   /** @summary Returns frame height */\n   getFrameHeight() { return this._frame_height || 0; }\n\n   /** @summary Returns frame rectangle plus extra info for hint display */\n   getFrameRect() {\n      return {\n         x: this._frame_x || 0,\n         y: this._frame_y || 0,\n         width: this.getFrameWidth(),\n         height: this.getFrameHeight(),\n         transform: this.draw_g?.attr('transform') || '',\n         hint_delta_x: 0,\n         hint_delta_y: 0\n      };\n   }\n\n   /** @summary Returns palette associated with frame */\n   getHistPalette() {\n      return this.getPadPainter().getHistPalette();\n   }\n\n   /** @summary Configure user-defined click handler\n     * @desc Function will be called every time when frame click was perfromed\n     * As argument, tooltip object with selected bins will be provided\n     * If handler function returns true, default handling of click will be disabled */\n   configureUserClickHandler(handler) {\n      this._click_handler = isFunc(handler) ? handler : null;\n   }\n\n   /** @summary Configure user-defined dblclick handler\n     * @desc Function will be called every time when double click was called\n     * As argument, tooltip object with selected bins will be provided\n     * If handler function returns true, default handling of dblclick (unzoom) will be disabled */\n   configureUserDblclickHandler(handler) {\n      this._dblclick_handler = isFunc(handler) ? handler : null;\n   }\n\n   /** @summary function can be used for zooming into specified range\n     * @desc if both limits for each axis 0 (like xmin === xmax === 0), axis will be unzoomed\n     * @return {Promise} with boolean flag if zoom operation was performed */\n   async zoom(xmin, xmax, ymin, ymax, zmin, zmax) {\n      // disable zooming when axis conversion is enabled\n      if (this.projection) return false;\n\n      if (xmin === 'x') { xmin = xmax; xmax = ymin; ymin = undefined; } else\n      if (xmin === 'y') { ymax = ymin; ymin = xmax; xmin = xmax = undefined; } else\n      if (xmin === 'z') { zmin = xmax; zmax = ymin; xmin = xmax = ymin = undefined; }\n\n      let zoom_x = (xmin !== xmax), zoom_y = (ymin !== ymax), zoom_z = (zmin !== zmax),\n          unzoom_x = false, unzoom_y = false, unzoom_z = false;\n\n      if (zoom_x) {\n         let cnt = 0;\n         if (xmin <= this.xmin) { xmin = this.xmin; cnt++; }\n         if (xmax >= this.xmax) { xmax = this.xmax; cnt++; }\n         if (cnt === 2) { zoom_x = false; unzoom_x = true; }\n      } else\n         unzoom_x = (xmin === xmax) && (xmin === 0);\n\n\n      if (zoom_y) {\n         let cnt = 0;\n         if (ymin <= this.ymin) { ymin = this.ymin; cnt++; }\n         if (ymax >= this.ymax) { ymax = this.ymax; cnt++; }\n         if (cnt === 2) { zoom_y = false; unzoom_y = true; }\n      } else\n         unzoom_y = (ymin === ymax) && (ymin === 0);\n\n\n      if (zoom_z) {\n         let cnt = 0;\n         // if (this.logz && this.ymin_nz && this.getDimension()===2) main_zmin = 0.3*this.ymin_nz;\n         if (zmin <= this.zmin) { zmin = this.zmin; cnt++; }\n         if (zmax >= this.zmax) { zmax = this.zmax; cnt++; }\n         if (cnt === 2) { zoom_z = false; unzoom_z = true; }\n      } else\n         unzoom_z = (zmin === zmax) && (zmin === 0);\n\n\n      let changed = false, r_x = '', r_y = '', r_z = '', is_any_check = false;\n      const req = {\n            _typename: `${nsREX}RFrame::RUserRanges`,\n            values: [0, 0, 0, 0, 0, 0],\n            flags: [false, false, false, false, false, false]\n      },\n\n      checkZooming = (painter, force) => {\n         if (!force && !isFunc(painter.canZoomInside)) return;\n\n         is_any_check = true;\n\n         if (zoom_x && (force || painter.canZoomInside('x', xmin, xmax))) {\n            this.zoom_xmin = xmin;\n            this.zoom_xmax = xmax;\n            changed = true; r_x = '0';\n            zoom_x = false;\n            req.values[0] = xmin; req.values[1] = xmax;\n            req.flags[0] = req.flags[1] = true;\n         }\n         if (zoom_y && (force || painter.canZoomInside('y', ymin, ymax))) {\n            this.zoom_ymin = ymin;\n            this.zoom_ymax = ymax;\n            changed = true; r_y = '1';\n            zoom_y = false;\n            req.values[2] = ymin; req.values[3] = ymax;\n            req.flags[2] = req.flags[3] = true;\n         }\n         if (zoom_z && (force || painter.canZoomInside('z', zmin, zmax))) {\n            this.zoom_zmin = zmin;\n            this.zoom_zmax = zmax;\n            changed = true; r_z = '2';\n            zoom_z = false;\n            req.values[4] = zmin; req.values[5] = zmax;\n            req.flags[4] = req.flags[5] = true;\n         }\n      };\n\n      // first process zooming (if any)\n      if (zoom_x || zoom_y || zoom_z)\n         this.forEachPainter(painter => checkZooming(painter));\n\n      // force zooming when no any other painter can verify zoom range\n      if (!is_any_check && this.self_drawaxes)\n         checkZooming(null, true);\n\n      // and process unzoom, if any\n      if (unzoom_x || unzoom_y || unzoom_z) {\n         if (unzoom_x) {\n            if (this.zoom_xmin !== this.zoom_xmax) { changed = true; r_x = '0'; }\n            this.zoom_xmin = this.zoom_xmax = 0;\n            req.values[0] = req.values[1] = -1;\n         }\n         if (unzoom_y) {\n            if (this.zoom_ymin !== this.zoom_ymax) { changed = true; r_y = '1'; }\n            this.zoom_ymin = this.zoom_ymax = 0;\n            req.values[2] = req.values[3] = -1;\n         }\n         if (unzoom_z) {\n            if (this.zoom_zmin !== this.zoom_zmax) { changed = true; r_z = '2'; }\n            this.zoom_zmin = this.zoom_zmax = 0;\n            req.values[4] = req.values[5] = -1;\n         }\n      }\n\n      if (!changed) return false;\n\n      if (this.v7NormalMode())\n         this.v7SubmitRequest('zoom', { _typename: `${nsREX}RFrame::RZoomRequest`, ranges: req });\n\n      return this.interactiveRedraw('pad', 'zoom' + r_x + r_y + r_z).then(() => true);\n   }\n\n   /** @summary Provide zooming of single axis\n     * @desc One can specify names like x/y/z but also second axis x2 or y2 */\n   async zoomSingle(name, vmin, vmax) {\n      const names = ['x', 'y', 'z', 'x2', 'y2'], indx = names.indexOf(name);\n\n      // disable zooming when axis conversion is enabled\n      if (this.projection || !this[name+'_handle'] || (indx < 0))\n         return false;\n\n      let zoom_v = (vmin !== vmax), unzoom_v = false;\n\n      if (zoom_v) {\n         let cnt = 0;\n         if (vmin <= this[name+'min']) { vmin = this[name+'min']; cnt++; }\n         if (vmax >= this[name+'max']) { vmax = this[name+'max']; cnt++; }\n         if (cnt === 2) { zoom_v = false; unzoom_v = true; }\n      } else\n         unzoom_v = (vmin === vmax) && (vmin === 0);\n\n\n      let changed = false, is_any_check = false;\n      const req = {\n             _typename: `${nsREX}RFrame::RUserRanges`,\n             values: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n             flags: [false, false, false, false, false, false, false, false, false, false]\n       },\n\n       checkZooming = (painter, force) => {\n         if (!force && !isFunc(painter?.canZoomInside)) return;\n\n         is_any_check = true;\n\n         if (zoom_v && (force || painter.canZoomInside(name[0], vmin, vmax))) {\n            this['zoom_' + name + 'min'] = vmin;\n            this['zoom_' + name + 'max'] = vmax;\n            changed = true;\n            zoom_v = false;\n            req.values[indx*2] = vmin; req.values[indx*2+1] = vmax;\n            req.flags[indx*2] = req.flags[indx*2+1] = true;\n         }\n      };\n\n      // first process zooming (if any)\n      if (zoom_v)\n         this.forEachPainter(painter => checkZooming(painter));\n\n      // force zooming when no any other painter can verify zoom range\n      if (!is_any_check && this.self_drawaxes)\n         checkZooming(null, true);\n\n      if (unzoom_v) {\n         if (this[`zoom_${name}min`] !== this[`zoom_${name}max`]) changed = true;\n         this[`zoom_${name}min`] = this[`zoom_${name}max`] = 0;\n         req.values[indx*2] = req.values[indx*2+1] = -1;\n      }\n\n      if (!changed) return false;\n\n      if (this.v7NormalMode())\n         this.v7SubmitRequest('zoom', { _typename: `${nsREX}RFrame::RZoomRequest`, ranges: req });\n\n      return this.interactiveRedraw('pad', `zoom${indx}`).then(() => true);\n   }\n\n   /** @summary Checks if specified axis zoomed */\n   isAxisZoomed(axis) {\n      return this[`zoom_${axis}min`] !== this[`zoom_${axis}max`];\n   }\n\n   /** @summary Unzoom specified axes\n     * @return {Promise} with boolean flag if zoom is changed */\n   async unzoom(dox, doy, doz) {\n      if (dox === 'all')\n         return this.unzoom('x2').then(() => this.unzoom('y2')).then(() => this.unzoom('xyz'));\n\n      if ((dox === 'x2') || (dox === 'y2')) {\n         return this.zoomSingle(dox, 0, 0).then(changed => {\n            if (changed) this.zoomChangedInteractive(dox, 'unzoom');\n            return changed;\n         });\n      }\n\n      if (typeof dox === 'undefined') dox = doy = doz = true; else\n      if (isStr(dox)) { doz = dox.indexOf('z') >= 0; doy = dox.indexOf('y') >= 0; dox = dox.indexOf('x') >= 0; }\n\n      return this.zoom(dox ? 0 : undefined, dox ? 0 : undefined,\n                       doy ? 0 : undefined, doy ? 0 : undefined,\n                       doz ? 0 : undefined, doz ? 0 : undefined).then(changed => {\n         if (changed && dox) this.zoomChangedInteractive('x', 'unzoom');\n         if (changed && doy) this.zoomChangedInteractive('y', 'unzoom');\n         if (changed && doz) this.zoomChangedInteractive('z', 'unzoom');\n\n         return changed;\n      });\n   }\n\n   /** @summary Mark/check if zoom for specific axis was changed interactively\n     * @private */\n   zoomChangedInteractive(axis, value) {\n      if (axis === 'reset') {\n         this.zoom_changed_x = this.zoom_changed_y = this.zoom_changed_z = undefined;\n         return;\n      }\n      if (!axis || axis === 'any')\n         return this.zoom_changed_x || this.zoom_changed_y || this.zoom_changed_z;\n\n      if ((axis !== 'x') && (axis !== 'y') && (axis !== 'z')) return;\n\n      const fld = 'zoom_changed_' + axis;\n      if (value === undefined) return this[fld];\n\n      if (value === 'unzoom') {\n         // special handling of unzoom, only if was never changed before flag set to true\n         this[fld] = (this[fld] === undefined);\n         return;\n      }\n\n      if (value) this[fld] = true;\n   }\n\n   /** @summary Fill menu for frame when server is not there */\n   fillObjectOfflineMenu(menu, kind) {\n      if ((kind !== 'x') && (kind !== 'y')) return;\n\n      menu.add('Unzoom', () => this.unzoom(kind));\n\n      // if (this[kind+'_kind'] === 'normal')\n      //   menu.addchk(this['log'+kind], 'SetLog'+kind, this.toggleAxisLog.bind(this, kind));\n\n      // here should be all axes attributes in offline\n   }\n\n   /** @summary Set grid drawing for specified axis */\n   changeFrameAttr(attr, value) {\n      const changes = {};\n      this.v7AttrChange(changes, attr, value);\n      this.v7SetAttr(attr, value);\n      this.v7SendAttrChanges(changes, false); // do not invoke canvas update on the server\n      this.redrawPad();\n   }\n\n   /** @summary Fill context menu */\n   fillContextMenu(menu, kind /* , obj */) {\n      // when fill and show context menu, remove all zooming\n\n      if (kind === 'pal') kind = 'z';\n\n      if ((kind === 'x') || (kind === 'y') || (kind === 'x2') || (kind === 'y2')) {\n         const handle = this[kind+'_handle'];\n         if (!handle) return false;\n         menu.add('header: ' + kind.toUpperCase() + ' axis');\n         return handle.fillAxisContextMenu(menu, kind);\n      }\n\n      const alone = menu.size() === 0;\n\n      if (alone)\n         menu.add('header:Frame');\n      else\n         menu.add('separator');\n\n      if (this.zoom_xmin !== this.zoom_xmax)\n         menu.add('Unzoom X', () => this.unzoom('x'));\n      if (this.zoom_ymin !== this.zoom_ymax)\n         menu.add('Unzoom Y', () => this.unzoom('y'));\n      if (this.zoom_zmin !== this.zoom_zmax)\n         menu.add('Unzoom Z', () => this.unzoom('z'));\n      if (this.zoom_x2min !== this.zoom_x2max)\n         menu.add('Unzoom X2', () => this.unzoom('x2'));\n      if (this.zoom_y2min !== this.zoom_y2max)\n         menu.add('Unzoom Y2', () => this.unzoom('y2'));\n      menu.add('Unzoom all', () => this.unzoom('all'));\n\n      menu.add('separator');\n\n      menu.addchk(this.isTooltipAllowed(), 'Show tooltips', () => this.setTooltipAllowed('toggle'));\n\n      if (this.x_handle)\n         menu.addchk(this.x_handle.draw_grid, 'Grid x', flag => this.changeFrameAttr('gridX', flag));\n      if (this.y_handle)\n         menu.addchk(this.y_handle.draw_grid, 'Grid y', flag => this.changeFrameAttr('gridY', flag));\n      if (this.x_handle && !this.x2_handle)\n         menu.addchk(this.x_handle.draw_swapside, 'Swap x', flag => this.changeFrameAttr('swapX', flag));\n      if (this.y_handle && !this.y2_handle)\n         menu.addchk(this.y_handle.draw_swapside, 'Swap y', flag => this.changeFrameAttr('swapY', flag));\n      if (this.x_handle && !this.x2_handle) {\n         menu.add('sub:Ticks x');\n         menu.addchk(this.x_handle.draw_ticks === 0, 'off', () => this.changeFrameAttr('ticksX', 0));\n         menu.addchk(this.x_handle.draw_ticks === 1, 'normal', () => this.changeFrameAttr('ticksX', 1));\n         menu.addchk(this.x_handle.draw_ticks === 2, 'ticks on both sides', () => this.changeFrameAttr('ticksX', 2));\n         menu.addchk(this.x_handle.draw_ticks === 3, 'labels on both sides', () => this.changeFrameAttr('ticksX', 3));\n         menu.add('endsub:');\n       }\n      if (this.y_handle && !this.y2_handle) {\n         menu.add('sub:Ticks y');\n         menu.addchk(this.y_handle.draw_ticks === 0, 'off', () => this.changeFrameAttr('ticksY', 0));\n         menu.addchk(this.y_handle.draw_ticks === 1, 'normal', () => this.changeFrameAttr('ticksY', 1));\n         menu.addchk(this.y_handle.draw_ticks === 2, 'ticks on both sides', () => this.changeFrameAttr('ticksY', 2));\n         menu.addchk(this.y_handle.draw_ticks === 3, 'labels on both sides', () => this.changeFrameAttr('ticksY', 3));\n         menu.add('endsub:');\n       }\n\n      menu.addAttributesMenu(this, alone ? '' : 'Frame ');\n      menu.add('separator');\n\n      menu.add('sub:Save as');\n      ['svg', 'png', 'jpeg', 'pdf', 'webp'].forEach(fmt => menu.add(`frame.${fmt}`, () => this.getPadPainter().saveAs(fmt, 'frame', `frame.${fmt}`)));\n      menu.add('endsub:');\n\n      return true;\n   }\n\n   /** @summary Convert graphical coordinate into axis value */\n   revertAxis(axis, pnt) { return this[`${axis}_handle`]?.revertPoint(pnt) ?? 0; }\n\n   /** @summary Show axis status message\n     * @desc method called normally when mouse enter main object element\n     * @private */\n   showAxisStatus(axis_name, evnt) {\n      const hint_name = axis_name, hint_title = 'axis',\n            m = d3_pointer(evnt, this.getFrameSvg().node());\n      let id = (axis_name === 'x') ? 0 : 1;\n\n      if (this.swap_xy) id = 1 - id;\n\n      const axis_value = this.revertAxis(axis_name, m[id]);\n\n      this.showObjectStatus(hint_name, hint_title, `${axis_name} : ${this.axisAsText(axis_name, axis_value)}`, `${Math.round(m[0])},${Math.round(m[1])}`);\n   }\n\n   /** @summary Add interactive keys handlers\n    * @private */\n   addKeysHandler() {\n      if (this.isBatchMode()) return;\n      FrameInteractive.assign(this);\n      this.addFrameKeysHandler();\n   }\n\n   /** @summary Add interactive functionality to the frame\n    * @private */\n   addInteractivity(for_second_axes) {\n      if (this.isBatchMode() || (!settings.Zooming && !settings.ContextMenu))\n         return true;\n\n      FrameInteractive.assign(this);\n      if (!for_second_axes)\n         this.addBasicInteractivity();\n      return this.addFrameInteractivity(for_second_axes);\n   }\n\n   /** @summary Set selected range back to pad object - to be implemented\n     * @private */\n   setRootPadRange(/* pad, is3d */) {\n      // TODO: change of pad range and send back to root application\n   }\n\n   /** @summary Toggle log scale on the specified axes */\n   toggleAxisLog(axis) {\n      const handle = this[axis+'_handle'];\n      return handle?.changeAxisLog('toggle');\n   }\n\n} // class RFramePainter\n\nexport { RFramePainter };\n","import { gStyle, settings, constants, internals, addMethods,\n         isPromise, getPromise, postponePromise, isBatchMode, isObject, isFunc, isStr, clTPad, nsREX } from '../core.mjs';\nimport { ColorPalette, addColor, getRootColors } from '../base/colors.mjs';\nimport { RObjectPainter } from '../base/RObjectPainter.mjs';\nimport { getElementRect, getAbsPosInCanvas, DrawOptions, compressSVG, makeTranslate, svgToImage } from '../base/BasePainter.mjs';\nimport { selectActivePad, getActivePad } from '../base/ObjectPainter.mjs';\nimport { registerForResize, saveFile } from '../gui/utils.mjs';\nimport { BrowserLayout } from '../gui/display.mjs';\nimport { createMenu, closeMenu } from '../gui/menu.mjs';\nimport { PadButtonsHandler } from './TPadPainter.mjs';\n\n\n/**\n * @summary Painter class for RPad\n *\n * @private\n */\n\nclass RPadPainter extends RObjectPainter {\n\n   /** @summary constructor */\n   constructor(dom, pad, iscan) {\n      super(dom, pad, '', 'pad');\n      this.pad = pad;\n      this.iscan = iscan; // indicate if working with canvas\n      this.this_pad_name = '';\n      if (!this.iscan && (pad !== null)) {\n         if (pad.fObjectID)\n            this.this_pad_name = 'pad' + pad.fObjectID; // use objectid as padname\n         else\n            this.this_pad_name = 'ppp' + internals.id_counter++; // artificical name\n      }\n      this.painters = []; // complete list of all painters in the pad\n      this.has_canvas = true;\n      this.forEachPainter = this.forEachPainterInPad;\n\n      const d = this.selectDom();\n      if (!d.empty() && d.property('_batch_mode'))\n         this.batch_mode = true;\n   }\n\n   /** @summary Indicates that drawing runs in batch mode\n     * @private */\n   isBatchMode() {\n      if (this.batch_mode !== undefined)\n         return this.batch_mode;\n\n      if (isBatchMode())\n         return true;\n\n      if (!this.iscan && this.has_canvas)\n         return this.getCanvPainter()?.isBatchMode();\n\n      return false;\n   }\n\n   /** @summary Indicates that is not Root6 pad painter\n    * @private */\n   isRoot6() { return false; }\n\n   /** @summary Returns true if pad is editable */\n   isEditable() {\n      return true;\n   }\n\n  /** @summary Returns SVG element for the pad itself\n    * @private */\n   svg_this_pad() {\n      return this.getPadSvg(this.this_pad_name);\n   }\n\n   /** @summary Returns main painter on the pad\n     * @desc Typically main painter is TH1/TH2 object which is drawing axes\n    * @private */\n   getMainPainter() {\n      return this.main_painter_ref || null;\n   }\n\n   /** @summary Assign main painter on the pad\n    * @private */\n   setMainPainter(painter, force) {\n      if (!this.main_painter_ref || force)\n         this.main_painter_ref = painter;\n   }\n\n   /** @summary cleanup pad and all primitives inside */\n   cleanup() {\n      if (this._doing_draw)\n         console.error('pad drawing is not completed when cleanup is called');\n\n      this.painters.forEach(p => p.cleanup());\n\n      const svg_p = this.svg_this_pad();\n      if (!svg_p.empty()) {\n         svg_p.property('pad_painter', null);\n         if (!this.iscan) svg_p.remove();\n      }\n\n      delete this.main_painter_ref;\n      delete this.frame_painter_ref;\n      delete this.pads_cache;\n      delete this._pad_x;\n      delete this._pad_y;\n      delete this._pad_width;\n      delete this._pad_height;\n      delete this._doing_draw;\n      delete this._dfltRFont;\n\n      this.painters = [];\n      this.pad = null;\n      this.draw_object = null;\n      this.pad_frame = null;\n      this.this_pad_name = undefined;\n      this.has_canvas = false;\n\n      selectActivePad({ pp: this, active: false });\n\n      super.cleanup();\n   }\n\n   /** @summary Returns frame painter inside the pad\n    * @private */\n   getFramePainter() { return this.frame_painter_ref; }\n\n   /** @summary get pad width */\n   getPadWidth() { return this._pad_width || 0; }\n\n   /** @summary get pad height */\n   getPadHeight() { return this._pad_height || 0; }\n\n   /** @summary get pad rect */\n   getPadRect() {\n      return {\n         x: this._pad_x || 0,\n         y: this._pad_y || 0,\n         width: this.getPadWidth(),\n         height: this.getPadHeight()\n      };\n   }\n\n   /** @summary Returns frame coordiantes - also when frame is not drawn */\n   getFrameRect() {\n      const fp = this.getFramePainter();\n      if (fp) return fp.getFrameRect();\n\n      const w = this.getPadWidth(),\n            h = this.getPadHeight(),\n            rect = {};\n\n      rect.szx = Math.round(0.5*w);\n      rect.szy = Math.round(0.5*h);\n      rect.width = 2*rect.szx;\n      rect.height = 2*rect.szy;\n      rect.x = Math.round(w/2 - rect.szx);\n      rect.y = Math.round(h/2 - rect.szy);\n      rect.hint_delta_x = rect.szx;\n      rect.hint_delta_y = rect.szy;\n      rect.transform = makeTranslate(rect.x, rect.y) || '';\n      return rect;\n   }\n\n   /** @summary return RPad object */\n   getRootPad(is_root6) {\n      return (is_root6 === undefined) || !is_root6 ? this.pad : null;\n   }\n\n   /** @summary Cleanup primitives from pad - selector lets define which painters to remove\n    * @private */\n   cleanPrimitives(selector) {\n      if (!isFunc(selector)) return;\n\n      for (let k = this.painters.length-1; k >= 0; --k) {\n         if (selector(this.painters[k])) {\n            this.painters[k].cleanup();\n            this.painters.splice(k, 1);\n         }\n      }\n   }\n\n   /** @summary Removes and cleanup specified primitive\n     * @desc also secondary primitives will be removed\n     * @return new index to continue loop or -111 if main painter removed\n     * @private */\n   removePrimitive(indx) {\n      const prim = this.painters[indx], arr = [];\n      let resindx = indx;\n      for (let k = this.painters.length-1; k >= 0; --k) {\n         if ((k === indx) || this.painters[k].isSecondary(prim)) {\n            arr.push(this.painters[k]);\n            this.painters.splice(k, 1);\n            if (k <= indx) resindx--;\n         }\n      }\n\n      arr.forEach(painter => {\n         painter.cleanup();\n         if (this.main_painter_ref === painter) {\n            delete this.main_painter_ref;\n            resindx = -111;\n         }\n      });\n\n      return resindx;\n   }\n\n   /** @summary try to find object by name in list of pad primitives\n     * @desc used to find title drawing\n     * @private */\n   findInPrimitives(objname, objtype) {\n      console.warn('findInPrimitives not implemented for RPad');\n      return null;\n   }\n\n   /** @summary Try to find painter for specified object\n     * @desc can be used to find painter for some special objects, registered as\n     * histogram functions\n     * @private */\n   findPainterFor(selobj, selname, seltype) {\n      return this.painters.find(p => {\n         const pobj = p.getObject();\n         if (!pobj) return false;\n\n         if (selobj && (pobj === selobj)) return true;\n         if (!selname && !seltype) return false;\n         if (selname && (pobj.fName !== selname)) return false;\n         if (seltype && (pobj._typename !== seltype)) return false;\n         return true;\n      });\n   }\n\n   /** @summary Returns palette associated with pad.\n     * @desc Either from existing palette painter or just default palette */\n   getHistPalette() {\n      const pp = this.findPainterFor(undefined, undefined, `${nsREX}RPaletteDrawable`);\n\n      if (pp) return pp.getHistPalette();\n\n      if (!this.fDfltPalette) {\n         this.fDfltPalette = {\n            _typename: `${nsREX}RPalette`,\n            fColors: [{ fOrdinal: 0, fColor: { fColor: 'rgb(53, 42, 135)' } },\n                      { fOrdinal: 0.125, fColor: { fColor: 'rgb(15, 92, 221)' } },\n                      { fOrdinal: 0.25, fColor: { fColor: 'rgb(20, 129, 214)' } },\n                      { fOrdinal: 0.375, fColor: { fColor: 'rgb(6, 164, 202)' } },\n                      { fOrdinal: 0.5, fColor: { fColor: 'rgb(46, 183, 164)' } },\n                      { fOrdinal: 0.625, fColor: { fColor: 'rgb(135, 191, 119)' } },\n                      { fOrdinal: 0.75, fColor: { fColor: 'rgb(209, 187, 89)' } },\n                      { fOrdinal: 0.875, fColor: { fColor: 'rgb(254, 200, 50)' } },\n                      { fOrdinal: 1, fColor: { fColor: 'rgb(249, 251, 14)' } }],\n             fInterpolate: true,\n             fNormalized: true\n         };\n         addMethods(this.fDfltPalette, `${nsREX}RPalette`);\n      }\n\n      return this.fDfltPalette;\n   }\n\n   /** @summary Returns number of painters\n     * @private */\n   getNumPainters() { return this.painters.length; }\n\n   /** @summary Call function for each painter in pad\n     * @param {function} userfunc - function to call\n     * @param {string} kind - 'all' for all objects (default), 'pads' only pads and subpads, 'objects' only for object in current pad\n     * @private */\n   forEachPainterInPad(userfunc, kind) {\n      if (!kind) kind = 'all';\n      if (kind !== 'objects') userfunc(this);\n      for (let k = 0; k < this.painters.length; ++k) {\n         const sub = this.painters[k];\n         if (isFunc(sub.forEachPainterInPad)) {\n            if (kind !== 'objects') sub.forEachPainterInPad(userfunc, kind);\n         } else if (kind !== 'pads') userfunc(sub);\n      }\n   }\n\n   /** @summary register for pad events receiver\n     * @desc in pad painter, while pad may be drawn without canvas\n     * @private */\n   registerForPadEvents(receiver) {\n      this.pad_events_receiver = receiver;\n   }\n\n   /** @summary Generate pad events, normally handled by GED\n     * @desc in pad painter, while pad may be drawn without canvas\n     * @private */\n   producePadEvent(what, padpainter, painter, position, place) {\n      if ((what === 'select') && isFunc(this.selectActivePad))\n         this.selectActivePad(padpainter, painter, position);\n\n      if (this.pad_events_receiver)\n         this.pad_events_receiver({ what, padpainter, painter, position, place });\n   }\n\n   /** @summary method redirect call to pad events receiver */\n   selectObjectPainter(painter, pos, place) {\n      const istoppad = (this.iscan || !this.has_canvas),\n          canp = istoppad ? this : this.getCanvPainter();\n\n      if (painter === undefined) painter = this;\n\n      if (pos && !istoppad)\n         pos = getAbsPosInCanvas(this.svg_this_pad(), pos);\n\n      selectActivePad({ pp: this, active: true });\n\n      canp.producePadEvent('select', this, painter, pos, place);\n   }\n\n   /** @summary Set fast drawing property depending on the size\n     * @private */\n   setFastDrawing(w, h) {\n      const was_fast = this._fast_drawing;\n      this._fast_drawing = settings.SmallPad && ((w < settings.SmallPad.width) || (h < settings.SmallPad.height));\n      if (was_fast !== this._fast_drawing)\n         this.showPadButtons();\n   }\n\n   /** @summary Returns true if canvas configured with grayscale\n     * @private */\n   isGrayscale() {\n      return false;\n   }\n\n   /** @summary Set grayscale mode for the canvas\n     * @private */\n   setGrayscale(/* flag */) {\n      console.error('grayscale mode not implemented for RCanvas');\n   }\n\n   /** @summary Create SVG element for the canvas */\n   createCanvasSvg(check_resize, new_size) {\n      const lmt = 5;\n      let factor = null, svg = null, rect = null, btns, frect;\n\n      if (check_resize > 0) {\n         if (this._fixed_size)\n            return check_resize > 1; // flag used to force re-drawing of all subpads\n\n         svg = this.getCanvSvg();\n         if (svg.empty())\n            return false;\n\n         factor = svg.property('height_factor');\n\n         rect = this.testMainResize(check_resize, null, factor);\n\n         if (!rect.changed && (check_resize === 1))\n            return false;\n\n         if (!this.isBatchMode())\n            btns = this.getLayerSvg('btns_layer', this.this_pad_name);\n\n         frect = svg.selectChild('.canvas_fillrect');\n      } else {\n         const render_to = this.selectDom();\n\n         if (render_to.style('position') === 'static')\n            render_to.style('position', 'relative');\n\n         svg = render_to.append('svg')\n             .attr('class', 'jsroot root_canvas')\n             .property('pad_painter', this) // this is custom property\n             .property('current_pad', '') // this is custom property\n             .property('redraw_by_resize', false); // could be enabled to force redraw by each resize\n\n         this.setTopPainter(); // assign canvas as top painter of that element\n\n         if (!this.isBatchMode() && !this.online_canvas)\n            svg.append('svg:title').text('ROOT canvas');\n\n         frect = svg.append('svg:path').attr('class', 'canvas_fillrect');\n         if (!this.isBatchMode()) {\n            frect.style('pointer-events', 'visibleFill')\n                 .on('dblclick', evnt => this.enlargePad(evnt, true))\n                 .on('click', () => this.selectObjectPainter(this, null))\n                 .on('mouseenter', () => this.showObjectStatus())\n                 .on('contextmenu', settings.ContextMenu ? evnt => this.padContextMenu(evnt) : null);\n         }\n\n         svg.append('svg:g').attr('class', 'primitives_layer');\n         svg.append('svg:g').attr('class', 'info_layer');\n         if (!this.isBatchMode()) {\n            btns = svg.append('svg:g')\n                      .attr('class', 'btns_layer')\n                      .property('leftside', settings.ToolBarSide === 'left')\n                      .property('vertical', settings.ToolBarVert);\n         }\n\n         factor = 0.66;\n         if (this.pad && this.pad.fWinSize[0] && this.pad.fWinSize[1]) {\n            factor = this.pad.fWinSize[1] / this.pad.fWinSize[0];\n            if ((factor < 0.1) || (factor > 10)) factor = 0.66;\n         }\n\n         if (this._fixed_size) {\n            render_to.style('overflow', 'auto');\n            rect = { width: this.pad.fWinSize[0], height: this.pad.fWinSize[1] };\n            if (!rect.width || !rect.height)\n               rect = getElementRect(render_to);\n         } else\n            rect = this.testMainResize(2, new_size, factor);\n      }\n\n      this.createAttFill({ pattern: 1001, color: 0 });\n\n      if ((rect.width <= lmt) || (rect.height <= lmt)) {\n         svg.style('display', 'none');\n         console.warn(`Hide canvas while geometry too small w=${rect.width} h=${rect.height}`);\n         rect.width = 200; rect.height = 100; // just to complete drawing\n      } else\n         svg.style('display', null);\n\n      if (this._fixed_size) {\n         svg.attr('x', 0)\n            .attr('y', 0)\n            .attr('width', rect.width)\n            .attr('height', rect.height)\n            .style('position', 'absolute');\n      } else {\n        svg.attr('x', 0)\n           .attr('y', 0)\n           .style('width', '100%')\n           .style('height', '100%')\n           .style('position', 'absolute')\n           .style('left', 0).style('top', 0).style('bottom', 0).style('right', 0);\n      }\n\n      svg.style('filter', settings.DarkMode ? 'invert(100%)' : null);\n\n      svg.attr('viewBox', `0 0 ${rect.width} ${rect.height}`)\n         .attr('preserveAspectRatio', 'none')  // we do not preserve relative ratio\n         .property('height_factor', factor)\n         .property('draw_x', 0)\n         .property('draw_y', 0)\n         .property('draw_width', rect.width)\n         .property('draw_height', rect.height);\n\n      this._pad_x = 0;\n      this._pad_y = 0;\n      this._pad_width = rect.width;\n      this._pad_height = rect.height;\n\n      frect.attr('d', `M0,0H${rect.width}V${rect.height}H0Z`)\n           .call(this.fillatt.func);\n\n      this.setFastDrawing(rect.width, rect.height);\n\n      if (this.alignButtons && btns)\n         this.alignButtons(btns, rect.width, rect.height);\n\n      return true;\n   }\n\n   /** @summary Draw item name on canvas, dummy for RPad\n     * @private */\n   drawItemNameOnCanvas() {\n   }\n\n   /** @summary Enlarge pad draw element when possible */\n   enlargePad(evnt, is_dblclick, is_escape) {\n      evnt?.preventDefault();\n      evnt?.stopPropagation();\n\n      // ignore double click on canvas itself for enlarge\n      if (is_dblclick && this._websocket && (this.enlargeMain('state') === 'off'))\n         return;\n\n      const svg_can = this.getCanvSvg(),\n            pad_enlarged = svg_can.property('pad_enlarged');\n\n      if (this.iscan || !this.has_canvas || (!pad_enlarged && !this.hasObjectsToDraw() && !this.painters)) {\n         if (this._fixed_size) return; // canvas cannot be enlarged in such mode\n         if (!this.enlargeMain(is_escape ? false : 'toggle')) return;\n         if (this.enlargeMain('state') === 'off')\n            svg_can.property('pad_enlarged', null);\n         else\n            selectActivePad({ pp: this, active: true });\n      } else if (!pad_enlarged && !is_escape) {\n         this.enlargeMain(true, true);\n         svg_can.property('pad_enlarged', this.pad);\n         selectActivePad({ pp: this, active: true });\n      } else if (pad_enlarged === this.pad) {\n         this.enlargeMain(false);\n         svg_can.property('pad_enlarged', null);\n      } else if (!is_escape && is_dblclick)\n         console.error('missmatch with pad double click events');\n\n      return this.checkResize(true);\n   }\n\n   /** @summary Create SVG element for the pad\n     * @return true when pad is displayed and all its items should be redrawn */\n   createPadSvg(only_resize) {\n      if (!this.has_canvas) {\n         this.createCanvasSvg(only_resize ? 2 : 0);\n         return true;\n      }\n\n      const svg_parent = this.getPadSvg(this.pad_name), // this.pad_name MUST be here to select parent pad\n            svg_can = this.getCanvSvg(),\n            width = svg_parent.property('draw_width'),\n            height = svg_parent.property('draw_height'),\n            pad_enlarged = svg_can.property('pad_enlarged');\n      let pad_visible = true,\n          w = width, h = height, x = 0, y = 0,\n          svg_pad = null, svg_rect = null, btns = null;\n\n      if (this.pad?.fPos && this.pad?.fSize) {\n         x = Math.round(width * this.pad.fPos.fHoriz.fArr[0]);\n         y = Math.round(height * this.pad.fPos.fVert.fArr[0]);\n         w = Math.round(width * this.pad.fSize.fHoriz.fArr[0]);\n         h = Math.round(height * this.pad.fSize.fVert.fArr[0]);\n      }\n\n      if (pad_enlarged) {\n         pad_visible = false;\n         if (pad_enlarged === this.pad)\n            pad_visible = true;\n         else\n            this.forEachPainterInPad(pp => { if (pp.getObject() === pad_enlarged) pad_visible = true; }, 'pads');\n\n         if (pad_visible) { w = width; h = height; x = y = 0; }\n      }\n\n      if (only_resize) {\n         svg_pad = this.svg_this_pad();\n         svg_rect = svg_pad.selectChild('.root_pad_border');\n         if (!this.isBatchMode())\n            btns = this.getLayerSvg('btns_layer', this.this_pad_name);\n      } else {\n         svg_pad = svg_parent.selectChild('.primitives_layer')\n             .append('svg:svg') // here was g before, svg used to blend all drawin outside\n             .classed('__root_pad_' + this.this_pad_name, true)\n             .attr('pad', this.this_pad_name) // set extra attribute  to mark pad name\n             .property('pad_painter', this); // this is custom property\n\n         if (!this.isBatchMode())\n            svg_pad.append('svg:title').text('ROOT subpad');\n\n         svg_rect = svg_pad.append('svg:path').attr('class', 'root_pad_border');\n\n         svg_pad.append('svg:g').attr('class', 'primitives_layer');\n         if (!this.isBatchMode()) {\n            btns = svg_pad.append('svg:g')\n                          .attr('class', 'btns_layer')\n                          .property('leftside', settings.ToolBarSide !== 'left')\n                          .property('vertical', settings.ToolBarVert);\n         }\n\n         if (settings.ContextMenu)\n            svg_rect.on('contextmenu', evnt => this.padContextMenu(evnt));\n\n         if (!this.isBatchMode()) {\n            svg_rect.style('pointer-events', 'visibleFill') // get events also for not visible rect\n                    .on('dblclick', evnt => this.enlargePad(evnt, true))\n                    .on('click', () => this.selectObjectPainter(this, null))\n                    .on('mouseenter', () => this.showObjectStatus());\n         }\n      }\n\n      this.createAttFill({ attr: this.pad });\n\n      this.createAttLine({ attr: this.pad, color0: this.pad.fBorderMode === 0 ? 'none' : '' });\n\n      svg_pad.style('display', pad_visible ? null : 'none')\n             .attr('viewBox', `0 0 ${w} ${h}`) // due to svg\n             .attr('preserveAspectRatio', 'none')   // due to svg, we do not preserve relative ratio\n             .attr('x', x)    // due to svg\n             .attr('y', y)   // due to svg\n             .attr('width', w)    // due to svg\n             .attr('height', h)   // due to svg\n             .property('draw_x', x) // this is to make similar with canvas\n             .property('draw_y', y)\n             .property('draw_width', w)\n             .property('draw_height', h);\n\n      this._pad_x = x;\n      this._pad_y = y;\n      this._pad_width = w;\n      this._pad_height = h;\n\n      svg_rect.attr('d', `M0,0H${w}V${h}H0Z`)\n              .call(this.fillatt.func)\n              .call(this.lineatt.func);\n\n      this.setFastDrawing(w, h);\n\n      // special case of 3D canvas overlay\n      if (svg_pad.property('can3d') === constants.Embed3D.Overlay) {\n         this.selectDom().select('.draw3d_' + this.this_pad_name)\n             .style('display', pad_visible ? '' : 'none');\n      }\n\n      if (this.alignButtons && btns) this.alignButtons(btns, w, h);\n\n      return pad_visible;\n   }\n\n   /** @summary returns true if any objects beside sub-pads exists in the pad */\n   hasObjectsToDraw() {\n      return this.pad?.fPrimitives?.find(obj => obj._typename !== `${nsREX}RPadDisplayItem`);\n   }\n\n   /** @summary sync drawing/redrawing/resize of the pad\n     * @param {string} kind - kind of draw operation, if true - always queued\n     * @return {Promise} when pad is ready for draw operation or false if operation already queued\n     * @private */\n   syncDraw(kind) {\n      const entry = { kind: kind || 'redraw' };\n      if (this._doing_draw === undefined) {\n         this._doing_draw = [entry];\n         return Promise.resolve(true);\n      }\n      // if queued operation registered, ignore next calls, indx === 0 is running operation\n      if ((entry.kind !== true) && (this._doing_draw.findIndex((e, i) => (i > 0) && (e.kind === entry.kind)) > 0))\n         return false;\n      this._doing_draw.push(entry);\n      return new Promise(resolveFunc => {\n         entry.func = resolveFunc;\n      });\n   }\n\n   /** @summary confirms that drawing is completed, may trigger next drawing immediately\n     * @private */\n   confirmDraw() {\n      if (this._doing_draw === undefined)\n         return console.warn('failure, should not happen');\n      this._doing_draw.shift();\n      if (this._doing_draw.length === 0)\n         delete this._doing_draw;\n      else {\n         const entry = this._doing_draw[0];\n         if (entry.func) { entry.func(); delete entry.func; }\n      }\n   }\n\n   /** @summary Draw single primitive */\n   async drawObject(/* dom, obj, opt */) {\n      console.log('Not possible to draw object without loading of draw.mjs');\n      return null;\n   }\n\n   /** @summary Draw pad primitives\n     * @private */\n   async drawPrimitives(indx) {\n      if (indx === undefined) {\n         if (this.iscan)\n            this._start_tm = new Date().getTime();\n\n         // set number of primitves\n         this._num_primitives = this.pad?.fPrimitives?.length ?? 0;\n\n         return this.syncDraw(true).then(() => this.drawPrimitives(0));\n      }\n\n      if (!this.pad || (indx >= this._num_primitives)) {\n         this.confirmDraw();\n\n         if (this._start_tm) {\n            const spenttm = new Date().getTime() - this._start_tm;\n            if (spenttm > 3000) console.log(`Canvas drawing took ${(spenttm*1e-3).toFixed(2)}s`);\n            delete this._start_tm;\n         }\n\n         return;\n      }\n\n      // handle used to invoke callback only when necessary\n      return this.drawObject(this.getDom(), this.pad.fPrimitives[indx], '').then(op => {\n         // mark painter as belonging to primitives\n         if (isObject(op))\n            op._primitive = true;\n\n         return this.drawPrimitives(indx+1);\n      });\n   }\n\n   /** @summary Process tooltip event in the pad\n     * @private */\n   processPadTooltipEvent(pnt) {\n      const painters = [], hints = [];\n\n      // first count - how many processors are there\n      this.painters?.forEach(obj => {\n         if (isFunc(obj.processTooltipEvent)) painters.push(obj);\n      });\n\n      if (pnt) pnt.nproc = painters.length;\n\n      painters.forEach(obj => {\n         const hint = obj.processTooltipEvent(pnt) || { user_info: null };\n         hints.push(hint);\n         if (pnt?.painters) hint.painter = obj;\n      });\n\n      return hints;\n   }\n\n   /** @summary Changes canvas dark mode\n     * @private */\n   changeDarkMode(mode) {\n      this.getCanvSvg().style('filter', (mode ?? settings.DarkMode) ? 'invert(100%)' : null);\n   }\n\n   /** @summary Fill pad context menu\n     * @private */\n   fillContextMenu(menu) {\n      if (this.iscan)\n         menu.add('header: RCanvas');\n      else\n         menu.add('header: RPad');\n\n      menu.addchk(this.isTooltipAllowed(), 'Show tooltips', () => this.setTooltipAllowed('toggle'));\n\n      if (!this._websocket) {\n         menu.addAttributesMenu(this);\n         if (this.iscan) {\n            menu.addSettingsMenu(false, false, arg => {\n               if (arg === 'dark') this.changeDarkMode();\n            });\n         }\n      }\n\n      menu.add('separator');\n\n      if (isFunc(this.hasMenuBar) && isFunc(this.actiavteMenuBar))\n         menu.addchk(this.hasMenuBar(), 'Menu bar', flag => this.actiavteMenuBar(flag));\n\n      if (isFunc(this.hasEventStatus) && isFunc(this.activateStatusBar) && isFunc(this.canStatusBar)) {\n         if (this.canStatusBar())\n            menu.addchk(this.hasEventStatus(), 'Event status', () => this.activateStatusBar('toggle'));\n      }\n\n      if (this.enlargeMain() || (this.has_canvas && this.hasObjectsToDraw()))\n         menu.addchk((this.enlargeMain('state') === 'on'), 'Enlarge ' + (this.iscan ? 'canvas' : 'pad'), () => this.enlargePad());\n\n      const fname = this.this_pad_name || (this.iscan ? 'canvas' : 'pad');\n      menu.add('sub:Save as');\n      ['svg', 'png', 'jpeg', 'pdf', 'webp'].forEach(fmt => menu.add(`${fname}.${fmt}`, () => this.saveAs(fmt, this.iscan, `${fname}.${fmt}`)));\n      menu.add('endsub:');\n\n      return true;\n   }\n\n   /** @summary Show pad context menu\n     * @private */\n   padContextMenu(evnt) {\n      if (evnt.stopPropagation) {\n         // this is normal event processing and not emulated jsroot event\n\n         evnt.stopPropagation(); // disable main context menu\n         evnt.preventDefault();  // disable browser context menu\n\n         this.getFramePainter()?.setLastEventPos();\n      }\n\n      createMenu(evnt, this).then(menu => {\n         this.fillContextMenu(menu);\n         return this.fillObjectExecMenu(menu);\n      }).then(menu => menu.show());\n   }\n\n   /** @summary Redraw pad means redraw ourself\n     * @return {Promise} when redrawing ready */\n   async redrawPad(reason) {\n      const sync_promise = this.syncDraw(reason);\n      if (sync_promise === false) {\n         console.log('Prevent RPad redrawing');\n         return false;\n      }\n\n      let showsubitems = true;\n      const redrawNext = indx => {\n         while (indx < this.painters.length) {\n            const sub = this.painters[indx++];\n            let res = 0;\n            if (showsubitems || sub.this_pad_name)\n               res = sub.redraw(reason);\n\n            if (isPromise(res))\n               return res.then(() => redrawNext(indx));\n         }\n         return true;\n      };\n\n      return sync_promise.then(() => {\n         if (this.iscan)\n            this.createCanvasSvg(2);\n          else\n            showsubitems = this.createPadSvg(true);\n\n         return redrawNext(0);\n      }).then(() => {\n         if (getActivePad() === this)\n            this.getCanvPainter()?.producePadEvent('padredraw', this);\n         this.confirmDraw();\n         return true;\n      });\n   }\n\n   /** @summary redraw pad */\n   redraw(reason) {\n      return this.redrawPad(reason);\n   }\n\n\n   /** @summary Checks if pad should be redrawn by resize\n     * @private */\n   needRedrawByResize() {\n      const elem = this.svg_this_pad();\n      if (!elem.empty() && elem.property('can3d') === constants.Embed3D.Overlay) return true;\n\n      for (let i = 0; i < this.painters.length; ++i) {\n         if (isFunc(this.painters[i].needRedrawByResize))\n            if (this.painters[i].needRedrawByResize()) return true;\n      }\n\n      return false;\n   }\n\n   /** @summary Check resize of canvas */\n   checkCanvasResize(size, force) {\n      if (this._ignore_resize)\n         return false;\n\n      if (!this.iscan && this.has_canvas) return false;\n\n      const sync_promise = this.syncDraw('canvas_resize');\n      if (sync_promise === false) return false;\n\n      if ((size === true) || (size === false)) { force = size; size = null; }\n\n      if (isObject(size) && size.force) force = true;\n\n      if (!force) force = this.needRedrawByResize();\n\n      let changed = false;\n      const redrawNext = indx => {\n         if (!changed || (indx >= this.painters.length)) {\n            this.confirmDraw();\n            return changed;\n         }\n\n         return getPromise(this.painters[indx].redraw(force ? 'redraw' : 'resize')).then(() => redrawNext(indx+1));\n      };\n\n\n      return sync_promise.then(() => {\n         changed = this.createCanvasSvg(force ? 2 : 1, size);\n\n         if (changed && this.iscan && this.pad && this.online_canvas && !this.embed_canvas && !this.isBatchMode()) {\n            if (this._resize_tmout)\n               clearTimeout(this._resize_tmout);\n            this._resize_tmout = setTimeout(() => {\n               delete this._resize_tmout;\n               if (!this.pad?.fWinSize) return;\n               const cw = this.getPadWidth(), ch = this.getPadHeight();\n               if ((cw > 0) && (ch > 0) && ((this.pad.fWinSize[0] !== cw) || (this.pad.fWinSize[1] !== ch))) {\n                  this.pad.fWinSize[0] = cw;\n                  this.pad.fWinSize[1] = ch;\n                  this.sendWebsocket(`RESIZED:[${cw},${ch}]`);\n               }\n            }, 1000); // long enough delay to prevent multiple occurence\n         }\n\n         // if canvas changed, redraw all its subitems.\n         // If redrawing was forced for canvas, same applied for sub-elements\n         return redrawNext(0);\n      });\n   }\n\n   /** @summary update RPad object\n     * @private */\n   updateObject(obj) {\n      if (!obj) return false;\n\n      this.pad.fStyle = obj.fStyle;\n      this.pad.fAttr = obj.fAttr;\n\n      if (this.iscan) {\n         this.pad.fTitle = obj.fTitle;\n         this.pad.fWinSize = obj.fWinSize;\n      } else {\n         this.pad.fPos = obj.fPos;\n         this.pad.fSize = obj.fSize;\n      }\n\n      return true;\n   }\n\n\n   /** @summary Add object painter to list of primitives\n     * @private */\n   addObjectPainter(objpainter, lst, indx) {\n      if (objpainter && lst && lst[indx] && (objpainter.snapid === undefined)) {\n         // keep snap id in painter, will be used for the\n         if (this.painters.indexOf(objpainter) < 0)\n            this.painters.push(objpainter);\n         objpainter.assignSnapId(lst[indx].fObjectID);\n         if (!objpainter.rstyle) objpainter.rstyle = lst[indx].fStyle || this.rstyle;\n      }\n   }\n\n   /** @summary Extract properties from TObjectDisplayItem */\n   extractTObjectProp(snap) {\n      if (snap.fColIndex && snap.fColValue) {\n         const colors = this.root_colors || getRootColors();\n         for (let k = 0; k < snap.fColIndex.length; ++k)\n            colors[snap.fColIndex[k]] = snap.fColValue[k];\n       }\n\n      // painter used only for evaluation of attributes\n      const pattr = new RObjectPainter(), obj = snap.fObject;\n      pattr.assignObject(snap);\n      pattr.csstype = snap.fCssType;\n      pattr.rstyle = snap.fStyle;\n\n      snap.fOption = pattr.v7EvalAttr('options', '');\n\n      const extract_color = (member_name, attr_name) => {\n         const col = pattr.v7EvalColor(attr_name, '');\n         if (col) obj[member_name] = addColor(col, this.root_colors);\n      };\n\n      // handle TAttLine\n      if ((obj.fLineColor !== undefined) && (obj.fLineWidth !== undefined) && (obj.fLineStyle !== undefined)) {\n         extract_color('fLineColor', 'line_color');\n         obj.fLineWidth = pattr.v7EvalAttr('line_width', obj.fLineWidth);\n         obj.fLineStyle = pattr.v7EvalAttr('line_style', obj.fLineStyle);\n      }\n\n      // handle TAttFill\n      if ((obj.fFillColor !== undefined) && (obj.fFillStyle !== undefined)) {\n         extract_color('fFillColor', 'fill_color');\n         obj.fFillStyle = pattr.v7EvalAttr('fill_style', obj.fFillStyle);\n      }\n\n      // handle TAttMarker\n      if ((obj.fMarkerColor !== undefined) && (obj.fMarkerStyle !== undefined) && (obj.fMarkerSize !== undefined)) {\n         extract_color('fMarkerColor', 'marker_color');\n         obj.fMarkerStyle = pattr.v7EvalAttr('marker_style', obj.fMarkerStyle);\n         obj.fMarkerSize = pattr.v7EvalAttr('marker_size', obj.fMarkerSize);\n      }\n\n      // handle TAttText\n      if ((obj.fTextColor !== undefined) && (obj.fTextAlign !== undefined) && (obj.fTextAngle !== undefined) && (obj.fTextSize !== undefined)) {\n         extract_color('fTextColor', 'text_color');\n         obj.fTextAlign = pattr.v7EvalAttr('text_align', obj.fTextAlign);\n         obj.fTextAngle = pattr.v7EvalAttr('text_angle', obj.fTextAngle);\n         obj.fTextSize = pattr.v7EvalAttr('text_size', obj.fTextSize);\n         // TODO: v7 font handling differs much from v6, ignore for the moment\n      }\n   }\n\n   /** @summary Function called when drawing next snapshot from the list\n     * @return {Promise} with pad painter when ready\n     * @private */\n   async drawNextSnap(lst, indx) {\n      if (indx === undefined) {\n         indx = -1;\n         // flag used to prevent immediate pad redraw during first draw\n         this._snaps_map = {}; // to control how much snaps are drawn\n         this._num_primitives = lst ? lst.length : 0;\n         this._auto_color_cnt = 0;\n      }\n\n      delete this.next_rstyle;\n\n      ++indx; // change to the next snap\n\n      if (!lst || indx >= lst.length) {\n         delete this._snaps_map;\n         delete this._auto_color_cnt;\n         return this;\n      }\n\n      const snap = lst[indx],\n            snapid = snap.fObjectID;\n      let cnt = this._snaps_map[snapid],\n          objpainter = null;\n\n      if (cnt) cnt++; else cnt=1;\n      this._snaps_map[snapid] = cnt; // check how many objects with same snapid drawn, use them again\n\n      // empty object, no need to do something, take next\n      if (snap.fDummy) return this.drawNextSnap(lst, indx);\n\n      // first appropriate painter for the object\n      // if same object drawn twice, two painters will exists\n      for (let k = 0; k < this.painters.length; ++k) {\n         if (this.painters[k].snapid === snapid)\n            if (--cnt === 0) { objpainter = this.painters[k]; break; }\n      }\n\n      if (objpainter) {\n         if (snap._typename === `${nsREX}RPadDisplayItem`) {\n            // subpad\n            return objpainter.redrawPadSnap(snap).then(ppainter => {\n               this.addObjectPainter(ppainter, lst, indx);\n               return this.drawNextSnap(lst, indx);\n            });\n         }\n\n         if (snap._typename === `${nsREX}TObjectDisplayItem`)\n            this.extractTObjectProp(snap);\n\n         let promise;\n\n         if (objpainter.updateObject(snap.fDrawable || snap.fObject || snap, snap.fOption || '', true))\n            promise = objpainter.redraw();\n\n         return getPromise(promise).then(() => this.drawNextSnap(lst, indx)); // call next\n      }\n\n      if (snap._typename === `${nsREX}RPadDisplayItem`) { // subpad\n         const subpad = snap, // not subpad, but just attributes\n\n          padpainter = new RPadPainter(this.getDom(), subpad, false);\n         padpainter.decodeOptions('');\n         padpainter.addToPadPrimitives(this.this_pad_name); // only set parent pad name\n         padpainter.assignSnapId(snap.fObjectID);\n         padpainter.rstyle = snap.fStyle;\n\n         padpainter.createPadSvg();\n\n         if (snap.fPrimitives && snap.fPrimitives.length > 0)\n            padpainter.addPadButtons();\n\n         // we select current pad, where all drawing is performed\n         const prev_name = padpainter.selectCurrentPad(padpainter.this_pad_name);\n\n         return padpainter.drawNextSnap(snap.fPrimitives).then(() => {\n            padpainter.selectCurrentPad(prev_name);\n            return this.drawNextSnap(lst, indx);\n         });\n      }\n\n      // will be used in addToPadPrimitives to assign style to sub-painters\n      this.next_rstyle = lst[indx].fStyle || this.rstyle;\n\n      if (snap._typename === `${nsREX}TObjectDisplayItem`) {\n         // identifier used in RObjectDrawable\n         const webSnapIds = { kNone: 0, kObject: 1, kColors: 4, kStyle: 5, kPalette: 6 };\n\n         if (snap.fKind === webSnapIds.kStyle) {\n            Object.assign(gStyle, snap.fObject);\n            return this.drawNextSnap(lst, indx);\n         }\n\n         if (snap.fKind === webSnapIds.kColors) {\n            const ListOfColors = [], arr = snap.fObject.arr;\n            for (let n = 0; n < arr.length; ++n) {\n               const name = arr[n].fString, p = name.indexOf('=');\n               if (p > 0)\n                  ListOfColors[parseInt(name.slice(0, p))] = name.slice(p+1);\n            }\n\n            this.root_colors = ListOfColors;\n            // set global list of colors\n            // adoptRootColors(ListOfColors);\n            return this.drawNextSnap(lst, indx);\n         }\n\n         if (snap.fKind === webSnapIds.kPalette) {\n            const arr = snap.fObject.arr, palette = [];\n            for (let n = 0; n < arr.length; ++n)\n               palette[n] = arr[n].fString;\n            this.custom_palette = new ColorPalette(palette);\n            return this.drawNextSnap(lst, indx);\n         }\n\n         if (!this.getFramePainter()) {\n            return this.drawObject(this.getDom(), { _typename: 'TFrame', $dummy: true }, '')\n                       .then(() => this.drawNextSnap(lst, indx-1));\n         } // call same object again\n\n         this.extractTObjectProp(snap);\n      }\n\n      // TODO - fDrawable is v7, fObject from v6, maybe use same data member?\n      return this.drawObject(this.getDom(), snap.fDrawable || snap.fObject || snap, snap.fOption || '').then(objpainter => {\n         this.addObjectPainter(objpainter, lst, indx);\n         return this.drawNextSnap(lst, indx);\n      });\n   }\n\n   /** @summary Search painter with specified snapid, also sub-pads are checked\n     * @private */\n   findSnap(snapid, onlyid) {\n      function check(checkid) {\n         if (!checkid || !isStr(checkid)) return false;\n         if (checkid === snapid) return true;\n         return onlyid && (checkid.length > snapid.length) &&\n                (checkid.indexOf(snapid) === (checkid.length - snapid.length));\n      }\n\n      if (check(this.snapid)) return this;\n\n      if (!this.painters) return null;\n\n      for (let k=0; k<this.painters.length; ++k) {\n         let sub = this.painters[k];\n\n         if (!onlyid && isFunc(sub.findSnap))\n            sub = sub.findSnap(snapid);\n         else if (!check(sub.snapid))\n            sub = null;\n\n         if (sub) return sub;\n      }\n\n      return null;\n   }\n\n   /** @summary Redraw pad snap\n     * @desc Online version of drawing pad primitives\n     * @return {Promise} with pad painter */\n   async redrawPadSnap(snap) {\n      // for the pad/canvas display item contains list of primitives plus pad attributes\n\n      if (!snap || !snap.fPrimitives)\n         return this;\n\n      // for the moment only window size attributes are provided\n      // let padattr = { fCw: snap.fWinSize[0], fCh: snap.fWinSize[1], fTitle: snap.fTitle };\n\n      // if canvas size not specified in batch mode, temporary use 900x700 size\n      // if (this.isBatchMode() && this.iscan && (!padattr.fCw || !padattr.fCh)) { padattr.fCw = 900; padattr.fCh = 700; }\n\n      if (this.iscan && this._websocket && snap.fTitle && !this.embed_canvas && (typeof document !== 'undefined'))\n         document.title = snap.fTitle;\n\n      if (this.snapid === undefined) {\n         // first time getting snap, create all gui elements first\n\n         this.assignSnapId(snap.fObjectID);\n\n         this.draw_object = snap;\n         this.pad = snap;\n\n         if (this.isBatchMode() && this.iscan)\n             this._fixed_size = true;\n\n         const mainid = this.selectDom().attr('id');\n\n         if (!this.isBatchMode() && !this.use_openui && !this.brlayout && mainid && isStr(mainid)) {\n            this.brlayout = new BrowserLayout(mainid, null, this);\n            this.brlayout.create(mainid, true);\n            this.setDom(this.brlayout.drawing_divid()); // need to create canvas\n            registerForResize(this.brlayout);\n         }\n\n         this.createCanvasSvg(0);\n         this.addPadButtons(true);\n\n         return this.drawNextSnap(snap.fPrimitives);\n      }\n\n      // update only pad/canvas attributes\n      this.updateObject(snap);\n\n      // apply all changes in the object (pad or canvas)\n      if (this.iscan)\n         this.createCanvasSvg(2);\n       else\n         this.createPadSvg(true);\n\n\n      let isanyfound = false, isanyremove = false;\n\n      // find and remove painters which no longer exists in the list\n      for (let k = 0; k < this.painters.length; ++k) {\n         let sub = this.painters[k];\n         if (sub.snapid === undefined) continue; // look only for painters with snapid\n\n         snap.fPrimitives.forEach(prim => {\n            if (sub && (prim.fObjectID === sub.snapid)) {\n               sub = null; isanyfound = true;\n            }\n         });\n\n         if (sub) {\n            // remove painter which does not found in the list of snaps\n            this.painters.splice(k--, 1);\n            sub.cleanup(); // cleanup such painter\n            isanyremove = true;\n            if (this.main_painter_ref === sub)\n               delete this.main_painter_ref;\n         }\n      }\n\n      if (isanyremove)\n         delete this.pads_cache;\n\n      if (!isanyfound) {\n         let fp = this.getFramePainter();\n         // cannot preserve ROOT6 frame - it must be recreated\n         if (fp?.is_root6()) fp = null;\n         for (let k = 0; k < this.painters.length; ++k) {\n if (fp !== this.painters[k])\n               this.painters[k].cleanup();\n}\n         this.painters = [];\n         delete this.main_painter_ref;\n         if (fp) {\n            this.painters.push(fp);\n            fp.cleanFrameDrawings();\n            fp.redraw(); // need to create all layers again\n         }\n         if (this.removePadButtons) this.removePadButtons();\n         this.addPadButtons(true);\n      }\n\n      const prev_name = this.selectCurrentPad(this.this_pad_name);\n\n      return this.drawNextSnap(snap.fPrimitives).then(() => {\n         this.selectCurrentPad(prev_name);\n\n         if (getActivePad() === this)\n            this.getCanvPainter()?.producePadEvent('padredraw', this);\n         return this;\n      });\n   }\n\n   /** @summary Create image for the pad\n     * @desc Used with web-based canvas to create images for server side\n     * @return {Promise} with image data, coded with btoa() function\n     * @private */\n   async createImage(format) {\n      if ((format === 'png') || (format === 'jpeg') || (format === 'svg') || (format === 'pdf')) {\n         return this.produceImage(true, format).then(res => {\n            if (!res || (format === 'svg')) return res;\n            const separ = res.indexOf('base64,');\n            return (separ > 0) ? res.slice(separ+7) : '';\n         });\n      }\n\n      return '';\n   }\n\n   /** @summary Show context menu for specified item\n     * @private */\n   itemContextMenu(name) {\n       const rrr = this.svg_this_pad().node().getBoundingClientRect(),\n           evnt = { clientX: rrr.left+10, clientY: rrr.top + 10 };\n\n       // use timeout to avoid conflict with mouse click and automatic menu close\n       if (name === 'pad')\n          return postponePromise(() => this.padContextMenu(evnt), 50);\n\n       let selp = null, selkind;\n\n       switch (name) {\n          case 'xaxis':\n          case 'yaxis':\n          case 'zaxis':\n             selp = this.getMainPainter();\n             selkind = name[0];\n             break;\n          case 'frame':\n             selp = this.getFramePainter();\n             break;\n          default: {\n             const indx = parseInt(name);\n             if (Number.isInteger(indx)) selp = this.painters[indx];\n          }\n       }\n\n       if (!isFunc(selp?.fillContextMenu)) return;\n\n       return createMenu(evnt, selp).then(menu => {\n          const offline_menu = selp.fillContextMenu(menu, selkind);\n          if (offline_menu || selp.snapid)\n             selp.fillObjectExecMenu(menu, selkind).then(() => postponePromise(() => menu.show(), 50));\n       });\n   }\n\n   /** @summary Save pad in specified format\n     * @desc Used from context menu */\n   saveAs(kind, full_canvas, filename) {\n      if (!filename)\n         filename = (this.this_pad_name || (this.iscan ? 'canvas' : 'pad')) + '.' + kind;\n\n      this.produceImage(full_canvas, kind).then(imgdata => {\n         if (!imgdata)\n            return console.error(`Fail to produce image ${filename}`);\n\n         saveFile(filename, (kind !== 'svg') ? imgdata : 'data:image/svg+xml;charset=utf-8,'+encodeURIComponent(imgdata));\n      });\n   }\n\n   /** @summary Search active pad\n     * @return {Object} pad painter for active pad */\n   findActivePad() {\n      return null;\n   }\n\n   /** @summary Prodce image for the pad\n     * @return {Promise} with created image */\n   async produceImage(full_canvas, file_format) {\n      const use_frame = (full_canvas === 'frame'),\n            elem = use_frame ? this.getFrameSvg(this.this_pad_name) : (full_canvas ? this.getCanvSvg() : this.svg_this_pad()),\n            painter = (full_canvas && !use_frame) ? this.getCanvPainter() : this,\n            items = []; // keep list of replaced elements, which should be moved back at the end\n\n      if (elem.empty())\n         return '';\n\n      if (use_frame || !full_canvas) {\n         const defs = this.getCanvSvg().selectChild('.canvas_defs');\n         if (!defs.empty()) {\n            items.push({ prnt: this.getCanvSvg(), defs });\n            elem.node().insertBefore(defs.node(), elem.node().firstChild);\n         }\n      }\n\n      if (!use_frame) {\n         // do not make transformations for the frame\n         painter.forEachPainterInPad(pp => {\n            const item = { prnt: pp.svg_this_pad() };\n            items.push(item);\n\n            // remove buttons from each subpad\n            const btns = pp.getLayerSvg('btns_layer', this.this_pad_name);\n            item.btns_node = btns.node();\n            if (item.btns_node) {\n               item.btns_prnt = item.btns_node.parentNode;\n               item.btns_next = item.btns_node.nextSibling;\n               btns.remove();\n            }\n\n            const main = pp.getFramePainter();\n            if (!isFunc(main?.render3D) || !isFunc(main?.access3dKind)) return;\n\n            const can3d = main.access3dKind();\n\n            if ((can3d !== constants.Embed3D.Overlay) && (can3d !== constants.Embed3D.Embed)) return;\n\n            const sz2 = main.getSizeFor3d(constants.Embed3D.Embed), // get size and position of DOM element as it will be embed\n                  canvas = main.renderer.domElement;\n\n            main.render3D(0); // WebGL clears buffers, therefore we should render scene and convert immediately\n\n            const dataUrl = canvas.toDataURL('image/png');\n\n            // remove 3D drawings\n            if (can3d === constants.Embed3D.Embed) {\n               item.foreign = item.prnt.select('.' + sz2.clname);\n               item.foreign.remove();\n            }\n\n            const svg_frame = main.getFrameSvg();\n            item.frame_node = svg_frame.node();\n            if (item.frame_node) {\n               item.frame_next = item.frame_node.nextSibling;\n               svg_frame.remove();\n            }\n\n            // add svg image\n            item.img = item.prnt.insert('image', '.primitives_layer')     // create image object\n                           .attr('x', sz2.x)\n                           .attr('y', sz2.y)\n                           .attr('width', canvas.width)\n                           .attr('height', canvas.height)\n                           .attr('href', dataUrl);\n         }, 'pads');\n      }\n\n      let width = elem.property('draw_width'), height = elem.property('draw_height');\n      if (use_frame) {\n         const fp = this.getFramePainter();\n         width = fp.getFrameWidth();\n         height = fp.getFrameHeight();\n      }\n\n      const arg = (file_format === 'pdf')\n         ? { node: elem.node(), width, height, reset_tranform: use_frame }\n         : compressSVG(`<svg width=\"${width}\" height=\"${height}\" xmlns=\"http://www.w3.org/2000/svg\">${elem.node().innerHTML}</svg>`);\n\n      return svgToImage(arg, file_format).then(res => {\n         for (let k = 0; k < items.length; ++k) {\n            const item = items[k];\n\n            item.img?.remove(); // delete embed image\n\n            const prim = item.prnt.selectChild('.primitives_layer');\n\n            if (item.foreign) // reinsert foreign object\n               item.prnt.node().insertBefore(item.foreign.node(), prim.node());\n\n            if (item.frame_node) // reinsert frame as first in list of primitives\n               prim.node().insertBefore(item.frame_node, item.frame_next);\n\n            if (item.btns_node) // reinsert buttons\n               item.btns_prnt.insertBefore(item.btns_node, item.btns_next);\n\n            if (item.defs) // reinsert defs\n               item.prnt.node().insertBefore(item.defs.node(), item.prnt.node().firstChild);\n         }\n         return res;\n      });\n   }\n\n   /** @summary Process pad button click */\n   clickPadButton(funcname, evnt) {\n      if (funcname === 'CanvasSnapShot')\n         return this.saveAs('png', true);\n\n      if (funcname === 'enlargePad')\n         return this.enlargePad();\n\n      if (funcname === 'PadSnapShot')\n         return this.saveAs('png', false);\n\n      if (funcname === 'PadContextMenus') {\n         evnt?.preventDefault();\n         evnt?.stopPropagation();\n         if (closeMenu()) return;\n\n         return createMenu(evnt, this).then(menu => {\n            menu.add('header:Menus');\n\n            if (this.iscan)\n               menu.add('Canvas', 'pad', this.itemContextMenu);\n            else\n               menu.add('Pad', 'pad', this.itemContextMenu);\n\n            if (this.getFramePainter())\n               menu.add('Frame', 'frame', this.itemContextMenu);\n\n            const main = this.getMainPainter(); // here hist painter methods\n\n            if (main) {\n               menu.add('X axis', 'xaxis', this.itemContextMenu);\n               menu.add('Y axis', 'yaxis', this.itemContextMenu);\n               if (isFunc(main.getDimension) && (main.getDimension() > 1))\n                  menu.add('Z axis', 'zaxis', this.itemContextMenu);\n            }\n\n            if (this.painters?.length) {\n               menu.add('separator');\n               const shown = [];\n               this.painters.forEach((pp, indx) => {\n                  const obj = pp?.getObject();\n                  if (!obj || (shown.indexOf(obj) >= 0) || pp.isSecondary()) return;\n                  let name = isFunc(pp.getClassName) ? pp.getClassName() : (obj._typename || '');\n                  if (name) name += '::';\n                  name += isFunc(pp.getObjectName) ? pp.getObjectName() : (obj.fName || `item${indx}`);\n                  menu.add(name, indx, this.itemContextMenu);\n                  shown.push(obj);\n               });\n            }\n\n            menu.show();\n         });\n      }\n\n      // click automatically goes to all sub-pads\n      // if any painter indicates that processing completed, it returns true\n      let done = false;\n      const prs = [];\n\n      for (let i = 0; i < this.painters.length; ++i) {\n         const pp = this.painters[i];\n\n         if (isFunc(pp.clickPadButton))\n            prs.push(pp.clickPadButton(funcname, evnt));\n\n         if (!done && isFunc(pp.clickButton)) {\n            done = pp.clickButton(funcname);\n            if (isPromise(done)) prs.push(done);\n         }\n      }\n\n      return Promise.all(prs);\n   }\n\n   /** @summary Add button to the pad\n     * @private */\n   addPadButton(btn, tooltip, funcname, keyname) {\n      if (!settings.ToolBar || this.isBatchMode()) return;\n\n      if (!this._buttons) this._buttons = [];\n      // check if there are duplications\n\n      for (let k = 0; k < this._buttons.length; ++k)\n         if (this._buttons[k].funcname === funcname) return;\n\n      this._buttons.push({ btn, tooltip, funcname, keyname });\n\n      const iscan = this.iscan || !this.has_canvas;\n      if (!iscan && (funcname.indexOf('Pad') !== 0) && (funcname !== 'enlargePad')) {\n         const cp = this.getCanvPainter();\n         if (cp && (cp !== this)) cp.addPadButton(btn, tooltip, funcname);\n      }\n   }\n\n   /** @summary Add buttons for pad or canvas\n     * @private */\n   addPadButtons(is_online) {\n      this.addPadButton('camera', 'Create PNG', this.iscan ? 'CanvasSnapShot' : 'PadSnapShot', 'Ctrl PrintScreen');\n\n      if (settings.ContextMenu)\n         this.addPadButton('question', 'Access context menus', 'PadContextMenus');\n\n      const add_enlarge = !this.iscan && this.has_canvas && this.hasObjectsToDraw();\n\n      if (add_enlarge || this.enlargeMain('verify'))\n         this.addPadButton('circle', 'Enlarge canvas', 'enlargePad');\n\n      if (is_online && this.brlayout) {\n         this.addPadButton('diamand', 'Toggle Ged', 'ToggleGed');\n         this.addPadButton('three_circles', 'Toggle Status', 'ToggleStatus');\n      }\n   }\n\n   /** @summary Show pad buttons\n     * @private */\n   showPadButtons() {\n      if (!this._buttons) return;\n\n      PadButtonsHandler.assign(this);\n      this.showPadButtons();\n   }\n\n   /** @summary Calculates RPadLength value */\n   getPadLength(vertical, len, frame_painter) {\n      let rect, res;\n      const sign = vertical ? -1 : 1,\n            getV = (indx, dflt) => (indx < len.fArr.length) ? len.fArr[indx] : dflt,\n            getRect = () => {\n               if (!rect)\n                  rect = frame_painter ? frame_painter.getFrameRect() : this.getPadRect();\n               return rect;\n            };\n\n      if (frame_painter) {\n         const user = getV(2), func = vertical ? 'gry' : 'grx';\n         if ((user !== undefined) && frame_painter[func])\n            res = frame_painter[func](user);\n      }\n\n      if (res === undefined)\n         res = vertical ? getRect().height : 0;\n\n      const norm = getV(0, 0), pixel = getV(1, 0);\n\n      res += sign*pixel;\n\n      if (norm)\n         res += sign * (vertical ? getRect().height : getRect().width) * norm;\n\n      return Math.round(res);\n   }\n\n\n   /** @summary Calculates pad position for RPadPos values\n     * @param {object} pos - instance of RPadPos\n     * @param {object} frame_painter - if drawing will be performed inside frame, frame painter */\n   getCoordinate(pos, frame_painter) {\n      return {\n         x: this.getPadLength(false, pos.fHoriz, frame_painter),\n         y: this.getPadLength(true, pos.fVert, frame_painter)\n      };\n   }\n\n   /** @summary Decode pad draw options */\n   decodeOptions(opt) {\n      const pad = this.getObject();\n      if (!pad) return;\n\n      const d = new DrawOptions(opt);\n\n      if (!this.options) this.options = {};\n\n      Object.assign(this.options, { GlobalColors: true, LocalColors: false, IgnorePalette: false, RotateFrame: false, FixFrame: false });\n\n      if (d.check('NOCOLORS') || d.check('NOCOL')) this.options.GlobalColors = this.options.LocalColors = false;\n      if (d.check('LCOLORS') || d.check('LCOL')) { this.options.GlobalColors = false; this.options.LocalColors = true; }\n      if (d.check('NOPALETTE') || d.check('NOPAL')) this.options.IgnorePalette = true;\n      if (d.check('ROTATE')) this.options.RotateFrame = true;\n      if (d.check('FIXFRAME')) this.options.FixFrame = true;\n\n      if (d.check('WHITE')) pad.fFillColor = 0;\n      if (d.check('LOGX')) pad.fLogx = 1;\n      if (d.check('LOGY')) pad.fLogy = 1;\n      if (d.check('LOGZ')) pad.fLogz = 1;\n      if (d.check('LOG')) pad.fLogx = pad.fLogy = pad.fLogz = 1;\n      if (d.check('GRIDX')) pad.fGridx = 1;\n      if (d.check('GRIDY')) pad.fGridy = 1;\n      if (d.check('GRID')) pad.fGridx = pad.fGridy = 1;\n      if (d.check('TICKX')) pad.fTickx = 1;\n      if (d.check('TICKY')) pad.fTicky = 1;\n      if (d.check('TICK')) pad.fTickx = pad.fTicky = 1;\n   }\n\n   /** @summary draw RPad object */\n   static async draw(dom, pad, opt) {\n      const painter = new RPadPainter(dom, pad, false);\n      painter.decodeOptions(opt);\n\n      if (painter.getCanvSvg().empty()) {\n         painter.has_canvas = false;\n         painter.this_pad_name = '';\n         painter.setTopPainter();\n      } else\n         painter.addToPadPrimitives(painter.pad_name); // must be here due to pad painter\n\n\n      painter.createPadSvg();\n\n      if (painter.matchObjectType(clTPad) && (!painter.has_canvas || painter.hasObjectsToDraw()))\n         painter.addPadButtons();\n\n      // we select current pad, where all drawing is performed\n      const prev_name = painter.has_canvas ? painter.selectCurrentPad(painter.this_pad_name) : undefined;\n\n      selectActivePad({ pp: painter, active: false });\n\n      // flag used to prevent immediate pad redraw during first draw\n      return painter.drawPrimitives().then(() => {\n         painter.showPadButtons();\n         // we restore previous pad name\n         painter.selectCurrentPad(prev_name);\n         return painter;\n      });\n   }\n\n} // class RPadPainter\n\nexport { RPadPainter };\n","/**\n * [js-sha256]{@link https://github.com/emn178/js-sha256}\n *\n * @version 0.10.1\n * @author Chen, Yi-Cyuan [emn178@gmail.com]\n * @copyright Chen, Yi-Cyuan 2014-2023\n * @license MIT\n */\n\nconst HEX_CHARS = '0123456789abcdef'.split(''),\n      EXTRA = [-2147483648, 8388608, 32768, 128],\n      SHIFT = [24, 16, 8, 0],\n      K = [0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5,\n           0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174,\n           0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,\n           0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967,\n           0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,\n           0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,\n           0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,\n           0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2];\n\n\nclass Sha256 {\n\n  constructor(is224) {\n    this.blocks = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n\n    if (is224) {\n      this.h0 = 0xc1059ed8;\n      this.h1 = 0x367cd507;\n      this.h2 = 0x3070dd17;\n      this.h3 = 0xf70e5939;\n      this.h4 = 0xffc00b31;\n      this.h5 = 0x68581511;\n      this.h6 = 0x64f98fa7;\n      this.h7 = 0xbefa4fa4;\n    } else { // 256\n      this.h0 = 0x6a09e667;\n      this.h1 = 0xbb67ae85;\n      this.h2 = 0x3c6ef372;\n      this.h3 = 0xa54ff53a;\n      this.h4 = 0x510e527f;\n      this.h5 = 0x9b05688c;\n      this.h6 = 0x1f83d9ab;\n      this.h7 = 0x5be0cd19;\n    }\n\n    this.block = this.start = this.bytes = this.hBytes = 0;\n    this.finalized = this.hashed = false;\n    this.first = true;\n    this.is224 = is224;\n  }\n\n  /** One can use only string or Uint8Array */\n  update(message) {\n    if (this.finalized)\n      return;\n\n    const notString = (typeof message !== 'string'),\n          length = message.length, blocks = this.blocks;\n\n    let code, index = 0, i;\n\n    while (index < length) {\n      if (this.hashed) {\n        this.hashed = false;\n        blocks[0] = this.block;\n        blocks[16] = blocks[1] = blocks[2] = blocks[3] =\n          blocks[4] = blocks[5] = blocks[6] = blocks[7] =\n          blocks[8] = blocks[9] = blocks[10] = blocks[11] =\n          blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;\n      }\n\n      if (notString) {\n        for (i = this.start; index < length && i < 64; ++index)\n          blocks[i >> 2] |= message[index] << SHIFT[i++ & 3];\n      } else {\n        for (i = this.start; index < length && i < 64; ++index) {\n          code = message.charCodeAt(index);\n          if (code < 0x80)\n            blocks[i >> 2] |= code << SHIFT[i++ & 3];\n          else if (code < 0x800) {\n            blocks[i >> 2] |= (0xc0 | (code >> 6)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | (code & 0x3f)) << SHIFT[i++ & 3];\n          } else if (code < 0xd800 || code >= 0xe000) {\n            blocks[i >> 2] |= (0xe0 | (code >> 12)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | ((code >> 6) & 0x3f)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | (code & 0x3f)) << SHIFT[i++ & 3];\n          } else {\n            code = 0x10000 + (((code & 0x3ff) << 10) | (message.charCodeAt(++index) & 0x3ff));\n            blocks[i >> 2] |= (0xf0 | (code >> 18)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | ((code >> 12) & 0x3f)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | ((code >> 6) & 0x3f)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | (code & 0x3f)) << SHIFT[i++ & 3];\n          }\n        }\n      }\n\n      this.lastByteIndex = i;\n      this.bytes += i - this.start;\n      if (i >= 64) {\n        this.block = blocks[16];\n        this.start = i - 64;\n        this.hash();\n        this.hashed = true;\n      } else\n        this.start = i;\n    }\n    if (this.bytes > 4294967295) {\n      this.hBytes += this.bytes / 4294967296 << 0;\n      this.bytes = this.bytes % 4294967296;\n    }\n    return this;\n  }\n\n  finalize() {\n    if (this.finalized)\n      return;\n    this.finalized = true;\n    const blocks = this.blocks,\n          i = this.lastByteIndex;\n    blocks[16] = this.block;\n    blocks[i >> 2] |= EXTRA[i & 3];\n    this.block = blocks[16];\n    if (i >= 56) {\n      if (!this.hashed)\n        this.hash();\n      blocks[0] = this.block;\n      blocks[16] = blocks[1] = blocks[2] = blocks[3] =\n      blocks[4] = blocks[5] = blocks[6] = blocks[7] =\n      blocks[8] = blocks[9] = blocks[10] = blocks[11] =\n      blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;\n    }\n    blocks[14] = this.hBytes << 3 | this.bytes >>> 29;\n    blocks[15] = this.bytes << 3;\n    this.hash();\n  }\n\n  hash() {\n    const blocks = this.blocks;\n    let a = this.h0, b = this.h1, c = this.h2, d = this.h3, e = this.h4, f = this.h5, g = this.h6,\n        h = this.h7, j, s0, s1, maj, t1, t2, ch, ab, da, cd, bc;\n\n    for (j = 16; j < 64; ++j) {\n      // rightrotate\n      t1 = blocks[j - 15];\n      s0 = ((t1 >>> 7) | (t1 << 25)) ^ ((t1 >>> 18) | (t1 << 14)) ^ (t1 >>> 3);\n      t1 = blocks[j - 2];\n      s1 = ((t1 >>> 17) | (t1 << 15)) ^ ((t1 >>> 19) | (t1 << 13)) ^ (t1 >>> 10);\n      blocks[j] = blocks[j - 16] + s0 + blocks[j - 7] + s1 << 0;\n    }\n\n    bc = b & c;\n    for (j = 0; j < 64; j += 4) {\n      if (this.first) {\n        if (this.is224) {\n          ab = 300032;\n          t1 = blocks[0] - 1413257819;\n          h = t1 - 150054599 << 0;\n          d = t1 + 24177077 << 0;\n        } else {\n          ab = 704751109;\n          t1 = blocks[0] - 210244248;\n          h = t1 - 1521486534 << 0;\n          d = t1 + 143694565 << 0;\n        }\n        this.first = false;\n      } else {\n        s0 = ((a >>> 2) | (a << 30)) ^ ((a >>> 13) | (a << 19)) ^ ((a >>> 22) | (a << 10));\n        s1 = ((e >>> 6) | (e << 26)) ^ ((e >>> 11) | (e << 21)) ^ ((e >>> 25) | (e << 7));\n        ab = a & b;\n        maj = ab ^ (a & c) ^ bc;\n        ch = (e & f) ^ (~e & g);\n        t1 = h + s1 + ch + K[j] + blocks[j];\n        t2 = s0 + maj;\n        h = d + t1 << 0;\n        d = t1 + t2 << 0;\n      }\n      s0 = ((d >>> 2) | (d << 30)) ^ ((d >>> 13) | (d << 19)) ^ ((d >>> 22) | (d << 10));\n      s1 = ((h >>> 6) | (h << 26)) ^ ((h >>> 11) | (h << 21)) ^ ((h >>> 25) | (h << 7));\n      da = d & a;\n      maj = da ^ (d & b) ^ ab;\n      ch = (h & e) ^ (~h & f);\n      t1 = g + s1 + ch + K[j + 1] + blocks[j + 1];\n      t2 = s0 + maj;\n      g = c + t1 << 0;\n      c = t1 + t2 << 0;\n      s0 = ((c >>> 2) | (c << 30)) ^ ((c >>> 13) | (c << 19)) ^ ((c >>> 22) | (c << 10));\n      s1 = ((g >>> 6) | (g << 26)) ^ ((g >>> 11) | (g << 21)) ^ ((g >>> 25) | (g << 7));\n      cd = c & d;\n      maj = cd ^ (c & a) ^ da;\n      ch = (g & h) ^ (~g & e);\n      t1 = f + s1 + ch + K[j + 2] + blocks[j + 2];\n      t2 = s0 + maj;\n      f = b + t1 << 0;\n      b = t1 + t2 << 0;\n      s0 = ((b >>> 2) | (b << 30)) ^ ((b >>> 13) | (b << 19)) ^ ((b >>> 22) | (b << 10));\n      s1 = ((f >>> 6) | (f << 26)) ^ ((f >>> 11) | (f << 21)) ^ ((f >>> 25) | (f << 7));\n      bc = b & c;\n      maj = bc ^ (b & d) ^ cd;\n      ch = (f & g) ^ (~f & h);\n      t1 = e + s1 + ch + K[j + 3] + blocks[j + 3];\n      t2 = s0 + maj;\n      e = a + t1 << 0;\n      a = t1 + t2 << 0;\n      this.chromeBugWorkAround = true;\n    }\n\n    this.h0 = this.h0 + a << 0;\n    this.h1 = this.h1 + b << 0;\n    this.h2 = this.h2 + c << 0;\n    this.h3 = this.h3 + d << 0;\n    this.h4 = this.h4 + e << 0;\n    this.h5 = this.h5 + f << 0;\n    this.h6 = this.h6 + g << 0;\n    this.h7 = this.h7 + h << 0;\n  }\n\n  digest() {\n    this.finalize();\n\n    const h0 = this.h0, h1 = this.h1, h2 = this.h2, h3 = this.h3, h4 = this.h4, h5 = this.h5,\n          h6 = this.h6, h7 = this.h7,\n    arr = [\n      (h0 >> 24) & 0xFF, (h0 >> 16) & 0xFF, (h0 >> 8) & 0xFF, h0 & 0xFF,\n      (h1 >> 24) & 0xFF, (h1 >> 16) & 0xFF, (h1 >> 8) & 0xFF, h1 & 0xFF,\n      (h2 >> 24) & 0xFF, (h2 >> 16) & 0xFF, (h2 >> 8) & 0xFF, h2 & 0xFF,\n      (h3 >> 24) & 0xFF, (h3 >> 16) & 0xFF, (h3 >> 8) & 0xFF, h3 & 0xFF,\n      (h4 >> 24) & 0xFF, (h4 >> 16) & 0xFF, (h4 >> 8) & 0xFF, h4 & 0xFF,\n      (h5 >> 24) & 0xFF, (h5 >> 16) & 0xFF, (h5 >> 8) & 0xFF, h5 & 0xFF,\n      (h6 >> 24) & 0xFF, (h6 >> 16) & 0xFF, (h6 >> 8) & 0xFF, h6 & 0xFF\n    ];\n    if (!this.is224)\n      arr.push((h7 >> 24) & 0xFF, (h7 >> 16) & 0xFF, (h7 >> 8) & 0xFF, h7 & 0xFF);\n    return arr;\n  }\n\n  hex() {\n    const d = this.digest();\n    let res = '';\n    for (let i = 0; i < d.length; ++i)\n       res += HEX_CHARS[(d[i] >> 4) & 0xF] + HEX_CHARS[d[i] & 0xF];\n    return res;\n  }\n\n  toString() {\n    return this.hex();\n  }\n\n} // class Sha256\n\nfunction sha256(message, as_hex) {\n  const m = new Sha256(false);\n  m.update(message);\n  return as_hex ? m.hex() : m.digest();\n}\n\nfunction sha256_2(message, arr, as_hex) {\n  const m = new Sha256(false);\n  m.update(message);\n  m.update(arr);\n  return as_hex ? m.hex() : m.digest();\n}\n\nexport { sha256, sha256_2 };\n","import { httpRequest, createHttpRequest, loadScript, decodeUrl,\n         browser, setBatchMode, isBatchMode, isObject, isFunc, isStr, btoa_func } from './core.mjs';\nimport { closeCurrentWindow, showProgress, loadOpenui5 } from './gui/utils.mjs';\nimport { sha256, sha256_2 } from './base/sha256.mjs';\n\n\n// secret session key used for hashing connections keys\n// only if set, all messages from and to server signed with HMAC hash\nlet sessionKey = '';\n\n/** @summary HMAC implementation\n * @desc see https://en.wikipedia.org/wiki/HMAC for more details\n * @private */\nfunction HMAC(key, m, o) {\n   const kbis = sha256(sessionKey + key),\n         block_size = 64,\n         opad = 0x5c, ipad = 0x36,\n         ko = [], ki = [];\n   while (kbis.length < block_size)\n      kbis.push(0);\n   for (let i = 0; i < kbis.length; ++i) {\n      const code = kbis[i];\n      ko.push(code ^ opad);\n      ki.push(code ^ ipad);\n   }\n\n   const hash = sha256_2(ki, (o === undefined) ? m : new Uint8Array(m, o));\n\n   return sha256_2(ko, hash, true);\n}\n\n/**\n * @summary Class emulating web socket with long-poll http requests\n *\n * @private\n */\n\nclass LongPollSocket {\n\n   constructor(addr, _raw, _handle, _counter) {\n      this.path = addr;\n      this.connid = null;\n      this.req = null;\n      this.raw = _raw;\n      this.handle = _handle;\n      this.counter = _counter;\n\n      this.nextRequest('', 'connect');\n   }\n\n   /** @summary Submit next request */\n   nextRequest(data, kind) {\n      let url = this.path, reqmode = 'buf', post = null;\n      if (kind === 'connect') {\n         url += this.raw ? '?raw_connect' : '?txt_connect';\n         if (this.handle) url += '&' + this.handle.getConnArgs(this.counter++);\n         console.log(`longpoll connect ${url} raw = ${this.raw}`);\n         this.connid = 'connect';\n      } else if (kind === 'close') {\n         if ((this.connid === null) || (this.connid === 'close')) return;\n         url += `?connection=${this.connid}&close`;\n         if (this.handle) url += '&' + this.handle.getConnArgs(this.counter++);\n         this.connid = 'close';\n         reqmode = 'text;sync'; // use sync mode to close connection before browser window closed\n      } else if ((this.connid === null) || (typeof this.connid !== 'number')) {\n         if (!browser.qt5) console.error('No connection');\n      } else {\n         url += '?connection=' + this.connid;\n         if (this.handle) url += '&' + this.handle.getConnArgs(this.counter++);\n         if (kind === 'dummy') url += '&dummy';\n      }\n\n      if (data) {\n         if (this.raw) {\n            // special workaround to avoid POST request, use base64 coding\n            url += '&post=' + btoa_func(data);\n         } else {\n            // send data with post request - most efficient way\n            reqmode = 'postbuf';\n            post = data;\n         }\n      }\n\n      createHttpRequest(url, reqmode, function(res) {\n         // this set to the request itself, res is response\n\n         if (this.handle.req === this)\n            this.handle.req = null; // get response for existing dummy request\n\n         if (res === null)\n            return this.handle.processRequest(null);\n\n         if (this.handle.raw) {\n            // raw mode - all kind of reply data packed into binary buffer\n            // first 4 bytes header 'txt:' or 'bin:'\n            // after the 'bin:' there is length of optional text argument like 'bin:14  :optional_text'\n            // and immedaitely after text binary data. Server sends binary data so, that offset should be multiple of 8\n\n            const u8Arr = new Uint8Array(res);\n            let str = '', i = 0, offset = u8Arr.length;\n            if (offset < 4) {\n               if (!browser.qt5) console.error(`longpoll got short message in raw mode ${offset}`);\n               return this.handle.processRequest(null);\n            }\n\n            while (i < 4) str += String.fromCharCode(u8Arr[i++]);\n            if (str !== 'txt:') {\n               str = '';\n               while ((i < offset) && (String.fromCharCode(u8Arr[i]) !== ':'))\n                  str += String.fromCharCode(u8Arr[i++]);\n               ++i;\n               offset = i + parseInt(str.trim());\n            }\n\n            str = '';\n            while (i < offset) str += String.fromCharCode(u8Arr[i++]);\n\n            if (str) {\n               if (str === '<<nope>>')\n                  this.handle.processRequest(-1111);\n               else\n                   this.handle.processRequest(str);\n            }\n            if (offset < u8Arr.length)\n               this.handle.processRequest(res, offset);\n         } else if (this.getResponseHeader('Content-Type') === 'application/x-binary') {\n            // binary reply with optional header\n            const extra_hdr = this.getResponseHeader('LongpollHeader');\n            if (extra_hdr) this.handle.processRequest(extra_hdr);\n            this.handle.processRequest(res, 0);\n         } else {\n            // text reply\n            if (res && !isStr(res)) {\n               let str = '';\n               const u8Arr = new Uint8Array(res);\n               for (let i = 0; i < u8Arr.length; ++i)\n                  str += String.fromCharCode(u8Arr[i]);\n               res = str;\n            }\n            if (res === '<<nope>>')\n               this.handle.processRequest(-1111);\n            else\n               this.handle.processRequest(res);\n         }\n      }, function(/* err, status */) {\n         this.handle.processRequest(null, 'error');\n      }, true).then(req => {\n         req.handle = this;\n         if (!this.req)\n            this.req = req; // any request can be used for response, do not submit dummy until req is there\n         req.send(post);\n      });\n   }\n\n   /** @summary Process request */\n   processRequest(res, _offset) {\n      if (res === null) {\n         if (isFunc(this.onerror))\n            this.onerror('receive data with connid ' + (this.connid || '---'));\n         if ((_offset === 'error') && isFunc(this.onclose))\n            this.onclose('force_close');\n         this.connid = null;\n         return;\n      } else if (res === -1111)\n         res = '';\n\n      let dummy_tmout = 5;\n\n      if (this.connid === 'connect') {\n         if (!res) {\n            this.connid = null;\n            if (isFunc(this.onerror))\n               this.onerror('connection rejected');\n            return;\n         }\n\n         this.connid = parseInt(res);\n         dummy_tmout = 100; // when establishing connection, wait a bit longer to submit dummy package\n         console.log(`Get new longpoll connection with id ${this.connid}`);\n         if (isFunc(this.onopen))\n            this.onopen();\n      } else if (this.connid === 'close') {\n         if (isFunc(this.onclose))\n            this.onclose();\n         return;\n      } else {\n         if (isFunc(this.onmessage) && res)\n            this.onmessage({ data: res, offset: _offset });\n      }\n\n      // minimal timeout to reduce load, generate dummy only if client not submit new request immediately\n      if (!this.req)\n         setTimeout(() => { if (!this.req) this.nextRequest('', 'dummy'); }, dummy_tmout);\n   }\n\n   /** @summary Send data */\n   send(str) { this.nextRequest(str); }\n\n   /** @summary Close connection */\n   close() { this.nextRequest('', 'close'); }\n\n} // class LongPollSocket\n\n// ========================================================================================\n\n/**\n * @summary Class re-playing socket data from stored protocol\n *\n * @private\n */\n\nclass FileDumpSocket {\n\n   constructor(receiver) {\n      this.receiver = receiver;\n      this.protocol = [];\n      this.cnt = 0;\n      httpRequest('protocol.json', 'text').then(res => this.getProtocol(res));\n   }\n\n   /** @summary Get stored protocol */\n   getProtocol(res) {\n      if (!res) return;\n      this.protocol = JSON.parse(res);\n      if (isFunc(this.onopen)) this.onopen();\n      this.nextOperation();\n   }\n\n   /** @summary Emulate send - just cound operation */\n   send(/* str */) {\n      if (this.protocol[this.cnt] === 'send') {\n         this.cnt++;\n         setTimeout(() => this.nextOperation(), 10);\n      }\n   }\n\n   /** @summary Emulate close */\n   close() {}\n\n   /** @summary Read data for next operation */\n   nextOperation() {\n      // when file request running - just ignore\n      if (this.wait_for_file) return;\n      const fname = this.protocol[this.cnt];\n\n      if (!fname) return;\n      if (fname === 'send') return; // waiting for send\n      this.wait_for_file = true;\n      this.cnt++;\n      httpRequest(fname, (fname.indexOf('.bin') > 0 ? 'buf' : 'text')).then(res => {\n         this.wait_for_file = false;\n         if (!res) return;\n         const p = fname.indexOf('_ch'),\n               chid = (p > 0) ? Number.parseInt(fname.slice(p+3, fname.indexOf('.', p))) : 1;\n         if (isFunc(this.receiver.provideData))\n            this.receiver.provideData(chid, res, 0);\n         setTimeout(() => this.nextOperation(), 10);\n      });\n   }\n\n} // class FileDumpSocket\n\n\n/**\n * @summary Client communication handle for RWebWindow.\n *\n * @desc Should be created with {@link connectWebWindow} function\n */\n\nclass WebWindowHandle {\n\n   constructor(socket_kind, credits) {\n      this.kind = socket_kind;\n      this.state = 0;\n      this.credits = credits || 10;\n      this.cansend = this.credits;\n      this.ackn = this.credits;\n      this.send_seq = 1; // sequence counter of send messages\n      this.recv_seq = 0; // sequence counter of received messages\n   }\n\n   /** @summary Returns arguments specified in the RWebWindow::SetUserArgs() method\n     * @desc Can be any valid JSON expression. Undefined by default.\n     * @param {string} [field] - if specified and user args is object, returns correspondent object member\n     * @return user arguments object */\n   getUserArgs(field) {\n      if (field && isStr(field))\n         return isObject(this.user_args) ? this.user_args[field] : undefined;\n\n      return this.user_args;\n   }\n\n   /** @summary Set user args\n     * @desc Normally set via RWebWindow::SetUserArgs() method */\n   setUserArgs(args) { this.user_args = args; }\n\n   /** @summary Set callbacks receiver.\n     * @param {object} obj - object with receiver functions\n     * @param {function} obj.onWebsocketMsg - called when new data receieved from RWebWindow\n     * @param {function} obj.onWebsocketOpened - called when connection established\n     * @param {function} obj.onWebsocketClosed - called when connection closed\n     * @param {function} obj.onWebsocketError - called when get error via the connection */\n   setReceiver(obj) { this.receiver = obj; }\n\n   /** @summary Cleanup and close connection. */\n   cleanup() {\n      delete this.receiver;\n      this.close(true);\n   }\n\n   /** @summary Invoke method in the receiver.\n    * @private */\n   invokeReceiver(brdcst, method, arg, arg2) {\n      if (this.receiver && isFunc(this.receiver[method]))\n         this.receiver[method](this, arg, arg2);\n\n      if (brdcst && this.channels) {\n         const ks = Object.keys(this.channels);\n         for (let n = 0; n < ks.length; ++n)\n            this.channels[ks[n]].invokeReceiver(false, method, arg, arg2);\n      }\n   }\n\n   /** @summary Provide data for receiver. When no queue - do it directly.\n    * @private */\n   provideData(chid, msg, len) {\n      if (this.wait_first_recv) {\n         // here dummy first recv like EMBED_DONE is handled\n         delete this.wait_first_recv;\n         this.state = 1;\n         return this.invokeReceiver(false, 'onWebsocketOpened');\n      }\n\n      if ((chid > 1) && this.channels) {\n         const channel = this.channels[chid];\n         if (channel)\n            return channel.provideData(1, msg, len);\n      }\n\n      const force_queue = len && (len < 0);\n      if (!force_queue && (!this.msgqueue || !this.msgqueue.length))\n         return this.invokeReceiver(false, 'onWebsocketMsg', msg, len);\n\n      if (!this.msgqueue) this.msgqueue = [];\n      if (force_queue) len = undefined;\n\n      this.msgqueue.push({ ready: true, msg, len });\n   }\n\n   /** @summary Reserve entry in queue for data, which is not yet decoded.\n    * @private */\n   reserveQueueItem() {\n      if (!this.msgqueue) this.msgqueue = [];\n      const item = { ready: false, msg: null, len: 0 };\n      this.msgqueue.push(item);\n      return item;\n   }\n\n   /** @summary Provide data for item which was reserved before.\n    * @private */\n   markQueueItemDone(item, _msg, _len) {\n      item.ready = true;\n      item.msg = _msg;\n      item.len = _len;\n      this.processQueue();\n   }\n\n   /** @summary Process completed messages in the queue\n     * @private */\n   processQueue() {\n      if (this._loop_msgqueue || !this.msgqueue) return;\n      this._loop_msgqueue = true;\n      while ((this.msgqueue.length > 0) && this.msgqueue[0].ready) {\n         const front = this.msgqueue.shift();\n         this.invokeReceiver(false, 'onWebsocketMsg', front.msg, front.len);\n      }\n      if (this.msgqueue.length === 0)\n         delete this.msgqueue;\n      delete this._loop_msgqueue;\n   }\n\n   /** @summary Close connection */\n   close(force) {\n      if (this.master) {\n         this.master.send(`CLOSECH=${this.channelid}`, 0);\n         delete this.master.channels[this.channelid];\n         delete this.master;\n         return;\n      }\n\n      if (this.timerid) {\n         clearTimeout(this.timerid);\n         delete this.timerid;\n      }\n\n      if (this._websocket && (this.state > 0)) {\n         this.state = force ? -1 : 0; // -1 prevent socket from reopening\n         this._websocket.onclose = null; // hide normal handler\n         this._websocket.close();\n         delete this._websocket;\n      }\n   }\n\n   /** @summary Checks number of credits for send operation\n     * @param {number} [numsend = 1] - number of required send operations\n     * @return true if one allow to send specified number of text message to server */\n   canSend(numsend) { return this.cansend >= (numsend || 1); }\n\n   /** @summary Returns number of possible send operations relative to number of credits */\n   getRelCanSend() { return !this.credits ? 1 : this.cansend / this.credits; }\n\n   /** @summary Send text message via the connection.\n     * @param {string} msg - text message to send\n     * @param {number} [chid] - channel id, 1 by default, 0 used only for internal communication */\n   send(msg, chid) {\n      if (this.master)\n         return this.master.send(msg, this.channelid);\n\n      if (!this._websocket || (this.state <= 0)) return false;\n\n      if (!Number.isInteger(chid)) chid = 1; // when not configured, channel 1 is used - main widget\n\n      if (this.cansend <= 0) console.error(`should be queued before sending cansend: ${this.cansend}`);\n\n      const prefix = `${this.send_seq++}:${this.ackn}:${this.cansend}:${chid}:`;\n      this.ackn = 0;\n      this.cansend--; // decrease number of allowed send packets\n\n      let hash = 'none';\n      if (this.key && sessionKey)\n         hash = HMAC(this.key, `${prefix}${msg}`);\n\n      this._websocket.send(`${hash}:${prefix}${msg}`);\n\n      if ((this.kind === 'websocket') || (this.kind === 'longpoll')) {\n         if (this.timerid) clearTimeout(this.timerid);\n         this.timerid = setTimeout(() => this.keepAlive(), 10000);\n      }\n\n      return true;\n   }\n\n   /** @summary Send only last message of specified kind during defined time interval.\n     * @desc Idea is to prvent sending multiple messages of similar kind and overload connection\n     * Instead timeout is started after which only last specified message will be send\n     * @private */\n   sendLast(kind, tmout, msg) {\n      let d = this._delayed;\n      if (!d) d = this._delayed = {};\n      d[kind] = msg;\n      if (!d[`${kind}_handler`])\n         d[`${kind}_handler`] = setTimeout(() => { delete d[`${kind}_handler`]; this.send(d[kind]); }, tmout);\n   }\n\n   /** @summary Inject message(s) into input queue, for debug purposes only\n     * @private */\n   inject(msg, chid, immediate) {\n      // use timeout to avoid too deep call stack\n      if (!immediate)\n         return setTimeout(this.inject.bind(this, msg, chid, true), 0);\n\n      if (chid === undefined) chid = 1;\n\n      if (Array.isArray(msg)) {\n         for (let k = 0; k < msg.length; ++k)\n            this.provideData(chid, isStr(msg[k]) ? msg[k] : JSON.stringify(msg[k]), -1);\n         this.processQueue();\n      } else if (msg)\n         this.provideData(chid, isStr(msg) ? msg : JSON.stringify(msg));\n   }\n\n   /** @summary Send keep-alive message.\n     * @desc Only for internal use, only when used with websockets\n     * @private */\n   keepAlive() {\n      delete this.timerid;\n      this.send('KEEPALIVE', 0);\n   }\n\n   /** @summary Request server to resize window\n     * @desc For local displays like CEF or qt5 only server can do this */\n   resizeWindow(w, h) {\n      if (browser.qt5 || browser.cef3)\n         this.send(`RESIZE=${w},${h}`, 0);\n      else if ((typeof window !== 'undefined') && isFunc(window?.resizeTo))\n         window.resizeTo(w, h);\n   }\n\n   /** @summary Method open channel, which will share same connection, but can be used independently from main\n     * @private */\n   createChannel() {\n      if (this.master)\n         return this.master.createChannel();\n\n      const channel = new WebWindowHandle('channel', this.credits);\n      channel.wait_first_recv = true; // first received message via the channel is confirmation of established connection\n\n      if (!this.channels) {\n         this.channels = {};\n         this.freechannelid = 2;\n      }\n\n      channel.master = this;\n      channel.channelid = this.freechannelid++;\n\n      // register\n      this.channels[channel.channelid] = channel;\n\n      // now server-side entity should be initialized and init message send from server side!\n      return channel;\n   }\n\n   /** @summary Returns true if socket connected */\n   isConnected() { return this.state > 0; }\n\n   /** @summary Returns used channel ID, 1 by default */\n   getChannelId() { return this.channelid && this.master ? this.channelid : 1; }\n\n   /** @summary Assign href parameter\n     * @param {string} [path] - absolute path, when not specified window.location.url will be used\n     * @private */\n   setHRef(path) {\n      if (isStr(path) && (path.indexOf('?') > 0)) {\n         this.href = path.slice(0, path.indexOf('?'));\n         const d = decodeUrl(path);\n         this.key = d.get('key');\n         this.token = d.get('token');\n      } else {\n         this.href = path;\n         delete this.key;\n         delete this.token;\n      }\n   }\n\n   /** @summary Return href part\n     * @param {string} [relative_path] - relative path to the handle\n     * @private */\n   getHRef(relative_path) {\n      if (!relative_path || !this.kind || !this.href)\n         return this.href;\n      let addr = this.href;\n      if (relative_path.indexOf('../') === 0) {\n         const ddd = addr.lastIndexOf('/', addr.length-2);\n         addr = addr.slice(0, ddd) + relative_path.slice(2);\n      } else\n         addr += relative_path;\n\n      return addr;\n   }\n\n   /** @summary provide connection args for the web socket\n    * @private */\n   getConnArgs(ntry) {\n      let args = '';\n      if (this.key) {\n         const k = HMAC(this.key, `attempt_${ntry}`);\n         args += `key=${k}&ntry=${ntry}`;\n      }\n      if (this.token) {\n         if (args) args += '&';\n         args += `token=${this.token}`;\n      }\n      return args;\n   }\n\n   /** @summary Create configured socket for current object.\n     * @private */\n   connect(href) {\n      this.close();\n      if (!href && this.href) href = this.href;\n\n      let ntry = 0;\n\n      const retry_open = first_time => {\n         if (this.state !== 0) return;\n\n         if (!first_time) console.log(`try connect window again ${new Date().toString()}`);\n\n         if (this._websocket) {\n            this._websocket.close();\n            delete this._websocket;\n         }\n\n         if (!href) {\n            href = window.location.href;\n            if (href && href.indexOf('#') > 0) href = href.slice(0, href.indexOf('#'));\n            if (href && href.lastIndexOf('/') > 0) href = href.slice(0, href.lastIndexOf('/') + 1);\n         }\n         this.href = href;\n         ntry++;\n\n         if (first_time) console.log(`Opening web socket at ${href}`);\n\n         if (ntry > 2) showProgress(`Trying to connect ${href}`);\n\n         let path = href;\n\n         if (this.kind === 'file') {\n            path += 'root.filedump';\n            this._websocket = new FileDumpSocket(this);\n            console.log(`configure protocol log ${path}`);\n         } else if ((this.kind === 'websocket') && first_time) {\n            path = path.replace('http://', 'ws://').replace('https://', 'wss://') + 'root.websocket';\n            path += '?' + this.getConnArgs(ntry);\n            console.log(`configure websocket ${path}`);\n            this._websocket = new WebSocket(path);\n         } else {\n            path += 'root.longpoll';\n            console.log(`configure longpoll ${path}`);\n            this._websocket = new LongPollSocket(path, (this.kind === 'rawlongpoll'), this, ntry);\n         }\n\n         if (!this._websocket) return;\n\n         this._websocket.onopen = () => {\n            if (ntry > 2) showProgress();\n            this.state = 1;\n\n            const key = this.key || '';\n            this.send(`READY=${key}`, 0); // need to confirm connection\n            this.invokeReceiver(false, 'onWebsocketOpened');\n         };\n\n         this._websocket.onmessage = e => {\n            let msg = e.data;\n\n            if (this.next_binary) {\n               const binchid = this.next_binary,\n                     server_hash = this.next_binary_hash;\n               delete this.next_binary;\n               delete this.next_binary_hash;\n\n               if (msg instanceof Blob) {\n                  // convert Blob object to BufferArray\n                  const reader = new FileReader(), qitem = this.reserveQueueItem();\n                  // The file's text will be printed here\n                  reader.onload = event => {\n                     let result = event.target.result;\n                     if (this.key && sessionKey) {\n                        const hash = HMAC(this.key, result, 0);\n                        if (hash !== server_hash) {\n                           console.log('Discard binary buffer because of HMAC mismatch');\n                           result = new ArrayBuffer(0);\n                        }\n                     }\n\n                     this.markQueueItemDone(qitem, result, 0);\n                  };\n                  reader.readAsArrayBuffer(msg, e.offset || 0);\n               } else {\n                  // this is from CEF or LongPoll handler\n                  let result = msg;\n                  if (this.key && sessionKey) {\n                     const hash = HMAC(this.key, result, e.offset || 0);\n                     if (hash !== server_hash) {\n                        console.log('Discard binary buffer because of HMAC mismatch');\n                        result = new ArrayBuffer(0);\n                     }\n                  }\n                  this.provideData(binchid, result, e.offset || 0);\n               }\n\n               return;\n            }\n\n            if (!isStr(msg))\n               return console.log(`unsupported message kind: ${typeof msg}`);\n\n            const i0 = msg.indexOf(':'),\n                  server_hash = msg.slice(0, i0),\n                  i1 = msg.indexOf(':', i0 + 1),\n                  seq_id = Number.parseInt(msg.slice(i0 + 1, i1)),\n                  i2 = msg.indexOf(':', i1 + 1),\n                  credit = Number.parseInt(msg.slice(i1 + 1, i2)),\n                  i3 = msg.indexOf(':', i2 + 1),\n                  // cansend = parseInt(msg.slice(i2 + 1, i3)),  // TODO: take into account when sending messages\n                  i4 = msg.indexOf(':', i3 + 1),\n                  chid = Number.parseInt(msg.slice(i3 + 1, i4));\n\n            // for authentication HMAC checksum and sequence id is important\n            // HMAC used to authenticate server\n            // sequence id is necessary to exclude submission of same packet again\n            if (this.key && sessionKey) {\n               const client_hash = HMAC(this.key, msg.slice(i0+1));\n               if (server_hash !== client_hash)\n                  return console.log(`Failure checking server md5 sum ${server_hash}`);\n            }\n\n            if (seq_id <= this.recv_seq)\n               return console.log(`Failure with packet sequence ${seq_id} <= ${this.recv_seq}`);\n\n            this.recv_seq = seq_id; // sequence id of received packet\n            this.ackn++;            // count number of received packets,\n            this.cansend += credit; // how many packets client can send\n\n            msg = msg.slice(i4 + 1);\n\n            if (chid === 0) {\n               console.log(`GET chid=0 message ${msg}`);\n               if (msg === 'CLOSE') {\n                  this.close(true); // force closing of socket\n                  this.invokeReceiver(true, 'onWebsocketClosed');\n               } else if (msg.indexOf('NEW_KEY=') === 0) {\n                  const newkey = msg.slice(8);\n                  this.close(true);\n                  let href = (typeof document !== 'undefined') ? document.URL : null;\n                  if (isStr(href) && (typeof window !== 'undefined') && window?.history) {\n                     const p = href.indexOf('?key=');\n                     if (p > 0) href = href.slice(0, p);\n                     window.history.replaceState(window.history.state, undefined, `${href}?key=${newkey}`);\n                  } else if (typeof sessionStorage !== 'undefined')\n                     sessionStorage.setItem('RWebWindow_Key', newkey);\n                  location.reload(true);\n               }\n            } else if (msg.slice(0, 10) === '$$binary$$') {\n               this.next_binary = chid;\n               this.next_binary_hash = msg.slice(10);\n            } else if (msg === '$$nullbinary$$')\n               this.provideData(chid, new ArrayBuffer(0), 0);\n            else\n               this.provideData(chid, msg);\n\n            if (this.ackn > 7)\n               this.send('READY', 0); // send dummy message to server\n         };\n\n         this._websocket.onclose = arg => {\n            delete this._websocket;\n            if ((this.state > 0) || (arg === 'force_close')) {\n               console.log('websocket closed');\n               this.state = 0;\n               this.invokeReceiver(true, 'onWebsocketClosed');\n            }\n         };\n\n         this._websocket.onerror = err => {\n            console.log(`websocket error ${err} state ${this.state}`);\n            if (this.state > 0) {\n               this.invokeReceiver(true, 'onWebsocketError', err);\n               this.state = 0;\n            }\n         };\n\n         // only in interactive mode try to reconnect\n         if (!isBatchMode())\n            setTimeout(retry_open, 3000); // after 3 seconds try again\n      }; // retry_open\n\n      retry_open(true); // call for the first time\n   }\n\n   /** @summary Send newkey request to application\n     * @desc If server creates newkey and response - webpage will be reaload\n     * After key generation done, connection will not be working any longer\n     * WARNING - only call when you know that you are doing\n     * @private */\n   askReload() {\n      this.send('GENERATE_KEY', 0);\n   }\n\n   /** @summary Instal Ctrl-R handler to realod web window\n     * @desc Instead of default window reload invokes {@link askReload} method\n     * WARNING - only call when you know that you are doing\n     * @private */\n   addReloadKeyHandler() {\n      if (this.kind === 'file') return;\n\n      window.addEventListener('keydown', evnt => {\n         if (((evnt.key === 'R') || (evnt.key === 'r')) && evnt.ctrlKey) {\n            evnt.stopPropagation();\n            evnt.preventDefault();\n            console.log('Prevent Ctrl-R propogation - ask reload RWebWindow!');\n            this.askReload();\n          }\n      });\n   }\n\n} // class WebWindowHandle\n\n\n/** @summary Method used to initialize connection to web window.\n  * @param {object} arg - arguments\n  * @param {string} [arg.socket_kind] - kind of connection longpoll|websocket, detected automatically from URL\n  * @param {number} [arg.credits = 10] - number of packets which can be send to server without acknowledge\n  * @param {object} arg.receiver - instance of receiver for websocket events, allows to initiate connection immediately\n  * @param {string} [arg.first_recv] - required prefix in the first message from RWebWindow, remain part of message will be returned in handle.first_msg\n  * @param {string} [arg.href] - URL to RWebWindow, using window.location.href by default\n  * @return {Promise} for ready-to-use {@link WebWindowHandle} instance  */\nasync function connectWebWindow(arg) {\n   // mark that jsroot used with RWebWindow\n   browser.webwindow = true;\n\n   if (isFunc(arg))\n      arg = { callback: arg };\n   else if (!isObject(arg))\n      arg = {};\n\n   let d_key, d_token, new_key;\n\n   if (!arg.href) {\n      let href = (typeof document !== 'undefined') ? document.URL : '';\n      const p = href.indexOf('#');\n      if (p > 0) {\n         sessionKey = href.slice(p+1);\n         href = href.slice(0, p);\n      }\n\n      const d = decodeUrl(href);\n      d_key = d.get('key');\n      d_token = d.get('token');\n\n      if (typeof sessionStorage !== 'undefined') {\n         new_key = sessionStorage.getItem('RWebWindow_Key');\n         sessionStorage.removeItem('RWebWindow_Key');\n         if (new_key) console.log(`Use key ${new_key} from session storage`);\n\n         if (sessionKey)\n            sessionStorage.setItem('RWebWindow_SessionKey', sessionKey);\n         else\n            sessionKey = sessionStorage.getItem('RWebWindow_SessionKey') || '';\n      }\n\n      // hide key and any following parameters from URL, chrome do not allows to close browser with changed URL\n      if (d_key && !d.has('headless') && isStr(href) && (typeof window !== 'undefined') && window?.history) {\n         const p = href.indexOf('?key=');\n         if (p > 0) window.history.replaceState(window.history.state, undefined, href.slice(0, p));\n      }\n\n      // special holder script, prevents headless chrome browser from too early exit\n      if (d.has('headless') && d_key && (browser.isChromeHeadless || browser.isChrome) && !arg.ignore_chrome_batch_holder)\n         loadScript('root_batch_holder.js?key=' + (new_key || d_key));\n\n      if (!arg.platform)\n         arg.platform = d.get('platform');\n\n      if (arg.platform === 'qt5')\n         browser.qt5 = true;\n      else if (arg.platform === 'cef3')\n         browser.cef3 = true;\n\n      if (arg.batch === undefined)\n         arg.batch = d.has('headless');\n\n      if (arg.batch) setBatchMode(true);\n\n      if (!arg.socket_kind)\n         arg.socket_kind = d.get('ws');\n\n      if (!new_key && arg.winW && arg.winH && !isBatchMode() && isFunc(window?.resizeTo))\n         window.resizeTo(arg.winW, arg.winH);\n\n      if (!new_key && arg.winX && arg.winY && !isBatchMode() && isFunc(window?.moveTo))\n         window.moveTo(arg.winX, arg.winY);\n   }\n\n   if (!arg.socket_kind) {\n      if (browser.qt5)\n         arg.socket_kind = 'rawlongpoll';\n      else if (browser.cef3)\n         arg.socket_kind = 'longpoll';\n      else\n         arg.socket_kind = 'websocket';\n   }\n\n   // only for debug purposes\n   // arg.socket_kind = 'longpoll';\n\n   const main = new Promise(resolveFunc => {\n      const handle = new WebWindowHandle(arg.socket_kind, arg.credits);\n      handle.setUserArgs(arg.user_args);\n      if (arg.href)\n         handle.setHRef(arg.href); // apply href now  while connect can be called from other place\n      else {\n         handle.key = new_key || d_key;\n         handle.token = d_token;\n      }\n\n      if (window) {\n         window.onbeforeunload = () => handle.close(true);\n         if (browser.qt5) window.onqt5unload = window.onbeforeunload;\n      }\n\n\n      if (arg.receiver) {\n         // when receiver exists, it handles itself callbacks\n         handle.setReceiver(arg.receiver);\n         handle.connect();\n         return resolveFunc(handle);\n      }\n\n      if (!arg.first_recv)\n         return resolveFunc(handle);\n\n      handle.setReceiver({\n         onWebsocketOpened() {}, // dummy function when websocket connected\n\n         onWebsocketMsg(handle, msg) {\n            if (msg.indexOf(arg.first_recv) !== 0)\n               return handle.close();\n            handle.first_msg = msg.slice(arg.first_recv.length);\n            resolveFunc(handle);\n         },\n\n         onWebsocketClosed() { closeCurrentWindow(); } // when connection closed, close panel as well\n      });\n\n      handle.connect();\n   });\n\n   if (!arg.ui5) return main;\n\n   return Promise.all([main, loadOpenui5(arg)]).then(arr => arr[0]);\n}\n\nexport { WebWindowHandle, connectWebWindow };\n","import { settings, create, parse, toJSON, loadScript, registerMethods, isBatchMode, isFunc, isStr, nsREX } from '../core.mjs';\nimport { select as d3_select, rgb as d3_rgb } from '../d3.mjs';\nimport { closeCurrentWindow, showProgress, loadOpenui5, ToolbarIcons, getColorExec } from '../gui/utils.mjs';\nimport { GridDisplay, getHPainter } from '../gui/display.mjs';\nimport { makeTranslate } from '../base/BasePainter.mjs';\nimport { selectActivePad, cleanup, resize, EAxisBits } from '../base/ObjectPainter.mjs';\nimport { RObjectPainter } from '../base/RObjectPainter.mjs';\nimport { RAxisPainter } from './RAxisPainter.mjs';\nimport { RFramePainter } from './RFramePainter.mjs';\nimport { RPadPainter } from './RPadPainter.mjs';\nimport { addDragHandler } from './TFramePainter.mjs';\nimport { WebWindowHandle } from '../webwindow.mjs';\n\n\n/**\n * @summary Painter class for RCanvas\n *\n * @private\n */\n\nclass RCanvasPainter extends RPadPainter {\n\n   /** @summary constructor */\n   constructor(dom, canvas) {\n      super(dom, canvas, true);\n      this._websocket = null;\n      this.tooltip_allowed = settings.Tooltip;\n      this.v7canvas = true;\n      if ((dom === null) && (canvas === null)) {\n         // for web canvas details are important\n         settings.SmallPad.width = 20;\n         settings.SmallPad.height = 10;\n      }\n   }\n\n   /** @summary Cleanup canvas painter */\n   cleanup() {\n      delete this._websocket;\n      delete this._submreq;\n\n     if (this._changed_layout)\n         this.setLayoutKind('simple');\n      delete this._changed_layout;\n\n      super.cleanup();\n   }\n\n   /** @summary Returns layout kind */\n   getLayoutKind() {\n      const origin = this.selectDom('origin'),\n         layout = origin.empty() ? '' : origin.property('layout');\n      return layout || 'simple';\n   }\n\n   /** @summary Set canvas layout kind */\n   setLayoutKind(kind, main_selector) {\n      const origin = this.selectDom('origin');\n      if (!origin.empty()) {\n         if (!kind) kind = 'simple';\n         origin.property('layout', kind);\n         origin.property('layout_selector', (kind !== 'simple') && main_selector ? main_selector : null);\n         this._changed_layout = (kind !== 'simple'); // use in cleanup\n      }\n   }\n\n   /** @summary Changes layout\n     * @return {Promise} indicating when finished */\n   async changeLayout(layout_kind, mainid) {\n      const current = this.getLayoutKind();\n      if (current === layout_kind)\n         return true;\n\n      const origin = this.selectDom('origin'),\n            sidebar2 = origin.select('.side_panel2'),\n            lst = [];\n      let sidebar = origin.select('.side_panel'),\n          main = this.selectDom(), force;\n\n      while (main.node().firstChild)\n         lst.push(main.node().removeChild(main.node().firstChild));\n\n      if (!sidebar.empty())\n         cleanup(sidebar.node());\n      if (!sidebar2.empty())\n         cleanup(sidebar2.node());\n\n      this.setLayoutKind('simple'); // restore defaults\n      origin.html(''); // cleanup origin\n\n      if (layout_kind === 'simple') {\n         main = origin;\n         for (let k = 0; k < lst.length; ++k)\n            main.node().appendChild(lst[k]);\n         this.setLayoutKind(layout_kind);\n         force = true;\n      } else {\n         const grid = new GridDisplay(origin.node(), layout_kind);\n\n         if (mainid === undefined)\n            mainid = (layout_kind.indexOf('vert') === 0) ? 0 : 1;\n\n         main = d3_select(grid.getGridFrame(mainid));\n         main.classed('central_panel', true).style('position', 'relative');\n\n         if (mainid === 2) {\n            // left panel for Y\n            sidebar = d3_select(grid.getGridFrame(0));\n            sidebar.classed('side_panel2', true).style('position', 'relative');\n            // bottom panel for X\n            sidebar = d3_select(grid.getGridFrame(3));\n            sidebar.classed('side_panel', true).style('position', 'relative');\n         } else {\n            sidebar = d3_select(grid.getGridFrame(1 - mainid));\n            sidebar.classed('side_panel', true).style('position', 'relative');\n         }\n\n         // now append all childs to the new main\n         for (let k = 0; k < lst.length; ++k)\n            main.node().appendChild(lst[k]);\n\n         this.setLayoutKind(layout_kind, '.central_panel');\n\n         // remove reference to MDIDisplay, solves resize problem\n         origin.property('mdi', null);\n      }\n\n      // resize main drawing and let draw extras\n      resize(main.node(), force);\n      return true;\n   }\n\n   /** @summary Toggle projection\n     * @return {Promise} indicating when ready\n     * @private */\n   async toggleProjection(kind) {\n      delete this.proj_painter;\n\n      if (kind) this.proj_painter = { X: false, Y: false }; // just indicator that drawing can be preformed\n\n      if (isFunc(this.showUI5ProjectionArea))\n         return this.showUI5ProjectionArea(kind);\n\n      let layout = 'simple', mainid;\n\n      switch (kind) {\n         case 'XY': layout = 'projxy'; mainid = 2; break;\n         case 'X':\n         case 'bottom': layout = 'vert2_31'; mainid = 0; break;\n         case 'Y':\n         case 'left': layout = 'horiz2_13'; mainid = 1; break;\n         case 'top': layout = 'vert2_13'; mainid = 1; break;\n         case 'right': layout = 'horiz2_31'; mainid = 0; break;\n      }\n\n      return this.changeLayout(layout, mainid);\n   }\n\n   /** @summary Draw projection for specified histogram\n     * @private */\n   async drawProjection(/* kind,hist,hopt */) {\n      // dummy for the moment\n      return false;\n   }\n\n   /** @summary Draw in side panel\n     * @private */\n   async drawInSidePanel(canv, opt, kind) {\n      const sel = ((this.getLayoutKind() === 'projxy') && (kind === 'Y')) ? '.side_panel2' : '.side_panel',\n            side = this.selectDom('origin').select(sel);\n      return side.empty() ? null : this.drawObject(side.node(), canv, opt);\n   }\n\n   /** @summary Checks if canvas shown inside ui5 widget\n     * @desc Function should be used only from the func which supposed to be replaced by ui5\n     * @private */\n   testUI5() {\n      if (!this.use_openui) return false;\n      console.warn('full ui5 should be used - not loaded yet? Please check!!');\n      return true;\n   }\n\n   /** @summary Show message\n     * @desc Used normally with web-based canvas and handled in ui5\n     * @private */\n   showMessage(msg) {\n      if (!this.testUI5())\n         showProgress(msg, 7000);\n   }\n\n   /** @summary Function called when canvas menu item Save is called */\n   saveCanvasAsFile(fname) {\n      const pnt = fname.indexOf('.');\n      this.createImage(fname.slice(pnt+1))\n          .then(res => this.sendWebsocket(`SAVE:${fname}:${res}`));\n   }\n\n   /** @summary Send command to server to save canvas with specified name\n     * @desc Should be only used in web-based canvas\n     * @private */\n   sendSaveCommand(fname) {\n      this.sendWebsocket('PRODUCE:' + fname);\n   }\n\n   /** @summary Send message via web socket\n     * @private */\n   sendWebsocket(msg) {\n      if (this._websocket?.canSend()) {\n         this._websocket.send(msg);\n         return true;\n      }\n\n      return false;\n   }\n\n   /** @summary Close websocket connection to canvas\n     * @private */\n   closeWebsocket(force) {\n      if (this._websocket) {\n         this._websocket.close(force);\n         this._websocket.cleanup();\n         delete this._websocket;\n      }\n   }\n\n   /** @summary Use provided connection for the web canvas\n     * @private */\n   useWebsocket(handle) {\n      this.closeWebsocket();\n\n      this._websocket = handle;\n      this._websocket.setReceiver(this);\n      this._websocket.connect();\n   }\n\n   /** @summary set, test or reset timeout of specified name\n     * @desc Used to prevent overloading of websocket for specific function */\n   websocketTimeout(name, tm) {\n      if (!this._websocket)\n         return;\n      if (!this._websocket._tmouts)\n         this._websocket._tmouts = {};\n\n      const handle = this._websocket._tmouts[name];\n      if (tm === undefined)\n         return handle !== undefined;\n\n      if (tm === 'reset') {\n         if (handle) { clearTimeout(handle); delete this._websocket._tmouts[name]; }\n      } else if (!handle && Number.isInteger(tm))\n         this._websocket._tmouts[name] = setTimeout(() => { delete this._websocket._tmouts[name]; }, tm);\n   }\n\n   /** @summary Hanler for websocket open event\n     * @private */\n   onWebsocketOpened(/* handle */) {\n   }\n\n   /** @summary Hanler for websocket close event\n     * @private */\n   onWebsocketClosed(/* handle */) {\n      if (!this.embed_canvas)\n         closeCurrentWindow();\n   }\n\n   /** @summary Hanler for websocket message\n     * @private */\n   onWebsocketMsg(handle, msg) {\n      // console.log('GET_MSG ' + msg.slice(0,30));\n\n      if (msg === 'CLOSE') {\n         this.onWebsocketClosed();\n         this.closeWebsocket(true);\n      } else if (msg.slice(0, 5) === 'SNAP:') {\n         msg = msg.slice(5);\n         const p1 = msg.indexOf(':'),\n             snapid = msg.slice(0, p1),\n             snap = parse(msg.slice(p1+1));\n         this.syncDraw(true)\n             .then(() => {\n                if (!this.snapid && snap?.fWinSize)\n                   this.resizeBrowser(snap.fWinSize[0], snap.fWinSize[1]);\n             }).then(() => this.redrawPadSnap(snap))\n             .then(() => {\n                 handle.send(`SNAPDONE:${snapid}`); // send ready message back when drawing completed\n                 this.confirmDraw();\n              });\n      } else if (msg.slice(0, 4) === 'JSON') {\n         const obj = parse(msg.slice(4));\n         // console.log('get JSON ', msg.length-4, obj._typename);\n         this.redrawObject(obj);\n      } else if (msg.slice(0, 9) === 'REPL_REQ:')\n         this.processDrawableReply(msg.slice(9));\n       else if (msg.slice(0, 4) === 'CMD:') {\n         msg = msg.slice(4);\n         const p1 = msg.indexOf(':'),\n             cmdid = msg.slice(0, p1),\n             cmd = msg.slice(p1+1),\n             reply = `REPLY:${cmdid}:`;\n         if ((cmd === 'SVG') || (cmd === 'PNG') || (cmd === 'JPEG')) {\n            this.createImage(cmd.toLowerCase())\n                .then(res => handle.send(reply + res));\n         } else if (cmd.indexOf('ADDPANEL:') === 0) {\n            const relative_path = cmd.slice(9);\n            if (!isFunc(this.showUI5Panel))\n               handle.send(reply + 'false');\n             else {\n               const conn = new WebWindowHandle(handle.kind);\n\n               // set interim receiver until first message arrives\n               conn.setReceiver({\n                  cpainter: this,\n\n                  onWebsocketOpened() {\n                  },\n\n                  onWebsocketMsg(panel_handle, msg) {\n                     const panel_name = (msg.indexOf('SHOWPANEL:') === 0) ? msg.slice(10) : '';\n                     this.cpainter.showUI5Panel(panel_name, panel_handle)\n                                  .then(res => handle.send(reply + (res ? 'true' : 'false')));\n                  },\n\n                  onWebsocketClosed() {\n                     // if connection failed,\n                     handle.send(reply + 'false');\n                  },\n\n                  onWebsocketError() {\n                     // if connection failed,\n                     handle.send(reply + 'false');\n                  }\n\n               });\n\n               let addr = handle.href;\n               if (relative_path.indexOf('../') === 0) {\n                  const ddd = addr.lastIndexOf('/', addr.length-2);\n                  addr = addr.slice(0, ddd) + relative_path.slice(2);\n               } else\n                  addr += relative_path;\n\n               // only when connection established, panel will be activated\n               conn.connect(addr);\n            }\n         } else {\n            console.log('Unrecognized command ' + cmd);\n            handle.send(reply);\n         }\n      } else if ((msg.slice(0, 7) === 'DXPROJ:') || (msg.slice(0, 7) === 'DYPROJ:')) {\n         const kind = msg[1],\n             hist = parse(msg.slice(7));\n         this.drawProjection(kind, hist);\n      } else if (msg.slice(0, 5) === 'SHOW:') {\n         const that = msg.slice(5),\n             on = that[that.length-1] === '1';\n         this.showSection(that.slice(0, that.length-2), on);\n      } else\n         console.log(`unrecognized msg len: ${msg.length} msg: ${msg.slice(0, 30)}`);\n   }\n\n   /** @summary Submit request to RDrawable object on server side */\n   submitDrawableRequest(kind, req, painter, method) {\n      if (!this._websocket || !req || !req._typename ||\n          !painter.snapid || !isStr(painter.snapid)) return null;\n\n      if (kind && method) {\n         // if kind specified - check if such request already was submitted\n         if (!painter._requests) painter._requests = {};\n\n         const prevreq = painter._requests[kind];\n\n         if (prevreq) {\n            const tm = new Date().getTime();\n            if (!prevreq._tm || (tm - prevreq._tm < 5000)) {\n               prevreq._nextreq = req; // submit when got reply\n               return false;\n            }\n            delete painter._requests[kind]; // let submit new request after timeout\n         }\n\n         painter._requests[kind] = req; // keep reference on the request\n      }\n\n      req.id = painter.snapid;\n\n      if (method) {\n         if (!this._nextreqid) this._nextreqid = 1;\n         req.reqid = this._nextreqid++;\n      } else\n         req.reqid = 0; // request will not be replied\n\n\n      const msg = JSON.stringify(req);\n\n      if (req.reqid) {\n         req._kind = kind;\n         req._painter = painter;\n         req._method = method;\n         req._tm = new Date().getTime();\n\n         if (!this._submreq) this._submreq = {};\n         this._submreq[req.reqid] = req; // fast access to submitted requests\n      }\n\n      // console.log('Sending request ', msg.slice(0,60));\n\n      this.sendWebsocket('REQ:' + msg);\n      return req;\n   }\n\n   /** @summary Submit menu request\n     * @private */\n   async submitMenuRequest(painter, menukind, reqid) {\n      return new Promise(resolveFunc => {\n         this.submitDrawableRequest('', {\n            _typename: `${nsREX}RDrawableMenuRequest`,\n            menukind: menukind || '',\n            menureqid: reqid // used to identify menu request\n         }, painter, resolveFunc);\n      });\n   }\n\n   /** @summary Submit executable command for given painter */\n   submitExec(painter, exec, subelem) {\n      // snapid is intentionally ignored - only painter.snapid has to be used\n      if (!this._websocket) return;\n\n      if (subelem && isStr(subelem)) {\n         const len = subelem.length;\n         if ((len > 2) && (subelem.indexOf('#x') === len - 2)) subelem = 'x'; else\n         if ((len > 2) && (subelem.indexOf('#y') === len - 2)) subelem = 'y'; else\n         if ((len > 2) && (subelem.indexOf('#z') === len - 2)) subelem = 'z';\n\n         if ((subelem === 'x') || (subelem === 'y') || (subelem === 'z'))\n            exec = subelem + 'axis#' + exec;\n         else\n            return console.log(`not recoginzed subelem ${subelem} in SubmitExec`);\n       }\n\n      this.submitDrawableRequest('', { _typename: `${nsREX}RDrawableExecRequest`, exec }, painter);\n   }\n\n   /** @summary Process reply from request to RDrawable */\n   processDrawableReply(msg) {\n      const reply = parse(msg);\n      if (!reply || !reply.reqid || !this._submreq) return false;\n\n      const req = this._submreq[reply.reqid];\n      if (!req) return false;\n\n      // remove reference first\n      delete this._submreq[reply.reqid];\n\n      // remove blocking reference for that kind\n      if (req._kind && req._painter?._requests) {\n         if (req._painter._requests[req._kind] === req)\n            delete req._painter._requests[req._kind];\n      }\n\n      if (req._method)\n         req._method(reply, req);\n\n      // resubmit last request of that kind\n      if (req._nextreq && !req._painter._requests[req._kind])\n         this.submitDrawableRequest(req._kind, req._nextreq, req._painter, req._method);\n   }\n\n   /** @summary Show specified section in canvas */\n   async showSection(that, on) {\n      switch (that) {\n         case 'Menu': break;\n         case 'StatusBar': break;\n         case 'Editor': break;\n         case 'ToolBar': break;\n         case 'ToolTips': this.setTooltipAllowed(on); break;\n      }\n      return true;\n   }\n\n   /** @summary Method informs that something was changed in the canvas\n     * @desc used to update information on the server (when used with web6gui)\n     * @private */\n   processChanges(kind, painter, subelem) {\n      // check if we could send at least one message more - for some meaningful actions\n      if (!this._websocket || !this._websocket.canSend(2) || !isStr(kind)) return;\n\n      const msg = '';\n      if (!painter) painter = this;\n      switch (kind) {\n         case 'sbits':\n            console.log('Status bits in RCanvas are changed - that to do?');\n            break;\n         case 'frame': // when moving frame\n         case 'zoom':  // when changing zoom inside frame\n            console.log('Frame moved or zoom is changed - that to do?');\n            break;\n         case 'pave_moved':\n            console.log('TPave is moved inside RCanvas - that to do?');\n            break;\n         default:\n            if ((kind.slice(0, 5) === 'exec:') && painter?.snapid)\n               this.submitExec(painter, kind.slice(5), subelem);\n             else\n               console.log('UNPROCESSED CHANGES', kind);\n      }\n\n      if (msg)\n         console.log('RCanvas::processChanges want to send  ' + msg.length + '  ' + msg.slice(0, 40));\n   }\n\n   /** @summary Handle pad button click event\n     * @private */\n   clickPadButton(funcname, evnt) {\n      if (funcname === 'ToggleGed')\n         return this.activateGed(this, null, 'toggle');\n      if (funcname === 'ToggleStatus')\n         return this.activateStatusBar('toggle');\n      return super.clickPadButton(funcname, evnt);\n   }\n\n   /** @summary returns true when event status area exist for the canvas */\n   hasEventStatus() {\n      if (this.testUI5()) return false;\n      if (this.brlayout)\n         return this.brlayout.hasStatus();\n      const hp = getHPainter();\n      return hp ? hp.hasStatusLine() : false;\n   }\n\n   /** @summary Check if status bar can be toggled\n     * @private */\n   canStatusBar() {\n      return this.testUI5() || this.brlayout || getHPainter();\n   }\n\n   /** @summary Show/toggle event status bar\n     * @private */\n   activateStatusBar(state) {\n      if (this.testUI5())\n         return;\n      if (this.brlayout)\n         this.brlayout.createStatusLine(23, state);\n      else\n         getHPainter()?.createStatusLine(23, state);\n\n      this.processChanges('sbits', this);\n   }\n\n   /** @summary Show online canvas status\n     * @private */\n   showCanvasStatus(...msgs) {\n      if (this.testUI5()) return;\n\n      const br = this.brlayout || getHPainter()?.brlayout;\n\n      br?.showStatus(...msgs);\n   }\n\n   /** @summary Returns true if GED is present on the canvas */\n   hasGed() {\n      if (this.testUI5()) return false;\n      return this.brlayout?.hasContent() ?? false;\n   }\n\n   /** @summary Function used to de-activate GED\n     * @private */\n   removeGed() {\n      if (this.testUI5()) return;\n\n      this.registerForPadEvents(null);\n\n      if (this.ged_view) {\n         this.ged_view.getController().cleanupGed();\n         this.ged_view.destroy();\n         delete this.ged_view;\n      }\n      this.brlayout?.deleteContent(true);\n      this.processChanges('sbits', this);\n   }\n\n   /** @summary Get view data for ui5 panel\n     * @private */\n   getUi5PanelData(/* panel_name */) {\n      return { jsroot: { settings, create, parse, toJSON, loadScript, EAxisBits, getColorExec } };\n   }\n\n   /** @summary Function used to activate GED\n     * @return {Promise} when GED is there\n     * @private */\n   async activateGed(objpainter, kind, mode) {\n      if (this.testUI5() || !this.brlayout)\n         return false;\n\n      if (this.brlayout.hasContent()) {\n         if ((mode === 'toggle') || (mode === false))\n            this.removeGed();\n         else\n            objpainter?.getPadPainter()?.selectObjectPainter(objpainter);\n\n         return true;\n      }\n\n      if (mode === false)\n         return false;\n\n      const btns = this.brlayout.createBrowserBtns();\n\n      ToolbarIcons.createSVG(btns, ToolbarIcons.diamand, 15, 'toggle fix-pos mode', 'browser')\n                  .style('margin', '3px').on('click', () => this.brlayout.toggleKind('fix'));\n\n      ToolbarIcons.createSVG(btns, ToolbarIcons.circle, 15, 'toggle float mode', 'browser')\n                  .style('margin', '3px').on('click', () => this.brlayout.toggleKind('float'));\n\n      ToolbarIcons.createSVG(btns, ToolbarIcons.cross, 15, 'delete GED', 'browser')\n                  .style('margin', '3px').on('click', () => this.removeGed());\n\n      // be aware, that jsroot_browser_hierarchy required for flexible layout that element use full browser area\n      this.brlayout.setBrowserContent('<div class=\\'jsroot_browser_hierarchy\\' id=\\'ged_placeholder\\'>Loading GED ...</div>');\n      this.brlayout.setBrowserTitle('GED');\n      this.brlayout.toggleBrowserKind(kind || 'float');\n\n      return new Promise(resolveFunc => {\n         loadOpenui5.then(sap => {\n            d3_select('#ged_placeholder').text('');\n\n            sap.ui.require(['sap/ui/model/json/JSONModel', 'sap/ui/core/mvc/XMLView'], (JSONModel, XMLView) => {\n               const oModel = new JSONModel({ handle: null });\n\n               XMLView.create({\n                  viewName: 'rootui5.canv.view.Ged',\n                  viewData: this.getUi5PanelData('Ged')\n               }).then(oGed => {\n                  oGed.setModel(oModel);\n\n                  oGed.placeAt('ged_placeholder');\n\n                  this.ged_view = oGed;\n\n                  // TODO: should be moved into Ged controller - it must be able to detect canvas painter itself\n                  this.registerForPadEvents(oGed.getController().padEventsReceiver.bind(oGed.getController()));\n\n                  objpainter?.getPadPainter()?.selectObjectPainter(objpainter);\n\n                  this.processChanges('sbits', this);\n\n                  resolveFunc(true);\n               });\n            });\n         });\n      });\n   }\n\n   /** @summary produce JSON for RCanvas, which can be used to display canvas once again\n     * @private */\n   produceJSON() {\n      console.error('RCanvasPainter.produceJSON not yet implemented');\n      return '';\n   }\n\n   /** @summary resize browser window to get requested canvas sizes */\n   resizeBrowser(fullW, fullH) {\n      if (!fullW || !fullH || this.isBatchMode() || this.embed_canvas || this.batch_mode)\n         return;\n      this._websocket?.resizeWindow(fullW, fullH);\n   }\n\n   /** @summary draw RCanvas object */\n   static async draw(dom, can /*, opt */) {\n      const nocanvas = !can;\n      if (nocanvas)\n         can = create(`${nsREX}RCanvas`);\n\n      const painter = new RCanvasPainter(dom, can);\n      painter.normal_canvas = !nocanvas;\n      painter.createCanvasSvg(0);\n\n      selectActivePad({ pp: painter, active: false });\n\n      return painter.drawPrimitives().then(() => {\n         painter.addPadButtons();\n         painter.showPadButtons();\n         return painter;\n      });\n   }\n\n} // class RCanvasPainter\n\n\n/** @summary draw RPadSnapshot object\n  * @private */\nfunction drawRPadSnapshot(dom, snap /*, opt */) {\n   const painter = new RCanvasPainter(dom, null);\n   painter.normal_canvas = false;\n   painter.batch_mode = isBatchMode();\n   return painter.syncDraw(true).then(() => painter.redrawPadSnap(snap)).then(() => {\n      painter.confirmDraw();\n      painter.showPadButtons();\n      return painter;\n   });\n}\n\n/** @summary Ensure RCanvas and RFrame for the painter object\n  * @param {Object} painter  - painter object to process\n  * @param {string|boolean} frame_kind  - false for no frame or '3d' for special 3D mode\n  * @desc Assigns DOM, creates and draw RCanvas and RFrame if necessary, add painter to pad list of painters\n  * @return {Promise} for ready\n  * @private */\nasync function ensureRCanvas(painter, frame_kind) {\n   if (!painter)\n      return Promise.reject(Error('Painter not provided in ensureRCanvas'));\n\n   // simple check - if canvas there, can use painter\n   const pr = painter.getCanvSvg().empty() ? RCanvasPainter.draw(painter.getDom(), null /* noframe */) : Promise.resolve(true);\n\n   return pr.then(() => {\n      if ((frame_kind !== false) && painter.getFrameSvg().selectChild('.main_layer').empty())\n         return RFramePainter.draw(painter.getDom(), null, isStr(frame_kind) ? frame_kind : '');\n   }).then(() => {\n      painter.addToPadPrimitives();\n      return painter;\n   });\n}\n\n\n/** @summary Function used for direct draw of RFrameTitle\n  * @private */\nfunction drawRFrameTitle(reason, drag) {\n   const fp = this.getFramePainter();\n   if (!fp)\n      return console.log('no frame painter - no title');\n\n   const rect = fp.getFrameRect(),\n         fx = rect.x,\n         fy = rect.y,\n         fw = rect.width,\n         // fh           = rect.height,\n         ph = this.getPadPainter().getPadHeight(),\n         title = this.getObject(),\n         title_width = fw,\n         textFont = this.v7EvalFont('text', { size: 0.07, color: 'black', align: 22 });\n   let title_margin = this.v7EvalLength('margin', ph, 0.02),\n       title_height = this.v7EvalLength('height', ph, 0.05);\n\n   if (reason === 'drag') {\n      title_height = drag.height;\n      title_margin = fy - drag.y - drag.height;\n      const changes = {};\n      this.v7AttrChange(changes, 'margin', title_margin / ph);\n      this.v7AttrChange(changes, 'height', title_height / ph);\n      this.v7SendAttrChanges(changes, false); // do not invoke canvas update on the server\n   }\n\n   this.createG();\n\n   makeTranslate(this.draw_g, fx, Math.round(fy-title_margin-title_height));\n\n   const arg = { x: title_width/2, y: title_height/2, text: title.fText, latex: 1 };\n\n   this.startTextDrawing(textFont, 'font');\n\n   this.drawText(arg);\n\n   return this.finishTextDrawing().then(() =>\n      addDragHandler(this, { x: fx, y: Math.round(fy-title_margin-title_height), width: title_width, height: title_height,\n                             minwidth: 20, minheight: 20, no_change_x: true, redraw: d => this.redraw('drag', d) })\n   );\n}\n\n/// /////////////////////////////////////////////////////////////////////////////////////////\n\nregisterMethods(`${nsREX}RPalette`, {\n\n   extractRColor(rcolor) {\n     return rcolor.fColor || 'black';\n   },\n\n   getColor(indx) {\n      return this.palette[indx];\n   },\n\n   getContourIndex(zc) {\n      const cntr = this.fContour;\n      let l = 0, r = cntr.length-1, mid;\n\n      if (zc < cntr[0]) return -1;\n      if (zc >= cntr[r]) return r-1;\n\n      if (this.fCustomContour) {\n         while (l < r-1) {\n            mid = Math.round((l+r)/2);\n            if (cntr[mid] > zc) r = mid; else l = mid;\n         }\n         return l;\n      }\n\n      // last color in palette starts from level cntr[r-1]\n      return Math.floor((zc-cntr[0]) / (cntr[r-1] - cntr[0]) * (r-1));\n   },\n\n   getContourColor(zc) {\n      const zindx = this.getContourIndex(zc);\n      return (zindx < 0) ? '' : this.getColor(zindx);\n   },\n\n   getContour() {\n      return this.fContour && (this.fContour.length > 1) ? this.fContour : null;\n   },\n\n   deleteContour() {\n      delete this.fContour;\n   },\n\n   calcColor(value, entry1, entry2) {\n      const dist = entry2.fOrdinal - entry1.fOrdinal,\n          r1 = entry2.fOrdinal - value,\n          r2 = value - entry1.fOrdinal;\n\n      if (!this.fInterpolate || (dist <= 0))\n         return (r1 < r2) ? entry2.fColor : entry1.fColor;\n\n      // interpolate\n      const col1 = d3_rgb(this.extractRColor(entry1.fColor)),\n          col2 = d3_rgb(this.extractRColor(entry2.fColor)),\n          color = d3_rgb(Math.round((col1.r*r1 + col2.r*r2)/dist),\n                         Math.round((col1.g*r1 + col2.g*r2)/dist),\n                         Math.round((col1.b*r1 + col2.b*r2)/dist));\n\n      return color.toString();\n   },\n\n   createPaletteColors(len) {\n      const arr = [];\n      let indx = 0;\n\n      while (arr.length < len) {\n         const value = arr.length / (len-1),\n\n          entry = this.fColors[indx];\n\n         if ((Math.abs(entry.fOrdinal - value) < 0.0001) || (indx === this.fColors.length - 1)) {\n            arr.push(this.extractRColor(entry.fColor));\n            continue;\n         }\n\n         const next = this.fColors[indx+1];\n         if (next.fOrdinal <= value)\n            indx++;\n         else\n            arr.push(this.calcColor(value, entry, next));\n      }\n\n      return arr;\n   },\n\n   getColorOrdinal(value) {\n      // extract color with ordinal value between 0 and 1\n      if (!this.fColors)\n         return 'black';\n      if ((typeof value !== 'number') || (value < 0))\n         value = 0;\n      else if (value > 1)\n         value = 1;\n\n      // TODO: implement better way to find index\n\n      let entry, next = this.fColors[0];\n      for (let indx = 0; indx < this.fColors.length-1; ++indx) {\n         entry = next;\n\n         if (Math.abs(entry.fOrdinal - value) < 0.0001)\n            return this.extractRColor(entry.fColor);\n\n         next = this.fColors[indx+1];\n         if (next.fOrdinal > value)\n            return this.calcColor(value, entry, next);\n      }\n\n      return this.extractRColor(next.fColor);\n   },\n\n   setFullRange(min, max) {\n      // set full z scale range, used in zooming\n      this.full_min = min;\n      this.full_max = max;\n   },\n\n   createContour(logz, nlevels, zmin, zmax, zminpositive) {\n      this.fContour = [];\n      delete this.fCustomContour;\n      this.colzmin = zmin;\n      this.colzmax = zmax;\n\n      if (logz) {\n         if (this.colzmax <= 0) this.colzmax = 1.0;\n         if (this.colzmin <= 0) {\n            if ((zminpositive === undefined) || (zminpositive <= 0))\n               this.colzmin = 0.0001*this.colzmax;\n            else\n               this.colzmin = ((zminpositive < 3) || (zminpositive>100)) ? 0.3*zminpositive : 1;\n         }\n         if (this.colzmin >= this.colzmax)\n            this.colzmin = 0.0001*this.colzmax;\n\n         const logmin = Math.log(this.colzmin)/Math.log(10),\n             logmax = Math.log(this.colzmax)/Math.log(10),\n             dz = (logmax-logmin)/nlevels;\n         this.fContour.push(this.colzmin);\n         for (let level=1; level<nlevels; level++)\n            this.fContour.push(Math.exp((logmin + dz*level)*Math.log(10)));\n         this.fContour.push(this.colzmax);\n         this.fCustomContour = true;\n      } else {\n         if ((this.colzmin === this.colzmax) && (this.colzmin !== 0)) {\n            this.colzmax += 0.01*Math.abs(this.colzmax);\n            this.colzmin -= 0.01*Math.abs(this.colzmin);\n         }\n         const dz = (this.colzmax-this.colzmin)/nlevels;\n         for (let level=0; level<=nlevels; level++)\n            this.fContour.push(this.colzmin + dz*level);\n      }\n\n      if (!this.palette || (this.palette.length !== nlevels))\n         this.palette = this.createPaletteColors(nlevels);\n   }\n\n});\n\n/** @summary draw RFont object\n  * @private */\nfunction drawRFont() {\n   const font = this.getObject(),\n         svg = this.getCanvSvg(),\n         clname = 'custom_font_' + font.fFamily+font.fWeight+font.fStyle;\n   let defs = svg.selectChild('.canvas_defs');\n\n   if (defs.empty())\n      defs = svg.insert('svg:defs', ':first-child').attr('class', 'canvas_defs');\n\n   let entry = defs.selectChild('.' + clname);\n   if (entry.empty()) {\n      entry = defs.append('style')\n                  .attr('type', 'text/css')\n                  .attr('class', clname)\n                  .text(`@font-face { font-family: \"${font.fFamily}\"; font-weight: ${font.fWeight ? font.fWeight : 'normal'}; font-style: ${font.fStyle ? font.fStyle : 'normal'}; src: ${font.fSrc}; }`);\n      const p1 = font.fSrc.indexOf('base64,'),\n            p2 = font.fSrc.lastIndexOf(' format(');\n      if (p1 > 0 && p2 > p1) {\n         const base64 = font.fSrc.slice(p1 + 7, p2 - 2),\n               is_ttf = font.fSrc.indexOf('data:application/font-ttf') > 0;\n         // TODO: for the moment only ttf format supported by jsPDF\n         if (is_ttf)\n            entry.property('$fonthandler', { name: font.fFamily, format: 'ttf', base64 });\n      }\n   }\n\n   if (font.fDefault)\n      this.getPadPainter()._dfltRFont = font;\n\n   return true;\n}\n\n/** @summary draw RAxis object\n  * @private */\nfunction drawRAxis(dom, obj, opt) {\n   const painter = new RAxisPainter(dom, obj, opt);\n   painter.disable_zooming = true;\n   return ensureRCanvas(painter, false)\n           .then(() => painter.redraw())\n           .then(() => painter);\n}\n\n/** @summary draw RFrame object\n  * @private */\nfunction drawRFrame(dom, obj, opt) {\n   const p = new RFramePainter(dom, obj);\n   if (opt === '3d') p.mode3d = true;\n   return ensureRCanvas(p, false).then(() => p.redraw());\n}\n\nexport { ensureRCanvas, drawRPadSnapshot,\n         drawRFrameTitle, drawRFont, drawRAxis, drawRFrame,\n         RObjectPainter, RPadPainter, RCanvasPainter };\n"],"x_google_ignoreList":[0,1,2,3,4,5,6]}