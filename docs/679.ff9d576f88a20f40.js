"use strict";(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[679],{2679:(R,L,k)=>{k.r(L),k.d(L,{TGraphPainter:()=>F,clTGraphAsymmErrors:()=>S});var T=k(4882),u=k(8872),C=k(8362),E=k(2843),z=k(1922),G=k(4615),Y=k(212),P=k(2985),D=k(5992),H=k(7900);const v=(0,u.BIT)(18),X="TGraphErrors",S="TGraphAsymmErrors",N="TGraphBentErrors",B="TGraphMultiErrors";class F extends z.JW{constructor(t,i){super(t,i),this.axes_draw=!1,this.bins=null,this.xmin=this.ymin=this.xmax=this.ymax=0,this.wheel_zoomy=!0,this.is_bent=i._typename===N,this.has_errors=i._typename===X||i._typename===B||i._typename===S||this.is_bent||i._typename.match(/^RooHist/)}getGraph(){return this.getObject()}getHistogram(){return this.getObject()?.fHistogram}setHistogram(t){const i=this.getObject();i&&(i.fHistogram=t)}redraw(){var t=this;return(0,T.A)(function*(){let i=Promise.resolve(!0);if(t.$redraw_hist){delete t.$redraw_hist;const s=t.getMainPainter();s?.isSecondary(t)&&t.axes_draw&&(i=s.redraw())}return i.then(()=>t.drawGraph()).then(()=>{const s=t._funcHandler?.drawNext(0)??t;return delete t._funcHandler,s})})()}cleanup(){delete this.interactive_bin,delete this.bins,super.cleanup()}get_gme(){const t=this.getGraph();return t?._typename===B?t:null}decodeOptions(t,i){(0,u.isStr)(t)&&0===t.indexOf("same ")&&(t=t.slice(5));const s=this.getGraph(),a=!!this.get_gme(),n=i?!!this.getMainPainter():!this.axes_draw;let l=[];this.options||(this.options={});const m=(x,e)=>{Object.assign(e,{Line:0,Curve:0,Rect:0,Mark:0,Bar:0,OutRange:0,EF:0,Fill:0,MainError:1,Ends:1,ScaleErrX:1}),a&&x.check("S=",!0)&&(e.ScaleErrX=x.partAsFloat()),x.check("L")&&(e.Line=1),x.check("F")&&(e.Fill=1),x.check("CC")&&(e.Curve=2),x.check("C")&&(e.Curve=1),x.check("*")&&(e.Mark=103),x.check("P0")&&(e.Mark=104),x.check("P")&&(e.Mark=1),x.check("B")&&(e.Bar=1,e.Errors=0),x.check("Z")&&(e.Errors=1,e.Ends=0),x.check("||")&&(e.Errors=1,e.MainError=0,e.Ends=1),x.check("[]")&&(e.Errors=1,e.MainError=0,e.Ends=2),x.check("|>")&&(e.Errors=1,e.Ends=3),x.check(">")&&(e.Errors=1,e.Ends=4),x.check("0")&&(e.Mark=1,e.Errors=1,e.OutRange=1),x.check("1")&&1===e.Bar&&(e.Bar=2),x.check("2")&&(e.Rect=1,e.Errors=0),x.check("3")&&(e.EF=1,e.Errors=0),x.check("4")&&(e.EF=2,e.Errors=0),x.check("5")&&(e.Rect=2,e.Errors=0),x.check("X")&&(e.Errors=0)};Object.assign(this.options,{Axis:"",NoOpt:0,PadStats:!1,PadPalette:!1,original:t,second_x:!1,second_y:!1,individual_styles:!1}),a&&t&&(t.indexOf(";")>0?(l=t.split(";"),t=l.shift()):t.indexOf("_")>0&&(l=t.split("_"),t=l.shift()));const r=this.options,y="AXIS;FORCE_TITLE;";let c=new E.nC(t),f="";if(Y.c.forEach(x=>{c.check(x)&&(f+=";"+x)}),c.check("XAXIS_",!0)&&(f+=";XAXIS_"+c.part),c.check("YAXIS_",!0)&&(f+=";YAXIS_"+c.part),c.empty()&&(r.original=n?"lp":"alp",c=new E.nC(r.original)),c.check("NOOPT")&&(r.NoOpt=1),c.check("POS3D_",!0)&&(r.pos3d=c.partAsInt()-.5),c.check("PFC")&&!r._pfc&&(r._pfc=2),c.check("PLC")&&!r._plc&&(r._plc=2),c.check("PMC")&&!r._pmc&&(r._pmc=2),c.check("A")&&(r.Axis=c.check("I")?"A;":y),c.check("X+")&&(r.Axis+="X+",r.second_x=n),c.check("Y+")&&(r.Axis+="Y+",r.second_y=n),c.check("RX")&&(r.Axis+="RX"),c.check("RY")&&(r.Axis+="RY"),a&&(r.blocks=[],r.skip_errors_x0=r.skip_errors_y0=!1,c.check("X0")&&(r.skip_errors_x0=!0),c.check("Y0")&&(r.skip_errors_y0=!0)),m(c,r),a&&c.check("S")&&(r.individual_styles=!0),void 0===r.Errors&&(r.Errors=!this.has_errors||a&&l.length?0:1),1===r.Mark&&1===s.fMarkerStyle&&(r.Mark=101),r.Line+r.Fill+r.Curve+r.Mark+r.Bar+r.EF+r.Rect+r.Errors===0&&c.empty()&&(r.Line=1),this.matchObjectType(X)){const x=s.fEX.length;let e=0;for(let h=0;h<x;++h)e=Math.max(e,s.fEX[h],s.fEY[h]);e<1e-100&&(r.Errors=0)}if(this._cutg=this.matchObjectType(u.clTCutG),this._cutg_lastsame=this._cutg&&s.fNpoints>3&&s.fX[0]===s.fX[s.fNpoints-1]&&s.fY[0]===s.fY[s.fNpoints-1],r.Axis)r.Axis.indexOf("A")<0&&(r.Axis=y+r.Axis);else{const x=this.getPadPainter()?.getRootPad(!0);(!x||x?.fPrimitives?.arr[0]===this.getObject())&&(r.Axis=y)}r.Axis+=f;for(let x=0;x<l.length;++x){const h={};m(new E.nC(l[x]),h),h.skip_errors_x0=r.skip_errors_x0,h.skip_errors_y0=r.skip_errors_y0,r.blocks.push(h)}}extractGmeErrors(t){if(!this.bins)return;const i=this.getGraph();this.bins.forEach(s=>{s.eylow=i.fEyL[t][s.indx],s.eyhigh=i.fEyH[t][s.indx]})}createBins(){const t=this.getGraph();if(!t)return;let i=0,s=t.fNpoints;this._cutg&&this._cutg_lastsame&&s--,t._typename===X?i=1:t._typename===B?i=2:(t._typename===S||t._typename===N||t._typename.match(/^RooHist/))&&(i=3),this.bins=new Array(s);for(let a=0;a<s;++a){const n=this.bins[a]={x:t.fX[a],y:t.fY[a],indx:a};switch(i){case 1:n.exlow=n.exhigh=t.fEX[a],n.eylow=n.eyhigh=t.fEY[a];break;case 2:n.exlow=t.fExL[a],n.exhigh=t.fExH[a],n.eylow=t.fEyL[0][a],n.eyhigh=t.fEyH[0][a];break;case 3:n.exlow=t.fEXlow[a],n.exhigh=t.fEXhigh[a],n.eylow=t.fEYlow[a],n.eyhigh=t.fEYhigh[a]}0===a&&(this.xmin=this.xmax=n.x,this.ymin=this.ymax=n.y),i>0?(this.xmin=Math.min(this.xmin,n.x-n.exlow,n.x+n.exhigh),this.xmax=Math.max(this.xmax,n.x-n.exlow,n.x+n.exhigh),this.ymin=Math.min(this.ymin,n.y-n.eylow,n.y+n.eyhigh),this.ymax=Math.max(this.ymax,n.y-n.eylow,n.y+n.eyhigh)):(this.xmin=Math.min(this.xmin,n.x),this.xmax=Math.max(this.xmax,n.x),this.ymin=Math.min(this.ymin,n.y),this.ymax=Math.max(this.ymax,n.y))}}getHistRangeMargin(){return.1}createHistogram(t,i){!t&&!i&&(t=i=!0);const s=this.getGraph(),a=this.xmin,n=this.getHistRangeMargin();let l=this.xmax,m=this.ymin,r=this.ymax;a>=l&&(l=a+1),m>=r&&(r=m+1);const y=(l-a)*n,c=(r-m)*n;let f=a-y,x=l+y,e=m-c,h=r+c;this._not_adjust_hrange||(f<0&&a>=0&&(f=a*(1-n)),x>0&&l<=0&&(x=0));const g=e,d=h;let o=this.getHistogram();return o?o.fMaximum!==u.kNoZoom&&o.fMinimum!==u.kNoZoom&&(e=o.fMinimum,h=o.fMaximum):(o=this._need_2dhist?(0,u.createHistogram)(u.clTH2I,30,30):(0,u.createHistogram)(u.clTH1I,100),o.fName=s.fName+"_h",o.fBits|=u.kNoStats,this._own_histogram=!0,this.setHistogram(o)),s.fMinimum!==u.kNoZoom&&(e=m=s.fMinimum),s.fMaximum!==u.kNoZoom&&(h=s.fMaximum),e<0&&m>=0&&(e=(1-n)*m),(0,u.setHistogramTitle)(o,this.getObject().fTitle),t&&(o.fXaxis.fXmin=f,o.fXaxis.fXmax=x),i&&(o.fYaxis.fXmin=Math.min(g,e),o.fYaxis.fXmax=Math.max(d,h),o.fMinimum=e,o.fMaximum=h),o}unzoomUserRange(t,i){const s=this.getGraph();if(this._own_histogram||!s)return!1;const a=this.getHistogram();return i=i&&a&&(a.fYaxis.fXmin>this.ymin||a.fYaxis.fXmax<this.ymax),!(!(t=t&&a&&(a.fXaxis.fXmin>this.xmin||a.fXaxis.fXmax<this.xmax))&&!i||(this.createHistogram(t,i),this.getMainPainter()?.extractAxesProperties(1),0))}canOptimize(){return u.settings.OptimizeDraw>0&&!this.options.NoOpt}optimizeBins(t,i){if(this.bins.length<30&&!i)return this.bins;let s=null;if((0,u.isFunc)(i))for(let l=0;l<this.bins.length;++l)i(this.bins[l],l)?s||(s=0===l?[]:this.bins.slice(0,l)):s&&s.push(this.bins[l]);if(s||(s=this.bins),t||(t=5e5),s.length<t||!this.canOptimize())return s;let a=Math.floor(s.length/t);a<2&&(a=2);const n=[];for(let l=0;l<s.length;l+=a)n.push(s[l]);return n}needDrawFunc(t,i){return i._typename===u.clTPaveStats?"stats"!==i.fName||!t.TestBit(u.kNoStats):i._typename!==u.clTF1&&i._typename!==u.clTF2||!i.TestBit((0,u.BIT)(9))}getTooltips(t){const s=[],a=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y),n=this.get_gme();if(s.push(this.getObjectHint()),t&&a)if(void 0!==t.indx&&s.push("p = "+t.indx),s.push("x = "+a.axisAsText("x",t.x),"y = "+a.axisAsText("y",t.y)),n?s.push("error x = -"+a.axisAsText("x",n.fExL[t.indx])+"/+"+a.axisAsText("x",n.fExH[t.indx])):this.options.Errors&&"normal"===a.x_handle.kind&&(t.exlow||t.exhigh)&&s.push("error x = -"+a.axisAsText("x",t.exlow)+"/+"+a.axisAsText("x",t.exhigh)),n)for(let l=0;l<n.fNYErrors;++l)s.push(`error y${l} = -${a.axisAsText("y",n.fEyL[l][t.indx])}/+${a.axisAsText("y",n.fEyH[l][t.indx])}`);else(this.options.Errors||this.options.EF>0)&&"normal"===a.y_handle.kind&&(t.eylow||t.eyhigh)&&s.push("error y = -"+a.axisAsText("y",t.eylow)+"/+"+a.axisAsText("y",t.eyhigh));return s}get_main(){let t=this.getFramePainter();if(t?.grx&&t?.gry)return t;const i=this.getPadPainter(),s=i?.getPadRect()||{width:800,height:600};return t={pad_layer:!0,pad:i?.getRootPad(!0)??(0,u.create)(u.clTPad),pw:s.width,ph:s.height,fX1NDC:.1,fX2NDC:.9,fY1NDC:.1,fY2NDC:.9,getFrameWidth(){return this.pw},getFrameHeight(){return this.ph},grx(a){return(a=this.pad.fLogx?a>0?Math.log10(a):this.pad.fUxmin:(a-this.pad.fX1)/(this.pad.fX2-this.pad.fX1))*this.pw},gry(a){return(1-(a=this.pad.fLogv??this.pad.fLogy?a>0?Math.log10(a):this.pad.fUymin:(a-this.pad.fY1)/(this.pad.fY2-this.pad.fY1)))*this.ph},revertAxis(a,n){return"x"===a?n/this.pw*(this.pad.fX2-this.pad.fX1)+this.pad.fX1:"y"===a?(1-n/this.ph)*(this.pad.fY2-this.pad.fY1)+this.pad.fY1:n},getGrFuncs(){return this}},t.pad?t:null}appendExclusion(t,i,s,a){const n=[];for(let m=s.length-1;m>=0;--m){const r=s[m],y=Math.sqrt(r.dgrx**2+r.dgry**2);y>1e-10&&(r.grx+=a*r.dgry/y,r.gry-=a*r.dgrx/y),n.push(r)}const l=(0,E.Mw)(n,{cmd:"L",line:!t});this.draw_g.append("svg:path").attr("d",i+l+"Z").call(this.fillatt.func).style("opacity",.75)}drawBins(t,i,s,a,n,l,m,r){const y=this.getGraph();if(!y?.fNpoints)return;let c=0,f=null;if(r&&l.excl_side&&(c=l.excl_width,l.width>0&&!i.Line&&!i.Curve&&(i.Line=1)),i.EF){f=this.optimizeBins(i.EF>1?2e4:0);for(let d=0;d<f.length;++d){const o=f[d];o.grx=t.grx(o.x),o.gry=t.gry(o.y-o.eylow)}const e=(0,E.Mw)(f,{line:i.EF<2,qubic:!0}),h=[];for(let d=f.length-1;d>=0;--d){const o=f[d];o.gry=t.gry(o.y+o.eyhigh),h.push(o)}const g=(0,E.Mw)(h,{line:i.EF<2,cmd:"L",qubic:!0});s.append("svg:path").attr("d",e+g+"Z").call(m.func),r&&(this.draw_kind="lines")}if(i.Line||i.Fill){let e="";this._cutg&&(e="Z",i.original||(i.Fill=1)),i.Fill&&(e="Z",c=0),f||(f=this.optimizeBins(0));for(let d=0;d<f.length;++d){const o=f[d];o.grx=t.grx(o.x),o.gry=t.gry(o.y)}const h=(0,E.Mw)(f,{line:!0,calc:c});c&&this.appendExclusion(!1,h,f,c);const g=s.append("svg:path").attr("d",h+e);i.Line&&g.call(l.func),i.Fill?g.call(m.func):g.style("fill","none"),r&&(this.draw_kind="lines")}if(i.Curve){let e=f;if("lines"!==this.draw_kind||!e||1===i.Curve&&e.length>2e4){e=this.optimizeBins(1===i.Curve?2e4:0);for(let g=0;g<e.length;++g){const d=e[g];d.grx=t.grx(d.x),d.gry=t.gry(d.y)}}const h=(0,E.Mw)(e,{qubic:!c});c&&this.appendExclusion(!0,h,e,c),s.append("svg:path").attr("d",h).call(l.func).style("fill","none"),r&&(this.draw_kind="lines")}let x=null;if((i.Errors||i.Rect||i.Bar)&&(f=this.optimizeBins(5e3,(e,h)=>{const g=t.grx(e.x);if(!i.Bar&&(g<0||g>a))return!0;const d=t.gry(e.y);return!i.Bar&&!i.OutRange&&(d<0||d>n)||(e.grx1=Math.round(g),e.gry1=Math.round(d),this.has_errors&&(e.grx0=Math.round(t.grx(e.x-i.ScaleErrX*e.exlow)-g),e.grx2=Math.round(t.grx(e.x+i.ScaleErrX*e.exhigh)-g),e.gry0=Math.round(t.gry(e.y-e.eylow)-d),e.gry2=Math.round(t.gry(e.y+e.eyhigh)-d),this.is_bent?(e.grdx0=Math.round(t.gry(e.y+y.fEXlowd[h])-d),e.grdx2=Math.round(t.gry(e.y+y.fEXhighd[h])-d),e.grdy0=Math.round(t.grx(e.x+y.fEYlowd[h])-g),e.grdy2=Math.round(t.grx(e.x+y.fEYhighd[h])-g)):e.grdx0=e.grdx2=e.grdy0=e.grdy2=0),!1)}),r&&(this.draw_kind="nodes"),x=s.selectAll(".grpoint").data(f).enter().append("svg:g").attr("class","grpoint").attr("transform",e=>(0,E.bk)(e.grx1,e.gry1))),i.Bar){let e=0,h=0;for(let o=0;o<f.length;++o)0===o?e=h=f[o].grx1:(e=Math.min(e,f[o].grx1),h=Math.max(h,f[o].grx1));if(1===f.length)f[0].width=a/4;else for(let o=0;o<f.length;++o)f[o].width=(h-e)/f.length*u.gStyle.fBarWidth;const g=Math.round(t.gry(0));let d=m;if(r){const o=this.getFramePainter(),p=o?.fillatt?.empty()?-1:o.fillatt.getFillColor();p===m.getFillColor()&&(d=this.createAttFill({color:"white"===p?P.tA:P.$q,pattern:1001,std:!1}))}x.append("svg:path").attr("d",o=>{o.bar=!0;const p=o.width>1?Math.round(-o.width/2):0,M=o.width>1?Math.round(o.width):1;return`M${p},${1!==i.Bar?0:o.gry1>g?g-o.gry1:0}h${M}v${1!==i.Bar?n>o.gry1?n-o.gry1:0:Math.abs(g-o.gry1)}h${-M}z`}).call(d.func)}if(i.Rect&&x.filter(e=>e.exlow>0&&e.exhigh>0&&e.eylow>0&&e.eyhigh>0).append("svg:path").attr("d",e=>(e.rect=!0,`M${e.grx0},${e.gry0}H${e.grx2}V${e.gry2}H${e.grx0}Z`)).call(m.func).call(2===i.Rect?l.func:()=>{}),this.error_size=0,i.Errors){let e=l.width+u.gStyle.fEndErrorSize,h=0;const g=i.Ends?`m0,${e}v${-2*e}`:"",d=i.Ends?`m${e},0h${-2*e}`:"";let o=g,p=g,M=d,b=d;const w=(_,A)=>{if(!i.MainError)return`M${_},${A}`;const O="M0,0";return _?O+(A?`L${_},${A}`:`H${_}`):A?O+`V${A}`:O};switch(i.Ends){case 2:h=Math.max(l.width+1,Math.round(.66*e)),o=`m${h},${e}h${-h}v${-2*e}h${h}`,p=`m${-h},${e}h${h}v${-2*e}h${-h}`,M=`m${-e},${h}v${-h}h${2*e}v${h}`,b=`m${-e},${-h}v${h}h${2*e}v${-h}`;break;case 3:e=Math.max(e,Math.round(8*y.fMarkerSize*.66)),h=Math.max(l.width+1,Math.round(.66*e)),o=`l${h},${e}v${-2*e}l${-h},${e}`,p=`l${-h},${e}v${-2*e}l${h},${e}`,M=`l${-e},${h}h${2*e}l${-e},${-h}`,b=`l${-e},${-h}h${2*e}l${-e},${h}`;break;case 4:e=Math.max(e,Math.round(8*y.fMarkerSize*.66)),h=Math.max(l.width+1,Math.round(.66*e)),o=`l${h},${e}m0,${-2*e}l${-h},${e}`,p=`l${-h},${e}m0,${-2*e}l${h},${e}`,M=`l${-e},${h}m${2*e},0l${-e},${-h}`,b=`l${-e},${-h}m${2*e},0l${-e},${h}`}this.error_size=e,e=Math.floor((l.width-1)/2);let $=x.filter(_=>_.exlow>0||_.exhigh>0||_.eylow>0||_.eyhigh>0);(i.skip_errors_x0||i.skip_errors_y0)&&($=$.filter(_=>!(0===_.x&&i.skip_errors_x0||0===_.y&&i.skip_errors_y0))),!this.isBatchMode()&&u.settings.Tooltip&&r&&$.append("svg:path").style("fill","none").style("pointer-events","visibleFill").attr("d",_=>`M${_.grx0},${_.gry0}h${_.grx2-_.grx0}v${_.gry2-_.gry0}h${_.grx0-_.grx2}z`),$.append("svg:path").call(l.func).style("fill","none").attr("d",_=>(_.error=!0,(_.exlow>0?w(_.grx0+e,_.grdx0)+o:"")+(_.exhigh>0?w(_.grx2-e,_.grdx2)+p:"")+(_.eylow>0?w(_.grdy0,_.gry0-e)+b:"")+(_.eyhigh>0?w(_.grdy2,_.gry2+e)+M:"")))}if(i.Mark){this.createAttMarker({attr:y,style:i.Mark-100}),this.marker_size=this.markeratt.getFullSize(),this.markeratt.resetPos();const e=!this.isBatchMode()&&u.settings.Tooltip&&(!this.markeratt.fill||this.marker_size<7)&&!x&&r,h=Math.max(5,Math.round(.7*this.marker_size)),g=1e6/(this.markeratt.getMarkerLength()+7);let o,p,M,d="",b="",w=1;f?this.canOptimize()&&f.length>1.5*g&&(w=Math.min(2,Math.round(f.length/g))):f=this.optimizeBins(g);for(let $=0;$<f.length;$+=w)o=f[$],p=t.grx(o.x),p>-this.marker_size&&p<a+this.marker_size&&(M=t.gry(o.y),M>-this.marker_size&&M<n+this.marker_size&&(d+=this.markeratt.create(p,M),e&&(b+=`M${p-h},${M-h}h${2*h}v${2*h}h${-2*h}z`)));d&&(s.append("svg:path").attr("d",d).call(this.markeratt.func),null===x&&"none"===this.draw_kind&&r&&(this.draw_kind=101===i.Mark?"path":"mark")),e&&b&&s.append("svg:path").attr("d",b).style("fill","none").style("pointer-events","visibleFill")}}appendQQ(t,i){const s=Math.max(t.scale_xmin,i.fXq1),a=Math.min(t.scale_xmax,i.fXq2),n=Math.max(t.scale_ymin,i.fYq1),l=Math.min(t.scale_ymax,i.fYq2),m=(e,h,g,d)=>`M${t.grx(e)},${t.gry(h)}L${t.grx(g)},${t.gry(d)}`,r=(i.fYq2-i.fYq1)*(t.scale_xmin-i.fXq1)/(i.fXq2-i.fXq1)+i.fYq1,y=(i.fYq2-i.fYq1)*(t.scale_xmax-i.fXq1)/(i.fXq2-i.fXq1)+i.fYq1;let c="";c=r<t.scale_ymin?m((i.fXq2-i.fXq1)*(t.scale_ymin-i.fYq1)/(i.fYq2-i.fYq1)+i.fXq1,t.scale_ymin,s,n):m(t.scale_xmin,r,s,n),c+=y>t.scale_ymax?m(a,l,(i.fXq2-i.fXq1)*(t.scale_ymax-i.fYq1)/(i.fYq2-i.fYq1)+i.fXq1,t.scale_ymax):m(a,l,t.scale_xmax,y);const f=this.createAttLine({style:1,width:1,color:P.tA,std:!1}),x=this.createAttLine({style:2,width:1,color:P.tA,std:!1});this.draw_g.append("path").attr("d",m(s,n,a,l)).call(f.func).style("fill","none"),this.draw_g.append("path").attr("d",c).call(x.func).style("fill","none")}drawBins3D(){console.log("Load ./hist/TGraphPainter.mjs to draw graph in 3D")}createGraphDrawAttributes(t){const i=this.getGraph(),s=this.options;if(s._pfc>1||s._plc>1||s._pmc>1){const a=this.getPadPainter();if((0,u.isFunc)(a?.getAutoColor)){const n=a.getAutoColor(i.$num_graphs);this._auto_exec="",s._pfc>1&&(s._pfc=1,i.fFillColor=n,this._auto_exec+=`SetFillColor(${n});;`,delete this.fillatt),s._plc>1&&(s._plc=1,i.fLineColor=n,this._auto_exec+=`SetLineColor(${n});;`,delete this.lineatt),s._pmc>1&&(s._pmc=1,i.fMarkerColor=n,this._auto_exec+=`SetMarkerColor(${n});;`,delete this.markeratt)}}t?this.deleteAttr():(this.createAttLine({attr:i,can_excl:!0}),this.createAttFill({attr:i}))}drawGraph(){const t=this.get_main(),i=this.getGraph();if(!t)return;if(this.options.pos3d)return this.drawBins3D(t,i);const s=!!this.get_gme(),a=t.getGrFuncs(this.options.second_x,this.options.second_y),n=t.getFrameWidth(),l=t.getFrameHeight();this.createG(!t.pad_layer),this.createGraphDrawAttributes(),this.fillatt.used=!1,this.draw_kind="none",this.marker_size=0;const m=s?this.draw_g.append("svg:g"):this.draw_g;if(this.drawBins(a,this.options,m,n,l,this.lineatt,this.fillatt,!0),"TGraphQQ"===i._typename&&this.appendQQ(a,i),s){for(let r=0;r<i.fNYErrors;++r){let y=this.lineatt,c=this.fillatt;this.options.individual_styles&&(y=this.createAttLine({attr:i.fAttLine[r],std:!1}),c=this.createAttFill({attr:i.fAttFill[r],std:!1}));const f=this.draw_g.append("svg:g"),x=r<this.options.blocks.length?this.options.blocks[r]:this.options;this.extractGmeErrors(r),this.drawBins(a,x,f,n,l,y,c)}this.extractGmeErrors(0)}this.isBatchMode()||((0,D.X2)(this,this.testEditable()),(0,H.wh)(this))}extractTooltip(t){if(!t)return null;if("lines"===this.draw_kind||"path"===this.draw_kind||"mark"===this.draw_kind)return this.extractTooltipForPath(t);if("nodes"!==this.draw_kind)return null;const i=this.get_main(),s=i.getFrameHeight(),a=this.error_size,n=1===this.options.Bar,l=n?i.getGrFuncs(this.options.second_x,this.options.second_y):null,m=this.marker_size?Math.round(this.marker_size/2+1.5):0;let r=null,y=1e10,c=null;if(this.draw_g.selectAll(".grpoint").each(function(){const h=(0,C.Lt)(this).datum();if(void 0===h)return;let d,g=(t.x-h.grx1)**2;if(1===t.nproc&&(g+=(t.y-h.gry1)**2),g>=y)return;if(h.error||h.rect||h.marker)d={x1:Math.min(-a,h.grx0,-m),x2:Math.max(a,h.grx2,m),y1:Math.min(-a,h.gry2,-m),y2:Math.max(a,h.gry0,m)};else if(h.bar){if(d={x1:-h.width/2,x2:h.width/2,y1:0,y2:s-h.gry1},n){const M=l.gry(0);d.y1=h.gry1>M?M-h.gry1:0,d.y2=h.gry1>M?0:M-h.gry1}}else d={x1:-5,x2:5,y1:-5,y2:5};const p=t.y>=h.gry1+d.y1&&t.y<=h.gry1+d.y2;t.x>=h.grx1+d.x1&&t.x<=h.grx1+d.x2&&(p||t.nproc>1)&&(y=g,r=this,c=d,c.exact=p)}),null===r)return null;const f=(0,C.Lt)(r).datum(),x=this.getGraph(),e={name:x.fName,title:x.fTitle,x:f.grx1,y:f.gry1,color1:this.lineatt.color,lines:this.getTooltips(f),rect:c,d3bin:r};return e.user_info={obj:x,name:x.fName,bin:f.indx,cont:f.y,grx:f.grx1,gry:f.gry1},this.fillatt?.used&&!this.fillatt?.empty()&&(e.color2=this.fillatt.getFillColor()),c.exact&&(e.exact=!0),e.menu=e.exact,e.menu_dist=3,e.bin=f,e.binindx=f.indx,e}showTooltip(t){let i=this.draw_g?.selectChild(".tooltip_bin");if(!t||!this.draw_g)return void i?.remove();if(t.usepath)return this.showTooltipForPath(t);const s=(0,C.Lt)(t.d3bin).datum();i.empty()&&(i=this.draw_g.append("svg:rect").attr("class","tooltip_bin").style("pointer-events","none").call(E.Ru)),t.changed=i.property("current_bin")!==t.d3bin,t.changed&&i.attr("x",s.grx1+t.rect.x1).attr("width",t.rect.x2-t.rect.x1).attr("y",s.gry1+t.rect.y1).attr("height",t.rect.y2-t.rect.y1).style("opacity","0.3").property("current_bin",t.d3bin)}processTooltipEvent(t){const i=this.extractTooltip(t);return(!t||!t.disabled)&&this.showTooltip(i),i}findBestBin(t){if(!this.bins)return null;const i="lines"===this.draw_kind,s=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y);let m,r,y,c,f,a=-1,n=null,l=1e10;for(c=0;c<this.bins.length;++c)f=this.bins[c],r=s.grx(f.x),y=s.gry(f.y),m=(t.x-r)**2+(t.y-y)**2,m<l&&(l=m,n=f,a=c);l>100&&i&&(n=null);let x=Math.max(this.lineatt.width+3,4);this.marker_size>0&&(x=Math.max(this.marker_size,x)),n&&(l=Math.sqrt((t.x-s.grx(n.x))**2+(t.y-s.gry(n.y))**2)),!i&&l>x&&(n=null),n||(a=-1);const e={bin:n,indx:a,dist:l,radius:Math.round(x)};if(!n&&i){l=1e10;const h=(M,b,w)=>b>=M&&M>=w||b<=M&&M<=w;let o,g=this.bins[0],d=s.grx(g.x),p=0;for(c=1;c<this.bins.length;++c)f=this.bins[c],r=s.grx(f.x),h(t.x,d,r)&&(o=s.gry(g.y),y=s.gry(f.y),Math.abs(r-d)<1?(p=t.y,m=h(t.y,o,y)?0:Math.min(Math.abs(t.y-o),Math.abs(t.y-y))):(p=o+(t.x-d)/(r-d)*(y-o),m=Math.abs(p-t.y)),m<l&&(l=m,e.linex=t.x,e.liney=p)),g=f,d=r;l<.5*x&&(e.linedist=l,e.closeline=!0)}return e}testEditable(t){const i=this.getGraph();return!!i&&(("toggle"===t||void 0!==t&&!t!==i.TestBit(v))&&i.InvertBit(v),!i.TestBit(v))}extractTooltipForPath(t){if(null===this.bins)return null;const i=this.findBestBin(t);if(!i||!i.bin&&!i.closeline)return null;const s="lines"===this.draw_kind,a="mark"===this.draw_kind,l=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y),m=this.getGraph(),r={name:m.fName,title:m.fTitle,x:i.bin?l.grx(i.bin.x):i.linex,y:i.bin?l.gry(i.bin.y):i.liney,color1:this.lineatt.color,lines:this.getTooltips(i.bin),usepath:!0};return r.user_info={obj:m,name:m.fName,bin:0,cont:0,grx:r.x,gry:r.y},r.ismark=a,r.islines=s,i.closeline?(r.menu=r.exact=!0,r.menu_dist=i.linedist):i.bin&&(this.options.EF&&s?(r.gry1=l.gry(i.bin.y-i.bin.eylow),r.gry2=l.gry(i.bin.y+i.bin.eyhigh)):r.gry1=r.gry2=l.gry(i.bin.y),r.binindx=i.indx,r.bin=i.bin,r.radius=i.radius,r.user_info.bin=i.indx,r.user_info.cont=i.bin.y,r.exact=Math.abs(t.x-r.x)<=i.radius&&(Math.abs(t.y-r.gry1)<=i.radius||Math.abs(t.y-r.gry2)<=i.radius),r.menu=r.exact,r.menu_dist=Math.sqrt((t.x-r.x)**2+Math.min(Math.abs(t.y-r.gry1),Math.abs(t.y-r.gry2))**2)),this.fillatt?.used&&!this.fillatt?.empty()&&(r.color2=this.fillatt.getFillColor()),s||(r.color1=this.getColor(m.fMarkerColor),r.color2||(r.color2=r.color1)),r}showTooltipForPath(t){let i=this.draw_g?.selectChild(".tooltip_bin");if(t?.bin&&this.draw_g){if(i.empty()&&(i=this.draw_g.append("svg:g").attr("class","tooltip_bin")),t.changed=i.property("current_bin")!==t.bin,t.changed)if(i.selectAll("*").remove(),i.property("current_bin",t.bin),t.ismark)i.append("svg:rect").style("pointer-events","none").call(E.Ru).style("opacity","0.3").attr("x",Math.round(t.x-t.radius)).attr("y",Math.round(t.y-t.radius)).attr("width",2*t.radius).attr("height",2*t.radius);else{i.append("svg:circle").attr("cy",Math.round(t.gry1)),Math.abs(t.gry1-t.gry2)>1&&i.append("svg:circle").attr("cy",Math.round(t.gry2));const s=i.selectAll("circle").attr("r",t.radius).attr("cx",Math.round(t.x));t.islines?(this.options.Line||this.options.Curve?s.call(this.lineatt.func):s.style("stroke","black"),this.options.Fill?s.call(this.fillatt.func):s.style("fill","none")):s.style("stroke","black"===t.color1?"green":"black").style("fill","none")}}else i?.remove()}moveEnabled(){return this.testEditable()}moveStart(t,i){this.pos_dx=this.pos_dy=0,this.move_funcs=this.get_main().getGrFuncs(this.options.second_x,this.options.second_y);const s=this.extractTooltip({x:t,y:i});s&&s.exact&&void 0!==s.binindx?(this.move_binindx=s.binindx,this.move_bin=s.bin,this.move_x0=this.move_funcs.grx(this.move_bin.x),this.move_y0=this.move_funcs.gry(this.move_bin.y)):delete this.move_binindx}moveDrag(t,i){this.pos_dx+=t,this.pos_dy+=i,void 0===this.move_binindx?(0,E.bk)(this.draw_g,this.pos_dx,this.pos_dy):this.move_funcs&&this.move_bin&&(this.move_bin.x=this.move_funcs.revertAxis("x",this.move_x0+this.pos_dx),this.move_bin.y=this.move_funcs.revertAxis("y",this.move_y0+this.pos_dy),this.drawGraph())}moveEnd(t){const i=this.getGraph(),s=i?.fNpoints-1;let a="";const n=l=>{a+=`SetPoint(${l.indx},${l.x},${l.y});;`,i.fX[l.indx]=l.x,i.fY[l.indx]=l.y,0===l.indx&&this._cutg_lastsame&&(a+=`SetPoint(${s},${l.x},${l.y});;`,i.fX[s]=l.x,i.fY[s]=l.y)};if(void 0===this.move_binindx){if(this.draw_g.attr("transform",null),this.move_funcs&&this.bins&&!t){for(let l=0;l<this.bins.length;++l){const m=this.bins[l];m.x=this.move_funcs.revertAxis("x",this.move_funcs.grx(m.x)+this.pos_dx),m.y=this.move_funcs.revertAxis("y",this.move_funcs.gry(m.y)+this.pos_dy),n(m)}i.$redraw_pad?this.redrawPad():this.drawGraph()}}else n(this.move_bin),delete this.move_binindx,i.$redraw_pad&&this.redrawPad();delete this.move_funcs,a&&!t&&this.submitCanvExec(a)}fillWebObjectOptions(t){this._auto_exec&&t&&(t.fcust="auto_exec:"+this._auto_exec,delete this._auto_exec)}fillContextMenuItems(t){this.snapid||t.addchk(this.testEditable(),"Editable",()=>{this.testEditable("toggle"),this.drawGraph()})}executeMenuCommand(t,i){if(super.executeMenuCommand(t,i))return!0;const s=this.getCanvPainter(),a=this.get_main();if("RemovePoint"===t.fName||"InsertPoint"===t.fName){if(!s||s._readonly)return!0;const n=(0,u.isFunc)(a?.getLastEventPos)?a.getLastEventPos():null,l=this.extractTooltip(n);if("InsertPoint"===t.fName){if(n){const m=a.getGrFuncs(this.options.second_x,this.options.second_y),r=m.revertAxis("x",n.x)??0,y=m.revertAxis("y",n.y)??0;this.submitCanvExec(`AddPoint(${r.toFixed(3)}, ${y.toFixed(3)})`,t.$execid)}}else t.$execid&&void 0!==l?.binindx&&this.submitCanvExec(`RemovePoint(${l.binindx})`,t.$execid);return!0}return!1}_updateMembers(t,i){t.fBits=i.fBits,t.fTitle=i.fTitle,t.fX=i.fX,t.fY=i.fY,t.fNpoints=i.fNpoints,t.fMinimum=i.fMinimum,t.fMaximum=i.fMaximum;const s=this.options;void 0!==this.snapid&&(s._pfc=s._plc=s._pmc=0),s._pfc||(t.fFillColor=i.fFillColor),t.fFillStyle=i.fFillStyle,s._plc||(t.fLineColor=i.fLineColor),t.fLineStyle=i.fLineStyle,t.fLineWidth=i.fLineWidth,s._pmc||(t.fMarkerColor=i.fMarkerColor),t.fMarkerSize=i.fMarkerSize,t.fMarkerStyle=i.fMarkerStyle}updateObject(t,i){if(!this.matchObjectType(t))return!1;if(i&&i!==this.options.original&&this.decodeOptions(i),this._updateMembers(this.getObject(),t),this.createBins(),delete this.$redraw_hist,this.axes_draw){const s=this.createHistogram(),a=this.getMainPainter();a?.isSecondary(this)&&(a.updateObject(s,this.options.Axis),this.$redraw_hist=!0)}return this._funcHandler=new G.eP(this,this.getPadPainter(),t.fFunctions),!0}canZoomInside(t,i,s){const a=this.getGraph();if(!a||t!==(this.options.pos3d?"y":"x"))return!1;for(let n=0;n<a.fNpoints;++n)if(i<a.fX[n]&&a.fX[n]<s)return!0;return!1}clickButton(t){return"ToggleZoom"===t&&(this.xmin!==this.xmax||this.ymin!==this.ymax)&&this.getFramePainter()?.zoom(this.xmin,this.xmax,this.ymin,this.ymax)}findFunc(){return this.getGraph()?.fFunctions?.arr?.find(t=>t._typename===u.clTF1||t._typename===u.clTF2)}findStat(){return this.getGraph()?.fFunctions?.arr?.find(t=>t._typename===u.clTPaveStats&&"stats"===t.fName)}createStat(){const t=this.findFunc();if(!t)return null;let i=this.findStat();if(i)return i;if(this.getCanvPainter()?.normal_canvas)return null;this.create_stats=!0;const s=u.gStyle;return i=(0,u.create)(u.clTPaveStats),Object.assign(i,{fName:"stats",fOptStat:0,fOptFit:s.fOptFit||111,fBorderSize:1,fX1NDC:s.fStatX-s.fStatW,fY1NDC:s.fStatY-s.fStatH,fX2NDC:s.fStatX,fY2NDC:s.fStatY,fFillColor:s.fStatColor,fFillStyle:s.fStatStyle}),i.fTextAngle=0,i.fTextSize=s.fStatFontSize,i.fTextAlign=12,i.fTextColor=s.fStatTextColor,i.fTextFont=s.fStatFont,i.AddText(t.fName),this.getGraph().fFunctions.Add(i),i}fillStatistic(t,i,s){const a=this.findFunc();return!(!a||!s||(t.clearPave(),t.fillFunctionStat(a,1===s?111:s,1),0))}drawAxisHisto(){var t=this;return(0,T.A)(function*(){const i=t.createHistogram();return Y.N.draw(t.getDom(),i,t.options.Axis)})()}static _drawGraph(t,i){return(0,T.A)(function*(){t.decodeOptions(i,!0),t.createBins(),t.createStat();const s=t.getGraph();!u.settings.DragGraphs&&s&&!s.TestBit(v)&&s.InvertBit(v);let a=Promise.resolve();return(!t.getMainPainter()||t.options.second_x||t.options.second_y)&&t.options.Axis&&(a=t.drawAxisHisto().then(n=>{n?.setSecondaryId(t,"hist"),t.axes_draw=!!n})),a.then(()=>(t.addToPadPrimitives(),t.drawGraph())).then(()=>new G.eP(t,t.getPadPainter(),s.fFunctions,!0).drawNext(0))})()}static draw(t,i,s){return(0,T.A)(function*(){return F._drawGraph(new F(t,i),s)})()}}}}]);
//# sourceMappingURL=679.ff9d576f88a20f40.js.map