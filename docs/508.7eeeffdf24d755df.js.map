{"version":3,"file":"508.7eeeffdf24d755df.js","mappings":"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","names":["kIsBayesian","BIT","kPosteriorMode","kUseBinPrior","kUseWeights","getBetaAlpha","obj","bin","fBeta_bin_params","length","first","fBeta_alpha","getBetaBeta","second","fBeta_beta","TEfficiencyPainter","ObjectPainter","getEfficiency","total","fTotalHistogram","fArray","passed","fPassedHistogram","TestBit","alpha","beta","aa","bb","tw","tw2","fSumw2","Math","abs","norm","BetaMode","a","b","BetaMean","getEfficiencyErrorLow","value","this","fBoundary","fConfLevel","getEfficiencyErrorUp","copyAttributes","eff","forEach","name","createGraph","gr","create","clTGraphAsymmErrors","fName","createHisto","hist","createHistogram","clTH2F","fXaxis","fNbins","fYaxis","Object","assign","fillGraph","opt","getObject","xaxis","npoints","plot0Bins","indexOf","n","j","getBinContent","fX","GetBinCenter","fY","fEXlow","GetBinLowEdge","fEXhigh","fEYlow","fEYhigh","fNpoints","fTitle","fillHisto","nbinsx","nbinsy","i","getBin","fBits","kNoStats","drawFunction","indx","fFunctions","arr","TF1Painter","draw","getPadPainter","then","funcp","setSecondaryId","fillContextMenuItems","menu","addRedrawMenu","redrawWith","skip_cleanup","_this","_asyncToGenerator","removePrimitive","isStr","toLowerCase","promise","draw_total","dom","getDrawDom","ndim","TH1Painter","TH2Painter","slice","TGraphPainter","subp","addToPadPrimitives","painter","_typename","clTH1","clTH2","getTEfficiencyBoundaryFunc","fStatisticOption"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["../node_modules/jsroot/modules/hist/TEfficiencyPainter.mjs"],"sourcesContent":["import { BIT, create, createHistogram, isStr, clTH1, clTH2, clTH2F, kNoStats } from '../core.mjs';\nimport { ObjectPainter } from '../base/ObjectPainter.mjs';\nimport { TGraphPainter, clTGraphAsymmErrors } from '../hist2d/TGraphPainter.mjs';\nimport { TF1Painter } from './TF1Painter.mjs';\nimport { TH1Painter } from './TH1Painter.mjs';\nimport { TH2Painter } from './TH2Painter.mjs';\nimport { getTEfficiencyBoundaryFunc } from '../base/math.mjs';\n\n\nconst kIsBayesian = BIT(14),  // Bayesian statistics are used\n      kPosteriorMode = BIT(15),  // Use posterior mean for best estimate (Bayesian statistics)\n //   kShortestInterval = BIT(16),  // Use shortest interval, not implemented - too complicated\n      kUseBinPrior = BIT(17),  // Use a different prior for each bin\n      kUseWeights = BIT(18),  // Use weights\n      getBetaAlpha = (obj, bin) => (obj.fBeta_bin_params.length > bin) ? obj.fBeta_bin_params[bin].first : obj.fBeta_alpha,\n      getBetaBeta = (obj, bin) => (obj.fBeta_bin_params.length > bin) ? obj.fBeta_bin_params[bin].second : obj.fBeta_beta;\n\n/**\n * @summary Painter for TEfficiency object\n *\n * @private\n */\n\nclass TEfficiencyPainter extends ObjectPainter {\n\n   /** @summary Calculate efficiency */\n   getEfficiency(obj, bin) {\n      const BetaMean = (a, b) => (a <= 0 || b <= 0) ? 0 : a / (a + b),\n            BetaMode = (a, b) => {\n         if (a <= 0 || b <= 0) return 0;\n         if (a <= 1 || b <= 1) {\n            if (a < b) return 0;\n            if (a > b) return 1;\n            if (a === b) return 0.5; // cannot do otherwise\n         }\n         return (a - 1.0) / (a + b -2.0);\n      },\n      total = obj.fTotalHistogram.fArray[bin], // should work for both 1-d and 2-d\n      passed = obj.fPassedHistogram.fArray[bin]; // should work for both 1-d and 2-d\n\n      if (obj.TestBit(kIsBayesian)) {\n         // parameters for the beta prior distribution\n         const alpha = obj.TestBit(kUseBinPrior) ? getBetaAlpha(obj, bin) : obj.fBeta_alpha,\n               beta = obj.TestBit(kUseBinPrior) ? getBetaBeta(obj, bin) : obj.fBeta_beta;\n\n         let aa, bb;\n         if (obj.TestBit(kUseWeights)) {\n            const tw = total, // fTotalHistogram->GetBinContent(bin);\n                tw2 = obj.fTotalHistogram.fSumw2 ? obj.fTotalHistogram.fSumw2[bin] : Math.abs(total),\n                pw = passed; // fPassedHistogram->GetBinContent(bin);\n\n            if (tw2 <= 0) return pw/tw;\n\n            // tw/tw2 re-normalize the weights\n            const norm = tw/tw2;\n            aa = pw * norm + alpha;\n            bb = (tw - pw) * norm + beta;\n         } else {\n            aa = passed + alpha;\n            bb = total - passed + beta;\n         }\n\n         if (!obj.TestBit(kPosteriorMode))\n            return BetaMean(aa, bb);\n         else\n            return BetaMode(aa, bb);\n      }\n\n      return total ? passed/total : 0;\n   }\n\n   /** @summary Calculate efficiency error low */\n   getEfficiencyErrorLow(obj, bin, value) {\n      const total = obj.fTotalHistogram.fArray[bin],\n            passed = obj.fPassedHistogram.fArray[bin];\n      let alpha = 0, beta = 0;\n      if (obj.TestBit(kIsBayesian)) {\n         alpha = obj.TestBit(kUseBinPrior) ? getBetaAlpha(obj, bin) : obj.fBeta_alpha;\n         beta = obj.TestBit(kUseBinPrior) ? getBetaBeta(obj, bin) : obj.fBeta_beta;\n      }\n\n      return value - this.fBoundary(total, passed, obj.fConfLevel, false, alpha, beta);\n   }\n\n   /** @summary Calculate efficiency error low up */\n   getEfficiencyErrorUp(obj, bin, value) {\n      const total = obj.fTotalHistogram.fArray[bin],\n            passed = obj.fPassedHistogram.fArray[bin];\n      let alpha = 0, beta = 0;\n      if (obj.TestBit(kIsBayesian)) {\n         alpha = obj.TestBit(kUseBinPrior) ? getBetaAlpha(obj, bin) : obj.fBeta_alpha;\n         beta = obj.TestBit(kUseBinPrior) ? getBetaBeta(obj, bin) : obj.fBeta_beta;\n      }\n\n      return this.fBoundary(total, passed, obj.fConfLevel, true, alpha, beta) - value;\n   }\n\n   /** @summary Copy drawing attributes */\n   copyAttributes(obj, eff) {\n      ['fLineColor', 'fLineStyle', 'fLineWidth', 'fFillColor', 'fFillStyle', 'fMarkerColor', 'fMarkerStyle', 'fMarkerSize'].forEach(name => { obj[name] = eff[name]; });\n   }\n\n   /** @summary Create graph for the drawing of 1-dim TEfficiency */\n   createGraph(/* eff */) {\n      const gr = create(clTGraphAsymmErrors);\n      gr.fName = 'eff_graph';\n      return gr;\n   }\n\n   /** @summary Create histogram for the drawing of 2-dim TEfficiency */\n   createHisto(eff) {\n      const nbinsx = eff.fTotalHistogram.fXaxis.fNbins,\n            nbinsy = eff.fTotalHistogram.fYaxis.fNbins,\n            hist = createHistogram(clTH2F, nbinsx, nbinsy);\n      Object.assign(hist.fXaxis, eff.fTotalHistogram.fXaxis);\n      Object.assign(hist.fYaxis, eff.fTotalHistogram.fYaxis);\n      hist.fName = 'eff_histo';\n      return hist;\n   }\n\n   /** @summary Fill graph with points from efficiency object */\n   fillGraph(gr, opt) {\n      const eff = this.getObject(),\n            xaxis = eff.fTotalHistogram.fXaxis,\n            npoints = xaxis.fNbins,\n            plot0Bins = (opt.indexOf('e0') >= 0);\n\n      for (let n = 0, j = 0; n < npoints; ++n) {\n         if (!plot0Bins && eff.fTotalHistogram.getBinContent(n+1) === 0) continue;\n\n         const value = this.getEfficiency(eff, n+1);\n\n         gr.fX[j] = xaxis.GetBinCenter(n+1);\n         gr.fY[j] = value;\n         gr.fEXlow[j] = xaxis.GetBinCenter(n+1) - xaxis.GetBinLowEdge(n+1);\n         gr.fEXhigh[j] = xaxis.GetBinLowEdge(n+2) - xaxis.GetBinCenter(n+1);\n         gr.fEYlow[j] = this.getEfficiencyErrorLow(eff, n+1, value);\n         gr.fEYhigh[j] = this.getEfficiencyErrorUp(eff, n+1, value);\n\n         gr.fNpoints = ++j;\n      }\n\n      gr.fTitle = eff.fTitle;\n      this.copyAttributes(gr, eff);\n   }\n\n   /** @summary Fill graph with points from efficiency object */\n   fillHisto(hist) {\n      const eff = this.getObject(),\n            nbinsx = hist.fXaxis.fNbins,\n            nbinsy = hist.fYaxis.fNbins;\n\n      for (let i = 0; i < nbinsx+2; ++i) {\n         for (let j = 0; j < nbinsy+2; ++j) {\n            const bin = hist.getBin(i, j),\n                value = this.getEfficiency(eff, bin);\n            hist.fArray[bin] = value;\n         }\n      }\n\n      hist.fTitle = eff.fTitle;\n      hist.fBits = hist.fBits | kNoStats;\n      this.copyAttributes(hist, eff);\n   }\n\n   /** @summary Draw function */\n   drawFunction(indx) {\n      const eff = this.getObject();\n\n      if (!eff?.fFunctions || (indx >= eff.fFunctions.arr.length))\n         return this;\n\n      return TF1Painter.draw(this.getPadPainter(), eff.fFunctions.arr[indx], eff.fFunctions.opt[indx])\n                        .then(funcp => {\n                           funcp?.setSecondaryId(this, `func_${indx}`);\n                           return this.drawFunction(indx + 1);\n                        });\n   }\n\n   /** @summary Fill context menu */\n   fillContextMenuItems(menu) {\n      menu.addRedrawMenu(this);\n   }\n\n   /** @summary Fully redraw efficiency with new draw options */\n   async redrawWith(opt, skip_cleanup) {\n      if (!skip_cleanup)\n         this.getPadPainter()?.removePrimitive(this, true);\n\n      if (!opt || !isStr(opt)) opt = '';\n      opt = opt.toLowerCase();\n\n      let promise, draw_total = false;\n\n      const eff = this.getObject(),\n            dom = this.getDrawDom();\n\n      if (opt[0] === 'b') {\n         draw_total = true;\n         promise = (this.ndim === 1 ? TH1Painter : TH2Painter).draw(dom, eff.fTotalHistogram, opt.slice(1));\n      } else if (this.ndim === 1) {\n         if (!opt) opt = 'ap';\n         if ((opt.indexOf('same') < 0) && (opt.indexOf('a') < 0)) opt += 'a';\n         if (opt.indexOf('p') < 0) opt += 'p';\n\n         const gr = this.createGraph(eff);\n         this.fillGraph(gr, opt);\n         promise = TGraphPainter.draw(dom, gr, opt);\n      } else {\n         if (!opt) opt = 'col';\n         const hist = this.createHisto(eff);\n         this.fillHisto(hist, opt);\n         promise = TH2Painter.draw(dom, hist, opt);\n      }\n\n      return promise.then(subp => {\n         subp?.setSecondaryId(this, 'eff');\n         this.addToPadPrimitives();\n         return draw_total ? this : this.drawFunction(0);\n      });\n   }\n\n   /** @summary Draw TEfficiency object */\n   static async draw(dom, eff, opt) {\n      if (!eff || !eff.fTotalHistogram)\n         return null;\n\n      const painter = new TEfficiencyPainter(dom, eff);\n\n      if (eff.fTotalHistogram._typename.indexOf(clTH1) === 0)\n         painter.ndim = 1;\n      else if (eff.fTotalHistogram._typename.indexOf(clTH2) === 0)\n         painter.ndim = 2;\n      else\n         return null;\n\n      painter.fBoundary = getTEfficiencyBoundaryFunc(eff.fStatisticOption, eff.TestBit(kIsBayesian));\n\n      return painter.redrawWith(opt, true);\n   }\n\n} // class TEfficiencyPainter\n\nexport { TEfficiencyPainter };\n"],"x_google_ignoreList":[0]}