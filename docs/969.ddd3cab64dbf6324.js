"use strict";(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[969],{7562:(w,P,h)=>{h.r(P),h.d(P,{THStackPainter:()=>g});var p=h(1773),k=h(5611),X=h(2454),E=h(7320),C=h(5759),M=h(6292),S=h(1518);class g extends X.tK{constructor(r,t,n){super(r,t,n),this.firstpainter=null,this.painters=[]}cleanup(){this.getPadPainter()?.cleanPrimitives(r=>r===this.firstpainter||this.painters.indexOf(r)>=0),delete this.firstpainter,delete this.painters,super.cleanup()}buildStack(r){if(!r.fHists)return!1;let t=r.fHists.arr.length;if(t<=0)return!1;let n=(0,p.create)("TList");n.Add((0,p.clone)(r.fHists.arr[0]),r.fHists.opt[0]);for(let e=1;e<t;++e){let i=(0,p.clone)(r.fHists.arr[e]),s=r.fHists.opt[e],a=n.arr[e-1];if(i.fNbins!=a.fNbins||i.fXaxis.fXmin!=a.fXaxis.fXmin||i.fXaxis.fXmax!=a.fXaxis.fXmax)return console.warn(`When drawing THStack, cannot sum-up histograms ${i.fName} and ${a.fName}`),n.Clear(),!1;for(let o=0;o<i.fArray.length;++o)i.fArray[o]+=a.fArray[o];n.Add(i,s)}return r.fStack=n,!0}getMinMax(r){let t={min:0,max:0},n=this.getObject(),e=this.getPadPainter().getRootPad(!0);const i=(s,a)=>{let o={min:0,max:0},f=!0,m=!0;if(-1111!==s.fMinimum&&(o.min=s.fMinimum,f=!1),-1111!==s.fMaximum&&(o.max=s.fMaximum,m=!1),!f&&!m)return o;let l=1,O=s.fXaxis.fNbins,T=1,_=1,H=!0;s.fXaxis.TestBit(M.VO.kAxisRange)&&(l=s.fXaxis.fFirst,O=s.fXaxis.fLast),0===s._typename.indexOf("TH2")&&(_=s.fYaxis.fNbins,s.fYaxis.TestBit(M.VO.kAxisRange)&&(T=s.fYaxis.fFirst,_=s.fYaxis.fLast));for(let c=T;c<=_;++c)for(let d=l;d<=O;++d){let x=s.getBinContent(d,c),u=a?s.getBinError(s.getBin(d,c)):0;f&&(H||x-u<o.min)&&(o.min=x-u),m&&(H||x+u>o.max)&&(o.max=x+u),H=!1}return o};if(this.options.nostack)for(let s=0;s<n.fHists.arr.length;++s){let a=i(n.fHists.arr[s],r);0==s?t=a:(t.min=Math.min(t.min,a.min),t.max=Math.max(t.max,a.max))}else t.min=i(n.fStack.arr[0],r).min,t.max=i(n.fStack.arr[n.fStack.arr.length-1],r).max;if(-1111!=n.fMaximum&&(t.max=n.fMaximum),t.max*=1+p.gStyle.fHistTopMargin,-1111!=n.fMinimum&&(t.min=n.fMinimum),e&&(1==this.options.ndim?e.fLogy:e.fLogz)){t.max<=0&&(t.max=1),t.min<=0&&(t.min=1e-4*t.max);let s=1/(1+.5*Math.log10(t.max/t.min)),a=1+.2*Math.log10(t.max/t.min);t.min*=s,t.max*=a}else t.min>0&&t.min<.05*t.max&&(t.min=0);return t}drawNextHisto(r,t){let n=this.getObject(),e=this.options.nostack?n.fHists:n.fStack,i=e&&e.arr?e.arr.length:0;if(r>=i)return Promise.resolve(this);let s=this.options.horder?r:i-r-1,a=e.arr[s],o=e.opt[s]||a.fOption||this.options.hopt;if(o.toUpperCase().indexOf(this.options.hopt)<0&&(o+=" "+this.options.hopt),this.options.draw_errors&&!o&&(o="E"),this.options._pfc||this.options._plc||this.options._pmc){let f=this.getMainPainter();if("function"==typeof f?.createAutoColor){let m=f.createAutoColor(i);this.options._pfc&&(a.fFillColor=m),this.options._plc&&(a.fLineColor=m),this.options._pmc&&(a.fMarkerColor=m)}}if(t){let f=t.getSubPadPainter(r+1);if(!f)return Promise.resolve(this);let m=f.selectCurrentPad(f.this_pad_name);return this.hdraw_func(f.getDom(),a,o).then(l=>(this.painters.push(l),f.selectCurrentPad(m),this.drawNextHisto(r+1,t)))}return s>0&&!this.options.nostack&&(a.$baseh=e.arr[s-1]),this.hdraw_func(this.getDom(),a,o+" same nostat").then(f=>(this.painters.push(f),this.drawNextHisto(r+1,t)))}decodeOptions(r){this.options||(this.options={}),Object.assign(this.options,{ndim:1,nostack:!1,same:!1,horder:!0,has_errors:!1,draw_errors:!1,hopt:""});let t=this.getObject(),n=t.fHistogram||(t.fHists?t.fHists.arr[0]:null)||(t.fStack?t.fStack.arr[0]:null);const e=a=>{if(a.fSumw2&&a.fSumw2.length>0)for(let o=0;o<a.fSumw2.length;++o)if(a.fSumw2[o]>0)return!0;return!1};if(n&&0==n._typename.indexOf("TH2")&&(this.options.ndim=2),2==this.options.ndim&&!r&&(r="lego1"),t.fHists&&!this.options.nostack)for(let a=0;a<t.fHists.arr.length;++a)this.options.has_errors=this.options.has_errors||e(t.fHists.arr[a]);this.options.nhist=t.fHists?t.fHists.arr.length:1;let i=new k.pc(r);this.options.nostack=i.check("NOSTACK"),i.check("STACK")&&(this.options.nostack=!1),this.options.same=i.check("SAME"),i.check("NOCLEAR"),this.options._pfc=i.check("PFC"),this.options._plc=i.check("PLC"),this.options._pmc=i.check("PMC"),this.options.pads=i.check("PADS"),this.options.pads&&(this.options.nostack=!0),this.options.hopt=i.remain();let s=i.check("LEGO");this.options.errors=i.check("E"),!this.options.nostack&&this.options.has_errors&&!s&&!i.check("HIST")&&this.options.hopt.indexOf("E")<0&&(this.options.draw_errors=!0),this.options.horder=this.options.nostack||s}createHistogram(r){let t=r.fHists,n=t?t.arr.length:0;if(!n){let s=(0,p.createHistogram)("TH1I",100);return s.fTitle=r.fTitle,s}let e=t.arr[0],i=(0,p.createHistogram)(1==this.options.ndim?"TH1I":"TH2I",e.fXaxis.fNbins,e.fYaxis.fNbins);i.fName="axis_hist",Object.assign(i.fXaxis,e.fXaxis),2==this.options.ndim&&Object.assign(i.fYaxis,e.fYaxis);for(let s=1;s<n;++s){let a=t.arr[s];i.fXaxis.fLabels||(i.fXaxis.fXmin=Math.min(i.fXaxis.fXmin,a.fXaxis.fXmin),i.fXaxis.fXmax=Math.max(i.fXaxis.fXmax,a.fXaxis.fXmax)),2==this.options.ndim&&!i.fYaxis.fLabels&&(i.fYaxis.fXmin=Math.min(i.fYaxis.fXmin,a.fYaxis.fXmin),i.fYaxis.fXmax=Math.max(i.fYaxis.fXmax,a.fYaxis.fXmax))}return i.fTitle=r.fTitle,i}updateObject(r){if(!this.matchObjectType(r))return!1;let t=this.getObject();if(t.fHists=r.fHists,t.fStack=r.fStack,t.fTitle=r.fTitle,this.options.nostack||(this.options.nostack=!this.buildStack(t)),this.firstpainter){let i=r.fHistogram;i||(i=t.fHistogram=this.createHistogram(t)),this.firstpainter.updateObject(i);let s=this.getMinMax(this.options.errors||this.options.draw_errors);this.firstpainter.options.minimum=s.min,this.firstpainter.options.maximum=s.max,1==this.options.ndim&&(this.firstpainter.ymin=s.min,this.firstpainter.ymax=s.max)}let n=this.options.nostack?t.fHists:t.fStack,e=n&&n.arr?n.arr.length:0;if(e!==this.painters.length)this.getPadPainter()?.cleanPrimitives(i=>this.painters.indexOf(i)>=0),this.painters=[],this.did_update=!0;else for(let i=0;i<e;++i)this.painters[i].updateObject(n.arr[this.options.horder?i:e-i-1]);return!0}redraw(){if(this.did_update)return delete this.did_update,this.drawNextHisto(0,this.options.pads?this.getPadPainter():null)}static draw(r,t,n){if(!t.fHists||!t.fHists.arr)return null;let e=new g(r,t,n),i=null,s=!1;return(0,S.ensureTCanvas)(e,!1).then(()=>{if(e.decodeOptions(n),e.hdraw_func=1==e.options.ndim?E.TH1Painter.draw:C.TH2Painter.draw,e.options.pads)return i=e.getPadPainter(),i.doingDraw()&&i.pad?.fPrimitives&&i.pad.fPrimitives.arr.length>1&&0==i.pad.fPrimitives.arr.indexOf(t)?(s=!0,void console.log("special case with THStack with is already rendered - do nothing")):(i.cleanPrimitives(f=>f!==e),i.divide(e.options.nhist));if(e.options.nostack||(e.options.nostack=!e.buildStack(t)),e.options.same)return;t.fHistogram||(t.fHistogram=e.createHistogram(t));let a=e.getMinMax(e.options.errors||e.options.draw_errors),o=e.options.hopt+" axis";return a&&(o+=";minimum:"+a.min+";maximum:"+a.max),e.hdraw_func(r,t.fHistogram,o).then(f=>{e.firstpainter=f})}).then(()=>s?e:e.drawNextHisto(0,i))}}}}]);
//# sourceMappingURL=969.ddd3cab64dbf6324.js.map