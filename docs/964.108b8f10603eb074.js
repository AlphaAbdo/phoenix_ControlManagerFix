"use strict";(self.webpackChunkphoenix_app=self.webpackChunkphoenix_app||[]).push([[964],{1985:(J,K,R)=>{R.d(K,{D:()=>G});var S=R(8872),c=R(4246),B=R(9640),I=R(8362);class G extends B.JW{constructor(p,b,v,h){super(p,b,v),this.csstype=h}addToPadPrimitives(){const p=super.addToPadPrimitives();return p&&!this.rstyle&&p.next_rstyle&&(this.rstyle=p.next_rstyle),p}v7EvalAttr(p,b){const v=this.getObject();if(!v)return b;this.cssprefix&&(p=this.cssprefix+p);const h=l=>{if(void 0===b)return l;const d=typeof b,n=typeof l;return d===n?l:"boolean"===d?"string"===n?""!==l&&"0"!==l&&"no"!==l&&"off"!==l:!!l:"number"===d&&"string"===n?parseFloat(l):l};if(v.fAttr?.m){const l=v.fAttr.m[p];if(l)return h(l.v)}if(this.rstyle?.fBlocks){const l=this.rstyle.fBlocks;for(let d=0;d<l.length;++d){const n=l[d];if((this.csstype&&n.selector===this.csstype||v.fId&&n.selector==="#"+v.fId||v.fCssClass&&n.selector==="."+v.fCssClass)&&n.map?.m){const u=n.map.m[p.toLowerCase()];if(u)return h(u.v)}}}return b}v7SetAttr(p,b){const v=this.getObject();this.cssprefix&&(p=this.cssprefix+p),v?.fAttr?.m&&(v.fAttr.m[p]={v:b})}v7EvalLength(p,b,v){b<=0&&(b=1);const h=this.v7EvalAttr(p);if(void 0===h)return Math.round(v*b);if("number"==typeof h)return Math.round(h*b);if(null===h)return 0;let l=0,d=0,n=h,m=0,u=0;for(;n;){for(;u<n.length&&(" "===n[u]||"\t"===n[u]);)++u;if(u>=n.length)break;if("-"===n[u]||"+"===n[u]){if(m)return console.log("Fail to parse RPadLength "+h),v;m="-"===n[u]?-1:1,u++;continue}for(u>0&&(n=n.slice(u),u=0);u<n.length&&(n[u]>="0"&&n[u]<="9"||"."===n[u]);)u++;const w=parseFloat(n.slice(0,u));if(!Number.isFinite(w))return console.log(`Fail to parse RPadLength ${h}`),Math.round(v*b);n=n.slice(u),u=0,m||(m=1),n&&"%"===n[0]?(n=n.slice(1),l+=m*w*.01):n.length>1&&"p"===n[0]&&"x"===n[1]?(n=n.slice(2),d+=m*w):l+=m*w,m=0}return Math.round(l*b+d)}v7EvalColor(p,b){let v=this.v7EvalAttr(p,"");if(!v||!(0,S.isStr)(v))return b;if("auto"===v){const h=this.getPadPainter();if(void 0!==h?._auto_color_cnt){const l=h.getHistPalette(),d=h._auto_color_cnt++;let n=h._num_primitives-1;n<2&&(n=2),v=l?l.getColorOrdinal(d%n/n):"blue",this._auto_colors||(this._auto_colors={}),this._auto_colors[p]=v}else this._auto_colors&&this._auto_colors[p]?v=this._auto_colors[p]:(console.error(`Autocolor ${p} not defined yet - please check code`),v="")}else if("["===v[0]){const h=parseFloat(v.slice(1,v.length-1));if(v="black",Number.isFinite(h)){const l=this.getPadPainter()?.getHistPalette();l&&(v=l.getColorOrdinal(h))}}if("#"===v[0]&&((0,S.isNodeJs)()||(0,S.isBatchMode)()&&S.settings.ApproxTextSize)){const h=(0,I.yW)(v);return 1!==h.opacity&&(h.opacity=h.opacity.toFixed(2)),h.formatRgb()}return v}v7EvalFont(p,b,v){b?"number"==typeof b&&(b={size:b}):b={};const h=this.getPadPainter(),l=h?._dfltRFont||{fFamily:"Arial",fStyle:"",fWeight:""},d=this.v7EvalAttr(p+"_angle",0),n=this.v7EvalAttr(p+"_align",b.align||"none"),m=this.v7EvalColor(p+"_color",b.color||"none"),u=this.v7EvalAttr(p+"_font_family",l.fFamily||"Arial"),w=this.v7EvalAttr(p+"_font_style",l.fStyle||""),P=this.v7EvalAttr(p+"_font_weight",l.fWeight||"");let A=this.v7EvalAttr(p+"_size",b.size||12);(0,S.isStr)(A)&&(A=parseFloat(A)),(!Number.isFinite(A)||A<=0)&&(A=12),v||(v=h?.getPadHeight()||100);const O=new c.qg(null,A,v);return O.setNameStyleWeight(u,w,P),d&&O.setAngle(360-d),"none"!==n&&O.setAlign(n),"none"!==m&&O.setColor(m),O}createv7AttFill(p){(!p||!(0,S.isStr)(p))&&(p="fill_");const b=this.v7EvalColor(p+"color",""),v=this.v7EvalAttr(p+"style",0);this.createAttFill({pattern:v,color:b,color_as_svg:!0})}createv7AttLine(p){(!p||!(0,S.isStr)(p))&&(p="line_");const b=this.v7EvalColor(p+"color","black"),v=this.v7EvalAttr(p+"width",1),h=this.v7EvalAttr(p+"style",1);let l=this.v7EvalAttr(p+"pattern");l&&(0,S.isNodeJs)()&&(l=l.split(",").join(", ")),this.createAttLine({color:b,width:v,style:h,pattern:l}),"border_"===p&&this.lineatt.setBorder(this.v7EvalAttr(p+"rx",0),this.v7EvalAttr(p+"ry",0))}createv7AttMarker(p){(!p||!(0,S.isStr)(p))&&(p="marker_");const b=this.v7EvalColor(p+"color","black"),v=this.v7EvalAttr(p+"size",.01),h=this.v7EvalAttr(p+"style",1),l=v>=1?1:this.getPadPainter()?.getPadHeight()||100;this.createAttMarker({color:b,size:v,style:h,refsize:l})}v7AttrChange(p,b,v,h){if(!this.snapid)return!1;p._typename||(p._typename=`${S.nsREX}RChangeAttrRequest`,p.ids=[],p.names=[],p.values=[],p.update=!0),this.cssprefix&&(b=this.cssprefix+b),p.ids.push(this.snapid),p.names.push(b);let l=null;if(null==v&&(h||(h="none"),"none"!==h&&console.error(`Trying to set ${h} for none value`)),!h)switch(typeof v){case"number":h="double";break;case"boolean":h="boolean"}switch(l={_typename:`${S.nsREX}RAttrMap::`},h){case"none":l._typename+="NoValue_t";break;case"boolean":l._typename+="BoolValue_t",l.v=!!v;break;case"int":l._typename+="IntValue_t",l.v=parseInt(v);break;case"double":l._typename+="DoubleValue_t",l.v=parseFloat(v);break;default:l._typename+="StringValue_t",l.v=(0,S.isStr)(v)?v:JSON.stringify(v)}return p.values.push(l),!0}v7SendAttrChanges(p,b){const v=this.getCanvPainter();v&&p?._typename&&(void 0!==b&&(p.update=!!b),v.v7SubmitRequest("",p))}v7SubmitRequest(p,b,v){const h=this.getCanvPainter();return(0,S.isFunc)(h?.submitDrawableRequest)?this.snapid?h.submitDrawableRequest(p,b,this,v):(this._pending_request={kind:p,req:b,method:v},b):null}assignSnapId(p){if(this.snapid=p,this.snapid&&this._pending_request){const b=this._pending_request;this.v7SubmitRequest(b.kind,b.req,b.method),delete this._pending_request}}v7CommMode(){const p=this.getCanvPainter();return p&&p.submitDrawableRequest&&p._websocket?1:3}v7NormalMode(){return 1===this.v7CommMode()}v7OfflineMode(){return 3===this.v7CommMode()}}},3804:(J,K,R)=>{R.d(K,{R:()=>b});var S=R(5072),c=R(8362),B=R(8872),I=R(2843),W=R(2866),L=R(7900),G=R(5638),D=R(9640),p=R(1985);class b extends p.D{constructor(h,l,d,n){super(h,n?l.getObject():l,"",n?l.csstype:"axis"),Object.assign(this,W.fm),this.initAxisPainter(),this.axis=d,n?(this.embedded=!0,this.cssprefix=n,this.rstyle=l.rstyle):this.cssprefix="axis_"}cleanup(){delete this.axis,delete this.axis_g,this.cleanupAxisPainter(),super.cleanup()}getAxisType(){return"RAttrAxis"}configureZAxis(h,l){this.name=h,this.kind=D.UV,this.log=!1;const d=this.v7EvalAttr("log",0);d&&(this.log=!0,this.logbase=10,Math.abs(d-Math.exp(1))<.1?this.logbase=Math.exp(1):d>1.9&&(this.logbase=Math.round(d))),l.logz=this.log}configureAxis(h,l,d,n,m,u,w,P,A){A||(A={}),this.name=h,this.full_min=l,this.full_max=d,this.kind=D.UV,this.vertical=u,this.log=!1;const O=this.v7EvalAttr("log",0),F=this.v7EvalAttr("symlog",0);if(this.reverse=A.reverse||!1,this.v7EvalAttr("time")){this.kind=D.Yu,this.timeoffset=0;let g=this.v7EvalAttr("timeOffset");void 0!==g&&(g=parseFloat(g),Number.isFinite(g)&&(this.timeoffset=1e3*g))}else this.axis?.fLabelsIndex?(this.kind=D.ei,delete this.own_labels):this.kind=A.labels?D.ei:D.UV;this.kind===D.Yu?this.func=(0,c.w7)().domain([this.convertDate(n),this.convertDate(m)]):F&&F>0?(this.symlog=F,this.func=(0,c.aX)().constant(F).domain([n,m])):O?(m<=0&&(m=1),(n<=0||n>=m)&&(n=1e-4*m),this.log=!0,this.logbase=10,Math.abs(O-Math.exp(1))<.1?this.logbase=Math.exp(1):O>1.9&&(this.logbase=Math.round(O)),this.func=(0,c.ZE)().base(this.logbase).domain([n,m])):this.func=(0,c.m4)().domain([n,m]),this.scale_min=n,this.scale_max=m,this.gr_range=P||1e3;const M=w??[0,this.gr_range];this.axis_shift=M[1]-this.gr_range,this.func.range(this.reverse?[M[1],M[0]]:M),this.gr=this.kind===D.Yu?g=>this.func(this.convertDate(g)):this.log?g=>g<this.scale_min?this.vertical?this.func.range()[0]+5:-5:this.func(g):this.func,delete this.format;const E=this.v7EvalAttr("ndiv",508);this.nticks=E%100,this.nticks2=(E%1e4-this.nticks)/100,this.nticks3=Math.floor(E/1e4),this.nticks>20&&(this.nticks=20);const $=Math.abs(this.gr_range)||100;if(this.kind===D.Yu){this.nticks>8&&(this.nticks=8);const g=this.scale_max-this.scale_min,t=(0,W.iF)(g/$,!1);let e=this.v7EvalAttr("timeFormat","");(!e||g<.1*(this.full_max-this.full_min))&&(e=(0,W.iF)(g/this.nticks,!0)),this.tfunc1=this.tfunc2=(0,c.DC)(e),t!==e&&(this.tfunc2=(0,c.DC)(t)),this.format=this.formatTime}else if(this.log)this.nticks2>1&&(this.nticks*=this.nticks2,this.nticks2=1),this.noexp=this.v7EvalAttr("noexp",!1),this.scale_max<300&&this.scale_min>.3&&10===this.logbase&&(this.noexp=!0),this.moreloglabels=this.v7EvalAttr("moreloglbls",!1),this.format=this.formatLog;else if(this.kind===D.ei){this.nticks=50;const g=this.scale_max-this.scale_min;this.nticks>g&&(this.nticks=Math.round(g)),this.nticks2=1,this.format=this.formatLabels}else this.order=0,this.ndig=0,this.format=this.formatNormal}getScaleMin(){return this.func?this.func.domain()[0]:0}getScaleMax(){return this.func?this.func.domain()[1]:0}formatLabels(h){const l=Math.round(h);if(this.axis?.fLabelsIndex){if(l<0||l>=this.axis.fNBinsNoOver)return null;for(let d=0;d<this.axis.fLabelsIndex.length;++d){const n=this.axis.fLabelsIndex[d];if(n.second===l)return n.first}}else{const d=this.getObject().fLabels;if(d&&l>=0&&l<d.length)return d[l]}return null}createTicks(h,l,d,n){d&&this.nticks&&this.kind===D.UV&&(this.noticksopt=!0);const m=this.produceTicks(this.nticks),u={nminor:0,nmiddle:0,nmajor:0,func:this.func,minor:m,middle:m,major:m};if(h){const w=u.major,P=1e-5*(this.scale_max-this.scale_min);return w[0]>this.scale_min+P&&w.unshift(this.scale_min),w[w.length-1]<this.scale_max-P&&w.push(this.scale_max),w}if(this.nticks2>1&&(!this.log||10===this.logbase)){u.minor=u.middle=this.produceTicks(u.major.length,this.nticks2);const w=Math.abs(this.func.range()[1]-this.func.range()[0]);u.middle.length<=u.major.length||u.middle.length>w/3.5?u.minor=u.middle=u.major:this.nticks3>1&&!this.log&&(u.minor=this.produceTicks(u.middle.length,this.nticks3),(u.minor.length<=u.middle.length||u.minor.length>w/1.7)&&(u.minor=u.middle))}if(u.reset=function(){this.nminor=this.nmiddle=this.nmajor=0},u.next=function(w){return!(this.nminor>=this.minor.length||(this.tick=this.minor[this.nminor++],this.grpos=this.func(this.tick),w&&(this.grpos=Math.round(this.grpos)),this.kind=3,this.nmiddle<this.middle.length&&Math.abs(this.grpos-this.func(this.middle[this.nmiddle]))<1&&(this.nmiddle++,this.kind=2),this.nmajor<this.major.length&&Math.abs(this.grpos-this.func(this.major[this.nmajor]))<1&&(this.nmajor++,this.kind=1),0))},u.last_major=function(){return 1===this.kind&&this.nmajor===this.major.length},u.next_major_grpos=function(){return this.nmajor>=this.major.length?null:this.func(this.major[this.nmajor])},u.get_modifier=function(){return null},this.order=0,this.ndig=0,this.kind===D.UV&&!this.log&&u.major.length>0){let w=0,P=0,A=!1;if(!l){const E=Math.max(Math.abs(u.major[0]),Math.abs(u.major[u.major.length-1])),$=Math.min(Math.abs(u.major[0]),Math.abs(u.major[u.major.length-1])),g=E>0?3*Math.round(Math.log10(E)/3):0,t=$>0?3*Math.round(Math.log10($)/3):0;A=E<2e4,(E||$)&&(w=Math.max(g,t)+3,P=Math.min(g,t)-3)}let O=0,F=this.ndig,M=1e10;for(let E=P;E<=w;E+=3){if(A&&3===E)continue;this.order=E,this.ndig=0;let $=[],g=0,t=0;for(;g<u.major.length;){const e=this.format(u.major[g],!0);if($.indexOf(e)<0)$.push(e),t+=e.length,g++;else{if(++this.ndig>11)break;$=[],g=0,t=0}}!E&&this.ndig<4&&(t-=2*u.major.length+3),t<M&&(M=t,O=this.order,F=this.ndig)}this.order=O,this.ndig=F,n&&(this.order&&console.warn(`Axis painter - integer labels are configured, but axis order ${this.order} is preferable`),this.ndig&&console.warn(`Axis painter - integer labels are configured, but ${this.ndig} decimal digits are required`),this.ndig=0,this.order=0)}return u}isCenteredLabels(){return this.kind===D.ei||"log"!==this.kind&&this.v7EvalAttr("labels_center",!1)}isRotateLabels(){return!1}processLabelsMove(h,l){if(this.optionUnlab||!this.axis_g)return!1;const d=this.axis_g.select(".axis_labels");if(!d||1!==d.size())return!1;if("start"===h){const m=d.node().getBBox();return d.append("rect").classed("drag",!0).attr("x",m.x).attr("y",m.y).attr("width",m.width).attr("height",m.height).style("cursor","move").call(I.Ru,!0),this.drag_pos0=this.vertical?l[0]:l[1],!0}let n=d.property("fix_offset");if(this.vertical?(n+=Math.round(l[0]-this.drag_pos0),d.attr("transform",`translate(${n})`)):(n+=Math.round(l[1]-this.drag_pos0),d.attr("transform",`translate(0,${n})`)),n||d.attr("transform",null),"stop"===h&&(d.select("rect.drag").remove(),delete this.drag_pos0,n!==d.property("fix_offset"))){d.property("fix_offset",n);const m=d.property("side")||1;this.labelsOffset=n/(this.vertical?-m:m),this.changeAxisAttr(1,"labels_offset",this.labelsOffset/this.scalingSize)}return!0}addTitleDrag(h,l){if(!B.settings.MoveResize||this.isBatchMode())return;let n,m,u,w,P,A,d=null;const O=(0,c.$E)().subject(Object);O.on("start",F=>{F.sourceEvent.preventDefault(),F.sourceEvent.stopPropagation();const M=h.node().getBBox(),E=this.vertical?M.height:M.width;u=n=h.property("shift_x"),w=m=h.property("shift_y"),A="center"===this.titlePos?1:"left"===this.titlePos?0:2,P=[0,this.gr_range/2,this.gr_range];const $=this.vertical?-E:E,g=this.isReverseAxis()?2:0;"middle"===this.title_align?(P[g]+=$/2,P[2-g]-=$/2):"begin"===this.title_align^this.isTitleRotated()?(P[1]-=$/2,P[2-g]-=$):(P[g]+=$,P[1]+=$/2),P[A]=this.vertical?m:n,d=h.append("rect").attr("x",M.x).attr("y",M.y).attr("width",M.width).attr("height",M.height).style("cursor","move").call(I.Ru,!0)}).on("drag",F=>{if(!d)return;F.sourceEvent.preventDefault(),F.sourceEvent.stopPropagation(),n+=F.dx,m+=F.dy;const M=this.vertical?m:n;let E,$,g=0;for(let t=1;t<3;++t)Math.abs(M-P[t])<Math.abs(M-P[g])&&(g=t);this.vertical?(E=n,$=P[g]):(E=P[g],$=m),u=E,w=$,A=g,(0,I.bk)(h,u,w)}).on("end",F=>{if(!d)return;F.sourceEvent.preventDefault(),F.sourceEvent.stopPropagation();const M=h.property("basepos")||0;h.property("shift_x",u).property("shift_y",w),this.titleOffset=(this.vertical?M-u:w-M)*l,this.titlePos=1===A?"center":0===A?"left":"right",this.changeAxisAttr(0,"title_position",this.titlePos,"title_offset",this.titleOffset/this.scalingSize),d.remove(),d=null}),h.style("cursor","move").call(O)}isInsideGrRange(h,l,d){return l||(l=0),void 0===d&&(d=l),this.gr_range<0?h>=this.gr_range-d&&h<=l:h>=-l&&h<=this.gr_range+d}getGrRange(h){return h||(h=0),this.gr_range<0?this.gr_range-h:this.gr_range+h}isReverseAxis(){return!this.vertical!=this.getGrRange()>0}drawMainLine(h){let l="";if(this.endingSize&&this.endingStyle){let d=this.gr_range>0?-this.endingSize:this.endingSize;const n=Math.round(.7*d);d=Math.round(d),l=this.vertical?`l${n},${d}M0,${this.gr_range}l${-n},${d}`:`l${d},${n}M${this.gr_range},0l${d},${-n}`}h.append("svg:path").attr("d","M0,0"+(this.vertical?"v":"h")+this.gr_range+l).call(this.lineatt.func).style("fill",l?"none":null)}drawTicks(h,l,d){d&&(this.ticks=[]),this.handle.reset();let n="",m=0;for("both"===this.ticksSide&&(l=1,m=1);this.handle.next(!0);){let P=Math.round(this.ticksSize/4),A=0;this.handle.kind<3&&(P=Math.round(this.ticksSize/2));const O=this.handle.grpos-this.axis_shift;(this.startingSize||this.endingSize)&&!this.isInsideGrRange(O,-Math.abs(this.startingSize),-Math.abs(this.endingSize))||(1===this.handle.kind&&((this.kind===D.ei||null!==this.format(this.handle.tick,!0))&&(P=this.ticksSize),d&&this.ticks.push(O)),m>0?A=-P:l<0?(A=-P,P=0):A=0,n+=this.vertical?`M${P},${O}H${A}`:`M${O},${-P}V${-A}`)}n&&h.append("svg:path").attr("d",n).style("stroke",this.ticksColor||this.lineatt.color).style("stroke-width",this.ticksWidth&&1!==this.ticksWidth?this.ticksWidth:null);const u=Math.round(.25*this.ticksSize),w=Math.round(1.25*this.ticksSize);return{"-1":l>0||m?w:u,1:l<0||m?w:u}}drawLabels(h,l,d){var n=this;return(0,S.A)(function*(){const m=n.isCenteredLabels(),u=0!==n.labelsFont.angle,w=h.append("svg:g").attr("class","axis_labels").property("side",l),P=n.handle.lbl_pos||n.handle.major;let A=1,O=0,F=!1,M=0,E=0;function $(i){M=Math.max(M,this.result_width),E=Math.max(E,this.result_height);const s=this.result_width;if(s&&(!i.vertical&&!u||i.vertical&&u)&&!i.log){let r=.45*this.gap_before+.45*this.gap_after;this.gap_before?this.gap_after||(r=.9*this.gap_before):r=.9*this.gap_after,A=Math.min(A,r/s)}A>1e-4&&A<.8&&!i.vertical&&!u&&O>5&&l>0&&(F=!0);const a=A*(F?3:1);a>1e-4&&a<1&&i.scaleTextDrawing(1/a,w)}const g=Math.round((n.vertical?-l:l)*n.labelsOffset),t=Math.round((n.vertical?-l:l)*d[l]);let e=0;return g&&w.attr("transform",n.vertical?`translate(${g})`:`translate(0,${g})`),w.property("fix_offset",g),n.startTextDrawingAsync(n.labelsFont,"font",w).then(()=>{for(let i=0;i<P.length;++i){const s=n.format(P[i],!0);if(null===s)continue;const a={text:s,latex:1,draw_g:w};let r=Math.round(n.func(P[i]));if(a.gap_before=i>0?Math.abs(Math.round(r-n.func(P[i-1]))):0,a.gap_after=i<P.length-1?Math.abs(Math.round(n.func(P[i+1])-r)):0,m){const f=a.gap_after||a.gap_before;if(r=Math.round(r-(n.vertical?.5*f:-.5*f)),!n.isInsideGrRange(r,5))continue}if(O=Math.max(O,s.length),r-=n.axis_shift,!n.startingSize&&!n.endingSize||n.isInsideGrRange(r,-Math.abs(n.startingSize),-Math.abs(n.endingSize))){if(n.vertical?(a.x=t,a.y=r,a.align=u?l<0?23:20:l<0?12:32):(a.x=r,a.y=t,a.align=u?l<0?12:32:l<0?20:23,n.log&&!n.noexp&&!n.vertical&&23===a.align&&(a.align=21,a.y+=n.labelsFont.size)),a.post_process=$,n.drawText(a),e&&r!==e&&(n.vertical&&!u||!n.vertical&&u)){const f=Math.abs(r-e);A=Math.min(A,.9*f/n.labelsFont.size)}e=r}}return n.order&&n.drawText({x:n.vertical?5*l:n.getGrRange(5),y:n.has_obstacle?t:n.vertical?n.getGrRange(3):-3*l,align:n.vertical?l<0?30:10:n.has_obstacle^l<0?13:10,latex:1,text:"#times"+n.formatExp(10,n.order),draw_g:w}),n.finishTextDrawing(w)}).then(()=>{if(F&&w.selectAll("text").each(function(){const i=(0,c.Lt)(this),s=i.attr("transform");i.attr("transform",s+" rotate(25)").style("text-anchor","start")}),n.vertical)d[l]+=Math.round(u?1.2*E:M+.4*n.labelsFont.size)-l*g;else{const i=F?M*Math.sin(.1388888888888889*Math.PI)+E*(Math.cos(.1388888888888889*Math.PI)+.2):0;d[l]+=Math.round(Math.max(u?M+.4*n.labelsFont.size:1.2*E,1.2*n.labelsFont.size,i))+g}return d})})()}addZoomingRect(h,l,d){if(B.settings.Zooming&&!this.disable_zooming&&!this.isBatchMode()){const n=Math.max(d[l],10),m=this.vertical?`v${this.gr_range}h${-l*n}v${-this.gr_range}`:`h${this.gr_range}v${l*n}h${-this.gr_range}`;h.append("svg:path").attr("d",`M0,0${m}z`).attr("class","axis_zoom").style("opacity","0").style("cursor","crosshair")}}isTitleRotated(){return this.titleFont&&this.titleFont.angle!==(this.vertical?270:0)}drawTitle(h,l,d){var n=this;return(0,S.A)(function*(){if(!n.fTitle)return n;const m=h.append("svg:g").attr("class","axis_title"),u=n.isTitleRotated();return n.startTextDrawingAsync(n.titleFont,"font",m).then(()=>{let w=0,P=0,A=0;return n.title_align=n.titleCenter?"middle":n.titleOpposite^(n.isReverseAxis()||u)?"begin":"end",n.vertical?(A=Math.round(-l*d[l]),w=A+Math.round(-l*n.titleOffset),P=Math.round(n.titleCenter?n.gr_range/2:n.titleOpposite?0:n.gr_range),n.drawText({align:[n.title_align,l<0^u?"top":"bottom"],text:n.fTitle,draw_g:m})):(w=Math.round(n.titleCenter?n.gr_range/2:n.titleOpposite?0:n.gr_range),A=Math.round(l*d[l]),P=A+Math.round(l*n.titleOffset),n.drawText({align:[n.title_align,l>0^u?"top":"bottom"],text:n.fTitle,draw_g:m})),(0,I.bk)(m,w,P).property("basepos",A).property("shift_x",w).property("shift_y",P),n.addTitleDrag(m,l),n.finishTextDrawing(m)})})()}extractDrawAttributes(h){const l=this.getPadPainter(),d=l?.getPadRect()||{width:10,height:10};this.scalingSize=h||(this.vertical?d.width:d.height),this.createv7AttLine("line_"),this.optionUnlab=this.v7EvalAttr("labels_hide",!1),this.endingStyle=this.v7EvalAttr("ending_style",""),this.endingSize=Math.round(this.v7EvalLength("ending_size",this.scalingSize,this.endingStyle?.02:0)),this.startingSize=Math.round(this.v7EvalLength("starting_size",this.scalingSize,0)),this.ticksSize=this.v7EvalLength("ticks_size",this.scalingSize,.02),this.ticksSide=this.v7EvalAttr("ticks_side","normal"),this.ticksColor=this.v7EvalColor("ticks_color",""),this.ticksWidth=this.v7EvalAttr("ticks_width",1),h&&this.ticksSize<0&&(this.ticksSize=-this.ticksSize),this.fTitle=this.v7EvalAttr("title_value",""),this.fTitle?(this.titleFont=this.v7EvalFont("title",{size:.03},h||l?.getPadHeight()||10),this.titleFont.roundAngle(180,this.vertical?270:0),this.titleOffset=this.v7EvalLength("title_offset",this.scalingSize,0),this.titlePos=this.v7EvalAttr("title_position","right"),this.titleCenter="center"===this.titlePos,this.titleOpposite="left"===this.titlePos):(delete this.titleFont,delete this.titleOffset,delete this.titlePos),this.labelsFont=this.v7EvalFont("labels",{size:h?.05:.03}),this.labelsFont.roundAngle(180),this.labelsFont.angle&&(this.labelsFont.angle=270),this.labelsOffset=this.v7EvalLength("labels_offset",this.scalingSize,0),h&&(this.ticksSize=.5*this.labelsFont.size),this.maxTickSize&&this.ticksSize>this.maxTickSize&&(this.ticksSize=this.maxTickSize)}drawAxis(h,l,d){var n=this;return(0,S.A)(function*(){let m=h;void 0===d&&(d=1),n.standalone||(m=h.selectChild(`.${n.name}_container`),m.empty()?m=h.append("svg:g").attr("class",`${n.name}_container`):m.selectAll("*").remove()),m.attr("transform",l),n.extractDrawAttributes(),n.axis_g=m,n.side=d,"invert"===n.ticksSide&&(d=-d),n.standalone&&n.drawMainLine(m),n.handle=n.createTicks(!1,!1,!1,!1);const A=n.drawTicks(m,d,!0);return(n.optionUnlab?Promise.resolve(A):n.drawLabels(m,d,A)).then(F=>(n.addZoomingRect(m,n.standalone?d:n.side,F),n.drawTitle(m,d,F)))})()}setAfterDrawHandler(h){this._afterDrawAgain=h}drawAxisAgain(){if(!this.axis_g||!this.side)return;this.axis_g.selectAll("*").remove(),this.extractDrawAttributes();let h=this.side;"invert"===this.ticksSide&&(h=-h),this.standalone&&this.drawMainLine(this.axis_g);const l=this.drawTicks(this.axis_g,h,!1);return(this.optionUnlab?Promise.resolve(l):this.drawLabels(this.axis_g,h,l)).then(n=>(this.addZoomingRect(this.axis_g,this.standalone?h:this.side,n),this.drawTitle(this.axis_g,h,n))).then(()=>{(0,B.isFunc)(this._afterDrawAgain)&&this._afterDrawAgain()})}drawAxisOtherPlace(h,l,d,n){let m=h.selectChild(`.${this.name}_container2`);m.empty()?m=h.append("svg:g").attr("class",`${this.name}_container2`):m.selectAll("*").remove(),m.attr("transform",l),"invert"===this.ticksSide&&(d=-d);const u=this.drawTicks(m,d,!1);return(this.optionUnlab||n?Promise.resolve(u):this.drawLabels(m,d,u)).then(P=>(this.addZoomingRect(m,d,P),!0))}zoomStandalone(h,l){this.changeAxisAttr(1,"zoomMin",h,"zoomMax",l)}redraw(){const h=this.getObject(),l=this.getPadPainter(),d=l.getCoordinate(h.fPos),n=this.v7EvalAttr("reverse",!1),m=h.fLabels.length,u=m>0?0:this.v7EvalAttr("min",0),w=m>0?m:this.v7EvalAttr("max",100);let P=l.getPadLength(h.fVertical,h.fLength);h.fVertical&&(P-=l.getPadHeight());let A=this.v7EvalAttr("zoomMin"),O=this.v7EvalAttr("zoomMax");A===O&&(A=u,O=w),this.configureAxis("axis",u,w,A,O,h.fVertical,void 0,P,{reverse:n,labels:m>0}),this.createG(),this.standalone=!0;const F=this.drawAxis(this.draw_g,(0,I.bk)(d.x,d.y));return this.isBatchMode()?F:F.then(()=>{B.settings.ContextMenu&&this.draw_g.on("contextmenu",M=>{M.stopPropagation(),M.preventDefault(),(0,L.ES)(M,this).then(E=>{E.header("RAxisDrawable",`${B.urlClassPrefix}ROOT_1_1Experimental_1_1RAxisBase.html`),E.add("Unzoom",()=>this.zoomStandalone()),this.fillAxisContextMenu(E,""),E.show()})}),(0,G.WJ)(this,{x:d.x,y:d.y,width:this.vertical?10:P,height:this.vertical?P:10,only_move:!0,redraw:M=>this.positionChanged(M)}),this.draw_g.on("dblclick",()=>this.zoomStandalone()),B.settings.ZoomWheel&&this.draw_g.on("wheel",M=>{M.stopPropagation(),M.preventDefault();const E=(0,c.Wn)(M,this.draw_g.node()),g=this.analyzeWheelEvent(M,this.vertical?1-E[1]/P:E[0]/P);g.changed&&this.zoomStandalone(g.min,g.max)})})}positionChanged(h){const l=this.getObject(),d=this.getPadPainter().getPadRect(),n=h.x/d.width,m=1-h.y/d.height;l.fPos.fHoriz.fArr=[n],l.fPos.fVert.fArr=[m],this.submitCanvExec(`SetPos({${n.toFixed(4)},${m.toFixed(4)}})`)}changeAxisAttr(h){const l={};let d=1;for(;d<arguments.length-1;)this.v7AttrChange(l,arguments[d],arguments[d+1]),this.v7SetAttr(arguments[d],arguments[d+1]),d+=2;this.v7SendAttrChanges(l,!1),1===h?this.standalone?this.redraw():this.drawAxisAgain():h&&this.redrawPad()}changeAxisLog(h){this.kind===D.ei||this.kind===D.Yu||("toggle"===h&&(h=this.log?0:10),h=parseFloat(h),Number.isFinite(h)&&this.changeAxisAttr(2,"log",h,"symlog",0))}fillAxisContextMenu(h,l){return l&&h.add("Unzoom",()=>this.getFramePainter().unzoom(l)),h.sub("Log scale",()=>this.changeAxisLog("toggle")),h.addchk(!this.log&&!this.symlog,"linear",0,d=>this.changeAxisLog(d)),h.addchk(this.log&&!this.symlog&&10===this.logbase,"log10",()=>this.changeAxisLog(10)),h.addchk(this.log&&!this.symlog&&2===this.logbase,"log2",()=>this.changeAxisLog(2)),h.addchk(this.log&&!this.symlog&&Math.abs(this.logbase-Math.exp(1))<.1,"ln",()=>this.changeAxisLog(Math.exp(1))),h.addchk(!this.log&&this.symlog,"symlog",0,()=>h.input("set symlog constant",this.symlog||10,"float").then(d=>this.changeAxisAttr(2,"symlog",d))),h.endsub(),h.add("Divisions",()=>h.input("Set axis devisions",this.v7EvalAttr("ndiv",508),"int").then(d=>this.changeAxisAttr(2,"ndiv",d))),h.sub("Ticks"),h.addRColorMenu("color",this.ticksColor,d=>this.changeAxisAttr(1,"ticks_color",d)),h.addSizeMenu("size",0,.05,.01,this.ticksSize/this.scalingSize,d=>this.changeAxisAttr(1,"ticks_size",d)),h.addSelectMenu("side",["normal","invert","both"],this.ticksSide,d=>this.changeAxisAttr(1,"ticks_side",d)),h.endsub(),!this.optionUnlab&&this.labelsFont&&(h.sub("Labels"),h.addSizeMenu("offset",-.05,.05,.01,this.labelsOffset/this.scalingSize,d=>this.changeAxisAttr(1,"labels_offset",d)),h.addRAttrTextItems(this.labelsFont,{noangle:1,noalign:1},d=>this.changeAxisAttr(1,"labels_"+d.name,d.value)),h.addchk(this.labelsFont.angle,"rotate",d=>this.changeAxisAttr(1,"labels_angle",d?180:0)),h.endsub()),h.sub("Title",()=>h.input("Enter axis title",this.fTitle).then(d=>this.changeAxisAttr(1,"title_value",d))),this.fTitle&&(h.addSizeMenu("offset",-.05,.05,.01,this.titleOffset/this.scalingSize,d=>this.changeAxisAttr(1,"title_offset",d)),h.addSelectMenu("position",["left","center","right"],this.titlePos,d=>this.changeAxisAttr(1,"title_position",d)),h.addchk(this.isTitleRotated(),"rotate",d=>this.changeAxisAttr(1,"title_angle",d?180:0)),h.addRAttrTextItems(this.titleFont,{noangle:1,noalign:1},d=>this.changeAxisAttr(1,"title_"+d.name,d.value))),h.endsub(),!0}}},9964:(J,K,R)=>{R.r(K),R.d(K,{RCanvasPainter:()=>w,RObjectPainter:()=>p.D,RPadPainter:()=>u,drawRAxis:()=>E,drawRFont:()=>M,drawRFrame:()=>$,drawRFrameTitle:()=>F,drawRPadSnapshot:()=>P,ensureRCanvas:()=>A});var S=R(5072),c=R(8872),B=R(8362),I=R(5992),W=R(6157),L=R(2843),G=R(2985),D=R(9640),p=R(1985),b=R(3804),v=R(4082),h=R(2866),l=R(5638);class d extends p.D{constructor(t,e){super(t,e,"","frame"),this.mode3d=!1,this.xmin=this.xmax=0,this.ymin=this.ymax=0,this.axes_drawn=!1,this.keys_handler=null,this.projection=0,this.v7_frame=!0}getFramePainter(){return this}is_root6(){return!1}setFrameActive(t){this.enabledKeys=t&&c.settings.HandleKeys,this.control&&(this.control.enableKeys=this.enabledKeys)}setLastEventPos(t){this.fLastEventPnt=t}getLastEventPos(){return this.fLastEventPnt}updateAttributes(t){if(void 0===this.fX1NDC||t&&!this.$modifiedNDC){const e=this.getPadPainter().getPadRect();this.fX1NDC=this.v7EvalLength("margins_left",e.width,c.gStyle.fPadLeftMargin)/e.width,this.fY1NDC=this.v7EvalLength("margins_bottom",e.height,c.gStyle.fPadBottomMargin)/e.height,this.fX2NDC=1-this.v7EvalLength("margins_right",e.width,c.gStyle.fPadRightMargin)/e.width,this.fY2NDC=1-this.v7EvalLength("margins_top",e.height,c.gStyle.fPadTopMargin)/e.height}this.fillatt||this.createv7AttFill(),this.createv7AttLine("border_")}getProjectionFunc(){return(0,l.qP)(this.projection)}recalculateRange(t){this.projection=t||0,2===this.projection&&(this.scale_ymin<=-90||this.scale_ymax>=90)&&(console.warn(`Mercator Projection: latitude out of range ${this.scale_ymin} ${this.scale_ymax}`),this.projection=0);const e=this.getProjectionFunc();if(!e)return;const i=[e(this.scale_xmin,this.scale_ymin),e(this.scale_xmin,this.scale_ymax),e(this.scale_xmax,this.scale_ymax),e(this.scale_xmax,this.scale_ymin)];this.scale_xmin<0&&this.scale_xmax>0&&(i.push(e(0,this.scale_ymin)),i.push(e(0,this.scale_ymax))),this.scale_ymin<0&&this.scale_ymax>0&&(i.push(e(this.scale_xmin,0)),i.push(e(this.scale_xmax,0))),this.original_xmin=this.scale_xmin,this.original_xmax=this.scale_xmax,this.original_ymin=this.scale_ymin,this.original_ymax=this.scale_ymax,this.scale_xmin=this.scale_xmax=i[0].x,this.scale_ymin=this.scale_ymax=i[0].y;for(let s=1;s<i.length;++s)this.scale_xmin=Math.min(this.scale_xmin,i[s].x),this.scale_xmax=Math.max(this.scale_xmax,i[s].x),this.scale_ymin=Math.min(this.scale_ymin,i[s].y),this.scale_ymax=Math.max(this.scale_ymax,i[s].y)}drawGrids(){const t=this.getFrameSvg().selectChild(".axis_layer");t.selectAll(".xgrid").remove(),t.selectAll(".ygrid").remove();const e=this.getFrameHeight(),i=this.getFrameWidth(),s=this.v7EvalAttr("gridX",!1),a=this.v7EvalAttr("gridY",!1),r=(0,v.Ov)(c.gStyle.fGridStyle),f=c.gStyle.fGridColor>0?this.getColor(c.gStyle.fGridColor):"black";if(this.x_handle&&(this.x_handle.draw_grid=s),this.x_handle?.draw_grid){let o="";for(let _=0;_<this.x_handle.ticks.length;++_)o+=this.swap_xy?`M0,${e+this.x_handle.ticks[_]}h${i}`:`M${this.x_handle.ticks[_]},0v${e}`;o&&t.append("svg:path").attr("class","xgrid").attr("d",o).style("stroke",f).style("stroke-width",c.gStyle.fGridWidth).style("stroke-dasharray",r)}if(this.y_handle&&(this.y_handle.draw_grid=a),this.y_handle?.draw_grid){let o="";for(let _=0;_<this.y_handle.ticks.length;++_)o+=this.swap_xy?`M${this.y_handle.ticks[_]},0v${e}`:`M0,${e+this.y_handle.ticks[_]}h${i}`;o&&t.append("svg:path").attr("class","ygrid").attr("d",o).style("stroke",f).style("stroke-width",c.gStyle.fGridWidth).style("stroke-dasharray",r)}}axisAsText(t,e){const i=this[`${t}_handle`];return i?i.axisAsText(e,c.settings[t.toUpperCase()+"ValuesFormat"]):e.toPrecision(4)}_setAxisRange(t,e,i){const s=`${t}min`,a=`${t}max`;if(this[s]!==this[a])return;let r=this.v7EvalAttr(`${t}_min`),f=this.v7EvalAttr(`${t}_max`);void 0!==r&&(e=r),void 0!==f&&(i=f),e<i&&(this[s]=e,this[a]=i);const o=`zoom_${t}min`,_=`zoom_${t}max`;this[o]===this[_]&&!this.zoomChangedInteractive(t)&&(r=this.v7EvalAttr(`${t}_zoomMin`),f=this.v7EvalAttr(`${t}_zoomMax`),(void 0!==r||void 0!==f)&&(this[o]=void 0===r?this[s]:r,this[_]=void 0===f?this[a]:f))}setAxesRanges(t,e,i,s,a,r,f,o,_){this.axes_drawn||(this.xaxis=t,this._setAxisRange("x",e,i),this.yaxis=s,this._setAxisRange("y",a,r),this.zaxis=f,this._setAxisRange("z",o,_))}setAxes2Ranges(t,e,i,s,a,r,f,o){t&&(this.x2axis=e,this._setAxisRange("x2",i,s)),a&&(this.y2axis=r,this._setAxisRange("y2",f,o))}createXY(t){if(this.self_drawaxes)return;this.cleanXY(),t||(t={ndim:1}),this.v6axes=!0,this.swap_xy=t.swap_xy||!1,this.reverse_x=t.reverse_x||!1,this.reverse_y=t.reverse_y||!1,this.logx=this.v7EvalAttr("x_log",0),this.logy=this.v7EvalAttr("y_log",0);const e=this.getFrameWidth(),i=this.getFrameHeight(),s=this.getPadPainter();this.scales_ndim=t.ndim,this.scale_xmin=this.xmin,this.scale_xmax=this.xmax,this.scale_ymin=this.ymin,this.scale_ymax=this.ymax,t.extra_y_space&&((this.swap_xy?this.logx:this.logy)&&this.scale_ymax>0?this.scale_ymax=Math.exp(1.1*Math.log(this.scale_ymax)):this.scale_ymax+=.1*(this.scale_ymax-this.scale_ymin)),t.zoom_xmin!==t.zoom_xmax&&(this.zoom_xmin===this.zoom_xmax||!this.zoomChangedInteractive("x"))&&(this.zoom_xmin=t.zoom_xmin,this.zoom_xmax=t.zoom_xmax),t.zoom_ymin!==t.zoom_ymax&&(this.zoom_ymin===this.zoom_ymax||!this.zoomChangedInteractive("y"))&&(this.zoom_ymin=t.zoom_ymin,this.zoom_ymax=t.zoom_ymax),this.zoom_xmin!==this.zoom_xmax&&(this.scale_xmin=this.zoom_xmin,this.scale_xmax=this.zoom_xmax),this.zoom_ymin!==this.zoom_ymax&&(this.scale_ymin=this.zoom_ymin,this.scale_ymax=this.zoom_ymax);let a=this.xaxis,r=this.yaxis;a?._typename!==c.clTAxis&&(a=(0,c.create)(c.clTAxis)),r?._typename!==c.clTAxis&&(r=(0,c.create)(c.clTAxis)),this.x_handle=new h.TB(s,a,!0),this.x_handle.optionUnlab=this.v7EvalAttr("x_labels_hide",!1),this.x_handle.configureAxis("xaxis",this.xmin,this.xmax,this.scale_xmin,this.scale_xmax,this.swap_xy,this.swap_xy?[0,i]:[0,e],{reverse:this.reverse_x,log:this.swap_xy?this.logy:this.logx,symlog:this.swap_xy?t.symlog_y:t.symlog_x,logcheckmin:t.ndim>1||!this.swap_xy,logminfactor:1e-4}),this.x_handle.assignFrameMembers(this,"x"),this.y_handle=new h.TB(s,r,!0),this.y_handle.optionUnlab=this.v7EvalAttr("y_labels_hide",!1),this.y_handle.configureAxis("yaxis",this.ymin,this.ymax,this.scale_ymin,this.scale_ymax,!this.swap_xy,this.swap_xy?[0,e]:[0,i],{reverse:this.reverse_y,log:this.swap_xy?this.logx:this.logy,symlog:this.swap_xy?t.symlog_x:t.symlog_y,logcheckmin:t.ndim>1||this.swap_xy,log_min_nz:t.ymin_nz&&t.ymin_nz<this.ymax?.5*t.ymin_nz:0,logminfactor:3e-4}),this.y_handle.assignFrameMembers(this,"y")}hasDrawnAxes(t,e){return!t&&!e&&this.axes_drawn}drawAxes(){var t=this;return(0,S.A)(function*(){if(t.axes_drawn||t.xmin===t.xmax||t.ymin===t.ymax)return t.axes_drawn;const e=t.v7EvalAttr("ticksX",1),i=t.v7EvalAttr("ticksY",1);let s=1,a=1;t.v7EvalAttr("swapX",!1)&&(s=-1),t.v7EvalAttr("swapY",!1)&&(a=-1);const r=t.getFrameWidth(),f=t.getFrameHeight(),o=t.getPadPainter();t.v6axes||(t.cleanupAxes(),t.swap_xy=!1,t.zoom_xmin!==t.zoom_xmax?(t.scale_xmin=t.zoom_xmin,t.scale_xmax=t.zoom_xmax):(t.scale_xmin=t.xmin,t.scale_xmax=t.xmax),t.zoom_ymin!==t.zoom_ymax?(t.scale_ymin=t.zoom_ymin,t.scale_ymax=t.zoom_ymax):(t.scale_ymin=t.ymin,t.scale_ymax=t.ymax),t.recalculateRange(0),t.x_handle=new b.R(o,t,t.xaxis,"x_"),t.x_handle.snapid=t.snapid,t.x_handle.draw_swapside=s<0,t.x_handle.draw_ticks=e,t.y_handle=new b.R(o,t,t.yaxis,"y_"),t.y_handle.snapid=t.snapid,t.y_handle.draw_swapside=a<0,t.y_handle.draw_ticks=i,t.z_handle=new b.R(o,t,t.zaxis,"z_"),t.z_handle.snapid=t.snapid,t.x_handle.configureAxis("xaxis",t.xmin,t.xmax,t.scale_xmin,t.scale_xmax,!1,[0,r],r,{reverse:!1}),t.x_handle.assignFrameMembers(t,"x"),t.y_handle.configureAxis("yaxis",t.ymin,t.ymax,t.scale_ymin,t.scale_ymax,!0,[f,0],-f,{reverse:!1}),t.y_handle.assignFrameMembers(t,"y"),t.z_handle.configureZAxis("zaxis",t));const _=t.getFrameSvg().selectChild(".axis_layer");t.x_handle.has_obstacle=!1;const z=t.swap_xy?t.y_handle:t.x_handle,x=t.swap_xy?t.x_handle:t.y_handle;let y;if(t.getPadPainter()?._fast_drawing)y=Promise.resolve(!0);else if(t.v6axes){z.disable_ticks=e<=0,x.disable_ticks=i<=0;const H=z.drawAxis(_,r,f,z.invert_side?null:`translate(0,${f})`,e>1?-f:0,!1,void 0,!1,t.getPadPainter().getPadHeight()-f-t.getFrameY()),U=x.drawAxis(_,r,f,x.invert_side?`translate(${r})`:null,i>1?r:0,!1,x.invert_side?0:t._frame_x,!1);y=Promise.all([H,U]).then(()=>t.drawGrids())}else{let C=[];e>0&&C.push(z.drawAxis(_,(0,L.bk)(0,s>0?f:0),s)),i>0&&C.push(x.drawAxis(_,(0,L.bk)(a>0?0:r,f),a)),y=Promise.all(C).then(()=>(C=[],e>1&&C.push(z.drawAxisOtherPlace(_,(0,L.bk)(0,s<0?f:0),-s,2===e)),i>1&&C.push(x.drawAxisOtherPlace(_,(0,L.bk)(a<0?0:r,f),-a,2===i)),Promise.all(C))).then(()=>t.drawGrids())}return y.then(()=>(t.axes_drawn=!0,!0))})()}drawAxes2(t,e){const i=this.getFrameWidth(),s=this.getFrameHeight(),a=this.getPadPainter(),r=this.getFrameSvg().selectChild(".axis_layer");let f,o;return t&&(this.zoom_x2min!==this.zoom_x2max?(this.scale_x2min=this.zoom_x2min,this.scale_x2max=this.zoom_x2max):(this.scale_x2min=this.x2min,this.scale_x2max=this.x2max),this.x2_handle=new b.R(a,this,this.x2axis,"x2_"),this.x2_handle.snapid=this.snapid,this.x2_handle.configureAxis("x2axis",this.x2min,this.x2max,this.scale_x2min,this.scale_x2max,!1,[0,i],i,{reverse:!1}),this.x2_handle.assignFrameMembers(this,"x2"),f=this.x2_handle.drawAxis(r,null,-1)),e&&(this.zoom_y2min!==this.zoom_y2max?(this.scale_y2min=this.zoom_y2min,this.scale_y2max=this.zoom_y2max):(this.scale_y2min=this.y2min,this.scale_y2max=this.y2max),this.y2_handle=new b.R(a,this,this.y2axis,"y2_"),this.y2_handle.snapid=this.snapid,this.y2_handle.configureAxis("y2axis",this.y2min,this.y2max,this.scale_y2min,this.scale_y2max,!0,[s,0],-s,{reverse:!1}),this.y2_handle.assignFrameMembers(this,"y2"),o=this.y2_handle.drawAxis(r,(0,L.bk)(i,s),-1)),Promise.all([f,o])}getGrFuncs(t,e){const i=t&&this.grx2,s=e&&this.gry2;return i||s?{use_x2:i,grx:i?this.grx2:this.grx,x_handle:i?this.x2_handle:this.x_handle,logx:i?this.x2_handle.log:this.x_handle.log,scale_xmin:i?this.scale_x2min:this.scale_xmin,scale_xmax:i?this.scale_x2max:this.scale_xmax,use_y2:s,gry:s?this.gry2:this.gry,y_handle:s?this.y2_handle:this.y_handle,logy:s?this.y2_handle.log:this.y_handle.log,scale_ymin:s?this.scale_y2min:this.scale_ymin,scale_ymax:s?this.scale_y2max:this.scale_ymax,swap_xy:this.swap_xy,fp:this,revertAxis(a,r){return"x"===a&&this.use_x2&&(a="x2"),"y"===a&&this.use_y2&&(a="y2"),this.fp.revertAxis(a,r)},axisAsText(a,r){return"x"===a&&this.use_x2&&(a="x2"),"y"===a&&this.use_y2&&(a="y2"),this.fp.axisAsText(a,r)}}:this}sizeChanged(){const t={};this.v7AttrChange(t,"margins_left",this.fX1NDC),this.v7AttrChange(t,"margins_bottom",this.fY1NDC),this.v7AttrChange(t,"margins_right",1-this.fX2NDC),this.v7AttrChange(t,"margins_top",1-this.fY2NDC),this.v7SendAttrChanges(t,!1),this.redrawPad()}cleanXY(){const t=(e,i)=>{this[e]?.cleanup(),delete this[e],delete this[i]};t("x_handle","grx"),t("y_handle","gry"),t("z_handle","grz"),t("x2_handle","grx2"),t("y2_handle","gry2"),delete this.v6axes}cleanupAxes(){this.cleanXY(),this.draw_g?.selectChild(".axis_layer").selectAll("*").remove(),this.axes_drawn=!1}cleanFrameDrawings(){(0,c.isFunc)(this.create3DScene)&&this.create3DScene(-1),this.cleanupAxes();const t=e=>{this[e+"min"]=this[e+"max"]=0,this[`zoom_${e}min`]=this[`zoom_${e}max`]=0,this[`scale_${e}min`]=this[`scale_${e}max`]=0};t("x"),t("y"),t("z"),t("x2"),t("y2"),this.draw_g?.selectChild(".main_layer").selectAll("*").remove(),this.draw_g?.selectChild(".upper_layer").selectAll("*").remove()}cleanup(){this.cleanFrameDrawings(),this.draw_g&&(this.draw_g.selectAll("*").remove(),this.draw_g.on("mousedown",null).on("dblclick",null).on("wheel",null).on("contextmenu",null).property("interactive_set",null)),this.keys_handler&&(window.removeEventListener("keydown",this.keys_handler,!1),this.keys_handler=null),delete this.enabledKeys,delete this.self_drawaxes,delete this.xaxis,delete this.yaxis,delete this.zaxis,delete this.x2axis,delete this.y2axis,delete this.draw_g,delete this._click_handler,delete this._dblclick_handler;const t=this.getPadPainter();t?.frame_painter_ref===this&&delete t.frame_painter_ref,super.cleanup()}redraw(){const t=this.getPadPainter();t&&(t.frame_painter_ref=this),this.updateAttributes();const e=t?.getPadRect()??{width:10,height:10},i=Math.round(e.width*this.fX1NDC),s=Math.round(e.height*(1-this.fY2NDC));let _,a=Math.round(e.width*(this.fX2NDC-this.fX1NDC)),r=Math.round(e.height*(this.fY2NDC-this.fY1NDC)),f=!1,o=!1;return t?.options&&(t.options.RotateFrame&&(f=!0),t.options.FixFrame&&(o=!0)),f?(_=`rotate(-90,${i},${s}) translate(${i-r},${s})`,[a,r]=[r,a]):_=(0,L.bk)(i,s),this._frame_x=i,this._frame_y=s,this._frame_width=a,this._frame_height=r,this._frame_rotate=f,this._frame_fixpos=o,this._frame_trans=_,this.mode3d?this:this.createFrameG()}createFrameG(){let t,e;this.draw_g=this.getFrameSvg(),this.draw_g.empty()?(this.draw_g=this.getLayerSvg("primitives_layer").append("svg:g").attr("class","root_frame"),this.isBatchMode()||this.draw_g.append("svg:title").text(""),t=this.draw_g.append("svg:rect"),e=this.draw_g.append("svg:svg").attr("class","main_layer").attr("x",0).attr("y",0).attr("overflow","hidden"),this.draw_g.append("svg:g").attr("class","axis_layer"),this.draw_g.append("svg:g").attr("class","upper_layer")):(t=this.draw_g.selectChild("rect"),e=this.draw_g.selectChild(".main_layer")),this.axes_drawn=!1,this.draw_g.attr("transform",this._frame_trans),t.attr("x",0).attr("y",0).attr("width",this._frame_width).attr("height",this._frame_height).attr("rx",this.lineatt.rx||null).attr("ry",this.lineatt.ry||null).call(this.fillatt.func).call(this.lineatt.func),e.attr("width",this._frame_width).attr("height",this._frame_height).attr("viewBox",`0 0 ${this._frame_width} ${this._frame_height}`);let i=Promise.resolve(!0);return this.v7EvalAttr("drawAxes")&&(this.self_drawaxes=!0,this.setAxesRanges(),i=this.drawAxes().then(()=>this.addInteractivity())),i.then(()=>this)}getFrameX(){return this._frame_x||0}getFrameY(){return this._frame_y||0}getFrameWidth(){return this._frame_width||0}getFrameHeight(){return this._frame_height||0}getFrameRect(){return{x:this._frame_x||0,y:this._frame_y||0,width:this.getFrameWidth(),height:this.getFrameHeight(),transform:this.draw_g?.attr("transform")||"",hint_delta_x:0,hint_delta_y:0}}getHistPalette(){return this.getPadPainter().getHistPalette()}configureUserClickHandler(t){this._click_handler=(0,c.isFunc)(t)?t:null}configureUserDblclickHandler(t){this._dblclick_handler=(0,c.isFunc)(t)?t:null}zoom(t,e,i,s,a,r,f){var o=this;return(0,S.A)(function*(){if(o.projection)return!1;"x"===t?(t=e,e=i,f=s,i=s=void 0):"y"===t?(f=s,s=i,i=e,t=e=void 0):"z"===t&&(f=s,a=e,r=i,t=e=i=s=void 0);let _=t!==e,z=i!==s,x=a!==r,y=!1,C=!1,k=!1;if(_){let N=0;t<=o.xmin&&(t=o.xmin,N++),e>=o.xmax&&(e=o.xmax,N++),2===N&&(_=!1,y=!0)}else y=t===e&&0===t;if(z){let N=0;i<=o.ymin&&(i=o.ymin,N++),s>=o.ymax&&(s=o.ymax,N++),2===N&&(z=!1,C=!0)}else C=i===s&&0===i;if(x){let N=0;a<=o.zmin&&(a=o.zmin,N++),r>=o.zmax&&(r=o.zmax,N++),2===N&&(x=!1,k=!0)}else k=a===r&&0===a;let T=!1,H="",U="",X="",Y=!1;const j={_typename:`${c.nsREX}RFrame::RUserRanges`,values:[0,0,0,0,0,0],flags:[!1,!1,!1,!1,!1,!1]},V=(N,Z)=>{!Z&&!(0,c.isFunc)(N.canZoomInside)||(Y=!0,_&&(Z||N.canZoomInside("x",t,e))&&(o.zoom_xmin=t,o.zoom_xmax=e,T=!0,H="0",_=!1,j.values[0]=t,j.values[1]=e,j.flags[0]=j.flags[1]=!0,f&&o.zoomChangedInteractive("x",f)),z&&(Z||N.canZoomInside("y",i,s))&&(o.zoom_ymin=i,o.zoom_ymax=s,T=!0,U="1",z=!1,j.values[2]=i,j.values[3]=s,j.flags[2]=j.flags[3]=!0,f&&o.zoomChangedInteractive("y",f)),x&&(Z||N.canZoomInside("z",a,r))&&(o.zoom_zmin=a,o.zoom_zmax=r,T=!0,X="2",x=!1,j.values[4]=a,j.values[5]=r,j.flags[4]=j.flags[5]=!0,f&&o.zoomChangedInteractive("z",f)))};return(_||z||x)&&o.forEachPainter(N=>V(N)),!Y&&o.self_drawaxes&&V(null,!0),(y||C||k)&&(y&&(o.zoom_xmin!==o.zoom_xmax&&(T=!0,H="0"),o.zoom_xmin=o.zoom_xmax=0,j.values[0]=j.values[1]=-1,f&&o.zoomChangedInteractive("x",f)),C&&(o.zoom_ymin!==o.zoom_ymax&&(T=!0,U="1"),o.zoom_ymin=o.zoom_ymax=0,j.values[2]=j.values[3]=-1,f&&o.zoomChangedInteractive("y",f)),k&&(o.zoom_zmin!==o.zoom_zmax&&(T=!0,X="2"),o.zoom_zmin=o.zoom_zmax=0,j.values[4]=j.values[5]=-1,f&&o.zoomChangedInteractive("z",f))),!!T&&(o.v7NormalMode()&&o.v7SubmitRequest("zoom",{_typename:`${c.nsREX}RFrame::RZoomRequest`,ranges:j}),o.interactiveRedraw("pad","zoom"+H+U+X).then(()=>!0))})()}zoomSingle(t,e,i,s){var a=this;return(0,S.A)(function*(){const f=["x","y","z","x2","y2"].indexOf(t);if(a.projection||!a[`${t}_handle`]&&"z"!==t||f<0)return!1;let o=e!==i,_=!1;if(o){let k=0;e<=a[t+"min"]&&(e=a[t+"min"],k++),i>=a[t+"max"]&&(i=a[t+"max"],k++),2===k&&(o=!1,_=!0)}else _=e===i&&0===e;let z=!1,x=!1;const y={_typename:`${c.nsREX}RFrame::RUserRanges`,values:[0,0,0,0,0,0,0,0,0,0],flags:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1]},C=(k,T)=>{!T&&!(0,c.isFunc)(k?.canZoomInside)||(x=!0,o&&(T||k.canZoomInside(t[0],e,i))&&(a[`zoom_${t}min`]=e,a[`zoom_${t}max`]=i,z=!0,o=!1,y.values[2*f]=e,y.values[2*f+1]=i,y.flags[2*f]=y.flags[2*f+1]=!0))};return o&&a.forEachPainter(k=>C(k)),!x&&a.self_drawaxes&&C(null,!0),_&&(a[`zoom_${t}min`]!==a[`zoom_${t}max`]&&(z=!0),a[`zoom_${t}min`]=a[`zoom_${t}max`]=0,y.values[2*f]=y.values[2*f+1]=-1),!!z&&(s&&a.zoomChangedInteractive(t,s),a.v7NormalMode()&&a.v7SubmitRequest("zoom",{_typename:`${c.nsREX}RFrame::RZoomRequest`,ranges:y}),a.interactiveRedraw("pad",`zoom${f}`).then(()=>!0))})()}unzoomSingle(t,e){var i=this;return(0,S.A)(function*(){return i.zoomSingle(t,0,0,typeof e>"u"?"unzoom":e)})()}isAxisZoomed(t){return this[`zoom_${t}min`]!==this[`zoom_${t}max`]}unzoom(t,e,i){var s=this;return(0,S.A)(function*(){return"all"===t?s.unzoom("x2").then(()=>s.unzoom("y2")).then(()=>s.unzoom("xyz")):"x2"===t||"y2"===t?s.unzoomSingle(t):(typeof t>"u"?t=e=i=!0:(0,c.isStr)(t)&&(i=t.indexOf("z")>=0,e=t.indexOf("y")>=0,t=t.indexOf("x")>=0),s.zoom(t?0:void 0,t?0:void 0,e?0:void 0,e?0:void 0,i?0:void 0,i?0:void 0,"unzoom"))})()}resetZoom(){["x","y","z","x2","y2"].forEach(t=>{this[`zoom_${t}min`]=void 0,this[`zoom_${t}max`]=void 0,this[`zoom_changed_${t}`]=void 0})}zoomChangedInteractive(t,e){if("reset"===t)return void(this.zoom_changed_x=this.zoom_changed_y=this.zoom_changed_z=void 0);if(!t||"any"===t)return this.zoom_changed_x||this.zoom_changed_y||this.zoom_changed_z;if("x"!==t&&"y"!==t&&"z"!==t)return;const i="zoom_changed_"+t;if(void 0===e)return this[i];"unzoom"!==e?e&&(this[i]=!0):this[i]=void 0===this[i]}fillObjectOfflineMenu(t,e){"x"!==e&&"y"!==e||t.add("Unzoom",()=>this.unzoom(e))}changeFrameAttr(t,e){const i={};this.v7AttrChange(i,t,e),this.v7SetAttr(t,e),this.v7SendAttrChanges(i,!1),this.redrawPad()}fillContextMenu(t,e,i){if("pal"===e&&(e="z"),"x"===e||"y"===e||"x2"===e||"y2"===e){const r=this[e+"_handle"],f=i||this[e+"axis"];if(!r)return!1;if(t.header(`${e.toUpperCase()} axis`,`${c.urlClassPrefix}ROOT_1_1Experimental_1_1RAxisBase.html`),(0,c.isFunc)(f?.TestBit)){const o=this.getMainPainter(!0);return t.addTAxisMenu(h.rb,o||this,f,e),!0}return r.fillAxisContextMenu(t,e)}const s=0===t.size();s?t.header("Frame",`${c.urlClassPrefix}ROOT_1_1Experimental_1_1RFrame.html`):t.separator(),this.zoom_xmin!==this.zoom_xmax&&t.add("Unzoom X",()=>this.unzoom("x")),this.zoom_ymin!==this.zoom_ymax&&t.add("Unzoom Y",()=>this.unzoom("y")),this.zoom_zmin!==this.zoom_zmax&&t.add("Unzoom Z",()=>this.unzoom("z")),this.zoom_x2min!==this.zoom_x2max&&t.add("Unzoom X2",()=>this.unzoom("x2")),this.zoom_y2min!==this.zoom_y2max&&t.add("Unzoom Y2",()=>this.unzoom("y2")),t.add("Unzoom all",()=>this.unzoom("all")),t.separator(),t.addchk(this.isTooltipAllowed(),"Show tooltips",()=>this.setTooltipAllowed("toggle")),this.x_handle&&t.addchk(this.x_handle.draw_grid,"Grid x",r=>this.changeFrameAttr("gridX",r)),this.y_handle&&t.addchk(this.y_handle.draw_grid,"Grid y",r=>this.changeFrameAttr("gridY",r)),this.x_handle&&!this.x2_handle&&t.addchk(this.x_handle.draw_swapside,"Swap x",r=>this.changeFrameAttr("swapX",r)),this.y_handle&&!this.y2_handle&&t.addchk(this.y_handle.draw_swapside,"Swap y",r=>this.changeFrameAttr("swapY",r)),this.x_handle&&!this.x2_handle&&(t.sub("Ticks x"),t.addchk(0===this.x_handle.draw_ticks,"off",()=>this.changeFrameAttr("ticksX",0)),t.addchk(1===this.x_handle.draw_ticks,"normal",()=>this.changeFrameAttr("ticksX",1)),t.addchk(2===this.x_handle.draw_ticks,"ticks on both sides",()=>this.changeFrameAttr("ticksX",2)),t.addchk(3===this.x_handle.draw_ticks,"labels on both sides",()=>this.changeFrameAttr("ticksX",3)),t.endsub()),this.y_handle&&!this.y2_handle&&(t.sub("Ticks y"),t.addchk(0===this.y_handle.draw_ticks,"off",()=>this.changeFrameAttr("ticksY",0)),t.addchk(1===this.y_handle.draw_ticks,"normal",()=>this.changeFrameAttr("ticksY",1)),t.addchk(2===this.y_handle.draw_ticks,"ticks on both sides",()=>this.changeFrameAttr("ticksY",2)),t.addchk(3===this.y_handle.draw_ticks,"labels on both sides",()=>this.changeFrameAttr("ticksY",3)),t.endsub()),t.addAttributesMenu(this,s?"":"Frame "),t.separator(),t.sub("Save as");const a=["svg","png","jpeg","webp"];return c.internals.makePDF&&a.push("pdf"),a.forEach(r=>t.add(`frame.${r}`,()=>this.getPadPainter().saveAs(r,"frame",`frame.${r}`))),t.endsub(),!0}revertAxis(t,e){return this[`${t}_handle`]?.revertPoint(e)??0}showAxisStatus(t,e){const i=t,a=(0,B.Wn)(e,this.getFrameSvg().node());let r="x"===t?0:1;this.swap_xy&&(r=1-r);const f=this.revertAxis(t,a[r]);this.showObjectStatus(i,"axis",`${t} : ${this.axisAsText(t,f)}`,`${Math.round(a[0])},${Math.round(a[1])}`)}addKeysHandler(){this.isBatchMode()||(l.wM.assign(this),this.addFrameKeysHandler())}addInteractivity(t){return!(!this.isBatchMode()&&(c.settings.Zooming||c.settings.ContextMenu))||(l.wM.assign(this),t||this.addBasicInteractivity(),this.addFrameInteractivity(t))}setRootPadRange(){}toggleAxisLog(t){return this[t+"_handle"]?.changeAxisLog("toggle")}}var n=R(7900),m=R(5102);class u extends p.D{constructor(t,e,i){super(t,e,"","pad"),this.pad=e,this.iscan=i,this.this_pad_name="",!this.iscan&&null!==e&&(this.this_pad_name=e.fObjectID?"pad"+e.fObjectID:"ppp"+c.internals.id_counter++),this.painters=[],this.has_canvas=!0,this.forEachPainter=this.forEachPainterInPad;const s=this.selectDom();!s.empty()&&s.property("_batch_mode")&&(this.batch_mode=!0)}isBatchMode(){return void 0!==this.batch_mode?this.batch_mode:!!(0,c.isBatchMode)()||!(this.iscan||!this.has_canvas)&&this.getCanvPainter()?.isBatchMode()}isRoot6(){return!1}isEditable(){return!0}svg_this_pad(){return this.getPadSvg(this.this_pad_name)}getMainPainter(){return this.main_painter_ref||null}setMainPainter(t,e){(!this.main_painter_ref||e)&&(this.main_painter_ref=t)}cleanup(){this._doing_draw&&console.error("pad drawing is not completed when cleanup is called"),this.painters.forEach(e=>e.cleanup());const t=this.svg_this_pad();t.empty()||(t.property("pad_painter",null),this.iscan||t.remove()),delete this.main_painter_ref,delete this.frame_painter_ref,delete this.pads_cache,delete this._pad_x,delete this._pad_y,delete this._pad_width,delete this._pad_height,delete this._doing_draw,delete this._dfltRFont,this.painters=[],this.pad=null,this.draw_object=null,this.pad_frame=null,this.this_pad_name=void 0,this.has_canvas=!1,(0,D.QD)({pp:this,active:!1}),super.cleanup()}getFramePainter(){return this.frame_painter_ref}getPadWidth(){return this._pad_width||0}getPadHeight(){return this._pad_height||0}getPadLog(t){return!1}getPadRect(){return{x:this._pad_x||0,y:this._pad_y||0,width:this.getPadWidth(),height:this.getPadHeight()}}getFrameRect(){const t=this.getFramePainter();if(t)return t.getFrameRect();const e=this.getPadWidth(),i=this.getPadHeight(),s={};return s.szx=Math.round(.5*e),s.szy=Math.round(.5*i),s.width=2*s.szx,s.height=2*s.szy,s.x=Math.round(e/2-s.szx),s.y=Math.round(i/2-s.szy),s.hint_delta_x=s.szx,s.hint_delta_y=s.szy,s.transform=(0,L.bk)(s.x,s.y)||"",s}getRootPad(t){return void 0!==t&&t?null:this.pad}cleanPrimitives(t){if(!0===t&&(t=()=>!0),(0,c.isFunc)(t))for(let e=this.painters.length-1;e>=0;--e)t(this.painters[e])&&(this.painters[e].cleanup(),this.painters.splice(e,1))}divide(){var t=this;return(0,S.A)(function*(){return console.warn("RPadPainter.divide not implemented"),t})()}removePrimitive(t,e){let i=-1,s=null;if(Number.isInteger(t)?(i=t,s=this.painters[i]):(i=this.painters.indexOf(t),s=t),i<0)return i;const a=[];let r=i-1;a.push(s),this.painters.splice(i,1);let f=0;for(;f<a.length;){for(let o=this.painters.length-1;o>=0;--o)this.painters[o].isSecondary(a[f])&&(a.push(this.painters[o]),this.painters.splice(o,1),o<=i&&r--);f++}return a.forEach(o=>{(o!==s||!e)&&o.cleanup(),this.main_painter_ref===o&&(delete this.main_painter_ref,r=-111)}),r}findInPrimitives(t,e){return console.warn("findInPrimitives not implemented for RPad"),null}findPainterFor(t,e,i){return this.painters.find(s=>{const a=s.getObject();return!(!a||(!t||a!==t)&&(!e&&!i||e&&a.fName!==e||i&&a._typename!==i))})}getHistPalette(){const t=this.findPainterFor(void 0,void 0,`${c.nsREX}RPaletteDrawable`);return t?t.getHistPalette():(this.fDfltPalette||(this.fDfltPalette={_typename:`${c.nsREX}RPalette`,fColors:[{fOrdinal:0,fColor:{fColor:"rgb(53, 42, 135)"}},{fOrdinal:.125,fColor:{fColor:"rgb(15, 92, 221)"}},{fOrdinal:.25,fColor:{fColor:"rgb(20, 129, 214)"}},{fOrdinal:.375,fColor:{fColor:"rgb(6, 164, 202)"}},{fOrdinal:.5,fColor:{fColor:"rgb(46, 183, 164)"}},{fOrdinal:.625,fColor:{fColor:"rgb(135, 191, 119)"}},{fOrdinal:.75,fColor:{fColor:"rgb(209, 187, 89)"}},{fOrdinal:.875,fColor:{fColor:"rgb(254, 200, 50)"}},{fOrdinal:1,fColor:{fColor:"rgb(249, 251, 14)"}}],fInterpolate:!0,fNormalized:!0},(0,c.addMethods)(this.fDfltPalette,`${c.nsREX}RPalette`)),this.fDfltPalette)}getNumPainters(){return this.painters.length}forEachPainterInPad(t,e){e||(e="all"),"objects"!==e&&t(this);for(let i=0;i<this.painters.length;++i){const s=this.painters[i];(0,c.isFunc)(s.forEachPainterInPad)?"objects"!==e&&s.forEachPainterInPad(t,e):"pads"!==e&&t(s)}}registerForPadEvents(t){this.pad_events_receiver=t}producePadEvent(t,e,i,s){"select"===t&&(0,c.isFunc)(this.selectActivePad)&&this.selectActivePad(e,i,s),(0,c.isFunc)(this.pad_events_receiver)&&this.pad_events_receiver({what:t,padpainter:e,painter:i,position:s})}selectObjectPainter(t,e){const i=this.iscan||!this.has_canvas,s=i?this:this.getCanvPainter();void 0===t&&(t=this),e&&!i&&(e=(0,L.md)(this.svg_this_pad(),e)),(0,D.QD)({pp:this,active:!0}),s.producePadEvent("select",this,t,e)}setFastDrawing(t,e){const i=this._fast_drawing;this._fast_drawing=c.settings.SmallPad&&(t<c.settings.SmallPad.width||e<c.settings.SmallPad.height),i!==this._fast_drawing&&this.showPadButtons()}isGrayscale(){return!1}setGrayscale(){console.error("grayscale mode not implemented for RCanvas")}createCanvasSvg(t,e){let f,o,s=null,a=null,r=null;if(t>0){if(this._fixed_size)return t>1;if(a=this.getCanvSvg(),a.empty()||(s=a.property("height_factor"),r=this.testMainResize(t,null,s),!r.changed&&1===t))return!1;this.isBatchMode()||(f=this.getLayerSvg("btns_layer",this.this_pad_name)),o=a.selectChild(".canvas_fillrect")}else{const _=this.selectDom();"static"===_.style("position")&&_.style("position","relative"),a=_.append("svg").attr("class","jsroot root_canvas").property("pad_painter",this).property("redraw_by_resize",!1),this.setTopPainter(),!this.isBatchMode()&&!this.online_canvas&&a.append("svg:title").text("ROOT canvas"),o=a.append("svg:path").attr("class","canvas_fillrect"),this.isBatchMode()||o.style("pointer-events","visibleFill").on("dblclick",z=>this.enlargePad(z,!0)).on("click",()=>this.selectObjectPainter(this,null)).on("mouseenter",()=>this.showObjectStatus()).on("contextmenu",c.settings.ContextMenu?z=>this.padContextMenu(z):null),a.append("svg:g").attr("class","primitives_layer"),a.append("svg:g").attr("class","info_layer"),this.isBatchMode()||(f=a.append("svg:g").attr("class","btns_layer").property("leftside","left"===c.settings.ToolBarSide).property("vertical",c.settings.ToolBarVert)),s=.66,this.pad&&this.pad.fWinSize[0]&&this.pad.fWinSize[1]&&(s=this.pad.fWinSize[1]/this.pad.fWinSize[0],(s<.1||s>10)&&(s=.66)),this._fixed_size?(_.style("overflow","auto"),r={width:this.pad.fWinSize[0],height:this.pad.fWinSize[1]},(!r.width||!r.height)&&(r=(0,L.xh)(_))):r=this.testMainResize(2,e,s)}return this.createAttFill({pattern:1001,color:0}),r.width<=5||r.height<=5?(a.style("display","none"),console.warn(`Hide canvas while geometry too small w=${r.width} h=${r.height}`),r.width=200,r.height=100):a.style("display",null),this._fixed_size?a.attr("x",0).attr("y",0).attr("width",r.width).attr("height",r.height).style("position","absolute"):a.attr("x",0).attr("y",0).style("width","100%").style("height","100%").style("position","absolute").style("left",0).style("top",0).style("bottom",0).style("right",0),a.style("filter",c.settings.DarkMode?"invert(100%)":null),a.attr("viewBox",`0 0 ${r.width} ${r.height}`).attr("preserveAspectRatio","none").property("height_factor",s).property("draw_x",0).property("draw_y",0).property("draw_width",r.width).property("draw_height",r.height),this._pad_x=0,this._pad_y=0,this._pad_width=r.width,this._pad_height=r.height,o.attr("d",`M0,0H${r.width}V${r.height}H0Z`).call(this.fillatt.func),this.setFastDrawing(r.width,r.height),this.alignButtons&&f&&this.alignButtons(f,r.width,r.height),!0}drawItemNameOnCanvas(){}enlargePad(t,e,i){if(t?.preventDefault(),t?.stopPropagation(),e&&this._websocket&&"off"===this.enlargeMain("state"))return;const s=this.getCanvSvg(),a=s.property("pad_enlarged");if(!this.iscan&&this.has_canvas&&(a||this.hasObjectsToDraw()||this.painters))a||i?a===this.pad?(this.enlargeMain(!1),s.property("pad_enlarged",null)):!i&&e&&console.error("missmatch with pad double click events"):(this.enlargeMain(!0,!0),s.property("pad_enlarged",this.pad),(0,D.QD)({pp:this,active:!0}));else{if(this._fixed_size||!this.enlargeMain(!i&&"toggle"))return;"off"===this.enlargeMain("state")?s.property("pad_enlarged",null):(0,D.QD)({pp:this,active:!0})}return this.checkResize(!0)}createPadSvg(t){if(!this.has_canvas)return this.createCanvasSvg(t?2:0),!0;const e=this.getPadSvg(this.pad_name),i=this.getCanvSvg(),s=e.property("draw_width"),a=e.property("draw_height"),r=i.property("pad_enlarged");let f=!0,o=s,_=a,z=0,x=0,y=null,C=null,k=null;return this.pad?.fPos&&this.pad?.fSize&&(z=Math.round(s*this.pad.fPos.fHoriz.fArr[0]),x=Math.round(a*this.pad.fPos.fVert.fArr[0]),o=Math.round(s*this.pad.fSize.fHoriz.fArr[0]),_=Math.round(a*this.pad.fSize.fVert.fArr[0])),r&&(f=!1,r===this.pad?f=!0:this.forEachPainterInPad(T=>{T.getObject()===r&&(f=!0)},"pads"),f&&(o=s,_=a,z=x=0)),t?(y=this.svg_this_pad(),C=y.selectChild(".root_pad_border"),this.isBatchMode()||(k=this.getLayerSvg("btns_layer",this.this_pad_name)),this.addPadInteractive(!0)):(y=e.selectChild(".primitives_layer").append("svg:svg").classed("__root_pad_"+this.this_pad_name,!0).attr("pad",this.this_pad_name).property("pad_painter",this),this.isBatchMode()||y.append("svg:title").text("ROOT subpad"),C=y.append("svg:path").attr("class","root_pad_border"),y.append("svg:g").attr("class","primitives_layer"),this.isBatchMode()||(k=y.append("svg:g").attr("class","btns_layer").property("leftside","left"!==c.settings.ToolBarSide).property("vertical",c.settings.ToolBarVert)),c.settings.ContextMenu&&C.on("contextmenu",T=>this.padContextMenu(T)),this.isBatchMode()||C.style("pointer-events","visibleFill").on("dblclick",T=>this.enlargePad(T,!0)).on("click",()=>this.selectObjectPainter(this,null)).on("mouseenter",()=>this.showObjectStatus())),this.createAttFill({attr:this.pad}),this.createAttLine({attr:this.pad,color0:0===this.pad.fBorderMode?"none":""}),y.style("display",f?null:"none").attr("viewBox",`0 0 ${o} ${_}`).attr("preserveAspectRatio","none").attr("x",z).attr("y",x).attr("width",o).attr("height",_).property("draw_x",z).property("draw_y",x).property("draw_width",o).property("draw_height",_),this._pad_x=z,this._pad_y=x,this._pad_width=o,this._pad_height=_,C.attr("d",`M0,0H${o}V${_}H0Z`).call(this.fillatt.func).call(this.lineatt.func),this.setFastDrawing(o,_),y.property("can3d")===c.constants.Embed3D.Overlay&&this.selectDom().select(".draw3d_"+this.this_pad_name).style("display",f?"":"none"),this.alignButtons&&k&&this.alignButtons(k,o,_),f}addPadInteractive(t=!1){(0,c.isFunc)(this.$userInteractive)&&(this.$userInteractive(),delete this.$userInteractive)}hasObjectsToDraw(){return this.pad?.fPrimitives?.find(t=>t._typename!==`${c.nsREX}RPadDisplayItem`)}syncDraw(t){const e={kind:t||"redraw"};return void 0===this._doing_draw?(this._doing_draw=[e],Promise.resolve(!0)):!(!0!==e.kind&&this._doing_draw.findIndex((i,s)=>s>0&&i.kind===e.kind)>0)&&(this._doing_draw.push(e),new Promise(i=>{e.func=i}))}confirmDraw(){if(void 0===this._doing_draw)return console.warn("failure, should not happen");if(this._doing_draw.shift(),0===this._doing_draw.length)delete this._doing_draw;else{const t=this._doing_draw[0];t.func&&(t.func(),delete t.func)}}drawObject(){return(0,S.A)(function*(){return console.log("Not possible to draw object without loading of draw.mjs"),null})()}drawPrimitives(t){var e=this;return(0,S.A)(function*(){if(void 0===t)return e.iscan&&(e._start_tm=(new Date).getTime()),e._num_primitives=e.pad?.fPrimitives?.length??0,e.syncDraw(!0).then(()=>e.drawPrimitives(0));if(e.pad&&!(t>=e._num_primitives))return e.drawObject(e,e.pad.fPrimitives[t],"").then(i=>((0,c.isObject)(i)&&(i._primitive=!0),e.drawPrimitives(t+1)));if(e.confirmDraw(),e._start_tm){const i=(new Date).getTime()-e._start_tm;i>3e3&&console.log(`Canvas drawing took ${(.001*i).toFixed(2)}s`),delete e._start_tm}})()}processPadTooltipEvent(t){const e=[],i=[];return this.painters?.forEach(s=>{(0,c.isFunc)(s.processTooltipEvent)&&e.push(s)}),t&&(t.nproc=e.length),e.forEach(s=>{const a=s.processTooltipEvent(t)||{user_info:null};i.push(a),t?.painters&&(a.painter=s)}),i}changeDarkMode(t){this.getCanvSvg().style("filter",t??c.settings.DarkMode?"invert(100%)":null)}fillContextMenu(t){const e=this.iscan?"RCanvas":"RPad";t.header(e,`${c.urlClassPrefix}ROOT_1_1Experimental_1_1${e}.html`),t.addchk(this.isTooltipAllowed(),"Show tooltips",()=>this.setTooltipAllowed("toggle")),this._websocket||(t.addAttributesMenu(this),this.iscan&&t.addSettingsMenu(!1,!1,s=>{"dark"===s&&this.changeDarkMode()})),t.separator(),(0,c.isFunc)(this.hasMenuBar)&&(0,c.isFunc)(this.actiavteMenuBar)&&t.addchk(this.hasMenuBar(),"Menu bar",s=>this.actiavteMenuBar(s)),(0,c.isFunc)(this.hasEventStatus)&&(0,c.isFunc)(this.activateStatusBar)&&(0,c.isFunc)(this.canStatusBar)&&this.canStatusBar()&&t.addchk(this.hasEventStatus(),"Event status",()=>this.activateStatusBar("toggle")),(this.enlargeMain()||this.has_canvas&&this.hasObjectsToDraw())&&t.addchk("on"===this.enlargeMain("state"),"Enlarge "+(this.iscan?"canvas":"pad"),()=>this.enlargePad());const i=this.this_pad_name||(this.iscan?"canvas":"pad");return t.sub("Save as"),["svg","png","jpeg","pdf","webp"].forEach(s=>t.add(`${i}.${s}`,()=>this.saveAs(s,this.iscan,`${i}.${s}`))),t.endsub(),!0}padContextMenu(t){t.stopPropagation&&(t.stopPropagation(),t.preventDefault(),this.getFramePainter()?.setLastEventPos()),(0,n.ES)(t,this).then(e=>(this.fillContextMenu(e),this.fillObjectExecMenu(e))).then(e=>e.show())}redrawLegend(){return(0,S.A)(function*(){})()}redrawPad(t){var e=this;return(0,S.A)(function*(){const i=e.syncDraw(t);if(!1===i)return console.log("Prevent RPad redrawing"),!1;let s=!0;const a=r=>{for(;r<e.painters.length;){const f=e.painters[r++];let o=0;if((s||f.this_pad_name)&&(o=f.redraw(t)),(0,c.isPromise)(o))return o.then(()=>a(r))}return!0};return i.then(()=>(e.iscan?e.createCanvasSvg(2):s=e.createPadSvg(!0),a(0))).then(()=>(e.addPadInteractive(),(0,D.OZ)()===e&&e.getCanvPainter()?.producePadEvent("padredraw",e),e.confirmDraw(),!0))})()}redraw(t){return this.redrawPad(t)}needRedrawByResize(){const t=this.svg_this_pad();if(!t.empty()&&t.property("can3d")===c.constants.Embed3D.Overlay)return!0;for(let e=0;e<this.painters.length;++e)if((0,c.isFunc)(this.painters[e].needRedrawByResize)&&this.painters[e].needRedrawByResize())return!0;return!1}checkCanvasResize(t,e){if(this._ignore_resize||!this.iscan&&this.has_canvas)return!1;const i=this.syncDraw("canvas_resize");if(!1===i)return!1;(!0===t||!1===t)&&(e=t,t=null),(0,c.isObject)(t)&&t.force&&(e=!0),e||(e=this.needRedrawByResize());let s=!1;const a=r=>!s||r>=this.painters.length?(this.confirmDraw(),s):(0,c.getPromise)(this.painters[r].redraw(e?"redraw":"resize")).then(()=>a(r+1));return i.then(()=>(s=this.createCanvasSvg(e?2:1,t),s&&this.iscan&&this.pad&&this.online_canvas&&!this.embed_canvas&&!this.isBatchMode()&&(this._resize_tmout&&clearTimeout(this._resize_tmout),this._resize_tmout=setTimeout(()=>{if(delete this._resize_tmout,!this.pad?.fWinSize)return;const r=this.getPadWidth(),f=this.getPadHeight();r>0&&f>0&&(this.pad.fWinSize[0]!==r||this.pad.fWinSize[1]!==f)&&(this.pad.fWinSize[0]=r,this.pad.fWinSize[1]=f,this.sendWebsocket(`RESIZED:[${r},${f}]`))},1e3)),a(0)))}updateObject(t){return!!t&&(this.pad.fStyle=t.fStyle,this.pad.fAttr=t.fAttr,this.iscan?(this.pad.fTitle=t.fTitle,this.pad.fWinSize=t.fWinSize):(this.pad.fPos=t.fPos,this.pad.fSize=t.fSize),!0)}addObjectPainter(t,e,i){t&&e&&e[i]&&void 0===t.snapid&&(this.painters.indexOf(t)<0&&this.painters.push(t),t.assignSnapId(e[i].fObjectID),t.rstyle||(t.rstyle=e[i].fStyle||this.rstyle))}extractTObjectProp(t){if(t.fColIndex&&t.fColValue){const a=this.root_colors||(0,G.HG)();for(let r=0;r<t.fColIndex.length;++r)a[t.fColIndex[r]]=(0,G.Nj)(t.fColValue[r])}const e=new p.D,i=t.fObject;e.assignObject(t),e.csstype=t.fCssType,e.rstyle=t.fStyle,t.fOption=e.v7EvalAttr("options","");const s=(a,r)=>{const f=e.v7EvalColor(r,"");f&&(i[a]=(0,G.nM)(f,this.root_colors))};void 0!==i.fLineColor&&void 0!==i.fLineWidth&&void 0!==i.fLineStyle&&(s("fLineColor","line_color"),i.fLineWidth=e.v7EvalAttr("line_width",i.fLineWidth),i.fLineStyle=e.v7EvalAttr("line_style",i.fLineStyle)),void 0!==i.fFillColor&&void 0!==i.fFillStyle&&(s("fFillColor","fill_color"),i.fFillStyle=e.v7EvalAttr("fill_style",i.fFillStyle)),void 0!==i.fMarkerColor&&void 0!==i.fMarkerStyle&&void 0!==i.fMarkerSize&&(s("fMarkerColor","marker_color"),i.fMarkerStyle=e.v7EvalAttr("marker_style",i.fMarkerStyle),i.fMarkerSize=e.v7EvalAttr("marker_size",i.fMarkerSize)),void 0!==i.fTextColor&&void 0!==i.fTextAlign&&void 0!==i.fTextAngle&&void 0!==i.fTextSize&&(s("fTextColor","text_color"),i.fTextAlign=e.v7EvalAttr("text_align",i.fTextAlign),i.fTextAngle=e.v7EvalAttr("text_angle",i.fTextAngle),i.fTextSize=e.v7EvalAttr("text_size",i.fTextSize))}drawNextSnap(t,e){var i=this;return(0,S.A)(function*(){if(void 0===e&&(e=-1,i._snaps_map={},i._num_primitives=t?t.length:0,i._auto_color_cnt=0),delete i.next_rstyle,++e,!t||e>=t.length)return delete i._snaps_map,delete i._auto_color_cnt,i;const s=t[e],a=s.fObjectID;let r=i._snaps_map[a],f=null;if(r?r++:r=1,i._snaps_map[a]=r,s.fDummy)return i.drawNextSnap(t,e);for(let o=0;o<i.painters.length;++o)if(i.painters[o].snapid===a&&0==--r){f=i.painters[o];break}if(f){if(s._typename===`${c.nsREX}RPadDisplayItem`)return f.redrawPadSnap(s).then(_=>(i.addObjectPainter(_,t,e),i.drawNextSnap(t,e)));let o;return s._typename===`${c.nsREX}TObjectDisplayItem`&&i.extractTObjectProp(s),f.updateObject(s.fDrawable||s.fObject||s,s.fOption||"",!0)&&(o=f.redraw()),(0,c.getPromise)(o).then(()=>i.drawNextSnap(t,e))}if(s._typename===`${c.nsREX}RPadDisplayItem`){const _=new u(i,s,!1);return _.decodeOptions(""),_.addToPadPrimitives(),_.assignSnapId(s.fObjectID),_.rstyle=s.fStyle,_.createPadSvg(),s.fPrimitives&&s.fPrimitives.length>0&&_.addPadButtons(),_.drawNextSnap(s.fPrimitives).then(()=>(_.addPadInteractive(),i.drawNextSnap(t,e)))}if(i.next_rstyle=t[e].fStyle||i.rstyle,s._typename===`${c.nsREX}TObjectDisplayItem`){const o={kNone:0,kObject:1,kColors:4,kStyle:5,kPalette:6};if(s.fKind===o.kStyle)return Object.assign(c.gStyle,s.fObject),i.drawNextSnap(t,e);if(s.fKind===o.kColors){const _=[],z=s.fObject.arr;for(let x=0;x<z.length;++x){const y=z[x].fString,C=y.indexOf("=");C>0&&(_[parseInt(y.slice(0,C))]=(0,G.Nj)(y.slice(C+1)))}return i.root_colors=_,i.drawNextSnap(t,e)}if(s.fKind===o.kPalette){const _=s.fObject.arr,z=[];for(let x=0;x<_.length;++x)z[x]=_[x].fString;return i.custom_palette=new G.rE(z),i.drawNextSnap(t,e)}if(!i.getFramePainter())return i.drawObject(i,{_typename:c.clTFrame,$dummy:!0},"").then(()=>i.drawNextSnap(t,e-1));i.extractTObjectProp(s)}return i.drawObject(i,s.fDrawable||s.fObject||s,s.fOption||"").then(o=>(i.addObjectPainter(o,t,e),i.drawNextSnap(t,e)))})()}findSnap(t,e){function i(s){return!(!s||!(0,c.isStr)(s))&&(s===t||e&&s.length>t.length&&s.indexOf(t)===s.length-t.length)}if(i(this.snapid))return this;if(!this.painters)return null;for(let s=0;s<this.painters.length;++s){let a=this.painters[s];if(!e&&(0,c.isFunc)(a.findSnap)?a=a.findSnap(t):i(a.snapid)||(a=null),a)return a}return null}redrawPadSnap(t){var e=this;return(0,S.A)(function*(){if(!t||!t.fPrimitives)return e;if(e.iscan&&e._websocket&&t.fTitle&&!e.embed_canvas&&typeof document<"u"&&(document.title=t.fTitle),void 0===e.snapid){e.assignSnapId(t.fObjectID),e.draw_object=t,e.pad=t,e.isBatchMode()&&e.iscan&&(e._fixed_size=!0);const a=e.selectDom().attr("id");return!e.isBatchMode()&&!e.use_openui&&!e.brlayout&&a&&(0,c.isStr)(a)&&(e.brlayout=new W.jX(a,null,e),e.brlayout.create(a,!0),e.setDom(e.brlayout.drawing_divid()),(0,I.d7)(e.brlayout)),e.createCanvasSvg(0),e.addPadButtons(!0),e.drawNextSnap(t.fPrimitives).then(()=>((0,c.isFunc)(e.onCanvasUpdated)&&e.onCanvasUpdated(e),e))}e.updateObject(t),e.iscan?e.createCanvasSvg(2):e.createPadSvg(!0);let i=!1,s=!1;for(let a=0;a<e.painters.length;++a){let r=e.painters[a];void 0!==r.snapid&&(t.fPrimitives.forEach(f=>{r&&f.fObjectID===r.snapid&&(r=null,i=!0)}),r&&(e.painters.splice(a--,1),r.cleanup(),s=!0,e.main_painter_ref===r&&delete e.main_painter_ref))}if(s&&delete e.pads_cache,!i){let a=e.getFramePainter();a?.is_root6()&&(a=null);for(let r=0;r<e.painters.length;++r)a!==e.painters[r]&&e.painters[r].cleanup();e.painters=[],delete e.main_painter_ref,a&&(e.painters.push(a),a.cleanFrameDrawings(),a.redraw()),(0,c.isFunc)(e.removePadButtons)&&e.removePadButtons(),e.addPadButtons(!0)}return e.drawNextSnap(t.fPrimitives).then(()=>(e.addPadInteractive(),(0,D.OZ)()===e&&e.getCanvPainter()?.producePadEvent("padredraw",e),(0,c.isFunc)(e.onCanvasUpdated)&&e.onCanvasUpdated(e),e))})()}createImage(t){var e=this;return(0,S.A)(function*(){return"png"===t||"jpeg"===t||"svg"===t||"webp"===t||"pdf"===t?e.produceImage(!0,t).then(i=>{if(!i||"svg"===t)return i;const s=i.indexOf("base64,");return s>0?i.slice(s+7):""}):""})()}itemContextMenu(t){const e=this.svg_this_pad().node().getBoundingClientRect(),i={clientX:e.left+10,clientY:e.top+10};if("pad"===t)return(0,c.postponePromise)(()=>this.padContextMenu(i),50);let a,s=null;switch(t){case"xaxis":case"yaxis":case"zaxis":s=this.getMainPainter(),a=t[0];break;case"frame":s=this.getFramePainter();break;default:{const r=parseInt(t);Number.isInteger(r)&&(s=this.painters[r])}}return(0,c.isFunc)(s?.fillContextMenu)?(0,n.ES)(i,s).then(r=>{(s.fillContextMenu(r,a)||s.snapid)&&s.fillObjectExecMenu(r,a).then(()=>(0,c.postponePromise)(()=>r.show(),50))}):void 0}saveAs(t,e,i){i||(i=(this.this_pad_name||(this.iscan?"canvas":"pad"))+"."+t),this.produceImage(e,t).then(s=>{if(!s)return console.error(`Fail to produce image ${i}`);if((c.browser.qt5||c.browser.qt6||c.browser.cef3)&&this.snapid){console.warn(`sending file ${i} to server`);let a=s;if("svg"!==t){const r=a.indexOf("base64,");a=r>0?a.slice(r+7):""}a&&this.getCanvPainter()?.sendWebsocket(`SAVE:${i}:${a}`)}else(0,I.OJ)(i,"svg"!==t?s:L.LI+encodeURIComponent(s))})}findActivePad(){return null}produceImage(t,e,i){var s=this;return(0,S.A)(function*(){const a="frame"===t,r=a?s.getFrameSvg(s.this_pad_name):t?s.getCanvSvg():s.svg_this_pad(),f=t&&!a?s.getCanvPainter():s,o=[];if(r.empty())return"";if(a||!t){const y=s.getCanvSvg().selectChild(".canvas_defs");y.empty()||(o.push({prnt:s.getCanvSvg(),defs:y}),r.node().insertBefore(y.node(),r.node().firstChild))}a||f.forEachPainterInPad(y=>{const C={prnt:y.svg_this_pad()};o.push(C);const k=y.getLayerSvg("btns_layer",s.this_pad_name);C.btns_node=k.node(),C.btns_node&&(C.btns_prnt=C.btns_node.parentNode,C.btns_next=C.btns_node.nextSibling,k.remove());const T=y.getFramePainter();if(!(0,c.isFunc)(T?.access3dKind))return;const H=T.access3dKind();if(H!==c.constants.Embed3D.Overlay&&H!==c.constants.Embed3D.Embed)return;let U,X;if((0,c.isFunc)(T.render3D)?(U=T,X=T.renderer?.domElement):(U=T.getMainPainter(),X=U?._renderer?.domElement),!(0,c.isFunc)(U?.render3D)||!(0,c.isObject)(X))return;const Y=T.getSizeFor3d(c.constants.Embed3D.Embed);U.render3D(0);const j=X.toDataURL("image/png");H===c.constants.Embed3D.Embed&&(C.foreign=C.prnt.select("."+Y.clname),C.foreign.remove());const V=U.getFrameSvg();C.frame_node=V.node(),C.frame_node&&(C.frame_next=C.frame_node.nextSibling,V.remove()),C.img=C.prnt.insert("image",".primitives_layer").attr("x",Y.x).attr("y",Y.y).attr("width",X.width).attr("height",X.height).attr("href",j)},"pads");let _=r.property("draw_width"),z=r.property("draw_height");if(a){const y=s.getFramePainter();_=y.getFrameWidth(),z=y.getFrameHeight()}const x="pdf"===e?{node:r.node(),width:_,height:z,reset_tranform:a}:(0,L.NM)(`<svg width="${_}" height="${z}" xmlns="${c.nsSVG}">${r.node().innerHTML}</svg>`);return(0,L.Vm)(x,e,i).then(y=>{for(let C=0;C<o.length;++C){const k=o[C];k.img?.remove();const T=k.prnt.selectChild(".primitives_layer");k.foreign&&k.prnt.node().insertBefore(k.foreign.node(),T.node()),k.frame_node&&T.node().insertBefore(k.frame_node,k.frame_next),k.btns_node&&k.btns_prnt.insertBefore(k.btns_node,k.btns_next),k.defs&&k.prnt.node().insertBefore(k.defs.node(),k.prnt.node().firstChild)}return y})})()}clickPadButton(t,e){if("CanvasSnapShot"===t)return this.saveAs("png",!0);if("enlargePad"===t)return this.enlargePad();if("PadSnapShot"===t)return this.saveAs("png",!1);if("PadContextMenus"===t)return e?.preventDefault(),e?.stopPropagation(),(0,n.IV)()?void 0:(0,n.ES)(e,this).then(a=>{a.header("Menus"),a.add(this.iscan?"Canvas":"Pad","pad",this.itemContextMenu),this.getFramePainter()&&a.add("Frame","frame",this.itemContextMenu);const r=this.getMainPainter();if(r&&(a.add("X axis","xaxis",this.itemContextMenu),a.add("Y axis","yaxis",this.itemContextMenu),(0,c.isFunc)(r.getDimension)&&r.getDimension()>1&&a.add("Z axis","zaxis",this.itemContextMenu)),this.painters?.length){a.separator();const f=[];this.painters.forEach((o,_)=>{const z=o?.getObject();if(!z||f.indexOf(z)>=0||o.isSecondary())return;let x=(0,c.isFunc)(o.getClassName)?o.getClassName():z._typename||"";x&&(x+="::"),x+=(0,c.isFunc)(o.getObjectName)?o.getObjectName():z.fName||`item${_}`,a.add(x,_,this.itemContextMenu),f.push(z)})}a.show()});let i=!1;const s=[];for(let a=0;a<this.painters.length;++a){const r=this.painters[a];(0,c.isFunc)(r.clickPadButton)&&s.push(r.clickPadButton(t,e)),!i&&(0,c.isFunc)(r.clickButton)&&(i=r.clickButton(t),(0,c.isPromise)(i)&&s.push(i))}return Promise.all(s)}addPadButton(t,e,i,s){if(c.settings.ToolBar&&!this.isBatchMode()){this._buttons||(this._buttons=[]);for(let r=0;r<this._buttons.length;++r)if(this._buttons[r].funcname===i)return;if(this._buttons.push({btn:t,tooltip:e,funcname:i,keyname:s}),!this.iscan&&this.has_canvas&&0!==i.indexOf("Pad")&&"enlargePad"!==i){const r=this.getCanvPainter();r&&r!==this&&r.addPadButton(t,e,i)}}}addPadButtons(t){this.addPadButton("camera","Create PNG",this.iscan?"CanvasSnapShot":"PadSnapShot","Ctrl PrintScreen"),c.settings.ContextMenu&&this.addPadButton("question","Access context menus","PadContextMenus"),(!this.iscan&&this.has_canvas&&this.hasObjectsToDraw()||this.enlargeMain("verify"))&&this.addPadButton("circle","Enlarge canvas","enlargePad"),t&&this.brlayout&&(this.addPadButton("diamand","Toggle Ged","ToggleGed"),this.addPadButton("three_circles","Toggle Status","ToggleStatus"))}showPadButtons(){this._buttons&&(m.DR.assign(this),this.showPadButtons())}getPadLength(t,e,i){let s,a;const r=t?-1:1,f=(x,y)=>x<e.fArr.length?e.fArr[x]:y,o=()=>(s||(s=i?i.getFrameRect():this.getPadRect()),s);if(i){const x=f(2),y=t?"gry":"grx";void 0!==x&&i[y]&&(a=i[y](x))}void 0===a&&(a=t?o().height:0);const _=f(0,0);return a+=r*f(1,0),_&&(a+=r*(t?o().height:o().width)*_),Math.round(a)}getCoordinate(t,e){return{x:this.getPadLength(!1,t.fHoriz,e),y:this.getPadLength(!0,t.fVert,e)}}decodeOptions(t){const e=this.getObject();if(!e)return;const i=new L.nC(t);this.options||(this.options={}),Object.assign(this.options,{GlobalColors:!0,LocalColors:!1,IgnorePalette:!1,RotateFrame:!1,FixFrame:!1}),(i.check("NOCOLORS")||i.check("NOCOL"))&&(this.options.GlobalColors=this.options.LocalColors=!1),(i.check("LCOLORS")||i.check("LCOL"))&&(this.options.GlobalColors=!1,this.options.LocalColors=!0),(i.check("NOPALETTE")||i.check("NOPAL"))&&(this.options.IgnorePalette=!0),i.check("ROTATE")&&(this.options.RotateFrame=!0),i.check("FIXFRAME")&&(this.options.FixFrame=!0),i.check("WHITE")&&(e.fFillColor=0),i.check("LOGX")&&(e.fLogx=1),i.check("LOGY")&&(e.fLogy=1),i.check("LOGZ")&&(e.fLogz=1),i.check("LOG")&&(e.fLogx=e.fLogy=e.fLogz=1),i.check("GRIDX")&&(e.fGridx=1),i.check("GRIDY")&&(e.fGridy=1),i.check("GRID")&&(e.fGridx=e.fGridy=1),i.check("TICKX")&&(e.fTickx=1),i.check("TICKY")&&(e.fTicky=1),i.check("TICK")&&(e.fTickx=e.fTicky=1)}static draw(t,e,i){return(0,S.A)(function*(){const s=new u(t,e,!1);return s.decodeOptions(i),s.getCanvSvg().empty()?(s.has_canvas=!1,s.this_pad_name="",s.setTopPainter()):s.addToPadPrimitives(),s.createPadSvg(),s.matchObjectType(c.clTPad)&&(!s.has_canvas||s.hasObjectsToDraw())&&s.addPadButtons(),(0,D.QD)({pp:s,active:!1}),s.drawPrimitives().then(()=>(s.addPadInteractive(),s.showPadButtons(),s))})()}}class w extends u{constructor(t,e){super(t,e,!0),this._websocket=null,this.tooltip_allowed=c.settings.Tooltip,this.v7canvas=!0,null===t&&null===e&&(c.settings.SmallPad.width=20,c.settings.SmallPad.height=10)}cleanup(){delete this._websocket,delete this._submreq,this._changed_layout&&this.setLayoutKind("simple"),delete this._changed_layout,super.cleanup()}getCanvasName(){const t=this.pad?.fTitle;return t&&(0,c.isStr)(t)?t.replace(/ /g,"_"):"rcanvas"}getLayoutKind(){const t=this.selectDom("origin");return(t.empty()?"":t.property("layout"))||"simple"}setLayoutKind(t,e){const i=this.selectDom("origin");i.empty()||(t||(t="simple"),i.property("layout",t),i.property("layout_selector","simple"!==t&&e?e:null),this._changed_layout="simple"!==t)}changeLayout(t,e){var i=this;return(0,S.A)(function*(){if(i.getLayoutKind()===t)return!0;const a=i.selectDom("origin"),r=a.select(".side_panel2"),f=[];let z,o=a.select(".side_panel"),_=i.selectDom();for(;_.node().firstChild;)f.push(_.node().removeChild(_.node().firstChild));if(o.empty()||(0,D.tP)(o.node()),r.empty()||(0,D.tP)(r.node()),i.setLayoutKind("simple"),a.html(""),"simple"===t){_=a;for(let x=0;x<f.length;++x)_.node().appendChild(f[x]);i.setLayoutKind(t),z=!0}else{const x=new W.ho(a.node(),t);void 0===e&&(e=0===t.indexOf("vert")?0:1),_=(0,B.Lt)(x.getGridFrame(e)),_.classed("central_panel",!0).style("position","relative"),2===e?(o=(0,B.Lt)(x.getGridFrame(0)),o.classed("side_panel2",!0).style("position","relative"),o=(0,B.Lt)(x.getGridFrame(3)),o.classed("side_panel",!0).style("position","relative")):(o=(0,B.Lt)(x.getGridFrame(1-e)),o.classed("side_panel",!0).style("position","relative"));for(let y=0;y<f.length;++y)_.node().appendChild(f[y]);i.setLayoutKind(t,".central_panel"),a.property("mdi",null)}return(0,D.XR)(_.node(),z),!0})()}toggleProjection(t){var e=this;return(0,S.A)(function*(){if(delete e.proj_painter,t&&(e.proj_painter={X:!1,Y:!1}),(0,c.isFunc)(e.showUI5ProjectionArea))return e.showUI5ProjectionArea(t);let s,i="simple";switch(t){case"XY":i="projxy",s=2;break;case"X":case"bottom":i="vert2_31",s=0;break;case"Y":case"left":i="horiz2_13",s=1;break;case"top":i="vert2_13",s=1;break;case"right":i="horiz2_31",s=0}return e.changeLayout(i,s)})()}drawProjection(){return(0,S.A)(function*(){return!1})()}drawInSidePanel(t,e,i){var s=this;return(0,S.A)(function*(){const a="projxy"===s.getLayoutKind()&&"Y"===i?".side_panel2":".side_panel",r=s.selectDom("origin").select(a);return r.empty()?null:s.drawObject(r.node(),t,e)})()}testUI5(){return this.use_openui??!1}showMessage(t){this.testUI5()||(0,I.Rh)(t,7e3)}saveCanvasAsFile(t){const e=t.indexOf(".");this.createImage(t.slice(e+1)).then(i=>this.sendWebsocket(`SAVE:${t}:${i}`))}sendSaveCommand(t){this.sendWebsocket("PRODUCE:"+t)}canSendWebSocket(){return this._websocket?.canSend()}sendWebsocket(t){return!!this._websocket?.canSend()&&(this._websocket.send(t),!0)}closeWebsocket(t){this._websocket&&(this._websocket.close(t),this._websocket.cleanup(),delete this._websocket)}useWebsocket(t){this.closeWebsocket(),this._websocket=t,this._websocket.setReceiver(this),this._websocket.connect()}websocketTimeout(t,e){if(!this._websocket)return;this._websocket._tmouts||(this._websocket._tmouts={});const i=this._websocket._tmouts[t];if(void 0===e)return void 0!==i;"reset"===e?i&&(clearTimeout(i),delete this._websocket._tmouts[t]):!i&&Number.isInteger(e)&&(this._websocket._tmouts[t]=setTimeout(()=>{delete this._websocket._tmouts[t]},e))}onWebsocketOpened(){}onWebsocketClosed(){this.embed_canvas||(0,I.W4)()}onWebsocketMsg(t,e){if("CLOSE"===e)this.onWebsocketClosed(),this.closeWebsocket(!0);else if("SNAP:"===e.slice(0,5)){const i=(e=e.slice(5)).indexOf(":"),s=e.slice(0,i),a=(0,c.parse)(e.slice(i+1));this.syncDraw(!0).then(()=>{!this.snapid&&a?.fWinSize&&this.resizeBrowser(a.fWinSize[0],a.fWinSize[1])}).then(()=>this.redrawPadSnap(a)).then(()=>{this.addPadInteractive(),t.send(`SNAPDONE:${s}`),this.confirmDraw()}).catch(r=>{(0,c.isFunc)(this.showConsoleError)?this.showConsoleError(r):console.log(r)})}else if("JSON"===e.slice(0,4)){const i=(0,c.parse)(e.slice(4));this.redrawObject(i)}else if("REPL_REQ:"===e.slice(0,9))this.processDrawableReply(e.slice(9));else if("CMD:"===e.slice(0,4)){const i=(e=e.slice(4)).indexOf(":"),s=e.slice(0,i),a=e.slice(i+1),r=`REPLY:${s}:`;if("SVG"===a||"PNG"===a||"JPEG"===a||"WEBP"===a||"PDF"===a)this.createImage(a.toLowerCase()).then(f=>t.send(r+f));else if(0===a.indexOf("ADDPANEL:"))if((0,c.isFunc)(this.showUI5Panel)){const f=a.slice(9),o=t.createNewInstance(f);o.setReceiver({cpainter:this,onWebsocketOpened(){},onWebsocketMsg(_,z){const x=0===z.indexOf("SHOWPANEL:")?z.slice(10):"";this.cpainter.showUI5Panel(x,_).then(y=>t.send(r+(y?"true":"false")))},onWebsocketClosed(){t.send(r+"false")},onWebsocketError(){t.send(r+"false")}}),o.connect()}else t.send(r+"false");else console.log("Unrecognized command "+a),t.send(r)}else if("DXPROJ:"===e.slice(0,7)||"DYPROJ:"===e.slice(0,7)){const i=e[1],s=(0,c.parse)(e.slice(7));this.drawProjection(i,s)}else if("SHOW:"===e.slice(0,5)){const i=e.slice(5),s="1"===i[i.length-1];this.showSection(i.slice(0,i.length-2),s)}else console.log(`unrecognized msg len: ${e.length} msg: ${e.slice(0,30)}`)}submitDrawableRequest(t,e,i,s){if(!(this._websocket&&e&&e._typename&&i.snapid&&(0,c.isStr)(i.snapid)))return null;if(t&&s){i._requests||(i._requests={});const r=i._requests[t];if(r){const f=(new Date).getTime();if(!r._tm||f-r._tm<5e3)return r._nextreq=e,!1;delete i._requests[t]}i._requests[t]=e}e.id=i.snapid,s?(this._nextreqid||(this._nextreqid=1),e.reqid=this._nextreqid++):e.reqid=0;const a=JSON.stringify(e);return e.reqid&&(e._kind=t,e._painter=i,e._method=s,e._tm=(new Date).getTime(),this._submreq||(this._submreq={}),this._submreq[e.reqid]=e),this.sendWebsocket("REQ:"+a),e}submitMenuRequest(t,e,i){var s=this;return(0,S.A)(function*(){return new Promise(a=>{s.submitDrawableRequest("",{_typename:`${c.nsREX}RDrawableMenuRequest`,menukind:e||"",menureqid:i},t,a)})})()}submitExec(t,e,i){if(this._websocket){if(i&&(0,c.isStr)(i)){const s=i.length;if(s>2&&i.indexOf("#x")===s-2?i="x":s>2&&i.indexOf("#y")===s-2?i="y":s>2&&i.indexOf("#z")===s-2&&(i="z"),"x"!==i&&"y"!==i&&"z"!==i)return console.log(`not recoginzed subelem ${i} in SubmitExec`);e=i+"axis#"+e}this.submitDrawableRequest("",{_typename:`${c.nsREX}RDrawableExecRequest`,exec:e},t)}}processDrawableReply(t){const e=(0,c.parse)(t);if(!e||!e.reqid||!this._submreq)return!1;const i=this._submreq[e.reqid];if(!i)return!1;delete this._submreq[e.reqid],i._kind&&i._painter?._requests&&i._painter._requests[i._kind]===i&&delete i._painter._requests[i._kind],i._method&&i._method(e,i),i._nextreq&&!i._painter._requests[i._kind]&&this.submitDrawableRequest(i._kind,i._nextreq,i._painter,i._method)}showSection(t,e){var i=this;return(0,S.A)(function*(){switch(t){case"Menu":case"StatusBar":case"Editor":case"ToolBar":break;case"ToolTips":i.setTooltipAllowed(e)}return!0})()}processChanges(t,e,i){if(this._websocket&&this._websocket.canSend(2)&&(0,c.isStr)(t))switch(e||(e=this),t){case"sbits":console.log("Status bits in RCanvas are changed - that to do?");break;case"frame":case"zoom":console.log("Frame moved or zoom is changed - that to do?");break;case"pave_moved":console.log("TPave is moved inside RCanvas - that to do?");break;default:"exec:"===t.slice(0,5)&&e?.snapid?this.submitExec(e,t.slice(5),i):console.log("UNPROCESSED CHANGES",t)}}clickPadButton(t,e){return"ToggleGed"===t?this.activateGed(this,null,"toggle"):"ToggleStatus"===t?this.activateStatusBar("toggle"):super.clickPadButton(t,e)}hasEventStatus(){if(this.testUI5())return!1;if(this.brlayout)return this.brlayout.hasStatus();const t=(0,W.gZ)();return!!t&&t.hasStatusLine()}canStatusBar(){return this.testUI5()||this.brlayout||(0,W.gZ)()}activateStatusBar(t){this.testUI5()||(this.brlayout?this.brlayout.createStatusLine(23,t):(0,W.gZ)()?.createStatusLine(23,t),this.processChanges("sbits",this))}showCanvasStatus(...t){this.testUI5()||(this.brlayout||(0,W.gZ)()?.brlayout)?.showStatus(...t)}hasGed(){return!this.testUI5()&&(this.brlayout?.hasContent()??!1)}removeGed(){this.testUI5()||(this.registerForPadEvents(null),this.ged_view&&(this.ged_view.getController().cleanupGed(),this.ged_view.destroy(),delete this.ged_view),this.brlayout?.deleteContent(!0),this.processChanges("sbits",this))}getUi5PanelData(){return{jsroot:{settings:c.settings,create:c.create,parse:c.parse,toJSON:c.toJSON,loadScript:c.loadScript,EAxisBits:D.rb,getColorExec:I.pp}}}activateGed(t,e,i){var s=this;return(0,S.A)(function*(){if(s.testUI5()||!s.brlayout)return!1;if(s.brlayout.hasContent())return"toggle"===i||!1===i?s.removeGed():t?.getPadPainter()?.selectObjectPainter(t),!0;if(!1===i)return!1;const a=s.brlayout.createBrowserBtns();return I.IK.createSVG(a,I.IK.diamand,15,"toggle fix-pos mode","browser").style("margin","3px").on("click",()=>s.brlayout.toggleKind("fix")),I.IK.createSVG(a,I.IK.circle,15,"toggle float mode","browser").style("margin","3px").on("click",()=>s.brlayout.toggleKind("float")),I.IK.createSVG(a,I.IK.cross,15,"delete GED","browser").style("margin","3px").on("click",()=>s.removeGed()),s.brlayout.setBrowserContent("<div class='jsroot_browser_hierarchy' id='ged_placeholder'>Loading GED ...</div>"),s.brlayout.setBrowserTitle("GED"),s.brlayout.toggleBrowserKind(e||"float"),new Promise(r=>{I.cA.then(f=>{(0,B.Lt)("#ged_placeholder").text(""),f.ui.require(["sap/ui/model/json/JSONModel","sap/ui/core/mvc/XMLView"],(o,_)=>{const z=new o({handle:null});_.create({viewName:"rootui5.canv.view.Ged",viewData:s.getUi5PanelData("Ged")}).then(x=>{x.setModel(z),x.placeAt("ged_placeholder"),s.ged_view=x,s.registerForPadEvents(x.getController().padEventsReceiver.bind(x.getController())),t?.getPadPainter()?.selectObjectPainter(t),s.processChanges("sbits",s),r(!0)})})})})})()}produceJSON(){return console.error("RCanvasPainter.produceJSON not yet implemented"),""}resizeBrowser(t,e){!t||!e||this.isBatchMode()||this.embed_canvas||this.batch_mode||this._websocket?.resizeWindow(t,e)}static draw(t,e){return(0,S.A)(function*(){const i=!e;i&&(e=(0,c.create)(`${c.nsREX}RCanvas`));const s=new w(t,e);return s.normal_canvas=!i,s.createCanvasSvg(0),(0,D.QD)({pp:s,active:!1}),s.drawPrimitives().then(()=>(s.addPadInteractive(),s.addPadButtons(),s.showPadButtons(),s))})()}}function P(g,t){const e=new w(g,null);return e.normal_canvas=!1,e.batch_mode=(0,c.isBatchMode)(),e.syncDraw(!0).then(()=>e.redrawPadSnap(t)).then(()=>(e.confirmDraw(),e.showPadButtons(),e))}function A(g,t){return O.apply(this,arguments)}function O(){return(O=(0,S.A)(function*(g,t){return g?(g.getCanvSvg().empty()?w.draw(g.getDom(),null):Promise.resolve(!0)).then(()=>{if(!1!==t&&g.getFrameSvg().selectChild(".main_layer").empty())return d.draw(g.getDom(),null,(0,c.isStr)(t)?t:"")}).then(()=>(g.addToPadPrimitives(),g)):Promise.reject(Error("Painter not provided in ensureRCanvas"))})).apply(this,arguments)}function F(g,t){const e=this.getFramePainter();if(!e)return console.log("no frame painter - no title");const i=e.getFrameRect(),s=i.x,a=i.y,r=i.width,f=this.getPadPainter().getPadHeight(),o=this.getObject(),_=r,z=this.v7EvalFont("text",{size:.07,color:"black",align:22});let x=this.v7EvalLength("margin",f,.02),y=this.v7EvalLength("height",f,.05);if("drag"===g){y=t.height,x=a-t.y-t.height;const C={};this.v7AttrChange(C,"margin",x/f),this.v7AttrChange(C,"height",y/f),this.v7SendAttrChanges(C,!1)}return this.createG(),(0,L.bk)(this.draw_g,s,Math.round(a-x-y)),this.startTextDrawingAsync(z,"font").then(()=>(this.drawText({x:_/2,y:y/2,text:o.fText,latex:1}),this.finishTextDrawing())).then(()=>{(0,l.WJ)(this,{x:s,y:Math.round(a-x-y),width:_,height:y,minwidth:20,minheight:20,no_change_x:!0,redraw:C=>this.redraw("drag",C)})})}function M(){const g=this.getObject(),t=this.getCanvSvg(),e="custom_font_"+g.fFamily+g.fWeight+g.fStyle;let i=t.selectChild(".canvas_defs");i.empty()&&(i=t.insert("svg:defs",":first-child").attr("class","canvas_defs"));let s=i.selectChild("."+e);if(s.empty()){s=i.append("style").attr("type","text/css").attr("class",e).text(`@font-face { font-family: "${g.fFamily}"; font-weight: ${g.fWeight?g.fWeight:"normal"}; font-style: ${g.fStyle?g.fStyle:"normal"}; src: ${g.fSrc}; }`);const a=g.fSrc.indexOf("base64,"),r=g.fSrc.lastIndexOf(" format(");if(a>0&&r>a){const f=g.fSrc.slice(a+7,r-2);g.fSrc.indexOf("data:application/font-ttf")>0&&s.property("$fontcfg",{n:g.fFamily,base64:f})}}return g.fDefault&&(this.getPadPainter()._dfltRFont=g),!0}function E(g,t,e){const i=new b.R(g,t,e);return i.disable_zooming=!0,A(i,!1).then(()=>i.redraw()).then(()=>i)}function $(g,t,e){const i=new d(g,t);return"3d"===e&&(i.mode3d=!0),A(i,!1).then(()=>i.redraw())}(0,c.registerMethods)(`${c.nsREX}RPalette`,{extractRColor:g=>(0,G.Nj)(g.fColor||"black"),getColor(g){return this.palette[g]},getContourIndex(g){const t=this.fContour;let s,e=0,i=t.length-1;if(g<t[0])return-1;if(g>=t[i])return i-1;if(this.fCustomContour){for(;e<i-1;)s=Math.round((e+i)/2),t[s]>g?i=s:e=s;return e}return Math.floor((g-t[0])/(t[i-1]-t[0])*(i-1))},getContourColor(g){const t=this.getContourIndex(g);return t<0?"":this.getColor(t)},getContour(){return this.fContour&&this.fContour.length>1?this.fContour:null},deleteContour(){delete this.fContour},calcColor(g,t,e){const i=e.fOrdinal-t.fOrdinal,s=e.fOrdinal-g,a=g-t.fOrdinal;if(!this.fInterpolate||i<=0)return(0,G.Nj)(s<a?e.fColor:t.fColor);const r=(0,B.Qh)(this.extractRColor(t.fColor)),f=(0,B.Qh)(this.extractRColor(e.fColor));return(0,B.Qh)(Math.round((r.r*s+f.r*a)/i),Math.round((r.g*s+f.g*a)/i),Math.round((r.b*s+f.b*a)/i)).formatRgb()},createPaletteColors(g){const t=[];let e=0;for(;t.length<g;){const i=t.length/(g-1),s=this.fColors[e];if(Math.abs(s.fOrdinal-i)<1e-4||e===this.fColors.length-1){t.push(this.extractRColor(s.fColor));continue}const a=this.fColors[e+1];a.fOrdinal<=i?e++:t.push(this.calcColor(i,s,a))}return t},getColorOrdinal(g){if(!this.fColors)return"black";"number"!=typeof g||g<0?g=0:g>1&&(g=1);let t,e=this.fColors[0];for(let i=0;i<this.fColors.length-1;++i){if(t=e,Math.abs(t.fOrdinal-g)<1e-4)return this.extractRColor(t.fColor);if(e=this.fColors[i+1],e.fOrdinal>g)return this.calcColor(g,t,e)}return this.extractRColor(e.fColor)},setFullRange(g,t){this.full_min=g,this.full_max=t},createContour(g,t,e,i,s){if(this.fContour=[],delete this.fCustomContour,this.colzmin=e,this.colzmax=i,g){this.colzmax<=0&&(this.colzmax=1),this.colzmin<=0&&(this.colzmin=void 0===s||s<=0?1e-4*this.colzmax:s<3||s>100?.3*s:1),this.colzmin>=this.colzmax&&(this.colzmin=1e-4*this.colzmax);const a=Math.log(this.colzmin)/Math.log(10),f=(Math.log(this.colzmax)/Math.log(10)-a)/t;this.fContour.push(this.colzmin);for(let o=1;o<t;o++)this.fContour.push(Math.exp((a+f*o)*Math.log(10)));this.fContour.push(this.colzmax),this.fCustomContour=!0}else{this.colzmin===this.colzmax&&0!==this.colzmin&&(this.colzmax+=.01*Math.abs(this.colzmax),this.colzmin-=.01*Math.abs(this.colzmin));const a=(this.colzmax-this.colzmin)/t;for(let r=0;r<=t;r++)this.fContour.push(this.colzmin+a*r)}(!this.palette||this.palette.length!==t)&&(this.palette=this.createPaletteColors(t))}})}}]);
//# sourceMappingURL=964.108b8f10603eb074.js.map